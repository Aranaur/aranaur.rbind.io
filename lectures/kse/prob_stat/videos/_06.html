<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="_06_files/libs/clipboard/clipboard.min.js"></script>
<script src="_06_files/libs/quarto-html/tabby.min.js"></script>
<script src="_06_files/libs/quarto-html/popper.min.js"></script>
<script src="_06_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="_06_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="_06_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="_06_files/libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Ihor Miroshnychenko">
  <title>Ratio-metrics and Linearization</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="_06_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="_06_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="_06_files/libs/revealjs/dist/theme/quarto-f3d08e28fe59b96701f0f66838ce6f8c.css">
  <link href="_06_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="_06_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="_06_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="_06_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="_06_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="_06_files/libs/revealjs/plugin/verticator/verticator.css" rel="stylesheet">
  <link href="_06_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Ratio-metrics and Linearization</h1>
  <p class="subtitle">Applied Statistics</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Ihor Miroshnychenko 
</div>
        <p class="quarto-title-affiliation">
            Kyiv School of Economics
          </p>
    </div>
</div>

</section>
<section>
<section id="independent-and-dependent-samples" class="title-slide slide level1 center">
<h1>Independent and dependent samples</h1>

</section>
<section id="task" class="slide level2">
<h2>Task</h2>
<blockquote>
<p>You are an analyst at OLX. Recently, a product manager approached you and requested to change the color of the “write a message” button in ads from <span class="blue">blue</span> to <span class="red">red</span>.</p>
</blockquote>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Question</strong></p>
</div>
<div class="callout-content">
<p>Will this increase the conversion rate for button clicks?</p>
</div>
</div>
</div>
</section>
<section id="data" class="slide level2">
<h2>Data</h2>
<p>Conversion rate is defined as the ratio of the number of users who started a chat conversation to the number of users who visited the ad page.</p>
<div id="eabcae9e" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display" data-execution_count="2">
<div id="yaucmclqmp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#yaucmclqmp table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#yaucmclqmp thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#yaucmclqmp p { margin: 0; padding: 0; }
 #yaucmclqmp .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #yaucmclqmp .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #yaucmclqmp .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #yaucmclqmp .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #yaucmclqmp .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #yaucmclqmp .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #yaucmclqmp .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #yaucmclqmp .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #yaucmclqmp .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #yaucmclqmp .gt_column_spanner_outer:first-child { padding-left: 0; }
 #yaucmclqmp .gt_column_spanner_outer:last-child { padding-right: 0; }
 #yaucmclqmp .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #yaucmclqmp .gt_spanner_row { border-bottom-style: hidden; }
 #yaucmclqmp .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #yaucmclqmp .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #yaucmclqmp .gt_from_md> :first-child { margin-top: 0; }
 #yaucmclqmp .gt_from_md> :last-child { margin-bottom: 0; }
 #yaucmclqmp .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #yaucmclqmp .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #yaucmclqmp .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #yaucmclqmp .gt_row_group_first td { border-top-width: 2px; }
 #yaucmclqmp .gt_row_group_first th { border-top-width: 2px; }
 #yaucmclqmp .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #yaucmclqmp .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #yaucmclqmp .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #yaucmclqmp .gt_left { text-align: left; }
 #yaucmclqmp .gt_center { text-align: center; }
 #yaucmclqmp .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #yaucmclqmp .gt_font_normal { font-weight: normal; }
 #yaucmclqmp .gt_font_bold { font-weight: bold; }
 #yaucmclqmp .gt_font_italic { font-style: italic; }
 #yaucmclqmp .gt_super { font-size: 65%; }
 #yaucmclqmp .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #yaucmclqmp .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead class="gt_header">
<tr class="header">
<th colspan="3" class="gt_heading gt_title gt_font_normal" data-quarto-table-cell-role="th">Conversion Rate Data</th>
</tr>
</thead>
<tbody>
<tr class="gt_col_headings odd">
<td id="User ID" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">User ID</td>
<td id="Visits the ad page" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Visits the ad page</td>
<td id="Start a chat conversation" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Start a chat conversation</td>
</tr>
</tbody>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left">1</td>
<td class="gt_row gt_right">5</td>
<td class="gt_row gt_right">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">2</td>
<td class="gt_row gt_right">4</td>
<td class="gt_row gt_right">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">3</td>
<td class="gt_row gt_right">0</td>
<td class="gt_row gt_right">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_left">4</td>
<td class="gt_row gt_right">6</td>
<td class="gt_row gt_right">4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">Total</td>
<td class="gt_row gt_right">15</td>
<td class="gt_row gt_right">10</td>
</tr>
</tbody>
</table>


</div>
        
</div>
</div>
<p><span class="math display">\[
\begin{align*}
\text{Conversion Rate} &amp;= \frac{\text{Number of Conversations}}{\text{Number of Visits}} \\
&amp;= \frac{10}{15} = \frac{2}{3} \approx 0.67
\end{align*}
\]</span></p>
</section>
<section id="split-the-data" class="slide level2">
<h2>Split the data</h2>
<p>For example: users 1 and 3 will be in the <strong>control group</strong>, and users 2 and 4 will be in the <strong>test group</strong>.</p>
<div id="06069ee6" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="3">
<div id="mikbbqrcwu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#mikbbqrcwu table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#mikbbqrcwu thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#mikbbqrcwu p { margin: 0; padding: 0; }
 #mikbbqrcwu .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #mikbbqrcwu .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #mikbbqrcwu .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #mikbbqrcwu .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #mikbbqrcwu .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #mikbbqrcwu .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #mikbbqrcwu .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #mikbbqrcwu .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #mikbbqrcwu .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #mikbbqrcwu .gt_column_spanner_outer:first-child { padding-left: 0; }
 #mikbbqrcwu .gt_column_spanner_outer:last-child { padding-right: 0; }
 #mikbbqrcwu .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #mikbbqrcwu .gt_spanner_row { border-bottom-style: hidden; }
 #mikbbqrcwu .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #mikbbqrcwu .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; }
 #mikbbqrcwu .gt_from_md> :first-child { margin-top: 0; }
 #mikbbqrcwu .gt_from_md> :last-child { margin-bottom: 0; }
 #mikbbqrcwu .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; }
 #mikbbqrcwu .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }
 #mikbbqrcwu .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #mikbbqrcwu .gt_row_group_first td { border-top-width: 2px; }
 #mikbbqrcwu .gt_row_group_first th { border-top-width: 2px; }
 #mikbbqrcwu .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }
 #mikbbqrcwu .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #mikbbqrcwu .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #mikbbqrcwu .gt_left { text-align: left; }
 #mikbbqrcwu .gt_center { text-align: center; }
 #mikbbqrcwu .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #mikbbqrcwu .gt_font_normal { font-weight: normal; }
 #mikbbqrcwu .gt_font_bold { font-weight: bold; }
 #mikbbqrcwu .gt_font_italic { font-style: italic; }
 #mikbbqrcwu .gt_super { font-size: 65%; }
 #mikbbqrcwu .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #mikbbqrcwu .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead class="gt_header">
<tr class="header">
<th colspan="3" class="gt_heading gt_title gt_font_normal" data-quarto-table-cell-role="th">Conversion Rate Data</th>
</tr>
</thead>
<tbody>
<tr class="gt_col_headings odd">
<td id="User ID" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">User ID</td>
<td id="Visits the ad page" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Visits the ad page</td>
<td id="Start a chat conversation" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Start a chat conversation</td>
</tr>
</tbody>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" style="background-color: lightblue">1</td>
<td class="gt_row gt_right" style="background-color: lightblue">5</td>
<td class="gt_row gt_right" style="background-color: lightblue">5</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" style="background-color: lightyellow">2</td>
<td class="gt_row gt_right" style="background-color: lightyellow">4</td>
<td class="gt_row gt_right" style="background-color: lightyellow">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" style="background-color: lightblue">3</td>
<td class="gt_row gt_right" style="background-color: lightblue">0</td>
<td class="gt_row gt_right" style="background-color: lightblue">0</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" style="background-color: lightyellow">4</td>
<td class="gt_row gt_right" style="background-color: lightyellow">6</td>
<td class="gt_row gt_right" style="background-color: lightyellow">4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left">Total</td>
<td class="gt_row gt_right">15</td>
<td class="gt_row gt_right">10</td>
</tr>
</tbody>
</table>


</div>
        
</div>
</div>
<p>Which test to use?</p>
</section>
<section id="t-test-visits-to-the-ad-page" class="slide level2 tiny">
<h2>T-test: visits to the ad page</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<svg width="960" height="480" viewbox="0.00 0.00 634.91 294.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none; display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 290)">
<title>ABTest</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-290 630.91,-290 630.91,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_test</title>
<path fill="none" stroke="black" d="M20,-8C20,-8 606.91,-8 606.91,-8 612.91,-8 618.91,-14 618.91,-20 618.91,-20 618.91,-127 618.91,-127 618.91,-133 612.91,-139 606.91,-139 606.91,-139 20,-139 20,-139 14,-139 8,-133 8,-127 8,-127 8,-20 8,-20 8,-14 14,-8 20,-8"></path>
<text text-anchor="middle" x="313.46" y="-122.4" font-family="Times,serif" font-size="14.00">Test</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_control</title>
<path fill="none" stroke="black" d="M20,-147C20,-147 516.91,-147 516.91,-147 522.91,-147 528.91,-153 528.91,-159 528.91,-159 528.91,-266 528.91,-266 528.91,-272 522.91,-278 516.91,-278 516.91,-278 20,-278 20,-278 14,-278 8,-272 8,-266 8,-266 8,-159 8,-159 8,-153 14,-147 20,-147"></path>
<text text-anchor="middle" x="268.46" y="-261.4" font-family="Times,serif" font-size="14.00">Control</text>
</g>
<!-- T2 -->
<g id="node1" class="node">
<title>T2</title>
<polygon fill="white" stroke="transparent" points="70.87,-106 16.04,-106 16.04,-70 70.87,-70 70.87,-106"></polygon>
<text text-anchor="middle" x="43.46" y="-83.8" font-family="Arial" font-size="14.00">user 2</text>
</g>
<!-- T2a -->
<g id="node2" class="node">
<title>T2a</title>
<polygon fill="white" stroke="black" points="160.91,-106 106.91,-106 106.91,-70 160.91,-70 160.91,-106"></polygon>
<text text-anchor="middle" x="133.91" y="-83.8" font-family="Arial" font-size="14.00">0</text>
</g>
<!-- T2&#45;&gt;T2a -->
<g id="edge1" class="edge">
<title>T2-&gt;T2a</title>
<path fill="none" stroke="black" d="M70.99,-88C79.03,-88 87.99,-88 96.55,-88"></path>
<polygon fill="black" stroke="black" points="96.69,-91.5 106.69,-88 96.69,-84.5 96.69,-91.5"></polygon>
</g>
<!-- T2b -->
<g id="node3" class="node">
<title>T2b</title>
<polygon fill="white" stroke="black" points="250.91,-106 196.91,-106 196.91,-70 250.91,-70 250.91,-106"></polygon>
<text text-anchor="middle" x="223.91" y="-83.8" font-family="Arial" font-size="14.00">0</text>
</g>
<!-- T2a&#45;&gt;T2b -->
<g id="edge2" class="edge">
<title>T2a-&gt;T2b</title>
<path fill="none" stroke="black" d="M161.31,-88C169.3,-88 178.22,-88 186.73,-88"></path>
<polygon fill="black" stroke="black" points="186.83,-91.5 196.83,-88 186.83,-84.5 186.83,-91.5"></polygon>
</g>
<!-- T2c -->
<g id="node4" class="node">
<title>T2c</title>
<polygon fill="white" stroke="black" points="340.91,-106 286.91,-106 286.91,-70 340.91,-70 340.91,-106"></polygon>
<text text-anchor="middle" x="313.91" y="-83.8" font-family="Arial" font-size="14.00">0</text>
</g>
<!-- T2b&#45;&gt;T2c -->
<g id="edge3" class="edge">
<title>T2b-&gt;T2c</title>
<path fill="none" stroke="black" d="M251.31,-88C259.3,-88 268.22,-88 276.73,-88"></path>
<polygon fill="black" stroke="black" points="276.83,-91.5 286.83,-88 276.83,-84.5 276.83,-91.5"></polygon>
</g>
<!-- T2d -->
<g id="node5" class="node">
<title>T2d</title>
<polygon fill="white" stroke="black" points="430.91,-106 376.91,-106 376.91,-70 430.91,-70 430.91,-106"></polygon>
<text text-anchor="middle" x="403.91" y="-83.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- T2c&#45;&gt;T2d -->
<g id="edge4" class="edge">
<title>T2c-&gt;T2d</title>
<path fill="none" stroke="black" d="M341.31,-88C349.3,-88 358.22,-88 366.73,-88"></path>
<polygon fill="black" stroke="black" points="366.83,-91.5 376.83,-88 366.83,-84.5 366.83,-91.5"></polygon>
</g>
<!-- T4 -->
<g id="node6" class="node">
<title>T4</title>
<polygon fill="white" stroke="transparent" points="70.87,-52 16.04,-52 16.04,-16 70.87,-16 70.87,-52"></polygon>
<text text-anchor="middle" x="43.46" y="-29.8" font-family="Arial" font-size="14.00">user 4</text>
</g>
<!-- T4a -->
<g id="node7" class="node">
<title>T4a</title>
<polygon fill="white" stroke="black" points="160.91,-52 106.91,-52 106.91,-16 160.91,-16 160.91,-52"></polygon>
<text text-anchor="middle" x="133.91" y="-29.8" font-family="Arial" font-size="14.00">0</text>
</g>
<!-- T4&#45;&gt;T4a -->
<g id="edge5" class="edge">
<title>T4-&gt;T4a</title>
<path fill="none" stroke="black" d="M70.99,-34C79.03,-34 87.99,-34 96.55,-34"></path>
<polygon fill="black" stroke="black" points="96.69,-37.5 106.69,-34 96.69,-30.5 96.69,-37.5"></polygon>
</g>
<!-- T4b -->
<g id="node8" class="node">
<title>T4b</title>
<polygon fill="white" stroke="black" points="250.91,-52 196.91,-52 196.91,-16 250.91,-16 250.91,-52"></polygon>
<text text-anchor="middle" x="223.91" y="-29.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- T4a&#45;&gt;T4b -->
<g id="edge6" class="edge">
<title>T4a-&gt;T4b</title>
<path fill="none" stroke="black" d="M161.31,-34C169.3,-34 178.22,-34 186.73,-34"></path>
<polygon fill="black" stroke="black" points="186.83,-37.5 196.83,-34 186.83,-30.5 186.83,-37.5"></polygon>
</g>
<!-- T4c -->
<g id="node9" class="node">
<title>T4c</title>
<polygon fill="white" stroke="black" points="340.91,-52 286.91,-52 286.91,-16 340.91,-16 340.91,-52"></polygon>
<text text-anchor="middle" x="313.91" y="-29.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- T4b&#45;&gt;T4c -->
<g id="edge7" class="edge">
<title>T4b-&gt;T4c</title>
<path fill="none" stroke="black" d="M251.31,-34C259.3,-34 268.22,-34 276.73,-34"></path>
<polygon fill="black" stroke="black" points="276.83,-37.5 286.83,-34 276.83,-30.5 276.83,-37.5"></polygon>
</g>
<!-- T4d -->
<g id="node10" class="node">
<title>T4d</title>
<polygon fill="white" stroke="black" points="430.91,-52 376.91,-52 376.91,-16 430.91,-16 430.91,-52"></polygon>
<text text-anchor="middle" x="403.91" y="-29.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- T4c&#45;&gt;T4d -->
<g id="edge8" class="edge">
<title>T4c-&gt;T4d</title>
<path fill="none" stroke="black" d="M341.31,-34C349.3,-34 358.22,-34 366.73,-34"></path>
<polygon fill="black" stroke="black" points="366.83,-37.5 376.83,-34 366.83,-30.5 366.83,-37.5"></polygon>
</g>
<!-- T4e -->
<g id="node11" class="node">
<title>T4e</title>
<polygon fill="white" stroke="black" points="520.91,-52 466.91,-52 466.91,-16 520.91,-16 520.91,-52"></polygon>
<text text-anchor="middle" x="493.91" y="-29.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- T4d&#45;&gt;T4e -->
<g id="edge9" class="edge">
<title>T4d-&gt;T4e</title>
<path fill="none" stroke="black" d="M431.31,-34C439.3,-34 448.22,-34 456.73,-34"></path>
<polygon fill="black" stroke="black" points="456.83,-37.5 466.83,-34 456.83,-30.5 456.83,-37.5"></polygon>
</g>
<!-- T4f -->
<g id="node12" class="node">
<title>T4f</title>
<polygon fill="white" stroke="black" points="610.91,-52 556.91,-52 556.91,-16 610.91,-16 610.91,-52"></polygon>
<text text-anchor="middle" x="583.91" y="-29.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- T4e&#45;&gt;T4f -->
<g id="edge10" class="edge">
<title>T4e-&gt;T4f</title>
<path fill="none" stroke="black" d="M521.31,-34C529.3,-34 538.22,-34 546.73,-34"></path>
<polygon fill="black" stroke="black" points="546.83,-37.5 556.83,-34 546.83,-30.5 546.83,-37.5"></polygon>
</g>
<!-- K1 -->
<g id="node13" class="node">
<title>K1</title>
<polygon fill="white" stroke="transparent" points="70.87,-245 16.04,-245 16.04,-209 70.87,-209 70.87,-245"></polygon>
<text text-anchor="middle" x="43.46" y="-222.8" font-family="Arial" font-size="14.00">user 1</text>
</g>
<!-- K1a -->
<g id="node14" class="node">
<title>K1a</title>
<polygon fill="white" stroke="black" points="160.91,-245 106.91,-245 106.91,-209 160.91,-209 160.91,-245"></polygon>
<text text-anchor="middle" x="133.91" y="-222.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- K1&#45;&gt;K1a -->
<g id="edge11" class="edge">
<title>K1-&gt;K1a</title>
<path fill="none" stroke="black" d="M70.99,-227C79.03,-227 87.99,-227 96.55,-227"></path>
<polygon fill="black" stroke="black" points="96.69,-230.5 106.69,-227 96.69,-223.5 96.69,-230.5"></polygon>
</g>
<!-- K1b -->
<g id="node15" class="node">
<title>K1b</title>
<polygon fill="white" stroke="black" points="250.91,-245 196.91,-245 196.91,-209 250.91,-209 250.91,-245"></polygon>
<text text-anchor="middle" x="223.91" y="-222.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- K1a&#45;&gt;K1b -->
<g id="edge12" class="edge">
<title>K1a-&gt;K1b</title>
<path fill="none" stroke="black" d="M161.31,-227C169.3,-227 178.22,-227 186.73,-227"></path>
<polygon fill="black" stroke="black" points="186.83,-230.5 196.83,-227 186.83,-223.5 186.83,-230.5"></polygon>
</g>
<!-- K1c -->
<g id="node16" class="node">
<title>K1c</title>
<polygon fill="white" stroke="black" points="340.91,-245 286.91,-245 286.91,-209 340.91,-209 340.91,-245"></polygon>
<text text-anchor="middle" x="313.91" y="-222.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- K1b&#45;&gt;K1c -->
<g id="edge13" class="edge">
<title>K1b-&gt;K1c</title>
<path fill="none" stroke="black" d="M251.31,-227C259.3,-227 268.22,-227 276.73,-227"></path>
<polygon fill="black" stroke="black" points="276.83,-230.5 286.83,-227 276.83,-223.5 276.83,-230.5"></polygon>
</g>
<!-- K1d -->
<g id="node17" class="node">
<title>K1d</title>
<polygon fill="white" stroke="black" points="430.91,-245 376.91,-245 376.91,-209 430.91,-209 430.91,-245"></polygon>
<text text-anchor="middle" x="403.91" y="-222.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- K1c&#45;&gt;K1d -->
<g id="edge14" class="edge">
<title>K1c-&gt;K1d</title>
<path fill="none" stroke="black" d="M341.31,-227C349.3,-227 358.22,-227 366.73,-227"></path>
<polygon fill="black" stroke="black" points="366.83,-230.5 376.83,-227 366.83,-223.5 366.83,-230.5"></polygon>
</g>
<!-- K1e -->
<g id="node18" class="node">
<title>K1e</title>
<polygon fill="white" stroke="black" points="520.91,-245 466.91,-245 466.91,-209 520.91,-209 520.91,-245"></polygon>
<text text-anchor="middle" x="493.91" y="-222.8" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- K1d&#45;&gt;K1e -->
<g id="edge15" class="edge">
<title>K1d-&gt;K1e</title>
<path fill="none" stroke="black" d="M431.31,-227C439.3,-227 448.22,-227 456.73,-227"></path>
<polygon fill="black" stroke="black" points="456.83,-230.5 466.83,-227 456.83,-223.5 456.83,-230.5"></polygon>
</g>
<!-- K3 -->
<g id="node19" class="node">
<title>K3</title>
<polygon fill="white" stroke="transparent" points="70.87,-191 16.04,-191 16.04,-155 70.87,-155 70.87,-191"></polygon>
<text text-anchor="middle" x="43.46" y="-168.8" font-family="Arial" font-size="14.00">user 3</text>
</g>
<!-- K3a -->
<g id="node20" class="node">
<title>K3a</title>
<polygon fill="white" stroke="black" points="160.91,-191 106.91,-191 106.91,-155 160.91,-155 160.91,-191"></polygon>
</g>
<!-- K3&#45;&gt;K3a -->
<g id="edge16" class="edge">
<title>K3-&gt;K3a</title>
<path fill="none" stroke="black" d="M70.99,-173C79.03,-173 87.99,-173 96.55,-173"></path>
<polygon fill="black" stroke="black" points="96.69,-176.5 106.69,-173 96.69,-169.5 96.69,-176.5"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>Let’s:</p>
<ul>
<li><span class="math inline">\(M_O^C,\ M_O^T\)</span> are random variables in the <em>test</em> and <em>control</em> groups, equal to 1 or 0.</li>
<li><span class="math inline">\(O\)</span> at the bottom means that the statistical unit of measurement is the number of announcements <em>opened</em> by the user.</li>
<li><span class="math inline">\(M\)</span> means whether correspondence has begun in the <em>messenger</em>.</li>
</ul>
</section>
<section id="t-test-visits-to-the-ad-page-1" class="slide level2">
<h2>T-test: visits to the ad page</h2>
<p>Hypothesis:</p>
<p><span class="math display">\[
H_0: \mathbb{E}\overline{M_O^C} = \mathbb{E} \overline{M_O^T}\ VS.\ H_1: \mathbb{E}\overline{M_O^C} &lt; \mathbb{E} \overline{M_O^T}
\]</span></p>
<div class="callout callout-caution no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>Can we use the t-test here?</p>
</div>
</div>
</div>
<div class="fragment">
<p>What if the entire <strong>difference between the groups</strong> is <strong>due to different users</strong> rather than the effect between the test and control groups?</p>
<p>For example, the <em>first user does not like to call and always writes in the chat</em>, while the others do not.</p>
</div>
</section>
<section id="t-test-visits-to-the-ad-page-2" class="slide level2 tiny">
<h2>T-test: visits to the ad page</h2>
<p>Monte Carlo simulation:</p>
<ul>
<li>Function to generate artificial user <span class="math inline">\(i\)</span>
<ul>
<li>In the first stage, we generate the <strong>number of ads the user clicked on the website</strong>. Let this number be <span class="math inline">\(O_i\)</span>, which we generate from a normal distribution for simplicity.</li>
<li>In the second stage, we generate the <strong>conversion</strong> <span class="math inline">\(p_i\)</span> of clicking on the “write message” button.</li>
<li>Thus, for each user, we will obtain a sample of size <span class="math inline">\(O_i\)</span> with conversion <span class="math inline">\(p_i\)</span>. To speed up the process, we will assume that the number of chats will be exactly <span class="math inline">\([O_i \cdot p_i]\)</span> (the integer part of <span class="math inline">\(O_i \cdot p_i\)</span>).</li>
</ul></li>
<li>In this case, users will be taken from a single distribution: there will be no difference between users in the test and control groups.</li>
</ul>
</section>
<section id="t-test-visits-to-the-ad-page-3" class="slide level2 tiny">
<h2>T-test: visits to the ad page</h2>
<ol type="1">
<li><code>O_array</code>: number of visits to the ad page by each user in the group, generated from a normal distribution.</li>
<li><code>p_array</code>: conversion rate for each user, generated from a uniform distribution.</li>
<li><code>sample_size</code>: total number of visits to the ad page in the group.</li>
<li><code>M_sum</code>: total number of chats started in the group, calculated as the sum of the products of <code>O_array</code> and <code>p_array</code>.</li>
<li>Return a sample consisting of <code>M_sum</code> ones (chats started) and the rest zeros (no chats started).</li>
</ol>
<ul>
<li><span class="math inline">\(N = 1000\)</span>: number of simulations</li>
<li><span class="math inline">\(\alpha = 0.05\)</span>: significance level</li>
<li><span class="math inline">\(n = 1000\)</span>: number of visits to the ad page in each group</li>
</ul>
<div id="generate_incorrect_group_sample" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_incorrect_group_sample(group_size, p<span class="op">=</span><span class="fl">0.3</span>):</span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-3"><a href="" aria-hidden="true" tabindex="-1"></a>    O_array <span class="op">=</span> norm(loc<span class="op">=</span><span class="dv">10</span>, scale<span class="op">=</span><span class="dv">1</span>).rvs(size<span class="op">=</span>group_size).astype(<span class="bu">int</span>)</span>
<span id="cb1-4"><a href="" aria-hidden="true" tabindex="-1"></a>    p_array <span class="op">=</span> uniform().rvs(size<span class="op">=</span>group_size)</span>
<span id="cb1-5"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-6"><a href="" aria-hidden="true" tabindex="-1"></a>    sample_size <span class="op">=</span> numpy.<span class="bu">sum</span>(O_array)</span>
<span id="cb1-7"><a href="" aria-hidden="true" tabindex="-1"></a>    M_sum <span class="op">=</span> numpy.<span class="bu">sum</span>((O_array <span class="op">*</span> p_array).astype(<span class="bu">int</span>))</span>
<span id="cb1-8"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="dv">1</span>] <span class="op">*</span> M_sum <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> (sample_size <span class="op">-</span> M_sum)</span>
<span id="cb1-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="" aria-hidden="true" tabindex="-1"></a>numpy.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-13"><a href="" aria-hidden="true" tabindex="-1"></a>mc_size <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb1-14"><a href="" aria-hidden="true" tabindex="-1"></a>bad_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-15"><a href="" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb1-16"><a href="" aria-hidden="true" tabindex="-1"></a>group_size <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb1-17"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(mc_size):</span>
<span id="cb1-19"><a href="" aria-hidden="true" tabindex="-1"></a>    test_sample <span class="op">=</span> generate_incorrect_group_sample(group_size)</span>
<span id="cb1-20"><a href="" aria-hidden="true" tabindex="-1"></a>    control_sample <span class="op">=</span> generate_incorrect_group_sample(group_size)</span>
<span id="cb1-21"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-22"><a href="" aria-hidden="true" tabindex="-1"></a>    pvalue <span class="op">=</span> ttest_ind(test_sample, control_sample, equal_var<span class="op">=</span><span class="va">True</span>, alternative<span class="op">=</span><span class="st">'two-sided'</span>).pvalue</span>
<span id="cb1-23"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="" aria-hidden="true" tabindex="-1"></a>    bad_cnt <span class="op">+=</span> (pvalue <span class="op">&lt;=</span> alpha)</span>
<span id="cb1-25"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FPR: </span><span class="sc">{</span><span class="bu">round</span>(bad_cnt <span class="op">/</span> mc_size, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-27"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"CI=</span><span class="sc">{</span>proportion_confint(count <span class="op">=</span> bad_cnt, nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>FPR: 0.263
CI=(0.23665685979107837, 0.2911570237310747)</code></pre>
</div>
</div>
<p>Why?</p>
<div class="fragment">
<p>The <strong>t-test</strong> assumes that the data is <strong>independent and identically distributed</strong> (i.i.d.), which is not true in this case.</p>
</div>
</section>
<section id="t-test-visits-to-the-ad-page-4" class="slide level2 smaller">
<h2>T-test: visits to the ad page</h2>
<ul>
<li><strong>One user</strong> was in the <strong>test</strong>, and one was in the <strong>control</strong>, each of whom clicked on the ad 10,000 times.</li>
<li>The first user’s conversion rate for writing in the chat is <strong>1</strong>, and the second’s is <strong>0</strong>, always. One is <strong>afraid of phone</strong> calls, and the other <strong>loves to talk</strong> on the phone, so they will never write in the chat.</li>
<li>Then we will have a <strong>conversion</strong> of <strong>1 in the test</strong> and <strong>0 in the control</strong>.</li>
<li>The <strong>t-test will reject</strong> everything: it will have two samples of size 10,000: one of ones, the other of zeros.</li>
<li>If we <strong>swapped</strong> the users, the <strong>opposite</strong> would happen: the control would be better than the test.</li>
</ul>
<div class="callout callout-note no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>The problem is that we only have two users, and the t-test is not applicable. So we “multiplied” them and obtained samples of size 10,000, and we are applying the t-test.</p>
</div>
</div>
</div>
</section>
<section id="baseline.-t-test-users" class="slide level2">
<h2>Baseline. T-test: users</h2>
<div class="callout callout-note no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>Not conversion from opening an ad to chat, but an increase in chats!</p>
</div>
</div>
</div>
<p>Hypothesis:</p>
<p><span class="math display">\[
H_1: \mathbb{E}\overline{M^C} &lt; \mathbb{E} \overline{M^T}
\]</span></p>
<p><span class="math inline">\(M^C,\ M^T\)</span> — average number of visits to the messenger by users in the test and control groups.</p>
<p>In this case, we look at the <strong>average user</strong> rather than the <strong>open advertisement</strong>, as in the previous case.</p>
<p>We also eliminate dependencies in selections: opening a chat by one user does not affect the opening of a chat by another user.</p>
</section>
<section id="baseline.-monte-carlo-simulation" class="slide level2">
<h2>Baseline. Monte Carlo simulation</h2>
<ol type="1">
<li><code>O_array</code>: number of visits to the ad page by each user in the group, generated from a normal distribution.</li>
<li><code>p_array</code>: conversion rate for each user, generated from a uniform distribution.</li>
<li><code>M_array</code>: number of chats started by each user, calculated as the product of <code>O_array</code> and <code>p_array</code>.</li>
<li>Return a sample consisting of <code>M_array</code>.</li>
</ol>
<div id="generate_incorrect_group_sample_1" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_group_sample(group_size):</span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-3"><a href="" aria-hidden="true" tabindex="-1"></a>    O_array <span class="op">=</span> norm(loc<span class="op">=</span><span class="dv">50</span>, scale<span class="op">=</span><span class="dv">5</span>).rvs(size<span class="op">=</span>group_size).astype(<span class="bu">int</span>)</span>
<span id="cb3-4"><a href="" aria-hidden="true" tabindex="-1"></a>    p_array <span class="op">=</span> uniform().rvs(size<span class="op">=</span>group_size)</span>
<span id="cb3-5"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-6"><a href="" aria-hidden="true" tabindex="-1"></a>    M_array <span class="op">=</span> (O_array <span class="op">*</span> p_array).astype(<span class="bu">int</span>)</span>
<span id="cb3-7"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-8"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb3-9"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"O_array"</span>: O_array,</span>
<span id="cb3-10"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"message_array"</span>: M_array</span>
<span id="cb3-11"><a href="" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-12"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="" aria-hidden="true" tabindex="-1"></a>numpy.random.seed(<span class="dv">42</span>)</span>
<span id="cb3-15"><a href="" aria-hidden="true" tabindex="-1"></a>mc_size <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb3-16"><a href="" aria-hidden="true" tabindex="-1"></a>bad_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-17"><a href="" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb3-18"><a href="" aria-hidden="true" tabindex="-1"></a>group_size <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb3-19"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(mc_size):</span>
<span id="cb3-21"><a href="" aria-hidden="true" tabindex="-1"></a>    test_sample <span class="op">=</span> generate_group_sample(group_size)</span>
<span id="cb3-22"><a href="" aria-hidden="true" tabindex="-1"></a>    control_sample <span class="op">=</span> generate_group_sample(group_size)</span>
<span id="cb3-23"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-24"><a href="" aria-hidden="true" tabindex="-1"></a>    pvalue <span class="op">=</span> ttest_ind(test_sample[<span class="st">'message_array'</span>], control_sample[<span class="st">'message_array'</span>],</span>
<span id="cb3-25"><a href="" aria-hidden="true" tabindex="-1"></a>                       equal_var<span class="op">=</span><span class="va">False</span>, alternative<span class="op">=</span><span class="st">'two-sided'</span>).pvalue</span>
<span id="cb3-26"><a href="" aria-hidden="true" tabindex="-1"></a>    bad_cnt <span class="op">+=</span> (pvalue <span class="op">&lt;=</span> alpha)</span>
<span id="cb3-27"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FPR: </span><span class="sc">{</span><span class="bu">round</span>(bad_cnt <span class="op">/</span> mc_size, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-29"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"CI=</span><span class="sc">{</span>proportion_confint(count <span class="op">=</span> bad_cnt, nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>FPR: 0.05
CI=(0.03813026239274881, 0.06531382024425081)</code></pre>
</div>
</div>
</section></section>
<section>
<section id="sensitivity-enhancement" class="title-slide slide level1 center">
<h1>Sensitivity enhancement</h1>

</section>
<section id="question-1" class="slide level2">
<h2>Question</h2>
<blockquote>
<p>What is the maximum number of chats any OLX user can have?</p>
</blockquote>
<div class="fragment">
<p>It’s unclear. But what if you know he only <strong>visited</strong> the page with <strong>one ad</strong>? Then you can easily answer the question: <strong>1 chat</strong>.</p>
<p>This means the <strong>number of chats</strong> may strongly <strong>correlate</strong> with <strong>user ad visits</strong>.</p>
<p>And we don’t want to lose this information: if we can use it, we can create a <strong>more powerful criterion</strong>!</p>
</div>
</section>
<section id="hypothesis" class="slide level2">
<h2>Hypothesis</h2>
<p>Let:</p>
<ul>
<li><span class="math inline">\(O^C,\ O^T\)</span> — the number of user ad views in the control and test groups.</li>
<li><span class="math inline">\(M^C,\ M^T\)</span> — the number of visits to the messenger by users in the test and control groups.</li>
</ul>
<p><span class="math display">\[
\begin{align}
&amp;H_0: \mathbb{E} \dfrac{\sum M^T}{\sum O^T} - \mathbb{E} \dfrac{\sum M^C}{\sum O^C} = 0\ vs.\ \\ &amp;H_1: \mathbb{E} \dfrac{\sum M^T}{\sum O^T} - \mathbb{E} \dfrac{\sum M^C}{\sum O^C} &gt; 0
\end{align}
\]</span></p>
</section>
<section id="confidence-interval" class="slide level2">
<h2>Confidence interval</h2>
<p>Ultimately, we are interested in calculating the statistics</p>
<p><span class="math display">\[
K = \dfrac{\sum M_T}{\sum O_T} - \dfrac{\sum M_C}{\sum O_C}
\]</span></p>
<p>and constructing a confidence interval for it. <strong>But how?</strong></p>
<div class="fragment">
<p><br></p>
<center>
<span class="red"><strong>Bootstrap!</strong></span>
</center>
</div>
</section>
<section id="bootstrap" class="slide level2">
<h2>Bootstrap</h2>
<div class="callout callout-important no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>In this case, it is essential to remember that in Bootstrap, you need to <strong>sample</strong> both the <strong>number of chats</strong> and <strong>the number of visits</strong> to the ad <strong>simultaneously</strong>, because they <em>depend on a single user</em>!</p>
</div>
</div>
</div>
<ol type="1">
<li><strong>Sample</strong> the number of chats and the number of visits to the ad page in the test and control groups.</li>
<li><strong>Calculate</strong> the statistic <span class="math inline">\(K\)</span> for the sample.</li>
<li><strong>Repeat</strong> steps 1-2 many times (e.g., 10000 times).</li>
</ol>
<div id="bootstrap_ratio" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ratio_bootstrap(message_array, message_control, n_test, n_control, alpha<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a>    theta_func <span class="op">=</span> <span class="kw">lambda</span> MT, MC, OT, OC: numpy.<span class="bu">sum</span>(MT, axis<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> numpy.<span class="bu">sum</span>(OT, axis<span class="op">=</span><span class="dv">1</span>) <span class="op">-</span> numpy.<span class="bu">sum</span>(MC, axis<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> numpy.<span class="bu">sum</span>(OC, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-3"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-4"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-5"><a href="" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb5-6"><a href="" aria-hidden="true" tabindex="-1"></a>    batch_size <span class="op">=</span> B <span class="op">//</span> <span class="dv">20</span></span>
<span id="cb5-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-9"><a href="" aria-hidden="true" tabindex="-1"></a>    theta_asterisk_array <span class="op">=</span> []</span>
<span id="cb5-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="" aria-hidden="true" tabindex="-1"></a>    test_size <span class="op">=</span> <span class="bu">len</span>(message_array)</span>
<span id="cb5-12"><a href="" aria-hidden="true" tabindex="-1"></a>    control_size <span class="op">=</span> <span class="bu">len</span>(message_control)</span>
<span id="cb5-13"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="" aria-hidden="true" tabindex="-1"></a>    test_inds_array <span class="op">=</span> numpy.arange(<span class="dv">0</span>, test_size)</span>
<span id="cb5-15"><a href="" aria-hidden="true" tabindex="-1"></a>    control_inds_array <span class="op">=</span> numpy.arange(<span class="dv">0</span>, control_size)</span>
<span id="cb5-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, B, batch_size):</span>
<span id="cb5-17"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-18"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_t_inds <span class="op">=</span> numpy.random.choice(test_inds_array, replace<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span>(batch_size, test_size))</span>
<span id="cb5-19"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_c_inds <span class="op">=</span> numpy.random.choice(control_inds_array, replace<span class="op">=</span><span class="va">True</span>, size<span class="op">=</span>(batch_size, control_size))</span>
<span id="cb5-20"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-21"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Wrong way to sample with replacement</span></span>
<span id="cb5-22"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># boot_MT = numpy.random.choice(message_array, replace=True, size=(batch_size, test_size))</span></span>
<span id="cb5-23"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># boot_MC = numpy.random.choice(message_control, replace=True, size=(batch_size, control_size))</span></span>
<span id="cb5-24"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># boot_OT = numpy.random.choice(n_test, replace=True, size=(batch_size, test_size))</span></span>
<span id="cb5-25"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># boot_OC = numpy.random.choice(n_control, replace=True, size=(batch_size, control_size))</span></span>
<span id="cb5-26"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_MT <span class="op">=</span> message_array[boot_t_inds]</span>
<span id="cb5-27"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_MC <span class="op">=</span> message_control[boot_c_inds]</span>
<span id="cb5-28"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_OT <span class="op">=</span> n_test[boot_t_inds]</span>
<span id="cb5-29"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_OC <span class="op">=</span> n_control[boot_c_inds]</span>
<span id="cb5-30"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-31"><a href="" aria-hidden="true" tabindex="-1"></a>        theta_asterisk <span class="op">=</span> theta_func(</span>
<span id="cb5-32"><a href="" aria-hidden="true" tabindex="-1"></a>            boot_MT, boot_MC, boot_OT, boot_OC</span>
<span id="cb5-33"><a href="" aria-hidden="true" tabindex="-1"></a>        ).ravel()</span>
<span id="cb5-34"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="bu">len</span>(theta_asterisk) <span class="op">==</span> batch_size</span>
<span id="cb5-35"><a href="" aria-hidden="true" tabindex="-1"></a>        theta_asterisk_array <span class="op">=</span> numpy.concatenate([theta_asterisk_array, theta_asterisk])</span>
<span id="cb5-36"><a href="" aria-hidden="true" tabindex="-1"></a>    left_theta_asterisk, right_theta_asterisk <span class="op">=</span> numpy.quantile(theta_asterisk_array, [alpha <span class="op">/</span> <span class="dv">2</span>, <span class="dv">1</span> <span class="op">-</span> alpha <span class="op">/</span> <span class="dv">2</span>])</span>
<span id="cb5-37"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-38"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-39"><a href="" aria-hidden="true" tabindex="-1"></a>    percentile_left_bound, percentile_right_bound <span class="op">=</span> left_theta_asterisk, right_theta_asterisk</span>
<span id="cb5-40"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> percentile_left_bound, percentile_right_bound</span>
<span id="cb5-41"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="" aria-hidden="true" tabindex="-1"></a>numpy.random.seed(<span class="dv">8</span>)</span>
<span id="cb5-44"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="" aria-hidden="true" tabindex="-1"></a>bad_cnt_correct_bootstrap <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-46"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(mc_size):</span>
<span id="cb5-48"><a href="" aria-hidden="true" tabindex="-1"></a>    test_sample <span class="op">=</span> generate_group_sample(group_size)</span>
<span id="cb5-49"><a href="" aria-hidden="true" tabindex="-1"></a>    control_sample <span class="op">=</span> generate_group_sample(group_size)</span>
<span id="cb5-50"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-52"><a href="" aria-hidden="true" tabindex="-1"></a>    left_bound_correct, right_bound_correct <span class="op">=</span> ratio_bootstrap(</span>
<span id="cb5-53"><a href="" aria-hidden="true" tabindex="-1"></a>        test_sample[<span class="st">'message_array'</span>], </span>
<span id="cb5-54"><a href="" aria-hidden="true" tabindex="-1"></a>        control_sample[<span class="st">'message_array'</span>], </span>
<span id="cb5-55"><a href="" aria-hidden="true" tabindex="-1"></a>        test_sample[<span class="st">'O_array'</span>], </span>
<span id="cb5-56"><a href="" aria-hidden="true" tabindex="-1"></a>        control_sample[<span class="st">'O_array'</span>]</span>
<span id="cb5-57"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-58"><a href="" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb5-59"><a href="" aria-hidden="true" tabindex="-1"></a>    bad_cnt_correct_bootstrap <span class="op">+=</span> ((left_bound_correct <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">|</span> (right_bound_correct <span class="op">&lt;</span> <span class="dv">0</span>))</span>
<span id="cb5-60"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="" aria-hidden="true" tabindex="-1"></a>corr_fpr <span class="op">=</span> <span class="bu">round</span>(bad_cnt_correct_bootstrap <span class="op">/</span> mc_size, <span class="dv">4</span>)</span>
<span id="cb5-62"><a href="" aria-hidden="true" tabindex="-1"></a>corr_left, corr_right <span class="op">=</span> proportion_confint(count <span class="op">=</span> bad_cnt_correct_bootstrap, </span>
<span id="cb5-63"><a href="" aria-hidden="true" tabindex="-1"></a>                                           nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)</span>
<span id="cb5-64"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FPR, correct bootstrap: </span><span class="sc">{</span><span class="bu">round</span>(corr_fpr, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">,"</span>\</span>
<span id="cb5-65"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f" [</span><span class="sc">{</span><span class="bu">round</span>(corr_left, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">round</span>(corr_right, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>FPR, correct bootstrap: 0.054, [0.0416, 0.0698]</code></pre>
</div>
</div>
</section>
<section id="t-test-vs-ratio-metrics-power" class="slide level2 smaller">
<h2>t-test vs ratio-metrics power</h2>
<p>To generate an AB test, we will slightly <strong>modify</strong> the user sample generation function: we will add the ability to change conversions in the test and control.</p>
<div id="generate_group_sample_2" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_group_sample_equal_cr(group_size, p<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a>    O_array <span class="op">=</span> norm(loc<span class="op">=</span><span class="dv">50</span>, scale<span class="op">=</span><span class="dv">5</span>).rvs(size<span class="op">=</span>group_size).astype(<span class="bu">int</span>)</span>
<span id="cb7-4"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-5"><a href="" aria-hidden="true" tabindex="-1"></a>    p_array <span class="op">=</span> norm(loc<span class="op">=</span>p, scale<span class="op">=</span>p <span class="op">/</span> <span class="dv">10</span>).rvs(group_size)</span>
<span id="cb7-6"><a href="" aria-hidden="true" tabindex="-1"></a>    p_array <span class="op">=</span> numpy.maximum(p_array, <span class="dv">0</span>)</span>
<span id="cb7-7"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="" aria-hidden="true" tabindex="-1"></a>    M_array <span class="op">=</span> (O_array <span class="op">*</span> p_array).astype(<span class="bu">int</span>)</span>
<span id="cb7-9"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-10"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb7-11"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"O_array"</span>: O_array,</span>
<span id="cb7-12"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"message_array"</span>: M_array</span>
<span id="cb7-13"><a href="" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-14"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="" aria-hidden="true" tabindex="-1"></a>numpy.random.seed(<span class="dv">8</span>)</span>
<span id="cb7-16"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="" aria-hidden="true" tabindex="-1"></a>power_ratio_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-18"><a href="" aria-hidden="true" tabindex="-1"></a>power_means_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-19"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(mc_size):</span>
<span id="cb7-21"><a href="" aria-hidden="true" tabindex="-1"></a>    test_sample <span class="op">=</span> generate_group_sample_equal_cr(group_size, p<span class="op">=</span><span class="fl">0.101</span>)</span>
<span id="cb7-22"><a href="" aria-hidden="true" tabindex="-1"></a>    control_sample <span class="op">=</span> generate_group_sample_equal_cr(group_size, p<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb7-23"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="" aria-hidden="true" tabindex="-1"></a>    left_bound_ratio, right_bound_ratio <span class="op">=</span> ratio_bootstrap(</span>
<span id="cb7-25"><a href="" aria-hidden="true" tabindex="-1"></a>        test_sample[<span class="st">'message_array'</span>], </span>
<span id="cb7-26"><a href="" aria-hidden="true" tabindex="-1"></a>        control_sample[<span class="st">'message_array'</span>], </span>
<span id="cb7-27"><a href="" aria-hidden="true" tabindex="-1"></a>        test_sample[<span class="st">'O_array'</span>], </span>
<span id="cb7-28"><a href="" aria-hidden="true" tabindex="-1"></a>        control_sample[<span class="st">'O_array'</span>]</span>
<span id="cb7-29"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-30"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-31"><a href="" aria-hidden="true" tabindex="-1"></a>    pvalue_means <span class="op">=</span> ttest_ind(test_sample[<span class="st">'message_array'</span>], control_sample[<span class="st">'message_array'</span>],</span>
<span id="cb7-32"><a href="" aria-hidden="true" tabindex="-1"></a>                       equal_var<span class="op">=</span><span class="va">False</span>, alternative<span class="op">=</span><span class="st">'two-sided'</span>).pvalue</span>
<span id="cb7-33"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb7-35"><a href="" aria-hidden="true" tabindex="-1"></a>    power_ratio_cnt <span class="op">+=</span> (left_bound_ratio <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb7-36"><a href="" aria-hidden="true" tabindex="-1"></a>    power_means_cnt <span class="op">+=</span> (pvalue_means <span class="op">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb7-37"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="" aria-hidden="true" tabindex="-1"></a>power_ratio <span class="op">=</span> <span class="bu">round</span>(power_ratio_cnt <span class="op">/</span> mc_size, <span class="dv">4</span>)</span>
<span id="cb7-40"><a href="" aria-hidden="true" tabindex="-1"></a>ratio_left, ratio_right <span class="op">=</span> proportion_confint(</span>
<span id="cb7-41"><a href="" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> power_ratio_cnt, nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)</span>
<span id="cb7-42"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"power, ratio: </span><span class="sc">{</span><span class="bu">round</span>(power_ratio, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">,"</span>\</span>
<span id="cb7-43"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f" [</span><span class="sc">{</span><span class="bu">round</span>(ratio_left, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">round</span>(ratio_right, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb7-44"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="" aria-hidden="true" tabindex="-1"></a>power_means <span class="op">=</span> <span class="bu">round</span>(power_means_cnt <span class="op">/</span> mc_size, <span class="dv">4</span>)</span>
<span id="cb7-47"><a href="" aria-hidden="true" tabindex="-1"></a>means_left, means_right <span class="op">=</span> proportion_confint(count <span class="op">=</span> power_means_cnt, </span>
<span id="cb7-48"><a href="" aria-hidden="true" tabindex="-1"></a>                                           nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)</span>
<span id="cb7-49"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"power, means: </span><span class="sc">{</span><span class="bu">round</span>(power_means, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">,"</span>\</span>
<span id="cb7-50"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f" [</span><span class="sc">{</span><span class="bu">round</span>(means_left, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">round</span>(means_right, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>power, ratio: 0.494, [0.4631, 0.525]
power, means: 0.328, [0.2996, 0.3577]</code></pre>
</div>
</div>
<ul>
<li>In the ratio metric we compare <span class="math inline">\(p^T\ vs.\ p^C\)</span> (since <span class="math inline">\(\dfrac{O \cdot p}{O} = p\)</span>).</li>
<li>In the t-test, we compare <span class="math inline">\(M^T\ vs.\ M^C\)</span>, or <span class="math inline">\({O^T \cdot p^T}\ vs.\ {O^C \cdot p^C}\)</span>, which is a noisier value due to the random variable O.</li>
</ul>
</section>
<section id="the-danger-of-using-ratio-metrics" class="slide level2 smaller">
<h2>The danger of using ratio metrics</h2>
<div class="callout callout-warning no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>The main problem with ratio metrics is that you <strong>add a denominator</strong> to your metric, which <strong>can also change</strong> based on your changes to the website.</p>
</div>
</div>
</div>
<p><span class="math inline">\(H_1: \mathbb{E} \dfrac{\sum M^T}{\sum O^T} - \mathbb{E} \dfrac{\sum M^C}{\sum O^C} &gt; 0\)</span> will be <strong>inconsistent</strong> with <span class="math inline">\(H_1: \mathbb{E} M^T -  \mathbb{E} M^C &gt; 0\)</span>.</p>
<p>Therefore, it is helpful to measure the change in the ratio metric and <strong>check the denominator using a t-test</strong>!</p>
<p>Therefore, your plan for working with ratio metrics is as follows:</p>
<ul>
<li>If you are sure you <strong>have not affected</strong> the <em>denominator</em>, <strong>check the change in the ratio metric</strong>.</li>
<li>If there is a chance that you <strong>may have affected the denominator</strong>, <em>check both</em> the ratio metric and the denominator.</li>
</ul>
</section></section>
<section>
<section id="linearization" class="title-slide slide level1 center">
<h1>Linearization</h1>

</section>
<section id="scaling-task" class="slide level2 smaller">
<h2>Scaling Task</h2>
<p>Let’s imagine you have joined a new company where AB testing is poorly organized: everyone does it however they want, making many mistakes in the process.</p>
<p>You decide to <strong>create a unified system for AB testing</strong> with the following features:</p>
<ul>
<li>It <strong>standardizes</strong> all AB tests in the company. This reduces the number of incorrectly created AB tests. If all analysts conducted AB tests, collected data, and applied criteria, any error in the code would lead to disastrous results.</li>
<li>It <strong>significantly reduces</strong> the time required to create and analyze AB tests, which is also very important for large companies.</li>
<li>It <strong>highlights</strong> which other experiments are running in the company, which helps to avoid conducting two conflicting tests.</li>
</ul>
<p>In this case, bootstrapping is not the best solution, as it is <strong>slow</strong> and <strong>requires a lot of memory</strong>.</p>
</section>
<section id="part-1.-taylor-series" class="slide level2 tiny">
<h2>Part 1. Taylor series</h2>
<p>Let’s recall what a <a href="https://en.wikipedia.org/wiki/Taylor_series">Taylor series</a> is and how it can be used to write any function:</p>
<p><span class="math inline">\(f(x) = \sum_{k=0}^{n}\dfrac{f^{(k)}(x_0)}{k!}(x - x_0)^k + o((x - x_0)^{n}), x \rightarrow x_0\)</span>.</p>
<p>If we expand the function only up to the first derivative, then:</p>
<p><span class="math inline">\(f(x) = f(x_0) + f'(x_0)(x-x_0) + o((x - x_0)) \approx f(x_0) + f'(x_0)(x-x_0), x \rightarrow x_0\)</span></p>
<p>And if you have a function of two variables, then:</p>
<p><span class="math inline">\(f(x, y) \approx f(\theta) + f'_x(\theta)(x-x_0) + f'_y(\theta)(y-y_0), (x, y) \rightarrow \theta, \theta := (x_0, y_0)\)</span>.</p>
<p>Now, let <span class="math inline">\(f(x, y) = \dfrac{x}{y}\)</span>. Then</p>
<p><span class="math display">\[\begin{align}
\dfrac{x}{y} &amp;\approx \dfrac{x_0}{y_0} + \left(\dfrac{1}{y_0}\right)(x - x_0) + \left(-\dfrac{x_0}{y^2_0}\right)(y-y_0) \\
&amp;= \dfrac{x_0}{y_0} + \dfrac{1}{y_0}\left(x - x_0 - \dfrac{x_0}{y_0}y + x_0\dfrac{y_0}{y_0}\right) \\
&amp;= \dfrac{x_0}{y_0} + \dfrac{1}{y_0}\left(x - \dfrac{x_0}{y_0}y \right)
\end{align}
\]</span></p>
<div class="footer">
<p><a href="https://www.youtube.com/watch?v=3d6DsjIBzJ4">3Blue1Brown: Taylor series</a></p>
</div>
</section>
<section id="part-2.-decomposition" class="slide level2 tiny">
<h2>Part 2. Decomposition</h2>
<p>Now let’s recall our ratio metric of interest: it is <span class="math inline">\(\dfrac{\sum_i^n {X_i}}{\sum_i^n {Y_i}}\)</span>, where all values for all users of the site are summed.</p>
<p>Let’s move from the sum to the average: <span class="math inline">\(\dfrac{\sum_i^n {X_i}}{\sum_i^n {Y_i}} = \dfrac{\overline{X}}{\overline{Y}}\)</span>.</p>
<p>What interesting fact do we know about the average? According to the <a href="https://en.wikipedia.org/wiki/Law_of_large_numbers">Law of Large Numbers</a>, we know that:</p>
<ul>
<li><span class="math inline">\(\overline{X} \stackrel{p}{\rightarrow} \mathbb{E} X\)</span>,</li>
<li><span class="math inline">\(\overline{Y} \stackrel{p}{\rightarrow} \mathbb{E} Y\)</span>,</li>
<li><span class="math inline">\((\overline{X}, \overline{Y}) \stackrel{p}{\rightarrow} (\mathbb{E} X, \mathbb{E} Y)\)</span></li>
</ul>
<p>Let’s then expand <span class="math inline">\(\dfrac{\overline{X}}{\overline{Y}}\)</span> using Taylor’s formula at the point <span class="math inline">\((\mathbb{E} X, \mathbb{E} Y)\)</span> with respect to the two variables <span class="math inline">\(\overline{X}, \overline{Y}\)</span>.</p>
<p><span class="math display">\[
    \dfrac{\overline{X}}{\overline{Y}} \approx \dfrac{\mathbb{E} X}{\mathbb{E} Y} + \dfrac{1}{\mathbb{E} Y}\left(\overline{X} - \dfrac{\mathbb{E} X}{\mathbb{E} Y}\overline{Y} \right)
\]</span></p>
</section>
<section id="part-3.-divide-the-result-by-n-users" class="slide level2 tiny">
<h2>Part 3. Divide the result by <span class="math inline">\(N\)</span> users</h2>
<p><span class="math display">\[\begin{align}
    \dfrac{\overline{X}}{\overline{Y}} &amp;\approx \dfrac{\mathbb{E} X}{\mathbb{E} Y} + \dfrac{1}{\mathbb{E} Y}\left(\overline{X} - \dfrac{\mathbb{E} X}{\mathbb{E} Y}\overline{Y} \right) \\
    &amp;=\dfrac{\mathbb{E} X}{\mathbb{E} Y} +  \dfrac{1}{\mathbb{E} Y} \cdot \dfrac{1}{N}\sum_{i}^N \left(X_i - \dfrac{\mathbb{E} X}{\mathbb{E} Y} Y_i \right) \\
    &amp;=  \dfrac{1}{N}\sum_{i}^N \left(\dfrac{\mathbb{E} X}{\mathbb{E} Y} + \dfrac{1}{\mathbb{E} Y}\left(X_i - \dfrac{\mathbb{E} X}{\mathbb{E} Y} Y_i \right) \right)
\end{align}
\]</span></p>
<p>Let us denote by <span class="math inline">\(Z'_i := \dfrac{\mathbb{E} X}{\mathbb{E} Y} + \dfrac{1}{\mathbb{E} Y}\left(X_i - \dfrac{\mathbb{E} X}{\mathbb{E} Y} Y_i \right)\)</span>.</p>
<p>Then</p>
<p><span class="math display">\[\begin{align}
    &amp;\dfrac{\overline{X}}{\overline{Y}} \approx \overline Z',\\
    &amp;\mathbb{E} \dfrac{\overline{X}}{\overline{Y}} \approx \mathbb{E} \overline Z'
\end{align}
\]</span></p>
<div class="callout callout-note no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>All <span class="math inline">\(Z'_i\)</span> are <strong>independent</strong> and <strong>identically distributed</strong> (i.i.d.) random variables, so we can use the <strong>t-test</strong> to check the hypothesis about the average value of <span class="math inline">\(Z'\)</span>. But we don’t knnow the value of <span class="math inline">\(\mathbb{E} X\)</span> and <span class="math inline">\(\mathbb{E} Y\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="part-4.-substitute-the-values" class="slide level2 tiny">
<h2>Part 4. Substitute the values</h2>
<p><span class="math display">\[
Z_i = \dfrac{\overline X}{\overline Y} + \dfrac{1}{\overline Y}\left(X_i - \dfrac{\overline X}{\overline Y} Y_i \right)
\]</span></p>
<p>Then we can write:</p>
<p><span class="math display">\[
(\overline{X}, \overline{Y}) \stackrel{p}{\rightarrow} (\mathbb{E} X, \mathbb{E} Y)
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\begin{align}
Z_i \stackrel{p}{\rightarrow} \dfrac{\mathbb{E} X}{\mathbb{E} Y} + \dfrac{1}{\mathbb{E} Y}\left(X_i - \dfrac{\mathbb{E} X}{\mathbb{E} Y} Y_i \right) = Z'_i
\end{align}
\]</span></p>
<div class="callout callout-none no-icon callout-style-simple">
<div class="callout-body">
<div class="callout-content">
<p>For large sample sizes, <span class="math inline">\(\mathbb{E} Z \approx \mathbb{E} Z'\)</span>. This means that <span class="math inline">\(\mathbb{E} Z \approx \mathbb{E} Z' \approx \mathbb{E} \dfrac{\overline{X}}{\overline{Y}}\)</span>.</p>
<p>By applying the t-test to sample <span class="math inline">\(Z\)</span>, we can compare <span class="math inline">\(\dfrac{\overline{X}}{\overline{Y}}\)</span></p>
</div>
</div>
</div>
</section>
<section id="linearization-vs-bootstrap-fpr" class="slide level2">
<h2>Linearization vs bootstrap: FPR</h2>
<div id="linearization" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> linearisation(numerator, denominator):</span>
<span id="cb9-2"><a href="" aria-hidden="true" tabindex="-1"></a>    E_num <span class="op">=</span> numpy.mean(numerator)</span>
<span id="cb9-3"><a href="" aria-hidden="true" tabindex="-1"></a>    E_den <span class="op">=</span> numpy.mean(denominator)</span>
<span id="cb9-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> E_num <span class="op">/</span> E_den <span class="op">+</span> <span class="dv">1</span> <span class="op">/</span> E_den <span class="op">*</span> (numerator <span class="op">-</span> E_num <span class="op">/</span> E_den <span class="op">*</span> denominator)</span>
<span id="cb9-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="" aria-hidden="true" tabindex="-1"></a>numpy.random.seed(<span class="dv">8</span>)</span>
<span id="cb9-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="" aria-hidden="true" tabindex="-1"></a>bad_cnt_linearisation <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-9"><a href="" aria-hidden="true" tabindex="-1"></a>bad_cnt_bootstrap <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(mc_size):</span>
<span id="cb9-12"><a href="" aria-hidden="true" tabindex="-1"></a>    test_sample <span class="op">=</span> generate_group_sample_equal_cr(group_size)</span>
<span id="cb9-13"><a href="" aria-hidden="true" tabindex="-1"></a>    control_sample <span class="op">=</span> generate_group_sample_equal_cr(group_size)</span>
<span id="cb9-14"><a href="" aria-hidden="true" tabindex="-1"></a>    test_Z <span class="op">=</span> linearisation(test_sample[<span class="st">'O_array'</span>], test_sample[<span class="st">'message_array'</span>])</span>
<span id="cb9-15"><a href="" aria-hidden="true" tabindex="-1"></a>    control_Z <span class="op">=</span> linearisation(control_sample[<span class="st">'O_array'</span>], control_sample[<span class="st">'message_array'</span>])</span>
<span id="cb9-16"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Запускаю критерий и строю доверительный интервал</span></span>
<span id="cb9-18"><a href="" aria-hidden="true" tabindex="-1"></a>    left_bound, right_bound <span class="op">=</span> ratio_bootstrap(</span>
<span id="cb9-19"><a href="" aria-hidden="true" tabindex="-1"></a>        test_sample[<span class="st">'O_array'</span>], </span>
<span id="cb9-20"><a href="" aria-hidden="true" tabindex="-1"></a>        control_sample[<span class="st">'O_array'</span>], </span>
<span id="cb9-21"><a href="" aria-hidden="true" tabindex="-1"></a>        test_sample[<span class="st">'message_array'</span>], </span>
<span id="cb9-22"><a href="" aria-hidden="true" tabindex="-1"></a>        control_sample[<span class="st">'message_array'</span>]</span>
<span id="cb9-23"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-24"><a href="" aria-hidden="true" tabindex="-1"></a>    pvalue_linearise <span class="op">=</span> ttest_ind(test_Z, control_Z, equal_var<span class="op">=</span><span class="va">False</span>, alternative<span class="op">=</span><span class="st">'two-sided'</span>).pvalue</span>
<span id="cb9-25"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-26"><a href="" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb9-27"><a href="" aria-hidden="true" tabindex="-1"></a>    bad_cnt_linearisation <span class="op">+=</span> (pvalue_linearise <span class="op">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb9-28"><a href="" aria-hidden="true" tabindex="-1"></a>    bad_cnt_bootstrap <span class="op">+=</span> ((left_bound <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">|</span> (right_bound <span class="op">&lt;</span> <span class="dv">0</span>))</span>
<span id="cb9-29"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="" aria-hidden="true" tabindex="-1"></a>bootstrap_fpr <span class="op">=</span> <span class="bu">round</span>(bad_cnt_bootstrap <span class="op">/</span> mc_size, <span class="dv">4</span>)</span>
<span id="cb9-32"><a href="" aria-hidden="true" tabindex="-1"></a>bootstrap_left, bootstrap_right <span class="op">=</span> proportion_confint(count <span class="op">=</span> bad_cnt_bootstrap, </span>
<span id="cb9-33"><a href="" aria-hidden="true" tabindex="-1"></a>                                               nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)</span>
<span id="cb9-34"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FPR, bootstrap: </span><span class="sc">{</span><span class="bu">round</span>(bootstrap_fpr, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">,"</span>\</span>
<span id="cb9-35"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f" [</span><span class="sc">{</span><span class="bu">round</span>(bootstrap_left, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">round</span>(bootstrap_right, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb9-36"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="" aria-hidden="true" tabindex="-1"></a>linearise_fpr <span class="op">=</span> <span class="bu">round</span>(bad_cnt_linearisation <span class="op">/</span> mc_size, <span class="dv">4</span>)</span>
<span id="cb9-38"><a href="" aria-hidden="true" tabindex="-1"></a>linearise_left, linearise_right <span class="op">=</span> proportion_confint(count <span class="op">=</span> bad_cnt_linearisation, </span>
<span id="cb9-39"><a href="" aria-hidden="true" tabindex="-1"></a>                                           nobs <span class="op">=</span> mc_size, alpha<span class="op">=</span><span class="fl">0.05</span>, method<span class="op">=</span><span class="st">'wilson'</span>)</span>
<span id="cb9-40"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FPR, linearisation: </span><span class="sc">{</span><span class="bu">round</span>(linearise_fpr, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">,"</span>\</span>
<span id="cb9-41"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f" [</span><span class="sc">{</span><span class="bu">round</span>(linearise_left, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">round</span>(linearise_right, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>FPR, bootstrap: 0.052, [0.0399, 0.0676]
FPR, linearisation: 0.049, [0.0373, 0.0642]</code></pre>
</div>
</div>
<p>So we can use the <strong>linearization</strong> method to <strong>calculate the ratio metric</strong> and <strong>apply the t-test</strong> to it.</p>
</section>
<section id="linearization-vs-bootstrap-time" class="slide level2">
<h2>Linearization vs bootstrap: time</h2>
<div id="linearization-time" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="" aria-hidden="true" tabindex="-1"></a>group_size <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb11-2"><a href="" aria-hidden="true" tabindex="-1"></a>test_sample <span class="op">=</span> generate_group_sample_equal_cr(group_size)</span>
<span id="cb11-3"><a href="" aria-hidden="true" tabindex="-1"></a>control_sample <span class="op">=</span> generate_group_sample_equal_cr(group_size)</span>
<span id="cb11-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb11-6"><a href="" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb11-7"><a href="" aria-hidden="true" tabindex="-1"></a>left_bound, right_bound <span class="op">=</span> ratio_bootstrap(</span>
<span id="cb11-8"><a href="" aria-hidden="true" tabindex="-1"></a>                                test_sample[<span class="st">'O_array'</span>], </span>
<span id="cb11-9"><a href="" aria-hidden="true" tabindex="-1"></a>                                control_sample[<span class="st">'O_array'</span>], </span>
<span id="cb11-10"><a href="" aria-hidden="true" tabindex="-1"></a>                                test_sample[<span class="st">'message_array'</span>], </span>
<span id="cb11-11"><a href="" aria-hidden="true" tabindex="-1"></a>                                control_sample[<span class="st">'message_array'</span>]</span>
<span id="cb11-12"><a href="" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb11-13"><a href="" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb11-14"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bootstrap time: </span><span class="sc">{</span><span class="bu">round</span>(end <span class="op">-</span> start, <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> seconds"</span>)</span>
<span id="cb11-15"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb11-17"><a href="" aria-hidden="true" tabindex="-1"></a>test_Z <span class="op">=</span> linearisation(test_sample[<span class="st">'O_array'</span>], test_sample[<span class="st">'message_array'</span>])</span>
<span id="cb11-18"><a href="" aria-hidden="true" tabindex="-1"></a>control_Z <span class="op">=</span> linearisation(control_sample[<span class="st">'O_array'</span>], control_sample[<span class="st">'message_array'</span>])</span>
<span id="cb11-19"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue_linearise <span class="op">=</span> ttest_ind(test_Z, control_Z, equal_var<span class="op">=</span><span class="va">False</span>, alternative<span class="op">=</span><span class="st">'two-sided'</span>).pvalue</span>
<span id="cb11-21"><a href="" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb11-22"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Linearisation time: </span><span class="sc">{</span><span class="bu">round</span>(end <span class="op">-</span> start, <span class="dv">2</span>)<span class="sc">}</span><span class="ss"> seconds"</span>)</span>
<span id="cb11-23"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"p-value: </span><span class="sc">{</span>pvalue_linearise<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-24"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pvalue_linearise <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb11-25"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Reject H0"</span>)</span>
<span id="cb11-26"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-27"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Do not reject H0"</span>)</span>
<span id="cb11-28"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Confidence interval: [</span><span class="sc">{</span>left_bound<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>right_bound<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap time: 0.31 seconds
Linearisation time: 0.0 seconds
p-value: 0.9368145845235889
Do not reject H0
Confidence interval: [-0.039138852630568086, 0.038235767330209953]</code></pre>
</div>
</div>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="img/kse.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Applied Statistics</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="_06_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="_06_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="_06_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="_06_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="_06_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="_06_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="_06_files/libs/revealjs/plugin/verticator/verticator.js"></script>
  <script src="_06_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="_06_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="_06_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="_06_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="_06_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'verticator': {"themetag":"h1","color":"","inversecolor":"","skipuncounted":false,"clickable":true,"position":"auto","offset":"3vmin","autogenerate":true,"tooltip":false,"scale":1},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h.v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: true,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1350,

        height: 759.375,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, Verticator, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>