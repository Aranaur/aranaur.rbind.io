<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src=".01_files/libs/clipboard/clipboard.min.js"></script>
<script src=".01_files/libs/quarto-html/tabby.min.js"></script>
<script src=".01_files/libs/quarto-html/popper.min.js"></script>
<script src=".01_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href=".01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href=".01_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href=".01_files/libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src=".01_files/libs/quarto-contrib/iconify-1.0.7/iconify-icon.min.js"></script><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Ігор Мірошниченко">
  <title>Not so big data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href=".01_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href=".01_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href=".01_files/libs/revealjs/dist/theme/quarto-26a030a05c7f22f9b9eae400ebcceb06.css">
  <link href=".01_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href=".01_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href=".01_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href=".01_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href=".01_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href=".01_files/libs/revealjs/plugin/verticator/verticator.css" rel="stylesheet">
  <link href=".01_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-iframe=".01_files/libs/colored-particles/index.html" class="quarto-title-block center">
  <h1 class="title">Not so big data</h1>
  <p class="subtitle">Моделі та методи обробки великих даних</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Ігор Мірошниченко 
</div>
        <p class="quarto-title-affiliation">
            КНУ імені Тараса Шевченка, ФІТ
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Зміст</h2>
<ul>
<li><a href="#/polars-vs.-pandas" id="/toc-polars-vs.-pandas">Polars vs.&nbsp;Pandas</a></li>
<li><a href="#/пайпи" id="/toc-пайпи">Пайпи</a></li>
<li><a href="#/продуктивність" id="/toc-продуктивність">Продуктивність</a></li>
<li><a href="#/охайні-дані" id="/toc-охайні-дані">Охайні дані</a></li>
</ul>
</nav>
</section>
<section>
<section id="polars-vs.-pandas" class="title-slide slide level1 center">
<h1>Polars vs.&nbsp;Pandas</h1>

</section>
<section id="benchmarking" class="slide level2">
<h2>Benchmarking</h2>
<div class="columns">
<div class="column">
<ul>
<li><a href="https://h2oai.github.io/db-benchmark/" data-preview-link="true">Benchmark</a> від H2O.ai</li>
</ul>
<p><img data-src="data/h20.png"></p>
</div><div class="column">
<ul>
<li><a href="https://duckdblabs.github.io/db-benchmark/" data-preview-link="true">Benchmark</a> від DuckDB Labs</li>
</ul>
<p><img data-src="data/duckdb.png"></p>
</div></div>
</section>
<section id="дані" class="slide level2 tiny">
<h2>Дані</h2>
<p>Спочатку ми отримаємо деякі дані про затримку рейсів.</p>
<div id="611a8a24" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zipfile <span class="im">import</span> ZipFile</span>
<span id="cb1-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> Path(<span class="st">"../data"</span>) <span class="co"># replace this with a directory of your choice</span></span>
<span id="cb1-6"><a href="" aria-hidden="true" tabindex="-1"></a>dest <span class="op">=</span> data_dir <span class="op">/</span> <span class="st">"flights.csv.zip"</span></span>
<span id="cb1-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> dest.exists():</span>
<span id="cb1-9"><a href="" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(</span>
<span id="cb1-10"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://transtats.bts.gov/PREZIP/On_Time_Reporting_Carrier_On_Time_Performance_1987_present_2022_1.zip"</span>,</span>
<span id="cb1-11"><a href="" aria-hidden="true" tabindex="-1"></a>        verify<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb1-12"><a href="" aria-hidden="true" tabindex="-1"></a>        stream<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-13"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-14"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="" aria-hidden="true" tabindex="-1"></a>    data_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> dest.<span class="bu">open</span>(<span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb1-17"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> chunk <span class="kw">in</span> r.iter_content(chunk_size<span class="op">=</span><span class="dv">102400</span>):</span>
<span id="cb1-18"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> chunk:</span>
<span id="cb1-19"><a href="" aria-hidden="true" tabindex="-1"></a>                f.write(chunk)</span>
<span id="cb1-20"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ZipFile(dest) <span class="im">as</span> zf:</span>
<span id="cb1-22"><a href="" aria-hidden="true" tabindex="-1"></a>        zf.extract(zf.filelist[<span class="dv">0</span>].filename, path<span class="op">=</span>data_dir)</span>
<span id="cb1-23"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="" aria-hidden="true" tabindex="-1"></a>extracted <span class="op">=</span> data_dir <span class="op">/</span> <span class="st">"On_Time_Reporting_Carrier_On_Time_Performance_(1987_present)_2022_1.csv"</span></span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="дані-з-google-drive" class="slide level2 tiny">
<h2>Дані з Google Drive</h2>
<div id="9935a94e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gdown</span>
<span id="cb2-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb2-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb2-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb2-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="" aria-hidden="true" tabindex="-1"></a>file_id <span class="op">=</span> <span class="st">"1UApDVdpgyeeZbJTvgCIjMjumGv_tWeQi"</span></span>
<span id="cb2-8"><a href="" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="ss">f"https://drive.google.com/uc?id=</span><span class="sc">{</span>file_id<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb2-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> gdown.download(url, quiet<span class="op">=</span><span class="va">True</span>, fuzzy<span class="op">=</span><span class="va">True</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Polars</a></li><li><a href="#tabset-1-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div id="ce8baaf7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a>pl.Config.set_tbl_rows(<span class="dv">5</span>)</span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb3-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(response, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb3-5"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pl <span class="op">=</span> pl.read_csv(f, truncate_ragged_lines<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-6"><a href="" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb3-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time taken: </span><span class="sc">{</span>end <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb3-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time taken: 0.17 seconds</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (537_902, 110)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Quarter</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">DayofMonth</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">FlightDate</th>
<th data-quarto-table-cell-role="th">Reporting_Airline</th>
<th data-quarto-table-cell-role="th">DOT_ID_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">IATA_CODE_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">Tail_Number</th>
<th data-quarto-table-cell-role="th">Flight_Number_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">OriginAirportID</th>
<th data-quarto-table-cell-role="th">OriginAirportSeqID</th>
<th data-quarto-table-cell-role="th">OriginCityMarketID</th>
<th data-quarto-table-cell-role="th">Origin</th>
<th data-quarto-table-cell-role="th">OriginCityName</th>
<th data-quarto-table-cell-role="th">OriginState</th>
<th data-quarto-table-cell-role="th">OriginStateFips</th>
<th data-quarto-table-cell-role="th">OriginStateName</th>
<th data-quarto-table-cell-role="th">OriginWac</th>
<th data-quarto-table-cell-role="th">DestAirportID</th>
<th data-quarto-table-cell-role="th">DestAirportSeqID</th>
<th data-quarto-table-cell-role="th">DestCityMarketID</th>
<th data-quarto-table-cell-role="th">Dest</th>
<th data-quarto-table-cell-role="th">DestCityName</th>
<th data-quarto-table-cell-role="th">DestState</th>
<th data-quarto-table-cell-role="th">DestStateFips</th>
<th data-quarto-table-cell-role="th">DestStateName</th>
<th data-quarto-table-cell-role="th">DestWac</th>
<th data-quarto-table-cell-role="th">CRSDepTime</th>
<th data-quarto-table-cell-role="th">DepTime</th>
<th data-quarto-table-cell-role="th">DepDelay</th>
<th data-quarto-table-cell-role="th">DepDelayMinutes</th>
<th data-quarto-table-cell-role="th">DepDel15</th>
<th data-quarto-table-cell-role="th">DepartureDelayGroups</th>
<th data-quarto-table-cell-role="th">DepTimeBlk</th>
<th data-quarto-table-cell-role="th">TaxiOut</th>
<th data-quarto-table-cell-role="th">…</th>
<th data-quarto-table-cell-role="th">Div1TotalGTime</th>
<th data-quarto-table-cell-role="th">Div1LongestGTime</th>
<th data-quarto-table-cell-role="th">Div1WheelsOff</th>
<th data-quarto-table-cell-role="th">Div1TailNum</th>
<th data-quarto-table-cell-role="th">Div2Airport</th>
<th data-quarto-table-cell-role="th">Div2AirportID</th>
<th data-quarto-table-cell-role="th">Div2AirportSeqID</th>
<th data-quarto-table-cell-role="th">Div2WheelsOn</th>
<th data-quarto-table-cell-role="th">Div2TotalGTime</th>
<th data-quarto-table-cell-role="th">Div2LongestGTime</th>
<th data-quarto-table-cell-role="th">Div2WheelsOff</th>
<th data-quarto-table-cell-role="th">Div2TailNum</th>
<th data-quarto-table-cell-role="th">Div3Airport</th>
<th data-quarto-table-cell-role="th">Div3AirportID</th>
<th data-quarto-table-cell-role="th">Div3AirportSeqID</th>
<th data-quarto-table-cell-role="th">Div3WheelsOn</th>
<th data-quarto-table-cell-role="th">Div3TotalGTime</th>
<th data-quarto-table-cell-role="th">Div3LongestGTime</th>
<th data-quarto-table-cell-role="th">Div3WheelsOff</th>
<th data-quarto-table-cell-role="th">Div3TailNum</th>
<th data-quarto-table-cell-role="th">Div4Airport</th>
<th data-quarto-table-cell-role="th">Div4AirportID</th>
<th data-quarto-table-cell-role="th">Div4AirportSeqID</th>
<th data-quarto-table-cell-role="th">Div4WheelsOn</th>
<th data-quarto-table-cell-role="th">Div4TotalGTime</th>
<th data-quarto-table-cell-role="th">Div4LongestGTime</th>
<th data-quarto-table-cell-role="th">Div4WheelsOff</th>
<th data-quarto-table-cell-role="th">Div4TailNum</th>
<th data-quarto-table-cell-role="th">Div5Airport</th>
<th data-quarto-table-cell-role="th">Div5AirportID</th>
<th data-quarto-table-cell-role="th">Div5AirportSeqID</th>
<th data-quarto-table-cell-role="th">Div5WheelsOn</th>
<th data-quarto-table-cell-role="th">Div5TotalGTime</th>
<th data-quarto-table-cell-role="th">Div5LongestGTime</th>
<th data-quarto-table-cell-role="th">Div5WheelsOff</th>
<th data-quarto-table-cell-role="th">Div5TailNum</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="even">
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
<th>…</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>5</td>
<td>"2022-01-14"</td>
<td>"YX"</td>
<td>20452</td>
<td>"YX"</td>
<td>"N119HQ"</td>
<td>4879</td>
<td>11066</td>
<td>1106606</td>
<td>31066</td>
<td>"CMH"</td>
<td>"Columbus, OH"</td>
<td>"OH"</td>
<td>39</td>
<td>"Ohio"</td>
<td>44</td>
<td>11278</td>
<td>1127805</td>
<td>30852</td>
<td>"DCA"</td>
<td>"Washington, DC"</td>
<td>"VA"</td>
<td>51</td>
<td>"Virginia"</td>
<td>38</td>
<td>1224</td>
<td>"1221"</td>
<td>-3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1</td>
<td>"1200-1259"</td>
<td>28.0</td>
<td>…</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>null</td>
</tr>
<tr class="even">
<td>2022</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>6</td>
<td>"2022-01-15"</td>
<td>"YX"</td>
<td>20452</td>
<td>"YX"</td>
<td>"N122HQ"</td>
<td>4879</td>
<td>11066</td>
<td>1106606</td>
<td>31066</td>
<td>"CMH"</td>
<td>"Columbus, OH"</td>
<td>"OH"</td>
<td>39</td>
<td>"Ohio"</td>
<td>44</td>
<td>11278</td>
<td>1127805</td>
<td>30852</td>
<td>"DCA"</td>
<td>"Washington, DC"</td>
<td>"VA"</td>
<td>51</td>
<td>"Virginia"</td>
<td>38</td>
<td>1224</td>
<td>"1214"</td>
<td>-10.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1</td>
<td>"1200-1259"</td>
<td>19.0</td>
<td>…</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>null</td>
</tr>
<tr class="odd">
<td>2022</td>
<td>1</td>
<td>1</td>
<td>16</td>
<td>7</td>
<td>"2022-01-16"</td>
<td>"YX"</td>
<td>20452</td>
<td>"YX"</td>
<td>"N412YX"</td>
<td>4879</td>
<td>11066</td>
<td>1106606</td>
<td>31066</td>
<td>"CMH"</td>
<td>"Columbus, OH"</td>
<td>"OH"</td>
<td>39</td>
<td>"Ohio"</td>
<td>44</td>
<td>11278</td>
<td>1127805</td>
<td>30852</td>
<td>"DCA"</td>
<td>"Washington, DC"</td>
<td>"VA"</td>
<td>51</td>
<td>"Virginia"</td>
<td>38</td>
<td>1224</td>
<td>"1218"</td>
<td>-6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1</td>
<td>"1200-1259"</td>
<td>16.0</td>
<td>…</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>null</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2022</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>4</td>
<td>"2022-01-06"</td>
<td>"DL"</td>
<td>19790</td>
<td>"DL"</td>
<td>"N989AT"</td>
<td>1579</td>
<td>11057</td>
<td>1105703</td>
<td>31057</td>
<td>"CLT"</td>
<td>"Charlotte, NC"</td>
<td>"NC"</td>
<td>37</td>
<td>"North Carolina"</td>
<td>36</td>
<td>10397</td>
<td>1039707</td>
<td>30397</td>
<td>"ATL"</td>
<td>"Atlanta, GA"</td>
<td>"GA"</td>
<td>13</td>
<td>"Georgia"</td>
<td>34</td>
<td>1258</td>
<td>"1257"</td>
<td>-1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1</td>
<td>"1200-1259"</td>
<td>15.0</td>
<td>…</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>null</td>
</tr>
<tr class="even">
<td>2022</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>4</td>
<td>"2022-01-06"</td>
<td>"DL"</td>
<td>19790</td>
<td>"DL"</td>
<td>"N815DN"</td>
<td>1580</td>
<td>14869</td>
<td>1486903</td>
<td>34614</td>
<td>"SLC"</td>
<td>"Salt Lake City, UT"</td>
<td>"UT"</td>
<td>49</td>
<td>"Utah"</td>
<td>87</td>
<td>14057</td>
<td>1405702</td>
<td>34057</td>
<td>"PDX"</td>
<td>"Portland, OR"</td>
<td>"OR"</td>
<td>41</td>
<td>"Oregon"</td>
<td>92</td>
<td>2240</td>
<td>"2231"</td>
<td>-9.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-1</td>
<td>"2200-2259"</td>
<td>10.0</td>
<td>…</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>null</td>
<td>null</td>
<td>""</td>
<td>""</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-1-2">
<div id="99ed426e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_rows <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb5-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(response, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb5-5"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pd <span class="op">=</span> pd.read_csv(f, on_bad_lines<span class="op">=</span><span class="st">'skip'</span>)</span>
<span id="cb5-6"><a href="" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb5-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time taken: </span><span class="sc">{</span>end <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb5-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="" aria-hidden="true" tabindex="-1"></a>df_pd</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time taken: 1.93 seconds</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Quarter</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">DayofMonth</th>
<th data-quarto-table-cell-role="th">DayOfWeek</th>
<th data-quarto-table-cell-role="th">FlightDate</th>
<th data-quarto-table-cell-role="th">Reporting_Airline</th>
<th data-quarto-table-cell-role="th">DOT_ID_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">IATA_CODE_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">Tail_Number</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Div4TailNum</th>
<th data-quarto-table-cell-role="th">Div5Airport</th>
<th data-quarto-table-cell-role="th">Div5AirportID</th>
<th data-quarto-table-cell-role="th">Div5AirportSeqID</th>
<th data-quarto-table-cell-role="th">Div5WheelsOn</th>
<th data-quarto-table-cell-role="th">Div5TotalGTime</th>
<th data-quarto-table-cell-role="th">Div5LongestGTime</th>
<th data-quarto-table-cell-role="th">Div5WheelsOff</th>
<th data-quarto-table-cell-role="th">Div5TailNum</th>
<th data-quarto-table-cell-role="th">Unnamed: 109</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2022</td>
<td>1</td>
<td>1</td>
<td>14</td>
<td>5</td>
<td>2022-01-14</td>
<td>YX</td>
<td>20452</td>
<td>YX</td>
<td>N119HQ</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2022</td>
<td>1</td>
<td>1</td>
<td>15</td>
<td>6</td>
<td>2022-01-15</td>
<td>YX</td>
<td>20452</td>
<td>YX</td>
<td>N122HQ</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">537900</td>
<td>2022</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>4</td>
<td>2022-01-06</td>
<td>DL</td>
<td>19790</td>
<td>DL</td>
<td>N989AT</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">537901</td>
<td>2022</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>4</td>
<td>2022-01-06</td>
<td>DL</td>
<td>19790</td>
<td>DL</td>
<td>N815DN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>537902 rows × 110 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="рядки-за-номером-стовпці-за-назвою" class="slide level2">
<h2>Рядки за номером, стовпці за назвою</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Polars (recommended)</a></li><li><a href="#tabset-2-2">Polars (square bracket)</a></li><li><a href="#tabset-2-3">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<p>Using <code>head</code> and <code>tail</code>:</p>
<div id="66811d43" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl.select([<span class="st">"Dest"</span>, <span class="st">"Tail_Number"</span>]).head(<span class="dv">16</span>).tail(<span class="dv">4</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19.7 µs ± 686 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)</code></pre>
</div>
</div>
<p>Or using <code>gather</code>:</p>
<div id="ad7d2ae2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb9-2"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl.select(pl.col([<span class="st">"Dest"</span>, <span class="st">"Tail_Number"</span>]).gather(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">12</span>, <span class="dv">16</span>))))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>94.1 µs ± 13 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2">
<div id="43563d84" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb11-2"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl[<span class="dv">12</span>:<span class="dv">16</span>, [<span class="st">"Dest"</span>, <span class="st">"Tail_Number"</span>]]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9.69 µs ± 857 ns per loop (mean ± std. dev. of 7 runs, 100,000 loops each)</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3">
<div id="250ac3a5" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb13-2"><a href="" aria-hidden="true" tabindex="-1"></a>df_pd.loc[<span class="dv">12</span>:<span class="dv">15</span>, [<span class="st">"Dest"</span>, <span class="st">"Tail_Number"</span>]]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>370 µs ± 16.2 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="рядки-за-індексом-рядка-стовпці-за-назвою" class="slide level2">
<h2>Рядки за індексом рядка, стовпці за назвою</h2>
<p>Оскільки в Polars немає такого поняття як індекс, ми просто використовуємо <code>.filter</code>:</p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Polars</a></li><li><a href="#tabset-3-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div id="6a7e8d71" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb15-2"><a href="" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-3"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pl</span>
<span id="cb15-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"IATA_CODE_Reporting_Airline"</span>).is_in([<span class="st">'AA'</span>, <span class="st">'DL'</span>]))</span>
<span id="cb15-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .select([<span class="st">"IATA_CODE_Reporting_Airline"</span>, <span class="st">"Dest"</span>, <span class="st">"Tail_Number"</span>])</span>
<span id="cb15-6"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>25.5 ms ± 846 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2">
<div id="70e712c7" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb17-2"><a href="" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-3"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pd</span>
<span id="cb17-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"IATA_CODE_Reporting_Airline"</span>)</span>
<span id="cb17-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .loc[[<span class="st">'AA'</span>, <span class="st">'DL'</span>], [<span class="st">"Dest"</span>, <span class="st">"Tail_Number"</span>]]</span>
<span id="cb17-6"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>227 ms ± 14 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="рядки-за-номерами-стовпці-за-номерами" class="slide level2">
<h2>Рядки за номерами, стовпці за номерами</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Polars</a></li><li><a href="#tabset-4-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div id="6d33220a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">0</span>, <span class="dv">1</span>]]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Quarter</th>
</tr>
<tr class="even">
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022</td>
<td>1</td>
</tr>
<tr class="even">
<td>2022</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2022</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div id="e0fd27bd" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="" aria-hidden="true" tabindex="-1"></a>df_pd.iloc[[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>], [<span class="dv">0</span>, <span class="dv">1</span>]]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Quarter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2022</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2022</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>2022</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="пайпи" class="title-slide slide level1 center">
<h1>Пайпи</h1>

</section>
<section id="пайпи-1" class="slide level2">
<h2>Пайпи</h2>
<ul>
<li><code>thing.min().abs().str()</code> замість <code>str(abs(min(thing)))</code></li>
<li>методи <code>assign</code> та <code>pipe</code></li>
</ul>
</section>
<section id="отримати-назви-міст" class="slide level2 tiny">
<h2>Отримати назви міст</h2>
<p>У наборі даних є два стовпці, які мають вигляд <code>$city, $state</code>. Давайте визначимо функцію, яка видаляє частину зі значенням штату з цих стовпців.</p>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Polars</a></li><li><a href="#tabset-5-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div id="c9f4121a" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_city_name_pl() <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb21-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    Chicago, IL -&gt; Chicago for OriginCityName and DestCityName</span></span>
<span id="cb21-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-5"><a href="" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">"OriginCityName"</span>, <span class="st">"DestCityName"</span>]</span>
<span id="cb21-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pl.col(cols).<span class="bu">str</span>.split(<span class="st">","</span>).<span class="bu">list</span>.get(<span class="dv">0</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2">
<div id="5f67dbac" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_city_name_pd(df: pd.DataFrame) <span class="op">-&gt;</span> pl.DataFrame:</span>
<span id="cb22-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    Chicago, IL -&gt; Chicago for OriginCityName and DestCityName</span></span>
<span id="cb22-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-5"><a href="" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">"OriginCityName"</span>, <span class="st">"DestCityName"</span>]</span>
<span id="cb22-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.assign(<span class="op">**</span>{col: df[col].<span class="bu">str</span>.split(<span class="st">","</span>, regex<span class="op">=</span><span class="va">False</span>).<span class="bu">str</span>[<span class="dv">0</span>] <span class="cf">for</span> col <span class="kw">in</span> cols})</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="отримати-назви-міст-1" class="slide level2 tiny">
<h2>Отримати назви міст</h2>
<p>Кілька пунктів, на які слід звернути увагу:</p>
<ol type="1">
<li><p>Наша функція Pandas додає стовпці до фрейму даних, тоді як наша функція Polars просто генерує <em>вираз</em>. Ви побачите, що часто простіше передавати <code>Expr</code>, ніж фрейми даних, тому що</p>
<ol type="i">
<li>Вони працюють як з <code>DataFrame</code>, так і з <code>LazyFrame</code>, і вони не прив’язані до конкретних даних.</li>
<li>Polars працює краще, якщо ви поміщаєте все в один виклик <code>.select</code> або <code>.with_columns</code>, а не викликаєте <code>.select</code> кілька разів. Якщо ви передаєте вирази, то цей патерн стає простим.</li>
</ol></li>
<li><p>Polars є швидким і зручним для виконання одних і тих же дій з декількома стовпчиками. Ми можемо передати список стовпців в <code>pl.col</code> а потім викликати метод на цьому <code>pl.col</code> так, ніби це один стовпець. Коли вираз буде виконано, його буде розпаралелено за допомогою Polars.</p>
<p>Тим часом у Pandas нам доводиться циклічно перебирати стовпці, щоб створити словник kwargs для <code>.assign</code>. Це не розпаралелюється. (Ми могли б використовувати <code>.apply</code> з <code>axis=0</code> замість цього, але це все одно відбуватиметься послідовно).</p></li>
<li><p>Виклик <code>.str.split</code> у Polars створює стовпчик, де кожен елемент є списком. Такий тип даних дратує в Pandas тому що з ними повільно і незручно працювати - зверніть увагу, що найзручніший спосіб отримати перший елемент стовпця зі списком у Pandas - це викликати <code>.str[0]</code>, навіть якщо це список, а не рядок 🤔.</p>
<p>Я не впевнений, що це взагалі має працювати. На противагу цьому, Polars насправді має першокласну підтримку стовпців зі списками, і вони працюють швидко, <strong>якщо вони не мають змішаних типів.</strong></p></li>
</ol>
</section>
<section id="отримати-назви-міст-2" class="slide level2 tiny">
<h2>Отримати назви міст</h2>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">Polars</a></li><li><a href="#tabset-6-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div id="8971141a" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> time_col_pl(col: <span class="bu">str</span>) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb23-2"><a href="" aria-hidden="true" tabindex="-1"></a>    col_expr <span class="op">=</span> pl.col(col)</span>
<span id="cb23-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb23-4"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.when(col_expr <span class="op">==</span> <span class="st">"2400"</span>)</span>
<span id="cb23-5"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(pl.lit(<span class="st">"0000"</span>))</span>
<span id="cb23-6"><a href="" aria-hidden="true" tabindex="-1"></a>        .otherwise(col_expr)</span>
<span id="cb23-7"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.strptime(pl.Time, <span class="st">"%H%M"</span>, strict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-8"><a href="" aria-hidden="true" tabindex="-1"></a>        .alias(col)</span>
<span id="cb23-9"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> time_to_datetime_pl(columns: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">list</span>[pl.Expr]:</span>
<span id="cb23-13"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-14"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    Combine all time items into datetimes.</span></span>
<span id="cb23-15"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    2014-01-01,0914 -&gt; 2014-01-01 09:14:00</span></span>
<span id="cb23-17"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-18"><a href="" aria-hidden="true" tabindex="-1"></a>    date_col <span class="op">=</span> pl.col(<span class="st">"FlightDate"</span>)</span>
<span id="cb23-19"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb23-20"><a href="" aria-hidden="true" tabindex="-1"></a>        date_col</span>
<span id="cb23-21"><a href="" aria-hidden="true" tabindex="-1"></a>        .dt.combine(time_col_pl(col))</span>
<span id="cb23-22"><a href="" aria-hidden="true" tabindex="-1"></a>        .alias(col)</span>
<span id="cb23-23"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> columns</span>
<span id="cb23-24"><a href="" aria-hidden="true" tabindex="-1"></a>    ]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2">
<div id="cf316e62" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> time_col_pd(col: <span class="bu">str</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb24-2"><a href="" aria-hidden="true" tabindex="-1"></a>    timepart <span class="op">=</span> df[col].replace(<span class="st">"2400"</span>, <span class="st">"0000"</span>)</span>
<span id="cb24-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.to_datetime(df[<span class="st">"FlightDate"</span>] <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span></span>
<span id="cb24-4"><a href="" aria-hidden="true" tabindex="-1"></a>                            timepart.<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">2</span>) <span class="op">+</span> <span class="st">':'</span> <span class="op">+</span></span>
<span id="cb24-5"><a href="" aria-hidden="true" tabindex="-1"></a>                            timepart.<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb24-6"><a href="" aria-hidden="true" tabindex="-1"></a>                            errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb24-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> time_to_datetime_pd(df: pd.DataFrame, columns: <span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb24-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    Combine all time items into datetimes.</span></span>
<span id="cb24-11"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    2014-01-01,0914 -&gt; 2014-01-01 09:14:00</span></span>
<span id="cb24-13"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb24-14"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.assign(<span class="op">**</span>{col: time_col_pd(col, df) <span class="cf">for</span> col <span class="kw">in</span> columns})</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="загальні-налаштування" class="slide level2 tiny">
<h2>Загальні налаштування</h2>
<div id="582af958" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a>category_cols <span class="op">=</span> [</span>
<span id="cb25-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Dest"</span>,</span>
<span id="cb25-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tail_Number"</span>,</span>
<span id="cb25-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IATA_CODE_Reporting_Airline"</span>,</span>
<span id="cb25-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CancellationCode"</span>,</span>
<span id="cb25-6"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb25-7"><a href="" aria-hidden="true" tabindex="-1"></a>time_cols <span class="op">=</span> [<span class="st">"DepTime"</span>, <span class="st">"ArrTime"</span>, <span class="st">"CRSArrTime"</span>, <span class="st">"CRSDepTime"</span>]</span>
<span id="cb25-8"><a href="" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> (</span>
<span id="cb25-9"><a href="" aria-hidden="true" tabindex="-1"></a>    category_cols</span>
<span id="cb25-10"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> time_cols</span>
<span id="cb25-11"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> [</span>
<span id="cb25-12"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"FlightDate"</span>,</span>
<span id="cb25-13"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Flight_Number_Reporting_Airline"</span>,</span>
<span id="cb25-14"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"OriginCityName"</span>,</span>
<span id="cb25-15"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DestCityName"</span>,</span>
<span id="cb25-16"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Origin"</span>,</span>
<span id="cb25-17"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DepDelay"</span>,</span>
<span id="cb25-18"><a href="" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb25-19"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-20"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="" aria-hidden="true" tabindex="-1"></a>extracted <span class="op">=</span> <span class="st">"On_Time_Reporting_Carrier_On_Time_Performance_(1987_present)_2022_1.csv"</span></span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="використовуємо-функції" class="slide level2 tiny">
<h2>Використовуємо функції</h2>
<div class="panel-tabset">
<ul id="tabset-7" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-7-1">Polars</a></li><li><a href="#tabset-7-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1">
<div id="b95221c2" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="" aria-hidden="true" tabindex="-1"></a>dtypes_pl <span class="op">=</span> (</span>
<span id="cb26-2"><a href="" aria-hidden="true" tabindex="-1"></a>    {col: pl.Categorical <span class="cf">for</span> col <span class="kw">in</span> category_cols}</span>
<span id="cb26-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {<span class="st">"FlightDate"</span>: pl.Date}</span>
<span id="cb26-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: pl.Utf8 <span class="cf">for</span> col <span class="kw">in</span> time_cols}</span>
<span id="cb26-5"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-6"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl <span class="op">=</span> (</span>
<span id="cb26-7"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.scan_csv(extracted, schema_overrides<span class="op">=</span>dtypes_pl, null_values<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb26-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .select(cols)</span>
<span id="cb26-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns([extract_city_name_pl(), <span class="op">*</span>time_to_datetime_pl(time_cols)])</span>
<span id="cb26-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .collect()</span>
<span id="cb26-11"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-12"><a href="" aria-hidden="true" tabindex="-1"></a>df_pl.head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 14)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Dest</th>
<th data-quarto-table-cell-role="th">Tail_Number</th>
<th data-quarto-table-cell-role="th">IATA_CODE_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">CancellationCode</th>
<th data-quarto-table-cell-role="th">DepTime</th>
<th data-quarto-table-cell-role="th">ArrTime</th>
<th data-quarto-table-cell-role="th">CRSArrTime</th>
<th data-quarto-table-cell-role="th">CRSDepTime</th>
<th data-quarto-table-cell-role="th">FlightDate</th>
<th data-quarto-table-cell-role="th">Flight_Number_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">OriginCityName</th>
<th data-quarto-table-cell-role="th">DestCityName</th>
<th data-quarto-table-cell-role="th">Origin</th>
<th data-quarto-table-cell-role="th">DepDelay</th>
</tr>
<tr class="even">
<th>cat</th>
<th>cat</th>
<th>cat</th>
<th>cat</th>
<th>datetime[μs]</th>
<th>datetime[μs]</th>
<th>datetime[μs]</th>
<th>datetime[μs]</th>
<th>date</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"DCA"</td>
<td>"N119HQ"</td>
<td>"YX"</td>
<td>null</td>
<td>2022-01-14 12:21:00</td>
<td>2022-01-14 13:56:00</td>
<td>2022-01-14 13:52:00</td>
<td>2022-01-14 12:24:00</td>
<td>2022-01-14</td>
<td>4879</td>
<td>"Columbus"</td>
<td>"Washington"</td>
<td>"CMH"</td>
<td>-3.0</td>
</tr>
<tr class="even">
<td>"DCA"</td>
<td>"N122HQ"</td>
<td>"YX"</td>
<td>null</td>
<td>2022-01-15 12:14:00</td>
<td>2022-01-15 13:28:00</td>
<td>2022-01-15 13:52:00</td>
<td>2022-01-15 12:24:00</td>
<td>2022-01-15</td>
<td>4879</td>
<td>"Columbus"</td>
<td>"Washington"</td>
<td>"CMH"</td>
<td>-10.0</td>
</tr>
<tr class="odd">
<td>"DCA"</td>
<td>"N412YX"</td>
<td>"YX"</td>
<td>null</td>
<td>2022-01-16 12:18:00</td>
<td>2022-01-16 13:39:00</td>
<td>2022-01-16 13:52:00</td>
<td>2022-01-16 12:24:00</td>
<td>2022-01-16</td>
<td>4879</td>
<td>"Columbus"</td>
<td>"Washington"</td>
<td>"CMH"</td>
<td>-6.0</td>
</tr>
<tr class="even">
<td>"DCA"</td>
<td>"N405YX"</td>
<td>"YX"</td>
<td>null</td>
<td>2022-01-17 12:17:00</td>
<td>2022-01-17 14:01:00</td>
<td>2022-01-17 13:52:00</td>
<td>2022-01-17 12:24:00</td>
<td>2022-01-17</td>
<td>4879</td>
<td>"Columbus"</td>
<td>"Washington"</td>
<td>"CMH"</td>
<td>-7.0</td>
</tr>
<tr class="odd">
<td>"DCA"</td>
<td>"N420YX"</td>
<td>"YX"</td>
<td>null</td>
<td>2022-01-18 12:18:00</td>
<td>2022-01-18 13:23:00</td>
<td>2022-01-18 13:52:00</td>
<td>2022-01-18 12:24:00</td>
<td>2022-01-18</td>
<td>4879</td>
<td>"Columbus"</td>
<td>"Washington"</td>
<td>"CMH"</td>
<td>-6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-7-2">
<div id="51c438e9" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a>dtypes_pd <span class="op">=</span> (</span>
<span id="cb27-2"><a href="" aria-hidden="true" tabindex="-1"></a>    {col: pd.CategoricalDtype() <span class="cf">for</span> col <span class="kw">in</span> category_cols}</span>
<span id="cb27-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: pd.StringDtype() <span class="cf">for</span> col <span class="kw">in</span> time_cols}</span>
<span id="cb27-4"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-5"><a href="" aria-hidden="true" tabindex="-1"></a>df_pd <span class="op">=</span> (</span>
<span id="cb27-6"><a href="" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(extracted, dtype<span class="op">=</span>dtypes_pd, usecols<span class="op">=</span>cols, na_values<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb27-7"><a href="" aria-hidden="true" tabindex="-1"></a>    .pipe(extract_city_name_pd)</span>
<span id="cb27-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .pipe(time_to_datetime_pd, time_cols)</span>
<span id="cb27-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(FlightDate<span class="op">=</span><span class="kw">lambda</span> df: pd.to_datetime(df[<span class="st">"FlightDate"</span>]))</span>
<span id="cb27-10"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-11"><a href="" aria-hidden="true" tabindex="-1"></a>df_pd[cols].head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dest</th>
<th data-quarto-table-cell-role="th">Tail_Number</th>
<th data-quarto-table-cell-role="th">IATA_CODE_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">CancellationCode</th>
<th data-quarto-table-cell-role="th">DepTime</th>
<th data-quarto-table-cell-role="th">ArrTime</th>
<th data-quarto-table-cell-role="th">CRSArrTime</th>
<th data-quarto-table-cell-role="th">CRSDepTime</th>
<th data-quarto-table-cell-role="th">FlightDate</th>
<th data-quarto-table-cell-role="th">Flight_Number_Reporting_Airline</th>
<th data-quarto-table-cell-role="th">OriginCityName</th>
<th data-quarto-table-cell-role="th">DestCityName</th>
<th data-quarto-table-cell-role="th">Origin</th>
<th data-quarto-table-cell-role="th">DepDelay</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>DCA</td>
<td>N119HQ</td>
<td>YX</td>
<td>NaN</td>
<td>2022-01-14 12:21:00</td>
<td>2022-01-14 13:56:00</td>
<td>2022-01-14 13:52:00</td>
<td>2022-01-14 12:24:00</td>
<td>2022-01-14</td>
<td>4879</td>
<td>Columbus</td>
<td>Washington</td>
<td>CMH</td>
<td>-3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>DCA</td>
<td>N122HQ</td>
<td>YX</td>
<td>NaN</td>
<td>2022-01-15 12:14:00</td>
<td>2022-01-15 13:28:00</td>
<td>2022-01-15 13:52:00</td>
<td>2022-01-15 12:24:00</td>
<td>2022-01-15</td>
<td>4879</td>
<td>Columbus</td>
<td>Washington</td>
<td>CMH</td>
<td>-10.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>DCA</td>
<td>N412YX</td>
<td>YX</td>
<td>NaN</td>
<td>2022-01-16 12:18:00</td>
<td>2022-01-16 13:39:00</td>
<td>2022-01-16 13:52:00</td>
<td>2022-01-16 12:24:00</td>
<td>2022-01-16</td>
<td>4879</td>
<td>Columbus</td>
<td>Washington</td>
<td>CMH</td>
<td>-6.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DCA</td>
<td>N405YX</td>
<td>YX</td>
<td>NaN</td>
<td>2022-01-17 12:17:00</td>
<td>2022-01-17 14:01:00</td>
<td>2022-01-17 13:52:00</td>
<td>2022-01-17 12:24:00</td>
<td>2022-01-17</td>
<td>4879</td>
<td>Columbus</td>
<td>Washington</td>
<td>CMH</td>
<td>-7.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>DCA</td>
<td>N420YX</td>
<td>YX</td>
<td>NaN</td>
<td>2022-01-18 12:18:00</td>
<td>2022-01-18 13:23:00</td>
<td>2022-01-18 13:52:00</td>
<td>2022-01-18 12:24:00</td>
<td>2022-01-18</td>
<td>4879</td>
<td>Columbus</td>
<td>Washington</td>
<td>CMH</td>
<td>-6.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="використовуємо-функції-1" class="slide level2">
<h2>Використовуємо функції</h2>
<p>Відмінності між двома підходами:</p>
<ol type="1">
<li>Оскільки <code>scan_csv</code> є лінивим, використання <code>scan_csv</code> з наступним <code>.select</code> для вибору підмножини стовпців еквівалентно <code>usecols</code> у <code>pd.read_csv</code>. Ось чому сам <code>pl.scan_csv</code> не має параметра для вибору підмножини стовпців для читання.</li>
<li>У Polars є метод <code>.pipe</code>, але ми не використовуємо його у цьому випадку, оскільки простіше працювати з виразами.</li>
</ol>
</section>
<section id="візуалізація" class="slide level2 tiny">
<h2>Візуалізація</h2>
<div class="panel-tabset">
<ul id="tabset-8" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-8-1">Polars</a></li><li><a href="#tabset-8-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1">
<div id="0bca22eb" class="cell columns column-output-location" data-execution_count="22">
<div class="column">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># filter for the busiest airlines</span></span>
<span id="cb28-2"><a href="" aria-hidden="true" tabindex="-1"></a>filter_expr <span class="op">=</span> pl.col(<span class="st">"IATA_CODE_Reporting_Airline"</span>).is_in(</span>
<span id="cb28-3"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"IATA_CODE_Reporting_Airline"</span>)</span>
<span id="cb28-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .value_counts(sort<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .struct.field(<span class="st">"IATA_CODE_Reporting_Airline"</span>)</span>
<span id="cb28-6"><a href="" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">5</span>)</span>
<span id="cb28-7"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-9"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pl</span>
<span id="cb28-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .drop_nulls(subset<span class="op">=</span>[<span class="st">"DepTime"</span>, <span class="st">"IATA_CODE_Reporting_Airline"</span>])</span>
<span id="cb28-11"><a href="" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(filter_expr)</span>
<span id="cb28-12"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"DepTime"</span>)</span>
<span id="cb28-13"><a href="" aria-hidden="true" tabindex="-1"></a>    .group_by_dynamic(</span>
<span id="cb28-14"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DepTime"</span>,</span>
<span id="cb28-15"><a href="" aria-hidden="true" tabindex="-1"></a>        every<span class="op">=</span><span class="st">"1h"</span>,</span>
<span id="cb28-16"><a href="" aria-hidden="true" tabindex="-1"></a>        group_by<span class="op">=</span><span class="st">"IATA_CODE_Reporting_Airline"</span>)</span>
<span id="cb28-17"><a href="" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"Flight_Number_Reporting_Airline"</span>).count())</span>
<span id="cb28-18"><a href="" aria-hidden="true" tabindex="-1"></a>    .pivot(</span>
<span id="cb28-19"><a href="" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span><span class="st">"DepTime"</span>,</span>
<span id="cb28-20"><a href="" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"IATA_CODE_Reporting_Airline"</span>,</span>
<span id="cb28-21"><a href="" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">"Flight_Number_Reporting_Airline"</span>,</span>
<span id="cb28-22"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-23"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"DepTime"</span>)</span>
<span id="cb28-24"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fill every missing hour with 0 so the plot looks better</span></span>
<span id="cb28-25"><a href="" aria-hidden="true" tabindex="-1"></a>    .upsample(time_column<span class="op">=</span><span class="st">"DepTime"</span>, every<span class="op">=</span><span class="st">"1h"</span>)</span>
<span id="cb28-26"><a href="" aria-hidden="true" tabindex="-1"></a>    .fill_null(<span class="dv">0</span>)</span>
<span id="cb28-27"><a href="" aria-hidden="true" tabindex="-1"></a>    .select([pl.col(<span class="st">"DepTime"</span>), pl.col(pl.UInt32).rolling_sum(<span class="dv">24</span>)])</span>
<span id="cb28-28"><a href="" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb28-29"><a href="" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"DepTime"</span>)</span>
<span id="cb28-30"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename_axis(<span class="st">"Flights per Day"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-31"><a href="" aria-hidden="true" tabindex="-1"></a>    .plot()</span>
<span id="cb28-32"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-23-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
<div id="tabset-8-2">
<div id="b45279f8" class="cell columns column-output-location" data-execution_count="23">
<div class="column">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pd</span>
<span id="cb29-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .dropna(subset<span class="op">=</span>[<span class="st">"DepTime"</span>, <span class="st">"IATA_CODE_Reporting_Airline"</span>])</span>
<span id="cb29-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter for the busiest airlines</span></span>
<span id="cb29-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .loc[</span>
<span id="cb29-6"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: x[<span class="st">"IATA_CODE_Reporting_Airline"</span>].isin(</span>
<span id="cb29-7"><a href="" aria-hidden="true" tabindex="-1"></a>            x[<span class="st">"IATA_CODE_Reporting_Airline"</span>].value_counts().index[:<span class="dv">5</span>]</span>
<span id="cb29-8"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-9"><a href="" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(</span>
<span id="cb29-11"><a href="" aria-hidden="true" tabindex="-1"></a>        IATA_CODE_Reporting_Airline<span class="op">=</span><span class="kw">lambda</span> x: x[</span>
<span id="cb29-12"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"IATA_CODE_Reporting_Airline"</span></span>
<span id="cb29-13"><a href="" aria-hidden="true" tabindex="-1"></a>        ].cat.remove_unused_categories()  <span class="co">#  annoying pandas behaviour</span></span>
<span id="cb29-14"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-15"><a href="" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"DepTime"</span>)</span>
<span id="cb29-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TimeGrouper to resample &amp; groupby at once</span></span>
<span id="cb29-17"><a href="" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"IATA_CODE_Reporting_Airline"</span>, pd.Grouper(freq<span class="op">=</span><span class="st">"h"</span>)])[</span>
<span id="cb29-18"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Flight_Number_Reporting_Airline"</span></span>
<span id="cb29-19"><a href="" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-20"><a href="" aria-hidden="true" tabindex="-1"></a>    .count()</span>
<span id="cb29-21"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the .pivot takes care of this in the Polars code.</span></span>
<span id="cb29-22"><a href="" aria-hidden="true" tabindex="-1"></a>    .unstack(<span class="dv">0</span>)</span>
<span id="cb29-23"><a href="" aria-hidden="true" tabindex="-1"></a>    .fillna(<span class="dv">0</span>)</span>
<span id="cb29-24"><a href="" aria-hidden="true" tabindex="-1"></a>    .rolling(<span class="dv">24</span>)</span>
<span id="cb29-25"><a href="" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb29-26"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename_axis(<span class="st">"Flights per Day"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-27"><a href="" aria-hidden="true" tabindex="-1"></a>    .plot()</span>
<span id="cb29-28"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-24-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="візуалізація-1" class="slide level2 smaller">
<h2>Візуалізація</h2>
<p>Відмінності між Polars і Pandas:</p>
<ol type="1">
<li>Для групування за часовим вікном та іншим значенням ми використовуємо <code>.groupby_dynamic</code>. У Pandas ми використовуємо .groupby з помічником <code>pd.Grouper</code>.</li>
<li>Замість <code>.rolling(n).sum()</code> у Polars використовується <code>.rolling_sum(n)</code>.</li>
<li>Якщо ви бачите код Pandas, що використовує <code>.unstack</code>, то відповідний код Polars, ймовірно, потребує <code>.pivot</code>.</li>
<li>У Polars <code>.value_counts</code> повертає стовпець <code>pl.Struct</code>, що містить значення та кількість значень. У Pandas вона повертає ряд, де елементами є кількість значень, а індекс містить самі значення.</li>
<li>У Polars нам потрібно вибрати всі стовпці UInt32 в одній точці за допомогою pl.col(pl.UInt32). У Pandas спосіб роботи <code>.rolling</code> означає, що нам не потрібно вибирати ці стовпці явно, але якщо ми це зробимо, це буде виглядати як <code>df.select_dtypes("uint32")</code>.</li>
</ol>
</section>
<section id="літаки-з-кількома-щоденними-рейсами" class="slide level2 tiny scrollable">
<h2>Літаки з кількома щоденними рейсами</h2>
<div class="panel-tabset">
<ul id="tabset-9" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-9-1">Polars</a></li><li><a href="#tabset-9-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1">
<div id="3c5d3d10" class="cell columns column-output-location" data-execution_count="24">
<div class="column">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="" aria-hidden="true" tabindex="-1"></a>flights_pl <span class="op">=</span> (</span>
<span id="cb30-2"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pl.select(</span>
<span id="cb30-3"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col([</span>
<span id="cb30-4"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"FlightDate"</span>,</span>
<span id="cb30-5"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Tail_Number"</span>,</span>
<span id="cb30-6"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"DepTime"</span>,</span>
<span id="cb30-7"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"DepDelay"</span></span>
<span id="cb30-8"><a href="" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb30-9"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .drop_nulls()</span>
<span id="cb30-11"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"DepTime"</span>)</span>
<span id="cb30-12"><a href="" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"DepDelay"</span>) <span class="op">&lt;</span> <span class="dv">500</span>)</span>
<span id="cb30-13"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb30-14"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"DepTime"</span>)</span>
<span id="cb30-15"><a href="" aria-hidden="true" tabindex="-1"></a>        .rank()</span>
<span id="cb30-16"><a href="" aria-hidden="true" tabindex="-1"></a>        .over([<span class="st">"FlightDate"</span>, <span class="st">"Tail_Number"</span>])</span>
<span id="cb30-17"><a href="" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"turn"</span>)</span>
<span id="cb30-18"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-19"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-20"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb30-22"><a href="" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">"turn"</span>, y<span class="op">=</span><span class="st">"DepDelay"</span>, data<span class="op">=</span>flights_pl.to_pandas(), ax<span class="op">=</span>ax)</span>
<span id="cb30-23"><a href="" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="dv">50</span>, <span class="dv">50</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-25-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
<div id="tabset-9-2">
<div id="b346da42" class="cell columns column-output-location" data-execution_count="25">
<div class="column">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a>flights_pd <span class="op">=</span> (</span>
<span id="cb31-2"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pd[[</span>
<span id="cb31-3"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"FlightDate"</span>,</span>
<span id="cb31-4"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Tail_Number"</span>,</span>
<span id="cb31-5"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DepTime"</span>,</span>
<span id="cb31-6"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"DepDelay"</span></span>
<span id="cb31-7"><a href="" aria-hidden="true" tabindex="-1"></a>    ]]</span>
<span id="cb31-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb31-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'DepTime'</span>)</span>
<span id="cb31-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .loc[<span class="kw">lambda</span> x: x[<span class="st">"DepDelay"</span>] <span class="op">&lt;</span> <span class="dv">500</span>]</span>
<span id="cb31-11"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(turn <span class="op">=</span> <span class="kw">lambda</span> x:</span>
<span id="cb31-12"><a href="" aria-hidden="true" tabindex="-1"></a>        x.groupby([<span class="st">"FlightDate"</span>, <span class="st">"Tail_Number"</span>])</span>
<span id="cb31-13"><a href="" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"DepTime"</span>].transform(<span class="st">'rank'</span>)</span>
<span id="cb31-14"><a href="" aria-hidden="true" tabindex="-1"></a>        .astype(<span class="bu">int</span>)</span>
<span id="cb31-15"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-16"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-17"><a href="" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb31-18"><a href="" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">"turn"</span>, y<span class="op">=</span><span class="st">"DepDelay"</span>, data<span class="op">=</span>flights_pd, ax<span class="op">=</span>ax)</span>
<span id="cb31-19"><a href="" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="dv">50</span>, <span class="dv">50</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-26-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="літаки-з-кількома-щоденними-рейсами-1" class="slide level2">
<h2>Літаки з кількома щоденними рейсами</h2>
<p>Тут є одна новинка: <a href="https://pola-rs.github.io/polars-book/user-guide/dsl/window_functions.html">віконні функції</a>.</p>
<p>Коли код Pandas має вигляд:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="" aria-hidden="true" tabindex="-1"></a>.groupby(<span class="st">"country"</span>)[<span class="st">"population"</span>].transform(<span class="st">"sum"</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>то еквівалентний код Polars матиме вигляд:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a>pl.col(<span class="st">"population"</span>).<span class="bu">sum</span>().over(<span class="st">"country"</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="затримка-по-годинах-доби" class="slide level2 tiny">
<h2>Затримка по годинах доби</h2>
<div class="panel-tabset">
<ul id="tabset-10" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-10-1">Polars</a></li><li><a href="#tabset-10-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1">
<div id="91e911c6" class="cell columns column-output-location" data-execution_count="26">
<div class="column">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb34-2"><a href="" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb34-3"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pl.select(</span>
<span id="cb34-4"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(</span>
<span id="cb34-5"><a href="" aria-hidden="true" tabindex="-1"></a>            [<span class="st">"FlightDate"</span>, <span class="st">"Tail_Number"</span>, <span class="st">"DepTime"</span>, <span class="st">"DepDelay"</span>],</span>
<span id="cb34-6"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb34-7"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .drop_nulls()</span>
<span id="cb34-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"DepDelay"</span>).is_between(<span class="dv">5</span>, <span class="dv">600</span>, closed<span class="op">=</span><span class="st">"none"</span>))</span>
<span id="cb34-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns(pl.col(<span class="st">"DepTime"</span>).dt.hour().alias(<span class="st">"hour"</span>))</span>
<span id="cb34-11"><a href="" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb34-12"><a href="" aria-hidden="true" tabindex="-1"></a>    .pipe((sns.boxplot, <span class="st">"data"</span>), x<span class="op">=</span><span class="st">"hour"</span>, y<span class="op">=</span><span class="st">"DepDelay"</span>)</span>
<span id="cb34-13"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-27-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
<div id="tabset-10-2">
<div id="0e522a6c" class="cell columns column-output-location" data-execution_count="27">
<div class="column">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb35-2"><a href="" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-3"><a href="" aria-hidden="true" tabindex="-1"></a>    df_pd[[<span class="st">"FlightDate"</span>, <span class="st">"Tail_Number"</span>, <span class="st">"DepTime"</span>, <span class="st">"DepDelay"</span>]]</span>
<span id="cb35-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .dropna()</span>
<span id="cb35-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .loc[<span class="kw">lambda</span> df: df[<span class="st">"DepDelay"</span>].between(<span class="dv">5</span>, <span class="dv">600</span>, inclusive<span class="op">=</span><span class="st">"neither"</span>)]</span>
<span id="cb35-6"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(hour<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">"DepTime"</span>].dt.hour)</span>
<span id="cb35-7"><a href="" aria-hidden="true" tabindex="-1"></a>    .pipe((sns.boxplot, <span class="st">"data"</span>), x<span class="op">=</span><span class="st">"hour"</span>, y<span class="op">=</span><span class="st">"DepDelay"</span>)</span>
<span id="cb35-8"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-28-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="підсумок" class="slide level2">
<h2>Підсумок</h2>

<img data-src="data/pandas_chain_tweet.png" class="quarto-figure quarto-figure-center r-stretch"></section></section>
<section>
<section id="продуктивність" class="title-slide slide level1 center">
<h1>Продуктивність</h1>

</section>
<section id="шість-досить-очевидних-правил-ефективності" class="slide level2 tiny">
<h2>Шість досить очевидних правил ефективності</h2>
<p><a href="https://www.pola.rs/benchmarks.html">Polars дуже швидкий</a>.</p>
<ul>
<li>Використовуйте лінивий API.</li>
<li>Використовуйте <code>Expr</code> і не використовуйте <code>.apply</code>, якщо це дійсно необхідно.</li>
<li>Використовуйте найменші необхідні числові типи (наприклад, якщо у вас є ціле число від 0 до 255, використовуйте <code>pl.UInt8</code>, а не <code>pl.Int64</code>). Це заощадить і час, і місце.</li>
<li>Використовуйте ефективне сховище (якщо ви зберігаєте дані у файлах, Parquet - хороший вибір).</li>
<li>Використовуйте категоризації для рядків, що повторюються (але зауважте, що це може бути недоцільно, якщо повторюваність невелика).</li>
<li>Вибирайте лише ті стовпці, які вам потрібні.</li>
</ul>
</section>
<section id="polars-швидше-справляється-з-нудними-завданнями" class="slide level2 tiny">
<h2>Polars швидше справляється з нудними завданнями</h2>
<p><a href="https://www.kaggle.com/datasets/yagunnersya/fifa-21-messy-raw-dataset-for-cleaning-exploring?resource=download">Дані</a> з Kaggle.</p>
<p>Крім того, дані занадто малі, тому я об’єднав їх 20 разів.</p>
<div id="cell-messy" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="" aria-hidden="true" tabindex="-1"></a>fifa <span class="op">=</span> pd.read_csv(<span class="st">"data/fifa21_raw_data.csv"</span>)</span>
<span id="cb36-2"><a href="" aria-hidden="true" tabindex="-1"></a>fifa <span class="op">=</span> pd.concat([fifa] <span class="op">*</span> <span class="dv">20</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="" aria-hidden="true" tabindex="-1"></a>fifa.to_csv(<span class="st">"data/fifa21_raw_big.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-5"><a href="" aria-hidden="true" tabindex="-1"></a>fifa</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="messy" class="cell-output cell-output-display" data-execution_count="26">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">LongName</th>
<th data-quarto-table-cell-role="th">photoUrl</th>
<th data-quarto-table-cell-role="th">playerUrl</th>
<th data-quarto-table-cell-role="th">Nationality</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">↓OVA</th>
<th data-quarto-table-cell-role="th">POT</th>
<th data-quarto-table-cell-role="th">Club</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">A/W</th>
<th data-quarto-table-cell-role="th">D/W</th>
<th data-quarto-table-cell-role="th">IR</th>
<th data-quarto-table-cell-role="th">PAC</th>
<th data-quarto-table-cell-role="th">SHO</th>
<th data-quarto-table-cell-role="th">PAS</th>
<th data-quarto-table-cell-role="th">DRI</th>
<th data-quarto-table-cell-role="th">DEF</th>
<th data-quarto-table-cell-role="th">PHY</th>
<th data-quarto-table-cell-role="th">Hits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>158023</td>
<td>L. Messi</td>
<td>Lionel Messi</td>
<td>https://cdn.sofifa.com/players/158/023/21_60.png</td>
<td>http://sofifa.com/player/158023/lionel-messi/2...</td>
<td>Argentina</td>
<td>33</td>
<td>93</td>
<td>93</td>
<td>\n\n\n\nFC Barcelona</td>
<td>...</td>
<td>Medium</td>
<td>Low</td>
<td>5 ★</td>
<td>85</td>
<td>92</td>
<td>91</td>
<td>95</td>
<td>38</td>
<td>65</td>
<td>771</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>20801</td>
<td>Cristiano Ronaldo</td>
<td>C. Ronaldo dos Santos Aveiro</td>
<td>https://cdn.sofifa.com/players/020/801/21_60.png</td>
<td>http://sofifa.com/player/20801/c-ronaldo-dos-s...</td>
<td>Portugal</td>
<td>35</td>
<td>92</td>
<td>92</td>
<td>\n\n\n\nJuventus</td>
<td>...</td>
<td>High</td>
<td>Low</td>
<td>5 ★</td>
<td>89</td>
<td>93</td>
<td>81</td>
<td>89</td>
<td>35</td>
<td>77</td>
<td>562</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">379578</td>
<td>243790</td>
<td>Wang Zhen'ao</td>
<td>Zhen'ao Wang</td>
<td>https://cdn.sofifa.com/players/243/790/21_60.png</td>
<td>http://sofifa.com/player/243790/zhenao-wang/21...</td>
<td>China PR</td>
<td>20</td>
<td>47</td>
<td>57</td>
<td>\n\n\n\nDalian YiFang FC</td>
<td>...</td>
<td>Medium</td>
<td>Medium</td>
<td>1 ★</td>
<td>58</td>
<td>49</td>
<td>41</td>
<td>49</td>
<td>30</td>
<td>44</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">379579</td>
<td>252520</td>
<td>Zhou Xiao</td>
<td>Xiao Zhou</td>
<td>https://cdn.sofifa.com/players/252/520/21_60.png</td>
<td>http://sofifa.com/player/252520/xiao-zhou/210006/</td>
<td>China PR</td>
<td>21</td>
<td>47</td>
<td>57</td>
<td>\n\n\n\nDalian YiFang FC</td>
<td>...</td>
<td>Medium</td>
<td>Medium</td>
<td>1 ★</td>
<td>62</td>
<td>22</td>
<td>39</td>
<td>42</td>
<td>45</td>
<td>55</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>379580 rows × 77 columns</p>
</div>
</div>
</div>
</section>
<section id="шаблон-стовпців" class="slide level2 tiny scrollable">
<h2>Шаблон стовпців</h2>
<div id="243896e4" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb37-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb37-5"><a href="" aria-hidden="true" tabindex="-1"></a>str_cols <span class="op">=</span> [</span>
<span id="cb37-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Name"</span>,</span>
<span id="cb37-7"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LongName"</span>,</span>
<span id="cb37-8"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"playerUrl"</span>,</span>
<span id="cb37-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"photoUrl"</span>,</span>
<span id="cb37-10"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-11"><a href="" aria-hidden="true" tabindex="-1"></a>initial_category_cols_pl <span class="op">=</span> [</span>
<span id="cb37-12"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nationality"</span>,</span>
<span id="cb37-13"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Preferred Foot"</span>,</span>
<span id="cb37-14"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Best Position"</span>,</span>
<span id="cb37-15"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"A/W"</span>,</span>
<span id="cb37-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D/W"</span></span>
<span id="cb37-17"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-18"><a href="" aria-hidden="true" tabindex="-1"></a>category_cols <span class="op">=</span> [<span class="op">*</span>initial_category_cols_pl, <span class="st">"Club"</span>]</span>
<span id="cb37-19"><a href="" aria-hidden="true" tabindex="-1"></a>date_cols <span class="op">=</span> [</span>
<span id="cb37-20"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Joined"</span>,</span>
<span id="cb37-21"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Loan Date End"</span></span>
<span id="cb37-22"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-23"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># всі вони починаються з символу євро і закінчуються на 0, M або K</span></span>
<span id="cb37-24"><a href="" aria-hidden="true" tabindex="-1"></a>money_cols <span class="op">=</span> [</span>
<span id="cb37-25"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Value"</span>,</span>
<span id="cb37-26"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Wage"</span>,</span>
<span id="cb37-27"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Release Clause"</span></span>
<span id="cb37-28"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-29"><a href="" aria-hidden="true" tabindex="-1"></a>star_cols <span class="op">=</span> [</span>
<span id="cb37-30"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"W/F"</span>,</span>
<span id="cb37-31"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SM"</span>,</span>
<span id="cb37-32"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IR"</span>,</span>
<span id="cb37-33"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-34"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Contract col - діапазон років контракту</span></span>
<span id="cb37-35"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Positions - список посад</span></span>
<span id="cb37-36"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Height - у см</span></span>
<span id="cb37-37"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Weight в кг</span></span>
<span id="cb37-38"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Hits - номери з K та M </span></span>
<span id="cb37-39"><a href="" aria-hidden="true" tabindex="-1"></a>messy_cols <span class="op">=</span> [</span>
<span id="cb37-40"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Contract"</span>,</span>
<span id="cb37-41"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Positions"</span>,</span>
<span id="cb37-42"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Height"</span>,</span>
<span id="cb37-43"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Weight"</span>,</span>
<span id="cb37-44"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hits"</span></span>
<span id="cb37-45"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-46"><a href="" aria-hidden="true" tabindex="-1"></a>initially_str_cols <span class="op">=</span> str_cols <span class="op">+</span> date_cols <span class="op">+</span> money_cols <span class="op">+</span> star_cols <span class="op">+</span> messy_cols</span>
<span id="cb37-47"><a href="" aria-hidden="true" tabindex="-1"></a>initially_str_cols_pl <span class="op">=</span> [<span class="op">*</span>initially_str_cols, <span class="st">"Club"</span>]</span>
<span id="cb37-48"><a href="" aria-hidden="true" tabindex="-1"></a>u32_cols <span class="op">=</span> [</span>
<span id="cb37-49"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ID"</span>,</span>
<span id="cb37-50"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total Stats"</span></span>
<span id="cb37-51"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-52"><a href="" aria-hidden="true" tabindex="-1"></a>u8_cols <span class="op">=</span> [</span>
<span id="cb37-53"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Age'</span>,</span>
<span id="cb37-54"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'↓OVA'</span>,</span>
<span id="cb37-55"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'POT'</span>,</span>
<span id="cb37-56"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'BOV'</span>,</span>
<span id="cb37-57"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Crossing'</span>,</span>
<span id="cb37-58"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finishing'</span>,</span>
<span id="cb37-59"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Heading Accuracy'</span>,</span>
<span id="cb37-60"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Short Passing'</span>,</span>
<span id="cb37-61"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Volleys'</span>,</span>
<span id="cb37-62"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Dribbling'</span>,</span>
<span id="cb37-63"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Curve'</span>,</span>
<span id="cb37-64"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'FK Accuracy'</span>,</span>
<span id="cb37-65"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Long Passing'</span>,</span>
<span id="cb37-66"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ball Control'</span>,</span>
<span id="cb37-67"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Acceleration'</span>,</span>
<span id="cb37-68"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sprint Speed'</span>,</span>
<span id="cb37-69"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Agility'</span>,</span>
<span id="cb37-70"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Reactions'</span>,</span>
<span id="cb37-71"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Balance'</span>,</span>
<span id="cb37-72"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Shot Power'</span>,</span>
<span id="cb37-73"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Jumping'</span>,</span>
<span id="cb37-74"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Stamina'</span>,</span>
<span id="cb37-75"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Strength'</span>,</span>
<span id="cb37-76"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Long Shots'</span>,</span>
<span id="cb37-77"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Aggression'</span>,</span>
<span id="cb37-78"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Interceptions'</span>,</span>
<span id="cb37-79"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Positioning'</span>,</span>
<span id="cb37-80"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vision'</span>,</span>
<span id="cb37-81"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Penalties'</span>,</span>
<span id="cb37-82"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Composure'</span>,</span>
<span id="cb37-83"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Marking'</span>,</span>
<span id="cb37-84"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Standing Tackle'</span>,</span>
<span id="cb37-85"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sliding Tackle'</span>,</span>
<span id="cb37-86"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GK Diving'</span>,</span>
<span id="cb37-87"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GK Handling'</span>,</span>
<span id="cb37-88"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GK Kicking'</span>,</span>
<span id="cb37-89"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GK Positioning'</span>,</span>
<span id="cb37-90"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GK Reflexes'</span>,</span>
<span id="cb37-91"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PAC'</span>,</span>
<span id="cb37-92"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SHO'</span>,</span>
<span id="cb37-93"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PAS'</span>,</span>
<span id="cb37-94"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DRI'</span>,</span>
<span id="cb37-95"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DEF'</span>,</span>
<span id="cb37-96"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PHY'</span></span>
<span id="cb37-97"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-98"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-99"><a href="" aria-hidden="true" tabindex="-1"></a>u16_cols <span class="op">=</span> [</span>
<span id="cb37-100"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Attacking'</span>,</span>
<span id="cb37-101"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Skill'</span>,</span>
<span id="cb37-102"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Movement'</span>,</span>
<span id="cb37-103"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Power'</span>,</span>
<span id="cb37-104"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mentality'</span>,</span>
<span id="cb37-105"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Defending'</span>,</span>
<span id="cb37-106"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Goalkeeping'</span>,</span>
<span id="cb37-107"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Total Stats'</span>,</span>
<span id="cb37-108"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Base Stats'</span></span>
<span id="cb37-109"><a href="" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dtypes" class="slide level2">
<h2>Dtypes</h2>
<div class="panel-tabset">
<ul id="tabset-11" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-11-1">Polars</a></li><li><a href="#tabset-11-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1">
<div id="f0c1aa90" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># не можна використовувати UInt8/16 в scan_csv</span></span>
<span id="cb38-2"><a href="" aria-hidden="true" tabindex="-1"></a>dtypes_pl <span class="op">=</span> (</span>
<span id="cb38-3"><a href="" aria-hidden="true" tabindex="-1"></a>    {col: pl.Utf8 <span class="cf">for</span> col <span class="kw">in</span> initially_str_cols_pl}</span>
<span id="cb38-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: pl.Categorical <span class="cf">for</span> col <span class="kw">in</span> initial_category_cols_pl}</span>
<span id="cb38-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: pl.UInt32 <span class="cf">for</span> col <span class="kw">in</span> [<span class="op">*</span>u32_cols, <span class="op">*</span>u16_cols, <span class="op">*</span>u8_cols]}</span>
<span id="cb38-6"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-11-2">
<div id="6199ac35" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="" aria-hidden="true" tabindex="-1"></a>dtypes_pd <span class="op">=</span> (</span>
<span id="cb39-2"><a href="" aria-hidden="true" tabindex="-1"></a>    {col: pd.StringDtype() <span class="cf">for</span> col <span class="kw">in</span> initially_str_cols}</span>
<span id="cb39-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: pd.CategoricalDtype() <span class="cf">for</span> col <span class="kw">in</span> category_cols}</span>
<span id="cb39-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: <span class="st">"uint32"</span> <span class="cf">for</span> col <span class="kw">in</span> u32_cols}</span>
<span id="cb39-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: <span class="st">"uint8"</span> <span class="cf">for</span> col <span class="kw">in</span> u8_cols}</span>
<span id="cb39-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> {col: <span class="st">"uint16"</span> <span class="cf">for</span> col <span class="kw">in</span> u16_cols}</span>
<span id="cb39-7"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="очистка" class="slide level2 tiny scrollable">
<h2>Очистка</h2>
<p><a href="https://pola-rs.github.io/polars/py-polars/html/reference/expressions/api/polars.when.html#polars.when"><code>pl.when</code></a> для тернарних виразів.</p>
<div class="panel-tabset">
<ul id="tabset-12" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-12-1">Polars</a></li><li><a href="#tabset-12-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1">
<div id="53b7d2df" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_date_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col.<span class="bu">str</span>.strptime(pl.Date, <span class="bu">format</span><span class="op">=</span><span class="st">"%b </span><span class="sc">%d</span><span class="st">, %Y"</span>)</span>
<span id="cb40-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_suffixed_num_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-5"><a href="" aria-hidden="true" tabindex="-1"></a>    suffix <span class="op">=</span> col.<span class="bu">str</span>.<span class="bu">slice</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb40-6"><a href="" aria-hidden="true" tabindex="-1"></a>    suffix_value <span class="op">=</span> (</span>
<span id="cb40-7"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.when(suffix <span class="op">==</span> <span class="st">"K"</span>)</span>
<span id="cb40-8"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">1_000</span>)</span>
<span id="cb40-9"><a href="" aria-hidden="true" tabindex="-1"></a>        .when(suffix <span class="op">==</span> <span class="st">"M"</span>)</span>
<span id="cb40-10"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">1_000_000</span>)</span>
<span id="cb40-11"><a href="" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="dv">1</span>)</span>
<span id="cb40-12"><a href="" aria-hidden="true" tabindex="-1"></a>        .cast(pl.UInt32)</span>
<span id="cb40-13"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-14"><a href="" aria-hidden="true" tabindex="-1"></a>    without_suffix <span class="op">=</span> (</span>
<span id="cb40-15"><a href="" aria-hidden="true" tabindex="-1"></a>        col</span>
<span id="cb40-16"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">"K"</span>, <span class="st">""</span>, literal<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-17"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">"M"</span>, <span class="st">""</span>, literal<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-18"><a href="" aria-hidden="true" tabindex="-1"></a>        .cast(pl.Float32)</span>
<span id="cb40-19"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-20"><a href="" aria-hidden="true" tabindex="-1"></a>    original_name <span class="op">=</span> col.meta.output_name()</span>
<span id="cb40-21"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (suffix_value <span class="op">*</span> without_suffix).alias(original_name)</span>
<span id="cb40-22"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_money_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-24"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parse_suffixed_num_pl(col.<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">1</span>)).cast(pl.UInt32)</span>
<span id="cb40-25"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_star_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-27"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col.<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">1</span>).cast(pl.UInt8)</span>
<span id="cb40-28"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> feet_to_cm_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-30"><a href="" aria-hidden="true" tabindex="-1"></a>    feet_inches_split <span class="op">=</span> col.<span class="bu">str</span>.split_exact(<span class="st">"'"</span>, <span class="dv">1</span>)</span>
<span id="cb40-31"><a href="" aria-hidden="true" tabindex="-1"></a>    total_inches <span class="op">=</span> (</span>
<span id="cb40-32"><a href="" aria-hidden="true" tabindex="-1"></a>        (feet_inches_split.struct.field(<span class="st">"field_0"</span>).cast(pl.UInt8, strict<span class="op">=</span><span class="va">False</span>) <span class="op">*</span> <span class="dv">12</span>)</span>
<span id="cb40-33"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> feet_inches_split.struct.field(<span class="st">"field_1"</span>).<span class="bu">str</span>.strip_chars_end(<span class="st">'"'</span>).cast(pl.UInt8, strict<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-34"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-35"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (total_inches <span class="op">*</span> <span class="fl">2.54</span>).<span class="bu">round</span>(<span class="dv">0</span>).cast(pl.UInt8)</span>
<span id="cb40-36"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-37"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_height_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-38"><a href="" aria-hidden="true" tabindex="-1"></a>    is_cm <span class="op">=</span> col.<span class="bu">str</span>.ends_with(<span class="st">"cm"</span>)</span>
<span id="cb40-39"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb40-40"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.when(is_cm)</span>
<span id="cb40-41"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(col.<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">3</span>).cast(pl.UInt8, strict<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb40-42"><a href="" aria-hidden="true" tabindex="-1"></a>        .otherwise(feet_to_cm_pl(col))</span>
<span id="cb40-43"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-44"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_weight_pl(col: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb40-46"><a href="" aria-hidden="true" tabindex="-1"></a>    is_kg <span class="op">=</span> col.<span class="bu">str</span>.ends_with(<span class="st">"kg"</span>)</span>
<span id="cb40-47"><a href="" aria-hidden="true" tabindex="-1"></a>    without_unit <span class="op">=</span> col.<span class="bu">str</span>.extract(<span class="vs">r"(\d+)"</span>).cast(pl.UInt8)</span>
<span id="cb40-48"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb40-49"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.when(is_kg)</span>
<span id="cb40-50"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(without_unit)</span>
<span id="cb40-51"><a href="" aria-hidden="true" tabindex="-1"></a>        .otherwise((without_unit <span class="op">*</span> <span class="fl">0.453592</span>).<span class="bu">round</span>(<span class="dv">0</span>).cast(pl.UInt8))</span>
<span id="cb40-52"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-53"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-54"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_contract_pl(col: pl.Expr) <span class="op">-&gt;</span> <span class="bu">list</span>[pl.Expr]:</span>
<span id="cb40-55"><a href="" aria-hidden="true" tabindex="-1"></a>    contains_tilde <span class="op">=</span> col.<span class="bu">str</span>.contains(<span class="st">" ~ "</span>, literal<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-56"><a href="" aria-hidden="true" tabindex="-1"></a>    loan_str <span class="op">=</span> <span class="st">" On Loan"</span></span>
<span id="cb40-57"><a href="" aria-hidden="true" tabindex="-1"></a>    loan_col <span class="op">=</span> col.<span class="bu">str</span>.ends_with(loan_str)</span>
<span id="cb40-58"><a href="" aria-hidden="true" tabindex="-1"></a>    split <span class="op">=</span> (</span>
<span id="cb40-59"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.when(contains_tilde)</span>
<span id="cb40-60"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(col)</span>
<span id="cb40-61"><a href="" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="va">None</span>)</span>
<span id="cb40-62"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.split_exact(<span class="st">" ~ "</span>, <span class="dv">1</span>)</span>
<span id="cb40-63"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-64"><a href="" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> split.struct.field(<span class="st">"field_0"</span>).cast(pl.UInt16).alias(<span class="st">"contract_start"</span>)</span>
<span id="cb40-65"><a href="" aria-hidden="true" tabindex="-1"></a>    end <span class="op">=</span> split.struct.field(<span class="st">"field_1"</span>).cast(pl.UInt16).alias(<span class="st">"contract_end"</span>)</span>
<span id="cb40-66"><a href="" aria-hidden="true" tabindex="-1"></a>    free_agent <span class="op">=</span> (col <span class="op">==</span> <span class="st">"Free"</span>).alias(<span class="st">"free_agent"</span>).fill_null(<span class="va">False</span>)</span>
<span id="cb40-67"><a href="" aria-hidden="true" tabindex="-1"></a>    loan_date <span class="op">=</span> (</span>
<span id="cb40-68"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.when(loan_col)</span>
<span id="cb40-69"><a href="" aria-hidden="true" tabindex="-1"></a>        .then(col)</span>
<span id="cb40-70"><a href="" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="va">None</span>)</span>
<span id="cb40-71"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.split_exact(<span class="st">" On Loan"</span>, <span class="dv">1</span>)</span>
<span id="cb40-72"><a href="" aria-hidden="true" tabindex="-1"></a>        .struct.field(<span class="st">"field_0"</span>)</span>
<span id="cb40-73"><a href="" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"loan_date_start"</span>)</span>
<span id="cb40-74"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-75"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [start, end, free_agent, parse_date_pl(loan_date)]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2">
<div id="8b86fc40" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_date_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.to_datetime(col, <span class="bu">format</span><span class="op">=</span><span class="st">"%b </span><span class="sc">%d</span><span class="st">, %Y"</span>)</span>
<span id="cb41-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_suffixed_num_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-5"><a href="" aria-hidden="true" tabindex="-1"></a>    suffix_value <span class="op">=</span> (</span>
<span id="cb41-6"><a href="" aria-hidden="true" tabindex="-1"></a>        col</span>
<span id="cb41-7"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb41-8"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">map</span>({<span class="st">"K"</span>: <span class="dv">1_000</span>, <span class="st">"M"</span>: <span class="dv">1_000_000</span>})</span>
<span id="cb41-9"><a href="" aria-hidden="true" tabindex="-1"></a>        .fillna(<span class="dv">1</span>)</span>
<span id="cb41-10"><a href="" aria-hidden="true" tabindex="-1"></a>        .astype(<span class="st">"uint32"</span>)</span>
<span id="cb41-11"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-12"><a href="" aria-hidden="true" tabindex="-1"></a>    without_suffix <span class="op">=</span> (</span>
<span id="cb41-13"><a href="" aria-hidden="true" tabindex="-1"></a>        col</span>
<span id="cb41-14"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">"K"</span>, <span class="st">""</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-15"><a href="" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">str</span>.replace(<span class="st">"M"</span>, <span class="st">""</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-16"><a href="" aria-hidden="true" tabindex="-1"></a>        .astype(<span class="st">"float"</span>)</span>
<span id="cb41-17"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-18"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> suffix_value <span class="op">*</span> without_suffix</span>
<span id="cb41-19"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_money_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-21"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> parse_suffixed_num_pd(col.<span class="bu">str</span>[<span class="dv">1</span>:]).astype(<span class="st">"uint32"</span>)</span>
<span id="cb41-22"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_star_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-24"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col.<span class="bu">str</span>[<span class="dv">0</span>].astype(<span class="st">"uint8"</span>)</span>
<span id="cb41-25"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> feet_to_cm_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-27"><a href="" aria-hidden="true" tabindex="-1"></a>    feet_inches_split <span class="op">=</span> col.<span class="bu">str</span>.split(<span class="st">"'"</span>, expand<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-28"><a href="" aria-hidden="true" tabindex="-1"></a>    total_inches <span class="op">=</span> (</span>
<span id="cb41-29"><a href="" aria-hidden="true" tabindex="-1"></a>        feet_inches_split[<span class="dv">0</span>].astype(<span class="st">"uint8"</span>).mul(<span class="dv">12</span>)</span>
<span id="cb41-30"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> feet_inches_split[<span class="dv">1</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">1</span>].astype(<span class="st">"uint8"</span>)</span>
<span id="cb41-31"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-32"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_inches.mul(<span class="fl">2.54</span>).<span class="bu">round</span>().astype(<span class="st">"uint8"</span>)</span>
<span id="cb41-33"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_height_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-35"><a href="" aria-hidden="true" tabindex="-1"></a>    is_cm <span class="op">=</span> col.<span class="bu">str</span>.endswith(<span class="st">"cm"</span>)</span>
<span id="cb41-36"><a href="" aria-hidden="true" tabindex="-1"></a>    cm_values <span class="op">=</span> col.loc[is_cm].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">2</span>].astype(<span class="st">"uint8"</span>)</span>
<span id="cb41-37"><a href="" aria-hidden="true" tabindex="-1"></a>    inches_as_cm <span class="op">=</span> feet_to_cm_pd(col.loc[<span class="op">~</span>is_cm])</span>
<span id="cb41-38"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.concat([cm_values, inches_as_cm])</span>
<span id="cb41-39"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_weight_pd(col: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb41-41"><a href="" aria-hidden="true" tabindex="-1"></a>    is_kg <span class="op">=</span> col.<span class="bu">str</span>.endswith(<span class="st">"kg"</span>)</span>
<span id="cb41-42"><a href="" aria-hidden="true" tabindex="-1"></a>    without_unit <span class="op">=</span> col.where(is_kg, col.<span class="bu">str</span>[:<span class="op">-</span><span class="dv">3</span>]).mask(is_kg, col.<span class="bu">str</span>[:<span class="op">-</span><span class="dv">2</span>]).astype(<span class="st">"uint8"</span>)</span>
<span id="cb41-43"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> without_unit.where(is_kg, without_unit.mul(<span class="fl">0.453592</span>).<span class="bu">round</span>().astype(<span class="st">"uint8"</span>))</span>
<span id="cb41-44"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_contract_pd(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb41-46"><a href="" aria-hidden="true" tabindex="-1"></a>    contract_col <span class="op">=</span> df[<span class="st">"Contract"</span>]</span>
<span id="cb41-47"><a href="" aria-hidden="true" tabindex="-1"></a>    contains_tilde <span class="op">=</span> contract_col.<span class="bu">str</span>.contains(<span class="st">" ~ "</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-48"><a href="" aria-hidden="true" tabindex="-1"></a>    split <span class="op">=</span> (</span>
<span id="cb41-49"><a href="" aria-hidden="true" tabindex="-1"></a>        contract_col.loc[contains_tilde].<span class="bu">str</span>.split(<span class="st">" ~ "</span>, expand<span class="op">=</span><span class="va">True</span>).astype(pd.UInt16Dtype())</span>
<span id="cb41-50"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-51"><a href="" aria-hidden="true" tabindex="-1"></a>    split.columns <span class="op">=</span> [<span class="st">"contract_start"</span>, <span class="st">"contract_end"</span>]</span>
<span id="cb41-52"><a href="" aria-hidden="true" tabindex="-1"></a>    not_tilde <span class="op">=</span> contract_col.loc[<span class="op">~</span>contains_tilde]</span>
<span id="cb41-53"><a href="" aria-hidden="true" tabindex="-1"></a>    free_agent <span class="op">=</span> (contract_col <span class="op">==</span> <span class="st">"Free"</span>).rename(<span class="st">"free_agent"</span>).fillna(<span class="va">False</span>)</span>
<span id="cb41-54"><a href="" aria-hidden="true" tabindex="-1"></a>    loan_date <span class="op">=</span> parse_date_pd(not_tilde.loc[<span class="op">~</span>free_agent].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">8</span>]).rename(<span class="st">"loan_date_start"</span>)</span>
<span id="cb41-55"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.concat([df.drop(<span class="st">"Contract"</span>, axis<span class="op">=</span><span class="dv">1</span>), split, free_agent, loan_date], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="порівняння-продуктивності" class="slide level2 tiny scrollable">
<h2>Порівняння продуктивності</h2>
<p>У цьому прикладі <strong>Polar в рази швидше</strong> ніж Pandas</p>
<div class="panel-tabset">
<ul id="tabset-13" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-13-1">Polars</a></li><li><a href="#tabset-13-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1">
<div id="8983d44b" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb42-2"><a href="" aria-hidden="true" tabindex="-1"></a>new_cols_pl <span class="op">=</span> ([</span>
<span id="cb42-3"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"Club"</span>).<span class="bu">str</span>.strip_chars().cast(pl.Categorical),</span>
<span id="cb42-4"><a href="" aria-hidden="true" tabindex="-1"></a>    parse_suffixed_num_pl(pl.col(<span class="st">"Hits"</span>)).cast(pl.UInt32),</span>
<span id="cb42-5"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"Positions"</span>).<span class="bu">str</span>.split(<span class="st">","</span>),</span>
<span id="cb42-6"><a href="" aria-hidden="true" tabindex="-1"></a>    parse_height_pl(pl.col(<span class="st">"Height"</span>)),</span>
<span id="cb42-7"><a href="" aria-hidden="true" tabindex="-1"></a>    parse_weight_pl(pl.col(<span class="st">"Weight"</span>)),</span>
<span id="cb42-8"><a href="" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-9"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> [parse_date_pl(pl.col(col)) <span class="cf">for</span> col <span class="kw">in</span> date_cols]</span>
<span id="cb42-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> [parse_money_pl(pl.col(col)) <span class="cf">for</span> col <span class="kw">in</span> money_cols]</span>
<span id="cb42-11"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> [parse_star_pl(pl.col(col)) <span class="cf">for</span> col <span class="kw">in</span> star_cols]</span>
<span id="cb42-12"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> parse_contract_pl(pl.col(<span class="st">"Contract"</span>))</span>
<span id="cb42-13"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> [pl.col(col).cast(pl.UInt16) <span class="cf">for</span> col <span class="kw">in</span> u16_cols]</span>
<span id="cb42-14"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> [pl.col(col).cast(pl.UInt8) <span class="cf">for</span> col <span class="kw">in</span> u8_cols]</span>
<span id="cb42-15"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-16"><a href="" aria-hidden="true" tabindex="-1"></a>fifa_pl <span class="op">=</span> (</span>
<span id="cb42-17"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.scan_csv(<span class="st">"data/fifa21_raw_big.csv"</span>, schema_overrides<span class="op">=</span>dtypes_pl)</span>
<span id="cb42-18"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns(new_cols_pl)</span>
<span id="cb42-19"><a href="" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">"Contract"</span>)</span>
<span id="cb42-20"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename({<span class="st">"↓OVA"</span>: <span class="st">"OVA"</span>})</span>
<span id="cb42-21"><a href="" aria-hidden="true" tabindex="-1"></a>    .collect()</span>
<span id="cb42-22"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 1.16 s
Wall time: 214 ms</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2">
<div id="fe0a1901" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb44-2"><a href="" aria-hidden="true" tabindex="-1"></a>fifa_pd <span class="op">=</span> (</span>
<span id="cb44-3"><a href="" aria-hidden="true" tabindex="-1"></a>    pd.read_csv(<span class="st">"data/fifa21_raw_big.csv"</span>, dtype<span class="op">=</span>dtypes_pd)</span>
<span id="cb44-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(Club<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">"Club"</span>].cat.rename_categories(<span class="kw">lambda</span> c: c.strip()),</span>
<span id="cb44-5"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>{col: <span class="kw">lambda</span> df: parse_date_pd(df[col]) <span class="cf">for</span> col <span class="kw">in</span> date_cols},</span>
<span id="cb44-6"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>{col: <span class="kw">lambda</span> df: parse_money_pd(df[col]) <span class="cf">for</span> col <span class="kw">in</span> money_cols},</span>
<span id="cb44-7"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>{col: <span class="kw">lambda</span> df: parse_star_pd(df[col]) <span class="cf">for</span> col <span class="kw">in</span> star_cols},</span>
<span id="cb44-8"><a href="" aria-hidden="true" tabindex="-1"></a>        Hits<span class="op">=</span><span class="kw">lambda</span> df: parse_suffixed_num_pd(df[<span class="st">"Hits"</span>]).astype(pd.UInt32Dtype()),</span>
<span id="cb44-9"><a href="" aria-hidden="true" tabindex="-1"></a>        Positions<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">"Positions"</span>].<span class="bu">str</span>.split(<span class="st">","</span>),</span>
<span id="cb44-10"><a href="" aria-hidden="true" tabindex="-1"></a>        Height<span class="op">=</span><span class="kw">lambda</span> df: parse_height_pd(df[<span class="st">"Height"</span>]),</span>
<span id="cb44-11"><a href="" aria-hidden="true" tabindex="-1"></a>        Weight<span class="op">=</span><span class="kw">lambda</span> df: parse_weight_pd(df[<span class="st">"Weight"</span>])</span>
<span id="cb44-12"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-13"><a href="" aria-hidden="true" tabindex="-1"></a>    .pipe(parse_contract_pd)</span>
<span id="cb44-14"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span>{<span class="st">"↓OVA"</span>: <span class="st">"OVA"</span>})</span>
<span id="cb44-15"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 4.28 s
Wall time: 4.33 s</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="порівняння-продуктивності-1" class="slide level2 tiny">
<h2>Порівняння продуктивності</h2>
<p>Результати:</p>
<div class="panel-tabset">
<ul id="tabset-14" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-14-1">Polars</a></li><li><a href="#tabset-14-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1">
<div id="852f1989" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="" aria-hidden="true" tabindex="-1"></a>fifa_pl.head(<span class="dv">3</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 80)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">LongName</th>
<th data-quarto-table-cell-role="th">photoUrl</th>
<th data-quarto-table-cell-role="th">playerUrl</th>
<th data-quarto-table-cell-role="th">Nationality</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">OVA</th>
<th data-quarto-table-cell-role="th">POT</th>
<th data-quarto-table-cell-role="th">Club</th>
<th data-quarto-table-cell-role="th">Positions</th>
<th data-quarto-table-cell-role="th">Height</th>
<th data-quarto-table-cell-role="th">Weight</th>
<th data-quarto-table-cell-role="th">Preferred Foot</th>
<th data-quarto-table-cell-role="th">BOV</th>
<th data-quarto-table-cell-role="th">Best Position</th>
<th data-quarto-table-cell-role="th">Joined</th>
<th data-quarto-table-cell-role="th">Loan Date End</th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Wage</th>
<th data-quarto-table-cell-role="th">Release Clause</th>
<th data-quarto-table-cell-role="th">Attacking</th>
<th data-quarto-table-cell-role="th">Crossing</th>
<th data-quarto-table-cell-role="th">Finishing</th>
<th data-quarto-table-cell-role="th">Heading Accuracy</th>
<th data-quarto-table-cell-role="th">Short Passing</th>
<th data-quarto-table-cell-role="th">Volleys</th>
<th data-quarto-table-cell-role="th">Skill</th>
<th data-quarto-table-cell-role="th">Dribbling</th>
<th data-quarto-table-cell-role="th">Curve</th>
<th data-quarto-table-cell-role="th">FK Accuracy</th>
<th data-quarto-table-cell-role="th">Long Passing</th>
<th data-quarto-table-cell-role="th">Ball Control</th>
<th data-quarto-table-cell-role="th">Movement</th>
<th data-quarto-table-cell-role="th">Acceleration</th>
<th data-quarto-table-cell-role="th">Sprint Speed</th>
<th data-quarto-table-cell-role="th">Agility</th>
<th data-quarto-table-cell-role="th">…</th>
<th data-quarto-table-cell-role="th">Strength</th>
<th data-quarto-table-cell-role="th">Long Shots</th>
<th data-quarto-table-cell-role="th">Mentality</th>
<th data-quarto-table-cell-role="th">Aggression</th>
<th data-quarto-table-cell-role="th">Interceptions</th>
<th data-quarto-table-cell-role="th">Positioning</th>
<th data-quarto-table-cell-role="th">Vision</th>
<th data-quarto-table-cell-role="th">Penalties</th>
<th data-quarto-table-cell-role="th">Composure</th>
<th data-quarto-table-cell-role="th">Defending</th>
<th data-quarto-table-cell-role="th">Marking</th>
<th data-quarto-table-cell-role="th">Standing Tackle</th>
<th data-quarto-table-cell-role="th">Sliding Tackle</th>
<th data-quarto-table-cell-role="th">Goalkeeping</th>
<th data-quarto-table-cell-role="th">GK Diving</th>
<th data-quarto-table-cell-role="th">GK Handling</th>
<th data-quarto-table-cell-role="th">GK Kicking</th>
<th data-quarto-table-cell-role="th">GK Positioning</th>
<th data-quarto-table-cell-role="th">GK Reflexes</th>
<th data-quarto-table-cell-role="th">Total Stats</th>
<th data-quarto-table-cell-role="th">Base Stats</th>
<th data-quarto-table-cell-role="th">W/F</th>
<th data-quarto-table-cell-role="th">SM</th>
<th data-quarto-table-cell-role="th">A/W</th>
<th data-quarto-table-cell-role="th">D/W</th>
<th data-quarto-table-cell-role="th">IR</th>
<th data-quarto-table-cell-role="th">PAC</th>
<th data-quarto-table-cell-role="th">SHO</th>
<th data-quarto-table-cell-role="th">PAS</th>
<th data-quarto-table-cell-role="th">DRI</th>
<th data-quarto-table-cell-role="th">DEF</th>
<th data-quarto-table-cell-role="th">PHY</th>
<th data-quarto-table-cell-role="th">Hits</th>
<th data-quarto-table-cell-role="th">contract_start</th>
<th data-quarto-table-cell-role="th">contract_end</th>
<th data-quarto-table-cell-role="th">free_agent</th>
<th data-quarto-table-cell-role="th">loan_date_start</th>
</tr>
<tr class="even">
<th>u32</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>cat</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>cat</th>
<th>list[str]</th>
<th>u8</th>
<th>u8</th>
<th>cat</th>
<th>u8</th>
<th>cat</th>
<th>date</th>
<th>date</th>
<th>u32</th>
<th>u32</th>
<th>u32</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>…</th>
<th>u8</th>
<th>u8</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u16</th>
<th>u16</th>
<th>u8</th>
<th>u8</th>
<th>cat</th>
<th>cat</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u8</th>
<th>u32</th>
<th>u16</th>
<th>u16</th>
<th>bool</th>
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>158023</td>
<td>"L. Messi"</td>
<td>"Lionel Messi"</td>
<td>"https://cdn.sofifa.com/players…</td>
<td>"http://sofifa.com/player/15802…</td>
<td>"Argentina"</td>
<td>33</td>
<td>93</td>
<td>93</td>
<td>"FC Barcelona"</td>
<td>["RW", " ST", " CF"]</td>
<td>170</td>
<td>72</td>
<td>"Left"</td>
<td>93</td>
<td>"RW"</td>
<td>2004-07-01</td>
<td>null</td>
<td>103500000</td>
<td>560000</td>
<td>138399993</td>
<td>429</td>
<td>85</td>
<td>95</td>
<td>70</td>
<td>91</td>
<td>88</td>
<td>470</td>
<td>96</td>
<td>93</td>
<td>94</td>
<td>91</td>
<td>96</td>
<td>451</td>
<td>91</td>
<td>80</td>
<td>91</td>
<td>…</td>
<td>69</td>
<td>94</td>
<td>347</td>
<td>44</td>
<td>40</td>
<td>93</td>
<td>95</td>
<td>75</td>
<td>96</td>
<td>91</td>
<td>32</td>
<td>35</td>
<td>24</td>
<td>54</td>
<td>6</td>
<td>11</td>
<td>15</td>
<td>14</td>
<td>8</td>
<td>2231</td>
<td>466</td>
<td>4</td>
<td>4</td>
<td>"Medium"</td>
<td>"Low"</td>
<td>5</td>
<td>85</td>
<td>92</td>
<td>91</td>
<td>95</td>
<td>38</td>
<td>65</td>
<td>771</td>
<td>2004</td>
<td>2021</td>
<td>false</td>
<td>null</td>
</tr>
<tr class="even">
<td>20801</td>
<td>"Cristiano Ronaldo"</td>
<td>"C. Ronaldo dos Santos Aveiro"</td>
<td>"https://cdn.sofifa.com/players…</td>
<td>"http://sofifa.com/player/20801…</td>
<td>"Portugal"</td>
<td>35</td>
<td>92</td>
<td>92</td>
<td>"Juventus"</td>
<td>["ST", " LW"]</td>
<td>187</td>
<td>83</td>
<td>"Right"</td>
<td>92</td>
<td>"ST"</td>
<td>2018-07-10</td>
<td>null</td>
<td>63000000</td>
<td>220000</td>
<td>75900001</td>
<td>437</td>
<td>84</td>
<td>95</td>
<td>90</td>
<td>82</td>
<td>86</td>
<td>414</td>
<td>88</td>
<td>81</td>
<td>76</td>
<td>77</td>
<td>92</td>
<td>431</td>
<td>87</td>
<td>91</td>
<td>87</td>
<td>…</td>
<td>78</td>
<td>93</td>
<td>353</td>
<td>63</td>
<td>29</td>
<td>95</td>
<td>82</td>
<td>84</td>
<td>95</td>
<td>84</td>
<td>28</td>
<td>32</td>
<td>24</td>
<td>58</td>
<td>7</td>
<td>11</td>
<td>15</td>
<td>14</td>
<td>11</td>
<td>2221</td>
<td>464</td>
<td>4</td>
<td>5</td>
<td>"High"</td>
<td>"Low"</td>
<td>5</td>
<td>89</td>
<td>93</td>
<td>81</td>
<td>89</td>
<td>35</td>
<td>77</td>
<td>562</td>
<td>2018</td>
<td>2022</td>
<td>false</td>
<td>null</td>
</tr>
<tr class="odd">
<td>200389</td>
<td>"J. Oblak"</td>
<td>"Jan Oblak"</td>
<td>"https://cdn.sofifa.com/players…</td>
<td>"http://sofifa.com/player/20038…</td>
<td>"Slovenia"</td>
<td>27</td>
<td>91</td>
<td>93</td>
<td>"Atlético Madrid"</td>
<td>["GK"]</td>
<td>188</td>
<td>87</td>
<td>"Right"</td>
<td>91</td>
<td>"GK"</td>
<td>2014-07-16</td>
<td>null</td>
<td>120000000</td>
<td>125000</td>
<td>159399993</td>
<td>95</td>
<td>13</td>
<td>11</td>
<td>15</td>
<td>43</td>
<td>13</td>
<td>109</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>40</td>
<td>30</td>
<td>307</td>
<td>43</td>
<td>60</td>
<td>67</td>
<td>…</td>
<td>78</td>
<td>12</td>
<td>140</td>
<td>34</td>
<td>19</td>
<td>11</td>
<td>65</td>
<td>11</td>
<td>68</td>
<td>57</td>
<td>27</td>
<td>12</td>
<td>18</td>
<td>437</td>
<td>87</td>
<td>92</td>
<td>78</td>
<td>90</td>
<td>90</td>
<td>1413</td>
<td>489</td>
<td>3</td>
<td>1</td>
<td>"Medium"</td>
<td>"Medium"</td>
<td>3</td>
<td>87</td>
<td>92</td>
<td>78</td>
<td>90</td>
<td>52</td>
<td>90</td>
<td>150</td>
<td>2014</td>
<td>2023</td>
<td>false</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-14-2">
<div id="c4e6b246" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a>fifa_pd.head(<span class="dv">3</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">LongName</th>
<th data-quarto-table-cell-role="th">photoUrl</th>
<th data-quarto-table-cell-role="th">playerUrl</th>
<th data-quarto-table-cell-role="th">Nationality</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">OVA</th>
<th data-quarto-table-cell-role="th">POT</th>
<th data-quarto-table-cell-role="th">Club</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">SHO</th>
<th data-quarto-table-cell-role="th">PAS</th>
<th data-quarto-table-cell-role="th">DRI</th>
<th data-quarto-table-cell-role="th">DEF</th>
<th data-quarto-table-cell-role="th">PHY</th>
<th data-quarto-table-cell-role="th">Hits</th>
<th data-quarto-table-cell-role="th">contract_start</th>
<th data-quarto-table-cell-role="th">contract_end</th>
<th data-quarto-table-cell-role="th">free_agent</th>
<th data-quarto-table-cell-role="th">loan_date_start</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>158023</td>
<td>L. Messi</td>
<td>Lionel Messi</td>
<td>https://cdn.sofifa.com/players/158/023/21_60.png</td>
<td>http://sofifa.com/player/158023/lionel-messi/2...</td>
<td>Argentina</td>
<td>33</td>
<td>93</td>
<td>93</td>
<td>FC Barcelona</td>
<td>...</td>
<td>92</td>
<td>91</td>
<td>95</td>
<td>38</td>
<td>65</td>
<td>771</td>
<td>2004</td>
<td>2021</td>
<td>False</td>
<td>NaT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>20801</td>
<td>Cristiano Ronaldo</td>
<td>C. Ronaldo dos Santos Aveiro</td>
<td>https://cdn.sofifa.com/players/020/801/21_60.png</td>
<td>http://sofifa.com/player/20801/c-ronaldo-dos-s...</td>
<td>Portugal</td>
<td>35</td>
<td>92</td>
<td>92</td>
<td>Juventus</td>
<td>...</td>
<td>93</td>
<td>81</td>
<td>89</td>
<td>35</td>
<td>77</td>
<td>562</td>
<td>2018</td>
<td>2022</td>
<td>False</td>
<td>NaT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>200389</td>
<td>J. Oblak</td>
<td>Jan Oblak</td>
<td>https://cdn.sofifa.com/players/200/389/21_60.png</td>
<td>http://sofifa.com/player/200389/jan-oblak/210006/</td>
<td>Slovenia</td>
<td>27</td>
<td>91</td>
<td>93</td>
<td>Atlético Madrid</td>
<td>...</td>
<td>92</td>
<td>78</td>
<td>90</td>
<td>52</td>
<td>90</td>
<td>150</td>
<td>2014</td>
<td>2023</td>
<td>False</td>
<td>NaT</td>
</tr>
</tbody>
</table>

<p>3 rows × 80 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="порівняння-продуктивності-2" class="slide level2">
<h2>Порівняння продуктивності</h2>
<p>У цьому сценарії перевага Polars у швидкості, ймовірно, зводиться до трьох речей:</p>
<ul>
<li>Він набагато швидше читає CSV-файли.</li>
<li>Він набагато швидше обробляє рядки.</li>
<li>Він може вибирати/призначати стовпці паралельно.</li>
</ul>
</section>
<section id="numpy-може-іноді-прискорювати-роботу-polars" class="slide level2">
<h2>NumPy може іноді прискорювати роботу Polars</h2>
<p>Polars добре ладнає з утилітами NumPy, навіть у лінивому режимі (що цікаво, оскільки NumPy не має лінивого API).</p>
<p>Дані:</p>
<div id="cc142aab" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="" aria-hidden="true" tabindex="-1"></a>airports <span class="op">=</span> pl.scan_csv(<span class="st">"data/airports.csv"</span>).drop_nulls().unique(subset<span class="op">=</span>[<span class="st">"AIRPORT"</span>])</span>
<span id="cb48-2"><a href="" aria-hidden="true" tabindex="-1"></a>pairs <span class="op">=</span> airports.join(airports, how<span class="op">=</span><span class="st">"cross"</span>).<span class="bu">filter</span>(</span>
<span id="cb48-3"><a href="" aria-hidden="true" tabindex="-1"></a>    (pl.col(<span class="st">"AIRPORT"</span>) <span class="op">!=</span> pl.col(<span class="st">"AIRPORT_right"</span>))</span>
<span id="cb48-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (pl.col(<span class="st">"LATITUDE"</span>) <span class="op">!=</span> pl.col(<span class="st">"LATITUDE_right"</span>))</span>
<span id="cb48-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (pl.col(<span class="st">"LONGITUDE"</span>) <span class="op">!=</span> pl.col(<span class="st">"LONGITUDE_right"</span>))</span>
<span id="cb48-6"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="розрахувати-відстань-по-великому-колу" class="slide level2">
<h2>Розрахувати відстань по великому колу</h2>
<p><span class="math display">\[
d = 2r \cdot \arccos(\sin(\varphi_1) \cdot \sin(\varphi_2) + \cos(\varphi_1) \cdot \cos(\varphi_2) \cdot \cos(\theta_1 - \theta_2))
\]</span></p>
<div class="footer">
<p><a href="https://en.wikipedia.org/wiki/Great-circle_distance#:~:text=The%20great%2Dcircle%20distance%2C%20orthodromic,the%20surface%20of%20the%20sphere.">Great-circle distance</a></p>
</div>
<div class="panel-tabset">
<ul id="tabset-15" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-15-1">Polars</a></li><li><a href="#tabset-15-2">NumPy</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1">
<div id="2062414c" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> deg2rad_pl(degrees: pl.Expr) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb49-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> degrees <span class="op">*</span> math.pi <span class="op">/</span> <span class="dv">180</span></span>
<span id="cb49-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gcd_pl(lat1: pl.Expr, lng1: pl.Expr, lat2: pl.Expr, lng2: pl.Expr):</span>
<span id="cb49-5"><a href="" aria-hidden="true" tabindex="-1"></a>    ϕ<span class="dv">1</span> <span class="op">=</span> deg2rad_pl(<span class="dv">90</span> <span class="op">-</span> lat1)</span>
<span id="cb49-6"><a href="" aria-hidden="true" tabindex="-1"></a>    ϕ<span class="dv">2</span> <span class="op">=</span> deg2rad_pl(<span class="dv">90</span> <span class="op">-</span> lat2)</span>
<span id="cb49-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="" aria-hidden="true" tabindex="-1"></a>    θ<span class="dv">1</span> <span class="op">=</span> deg2rad_pl(lng1)</span>
<span id="cb49-9"><a href="" aria-hidden="true" tabindex="-1"></a>    θ<span class="dv">2</span> <span class="op">=</span> deg2rad_pl(lng2)</span>
<span id="cb49-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="" aria-hidden="true" tabindex="-1"></a>    cos <span class="op">=</span> ϕ<span class="fl">1.</span><span class="er">sin</span>() <span class="op">*</span> ϕ<span class="fl">2.</span><span class="er">sin</span>() <span class="op">*</span> (θ<span class="dv">1</span> <span class="op">-</span> θ<span class="dv">2</span>).cos() <span class="op">+</span> ϕ<span class="fl">1.</span><span class="er">cos</span>() <span class="op">*</span> ϕ<span class="fl">2.</span><span class="er">cos</span>()</span>
<span id="cb49-12"><a href="" aria-hidden="true" tabindex="-1"></a>    arc <span class="op">=</span> cos.arccos()</span>
<span id="cb49-13"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arc <span class="op">*</span> <span class="dv">6373</span></span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-15-2">
<div id="7455db4b" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gcd_np(lat1, lng1, lat2, lng2):</span>
<span id="cb50-2"><a href="" aria-hidden="true" tabindex="-1"></a>    ϕ<span class="dv">1</span> <span class="op">=</span> np.deg2rad(<span class="dv">90</span> <span class="op">-</span> lat1)</span>
<span id="cb50-3"><a href="" aria-hidden="true" tabindex="-1"></a>    ϕ<span class="dv">2</span> <span class="op">=</span> np.deg2rad(<span class="dv">90</span> <span class="op">-</span> lat2)</span>
<span id="cb50-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="" aria-hidden="true" tabindex="-1"></a>    θ<span class="dv">1</span> <span class="op">=</span> np.deg2rad(lng1)</span>
<span id="cb50-6"><a href="" aria-hidden="true" tabindex="-1"></a>    θ<span class="dv">2</span> <span class="op">=</span> np.deg2rad(lng2)</span>
<span id="cb50-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="" aria-hidden="true" tabindex="-1"></a>    cos <span class="op">=</span> np.sin(ϕ<span class="dv">1</span>) <span class="op">*</span> np.sin(ϕ<span class="dv">2</span>) <span class="op">*</span> np.cos(θ<span class="dv">1</span> <span class="op">-</span> θ<span class="dv">2</span>) <span class="op">+</span> np.cos(ϕ<span class="dv">1</span>) <span class="op">*</span> np.cos(ϕ<span class="dv">2</span>)</span>
<span id="cb50-9"><a href="" aria-hidden="true" tabindex="-1"></a>    arc <span class="op">=</span> np.arccos(cos)</span>
<span id="cb50-10"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arc <span class="op">*</span> <span class="dv">6373</span></span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="розрахувати-відстань-по-великому-колу-1" class="slide level2">
<h2>Розрахувати відстань по великому колу</h2>
<div class="panel-tabset">
<ul id="tabset-16" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-16-1">Polars</a></li><li><a href="#tabset-16-2">NumPy</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1">
<div id="ecf3a8d6" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb51-2"><a href="" aria-hidden="true" tabindex="-1"></a>pairs.select(</span>
<span id="cb51-3"><a href="" aria-hidden="true" tabindex="-1"></a>    gcd_pl(</span>
<span id="cb51-4"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LATITUDE"</span>),</span>
<span id="cb51-5"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LONGITUDE"</span>),</span>
<span id="cb51-6"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LATITUDE_right"</span>),</span>
<span id="cb51-7"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LONGITUDE_right"</span>)</span>
<span id="cb51-8"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-9"><a href="" aria-hidden="true" tabindex="-1"></a>).collect()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>828 ms ± 44.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2">
<div id="adedb64e" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb53-2"><a href="" aria-hidden="true" tabindex="-1"></a>pairs.select(</span>
<span id="cb53-3"><a href="" aria-hidden="true" tabindex="-1"></a>    gcd_np(</span>
<span id="cb53-4"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LATITUDE"</span>),</span>
<span id="cb53-5"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LONGITUDE"</span>),</span>
<span id="cb53-6"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LATITUDE_right"</span>),</span>
<span id="cb53-7"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"LONGITUDE_right"</span>)</span>
<span id="cb53-8"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-9"><a href="" aria-hidden="true" tabindex="-1"></a>).collect()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.48 s ± 69 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="polars-інколи-повільший-за-pandas" class="slide level2 tiny scrollable">
<h2>Polars інколи повільший за Pandas</h2>
<div id="4203ab60" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_frame(n, n_groups):</span>
<span id="cb55-2"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pl.DataFrame(</span>
<span id="cb55-3"><a href="" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"name"</span>: np.random.randint(<span class="dv">0</span>, n_groups, size<span class="op">=</span>n), <span class="st">"value2"</span>: np.random.randn(n)}</span>
<span id="cb55-4"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pandas_transform(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb55-7"><a href="" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> df.groupby(<span class="st">"name"</span>)[<span class="st">"value2"</span>]</span>
<span id="cb55-8"><a href="" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> df[<span class="st">"value2"</span>]</span>
<span id="cb55-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v <span class="op">-</span> g.transform(<span class="st">"mean"</span>)) <span class="op">/</span> g.transform(<span class="st">"std"</span>)</span>
<span id="cb55-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> polars_transform() <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb55-13"><a href="" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> pl.col(<span class="st">"value2"</span>)</span>
<span id="cb55-14"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v <span class="op">-</span> v.mean().over(<span class="st">"name"</span>)) <span class="op">/</span> v.std().over(<span class="st">"name"</span>)</span>
<span id="cb55-15"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="" aria-hidden="true" tabindex="-1"></a>rand_df_pl <span class="op">=</span> create_frame(<span class="dv">50_000_000</span>, <span class="dv">50_000</span>)</span>
<span id="cb55-17"><a href="" aria-hidden="true" tabindex="-1"></a>rand_df_pd <span class="op">=</span> rand_df_pl.to_pandas()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul id="tabset-17" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-17-1">Polars</a></li><li><a href="#tabset-17-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1">
<div id="1e355833" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit rand_df_pl.select(polars_transform())</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>751 ms ± 14.3 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
</div>
<div id="tabset-17-2">
<div id="baa1461c" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit pandas_transform(rand_df_pd)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.19 s ± 127 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="охайні-дані" class="title-slide slide level1 center">
<h1>Охайні дані</h1>

</section>
<section id="охайні-дані-1" class="slide level2">
<h2>Охайні дані</h2>
<p>Існує <a href="https://vita.had.co.nz/papers/tidy-data.pdf">ціла стаття</a> Хедлі Вікхем (Hadley Wickham) про чисті дані, але вона у форматі PDF, тому ви, мабуть, не будете її читати. Ось визначення чистих даних, наведене в цій статті:</p>
<ol type="1">
<li>Кожна змінна утворює стовпець.</li>
<li>Кожне спостереження формує рядок.</li>
<li>Кожен тип одиниці спостереження формує таблицю.</li>
</ol>
</section>
<section id="дані-nba" class="slide level2 tiny scrollable">
<h2>Дані NBA</h2>
<div id="2c881be2" class="cell columns column-output-location" data-execution_count="46">
<div class="column">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb60-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb60-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb60-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="" aria-hidden="true" tabindex="-1"></a>pl.Config.set_tbl_rows(<span class="dv">5</span>)</span>
<span id="cb60-6"><a href="" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_rows <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb60-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="" aria-hidden="true" tabindex="-1"></a>nba_dir <span class="op">=</span> Path(<span class="st">"data/nba/"</span>)</span>
<span id="cb60-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="" aria-hidden="true" tabindex="-1"></a>column_names <span class="op">=</span> {</span>
<span id="cb60-11"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Date"</span>: <span class="st">"date"</span>,</span>
<span id="cb60-12"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Visitor/Neutral"</span>: <span class="st">"away_team"</span>,</span>
<span id="cb60-13"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PTS"</span>: <span class="st">"away_points"</span>,</span>
<span id="cb60-14"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Home/Neutral"</span>: <span class="st">"home_team"</span>,</span>
<span id="cb60-15"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PTS.1"</span>: <span class="st">"home_points"</span>,</span>
<span id="cb60-16"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-17"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> nba_dir.exists():</span>
<span id="cb60-19"><a href="" aria-hidden="true" tabindex="-1"></a>    nba_dir.mkdir()</span>
<span id="cb60-20"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> month <span class="kw">in</span> (</span>
<span id="cb60-21"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"october"</span>,</span>
<span id="cb60-22"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"november"</span>,</span>
<span id="cb60-23"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"december"</span>,</span>
<span id="cb60-24"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"january"</span>,</span>
<span id="cb60-25"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"february"</span>,</span>
<span id="cb60-26"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"march"</span>,</span>
<span id="cb60-27"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"april"</span>,</span>
<span id="cb60-28"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"may"</span>,</span>
<span id="cb60-29"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="st">"june"</span>,</span>
<span id="cb60-30"><a href="" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb60-31"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># На практиці ми б зробили більше очищення даних тут, і зберегли б у паркет, а не CSV.</span></span>
<span id="cb60-32"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Але ми зберігаємо брудні дані тут, щоб потім очистити їх для педагогічних цілей.</span></span>
<span id="cb60-33"><a href="" aria-hidden="true" tabindex="-1"></a>        url <span class="op">=</span> <span class="ss">f"http://www.basketball-reference.com/leagues/NBA_2016_games-</span><span class="sc">{</span>month<span class="sc">}</span><span class="ss">.html"</span></span>
<span id="cb60-34"><a href="" aria-hidden="true" tabindex="-1"></a>        tables <span class="op">=</span> pd.read_html(url)</span>
<span id="cb60-35"><a href="" aria-hidden="true" tabindex="-1"></a>        raw <span class="op">=</span> (</span>
<span id="cb60-36"><a href="" aria-hidden="true" tabindex="-1"></a>            pl.from_pandas(tables[<span class="dv">0</span>].query(<span class="st">"Date != 'Playoffs'"</span>))</span>
<span id="cb60-37"><a href="" aria-hidden="true" tabindex="-1"></a>            .rename(column_names)</span>
<span id="cb60-38"><a href="" aria-hidden="true" tabindex="-1"></a>            .select(column_names.values())</span>
<span id="cb60-39"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb60-40"><a href="" aria-hidden="true" tabindex="-1"></a>        raw.write_csv(nba_dir <span class="op">/</span> <span class="ss">f"</span><span class="sc">{</span>month<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb60-41"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-42"><a href="" aria-hidden="true" tabindex="-1"></a>nba_glob <span class="op">=</span> nba_dir <span class="op">/</span> <span class="st">"*.csv"</span></span>
<span id="cb60-43"><a href="" aria-hidden="true" tabindex="-1"></a>pl.scan_csv(nba_glob).head().collect()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display" data-execution_count="44">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">away_points</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">home_points</th>
</tr>
<tr class="even">
<th>str</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Fri, Apr 1, 2016"</td>
<td>"Philadelphia 76ers"</td>
<td>91</td>
<td>"Charlotte Hornets"</td>
<td>100</td>
</tr>
<tr class="even">
<td>"Fri, Apr 1, 2016"</td>
<td>"Dallas Mavericks"</td>
<td>98</td>
<td>"Detroit Pistons"</td>
<td>89</td>
</tr>
<tr class="odd">
<td>"Fri, Apr 1, 2016"</td>
<td>"Brooklyn Nets"</td>
<td>91</td>
<td>"New York Knicks"</td>
<td>105</td>
</tr>
<tr class="even">
<td>"Fri, Apr 1, 2016"</td>
<td>"Cleveland Cavaliers"</td>
<td>110</td>
<td>"Atlanta Hawks"</td>
<td>108</td>
</tr>
<tr class="odd">
<td>"Fri, Apr 1, 2016"</td>
<td>"Toronto Raptors"</td>
<td>99</td>
<td>"Memphis Grizzlies"</td>
<td>95</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section>
<section id="очистка-даних" class="slide level2 tiny">
<h2>Очистка даних</h2>
<div class="panel-tabset">
<ul id="tabset-18" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-18-1">Polars</a></li><li><a href="#tabset-18-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1">
<div id="7142e2ae" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="" aria-hidden="true" tabindex="-1"></a>games_pl <span class="op">=</span> (</span>
<span id="cb61-2"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.scan_csv(nba_glob)</span>
<span id="cb61-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb61-4"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"date"</span>).<span class="bu">str</span>.strptime(pl.Date, <span class="st">"%a, %b </span><span class="sc">%d</span><span class="st">, %Y"</span>),</span>
<span id="cb61-5"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-6"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"date"</span>)</span>
<span id="cb61-7"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_row_index(<span class="st">"game_id"</span>)</span>
<span id="cb61-8"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-9"><a href="" aria-hidden="true" tabindex="-1"></a>games_pl.head().collect()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 6)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">away_points</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">home_points</th>
</tr>
<tr class="even">
<th>u32</th>
<th>date</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>2015-10-27</td>
<td>"Cleveland Cavaliers"</td>
<td>95</td>
<td>"Chicago Bulls"</td>
<td>97</td>
</tr>
<tr class="even">
<td>1</td>
<td>2015-10-27</td>
<td>"Detroit Pistons"</td>
<td>106</td>
<td>"Atlanta Hawks"</td>
<td>94</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2015-10-27</td>
<td>"New Orleans Pelicans"</td>
<td>95</td>
<td>"Golden State Warriors"</td>
<td>111</td>
</tr>
<tr class="even">
<td>3</td>
<td>2015-10-28</td>
<td>"Washington Wizards"</td>
<td>88</td>
<td>"Orlando Magic"</td>
<td>87</td>
</tr>
<tr class="odd">
<td>4</td>
<td>2015-10-28</td>
<td>"Philadelphia 76ers"</td>
<td>95</td>
<td>"Boston Celtics"</td>
<td>112</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-18-2">
<div id="936b88d6" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="" aria-hidden="true" tabindex="-1"></a>games_pd <span class="op">=</span> (</span>
<span id="cb62-2"><a href="" aria-hidden="true" tabindex="-1"></a>    pl.read_csv(nba_glob)</span>
<span id="cb62-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb62-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .dropna(how<span class="op">=</span><span class="st">"all"</span>)</span>
<span id="cb62-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(date<span class="op">=</span><span class="kw">lambda</span> x: pd.to_datetime(x[<span class="st">"date"</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"%a, %b </span><span class="sc">%d</span><span class="st">, %Y"</span>))</span>
<span id="cb62-6"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"date"</span>)</span>
<span id="cb62-7"><a href="" aria-hidden="true" tabindex="-1"></a>    .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"date"</span>, append<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename_axis([<span class="st">"game_id"</span>, <span class="st">"date"</span>])</span>
<span id="cb62-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort_index()</span>
<span id="cb62-11"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-12"><a href="" aria-hidden="true" tabindex="-1"></a>games_pd.head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">away_points</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">home_points</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td data-quarto-table-cell-role="th">2015-10-27</td>
<td>Cleveland Cavaliers</td>
<td>95</td>
<td>Chicago Bulls</td>
<td>97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td data-quarto-table-cell-role="th">2015-10-27</td>
<td>Detroit Pistons</td>
<td>106</td>
<td>Atlanta Hawks</td>
<td>94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td data-quarto-table-cell-role="th">2015-10-27</td>
<td>New Orleans Pelicans</td>
<td>95</td>
<td>Golden State Warriors</td>
<td>111</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td data-quarto-table-cell-role="th">2015-10-28</td>
<td>Philadelphia 76ers</td>
<td>95</td>
<td>Boston Celtics</td>
<td>112</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td data-quarto-table-cell-role="th">2015-10-28</td>
<td>Washington Wizards</td>
<td>88</td>
<td>Orlando Magic</td>
<td>87</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="pivot" class="slide level2 tiny">
<h2>Pivot</h2>
<p>Припустимо, у вас є фреймворк даних, який виглядає так:</p>
<div id="bcd841af" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Код</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb63-2"><a href="" aria-hidden="true" tabindex="-1"></a>prices <span class="op">=</span> pl.DataFrame({</span>
<span id="cb63-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"date"</span>: [<span class="op">*</span>[date(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">1</span>)]<span class="op">*</span><span class="dv">4</span>, <span class="op">*</span>[date(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">2</span>)]<span class="op">*</span><span class="dv">4</span>, <span class="op">*</span>[date(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">3</span>)]<span class="op">*</span><span class="dv">4</span>],</span>
<span id="cb63-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ticker"</span>: [<span class="op">*</span>[<span class="st">"AAPL"</span>, <span class="st">"TSLA"</span>, <span class="st">"MSFT"</span>, <span class="st">"NFLX"</span>]<span class="op">*</span><span class="dv">3</span>],</span>
<span id="cb63-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="st">"price"</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">110</span>, <span class="dv">220</span>, <span class="dv">330</span>, <span class="dv">420</span>, <span class="dv">105</span>, <span class="dv">210</span>, <span class="dv">315</span>, <span class="dv">440</span>],</span>
<span id="cb63-6"><a href="" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb63-7"><a href="" aria-hidden="true" tabindex="-1"></a>prices</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="47">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 3)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">ticker</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2020-01-01</td>
<td>"AAPL"</td>
<td>100</td>
</tr>
<tr class="even">
<td>2020-01-01</td>
<td>"TSLA"</td>
<td>200</td>
</tr>
<tr class="odd">
<td>2020-01-01</td>
<td>"MSFT"</td>
<td>300</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2020-01-03</td>
<td>"MSFT"</td>
<td>315</td>
</tr>
<tr class="even">
<td>2020-01-03</td>
<td>"NFLX"</td>
<td>440</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>І в Polars, і в Pandas ви можете викликати <code>df.pivot</code>, щоб отримати фрейм даних, який виглядає так:</p>
<div id="6ed6c155" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Код</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="" aria-hidden="true" tabindex="-1"></a>pivoted <span class="op">=</span> prices.pivot(index<span class="op">=</span><span class="st">"date"</span>, values<span class="op">=</span><span class="st">"price"</span>, on<span class="op">=</span><span class="st">"ticker"</span>)</span>
<span id="cb64-2"><a href="" aria-hidden="true" tabindex="-1"></a>pivoted</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">TSLA</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">NFLX</th>
</tr>
<tr class="even">
<th>date</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2020-01-01</td>
<td>100</td>
<td>200</td>
<td>300</td>
<td>400</td>
</tr>
<tr class="even">
<td>2020-01-02</td>
<td>110</td>
<td>220</td>
<td>330</td>
<td>420</td>
</tr>
<tr class="odd">
<td>2020-01-03</td>
<td>105</td>
<td>210</td>
<td>315</td>
<td>440</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="melt-unpivot" class="slide level2 tiny">
<h2>Melt/ Unpivot</h2>
<div id="f8004466" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="" aria-hidden="true" tabindex="-1"></a>pivoted.unpivot(index<span class="op">=</span><span class="st">"date"</span>, value_name<span class="op">=</span><span class="st">"price"</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 3)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
<tr class="even">
<th>date</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2020-01-01</td>
<td>"AAPL"</td>
<td>100</td>
</tr>
<tr class="even">
<td>2020-01-02</td>
<td>"AAPL"</td>
<td>110</td>
</tr>
<tr class="odd">
<td>2020-01-03</td>
<td>"AAPL"</td>
<td>105</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2020-01-02</td>
<td>"NFLX"</td>
<td>420</td>
</tr>
<tr class="even">
<td>2020-01-03</td>
<td>"NFLX"</td>
<td>440</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="tidy-nba-data" class="slide level2 tiny scrollable">
<h2>Tidy NBA data</h2>
<p>Припустимо, ми хочемо порахувати дні відпочинку кожної команди перед кожною грою. У поточній структурі це складно, оскільки нам потрібно відстежувати обидва стовпці <code>home_team</code> і <code>away_team</code></p>
<div class="panel-tabset">
<ul id="tabset-19" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-19-1">Polars</a></li><li><a href="#tabset-19-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1">
<div id="44dc5215" class="cell columns column-output-location" data-execution_count="52">
<div class="column">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="" aria-hidden="true" tabindex="-1"></a>tidy_pl <span class="op">=</span> (</span>
<span id="cb66-2"><a href="" aria-hidden="true" tabindex="-1"></a>    games_pl</span>
<span id="cb66-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .unpivot(</span>
<span id="cb66-4"><a href="" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="st">"game_id"</span>, <span class="st">"date"</span>],</span>
<span id="cb66-5"><a href="" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span>[<span class="st">"away_team"</span>, <span class="st">"home_team"</span>],</span>
<span id="cb66-6"><a href="" aria-hidden="true" tabindex="-1"></a>        value_name<span class="op">=</span><span class="st">"team"</span>,</span>
<span id="cb66-7"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"game_id"</span>)</span>
<span id="cb66-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns((</span>
<span id="cb66-10"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"date"</span>)</span>
<span id="cb66-11"><a href="" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"rest"</span>)</span>
<span id="cb66-12"><a href="" aria-hidden="true" tabindex="-1"></a>        .diff().over(<span class="st">"team"</span>)</span>
<span id="cb66-13"><a href="" aria-hidden="true" tabindex="-1"></a>        .dt.total_days() <span class="op">-</span> <span class="dv">1</span>).cast(pl.Int8))</span>
<span id="cb66-14"><a href="" aria-hidden="true" tabindex="-1"></a>    .drop_nulls(<span class="st">"rest"</span>)</span>
<span id="cb66-15"><a href="" aria-hidden="true" tabindex="-1"></a>    .collect()</span>
<span id="cb66-16"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-17"><a href="" aria-hidden="true" tabindex="-1"></a>tidy_pl</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display" data-execution_count="50">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2_602, 5)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">rest</th>
</tr>
<tr class="even">
<th>u32</th>
<th>date</th>
<th>str</th>
<th>str</th>
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>2015-10-28</td>
<td>"away_team"</td>
<td>"Chicago Bulls"</td>
<td>0</td>
</tr>
<tr class="even">
<td>6</td>
<td>2015-10-28</td>
<td>"home_team"</td>
<td>"Detroit Pistons"</td>
<td>0</td>
</tr>
<tr class="odd">
<td>11</td>
<td>2015-10-28</td>
<td>"away_team"</td>
<td>"Cleveland Cavaliers"</td>
<td>0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1315</td>
<td>2016-06-19</td>
<td>"away_team"</td>
<td>"Cleveland Cavaliers"</td>
<td>2</td>
</tr>
<tr class="even">
<td>1315</td>
<td>2016-06-19</td>
<td>"home_team"</td>
<td>"Golden State Warriors"</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</div>
<div id="tabset-19-2">
<div id="f3f42c9f" class="cell columns column-output-location" data-execution_count="53">
<div class="column">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="" aria-hidden="true" tabindex="-1"></a>tidy_pd <span class="op">=</span> (</span>
<span id="cb67-2"><a href="" aria-hidden="true" tabindex="-1"></a>    games_pd.reset_index()</span>
<span id="cb67-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .melt(</span>
<span id="cb67-4"><a href="" aria-hidden="true" tabindex="-1"></a>        id_vars<span class="op">=</span>[<span class="st">"game_id"</span>, <span class="st">"date"</span>],</span>
<span id="cb67-5"><a href="" aria-hidden="true" tabindex="-1"></a>        value_vars<span class="op">=</span>[<span class="st">"away_team"</span>, <span class="st">"home_team"</span>],</span>
<span id="cb67-6"><a href="" aria-hidden="true" tabindex="-1"></a>        value_name<span class="op">=</span><span class="st">"team"</span>,</span>
<span id="cb67-7"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"game_id"</span>)</span>
<span id="cb67-9"><a href="" aria-hidden="true" tabindex="-1"></a>    .assign(</span>
<span id="cb67-10"><a href="" aria-hidden="true" tabindex="-1"></a>        rest<span class="op">=</span><span class="kw">lambda</span> df: (</span>
<span id="cb67-11"><a href="" aria-hidden="true" tabindex="-1"></a>            df</span>
<span id="cb67-12"><a href="" aria-hidden="true" tabindex="-1"></a>            .sort_values(<span class="st">"date"</span>)</span>
<span id="cb67-13"><a href="" aria-hidden="true" tabindex="-1"></a>            .groupby(<span class="st">"team"</span>)</span>
<span id="cb67-14"><a href="" aria-hidden="true" tabindex="-1"></a>            [<span class="st">"date"</span>]</span>
<span id="cb67-15"><a href="" aria-hidden="true" tabindex="-1"></a>            .diff()</span>
<span id="cb67-16"><a href="" aria-hidden="true" tabindex="-1"></a>            .dt.days</span>
<span id="cb67-17"><a href="" aria-hidden="true" tabindex="-1"></a>            .sub(<span class="dv">1</span>)</span>
<span id="cb67-18"><a href="" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb67-19"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-20"><a href="" aria-hidden="true" tabindex="-1"></a>    .dropna(subset<span class="op">=</span>[<span class="st">"rest"</span>])</span>
<span id="cb67-21"><a href="" aria-hidden="true" tabindex="-1"></a>    .astype({<span class="st">"rest"</span>: pd.Int8Dtype()})</span>
<span id="cb67-22"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-23"><a href="" aria-hidden="true" tabindex="-1"></a>tidy_pd</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display" data-execution_count="51">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">rest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>2015-10-28</td>
<td>away_team</td>
<td>New Orleans Pelicans</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>11</td>
<td>2015-10-28</td>
<td>away_team</td>
<td>Chicago Bulls</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1315</td>
<td>1315</td>
<td>2016-06-19</td>
<td>away_team</td>
<td>Cleveland Cavaliers</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2631</td>
<td>1315</td>
<td>2016-06-19</td>
<td>home_team</td>
<td>Golden State Warriors</td>
<td>2</td>
</tr>
</tbody>
</table>

<p>2602 rows × 5 columns</p>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="tidy-nba-data-1" class="slide level2 tiny scrollable">
<h2>Tidy NBA data</h2>
<p>Тепер ми використовуємо <code>.pivot</code>, щоб додати ці дані про дні відпочинку назад до вихідного фрейму даних.</p>
<div class="panel-tabset">
<ul id="tabset-20" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-20-1">Polars</a></li><li><a href="#tabset-20-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1">
<div id="16a589da" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="" aria-hidden="true" tabindex="-1"></a>by_game_pl <span class="op">=</span> (</span>
<span id="cb68-2"><a href="" aria-hidden="true" tabindex="-1"></a>    tidy_pl</span>
<span id="cb68-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .pivot(</span>
<span id="cb68-4"><a href="" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">"rest"</span>,</span>
<span id="cb68-5"><a href="" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="st">"game_id"</span>, <span class="st">"date"</span>],</span>
<span id="cb68-6"><a href="" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"variable"</span></span>
<span id="cb68-7"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename({<span class="st">"away_team"</span>: <span class="st">"away_rest"</span>, <span class="st">"home_team"</span>: <span class="st">"home_rest"</span>})</span>
<span id="cb68-9"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-10"><a href="" aria-hidden="true" tabindex="-1"></a>joined_pl <span class="op">=</span> (</span>
<span id="cb68-11"><a href="" aria-hidden="true" tabindex="-1"></a>    by_game_pl</span>
<span id="cb68-12"><a href="" aria-hidden="true" tabindex="-1"></a>    .join(games_pl.collect(), on<span class="op">=</span>[<span class="st">"game_id"</span>, <span class="st">"date"</span>])</span>
<span id="cb68-13"><a href="" aria-hidden="true" tabindex="-1"></a>    .with_columns([</span>
<span id="cb68-14"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"home_points"</span>).alias(<span class="st">"home_win"</span>) <span class="op">&gt;</span> pl.col(<span class="st">"away_points"</span>),</span>
<span id="cb68-15"><a href="" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"home_rest"</span>).alias(<span class="st">"rest_spread"</span>) <span class="op">-</span> pl.col(<span class="st">"away_rest"</span>),</span>
<span id="cb68-16"><a href="" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb68-17"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-18"><a href="" aria-hidden="true" tabindex="-1"></a>joined_pl</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1_303, 10)</small>
<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">away_rest</th>
<th data-quarto-table-cell-role="th">home_rest</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">away_points</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">home_points</th>
<th data-quarto-table-cell-role="th">home_win</th>
<th data-quarto-table-cell-role="th">rest_spread</th>
</tr>
<tr class="even">
<th>u32</th>
<th>date</th>
<th>i8</th>
<th>i8</th>
<th>str</th>
<th>i64</th>
<th>str</th>
<th>i64</th>
<th>bool</th>
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>2015-10-28</td>
<td>0</td>
<td>null</td>
<td>"Chicago Bulls"</td>
<td>115</td>
<td>"Brooklyn Nets"</td>
<td>100</td>
<td>false</td>
<td>null</td>
</tr>
<tr class="even">
<td>6</td>
<td>2015-10-28</td>
<td>null</td>
<td>0</td>
<td>"Utah Jazz"</td>
<td>87</td>
<td>"Detroit Pistons"</td>
<td>92</td>
<td>true</td>
<td>null</td>
</tr>
<tr class="odd">
<td>11</td>
<td>2015-10-28</td>
<td>0</td>
<td>null</td>
<td>"Cleveland Cavaliers"</td>
<td>106</td>
<td>"Memphis Grizzlies"</td>
<td>76</td>
<td>false</td>
<td>null</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1314</td>
<td>2016-06-16</td>
<td>2</td>
<td>2</td>
<td>"Golden State Warriors"</td>
<td>101</td>
<td>"Cleveland Cavaliers"</td>
<td>115</td>
<td>true</td>
<td>0</td>
</tr>
<tr class="even">
<td>1315</td>
<td>2016-06-19</td>
<td>2</td>
<td>2</td>
<td>"Cleveland Cavaliers"</td>
<td>93</td>
<td>"Golden State Warriors"</td>
<td>89</td>
<td>false</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="tabset-20-2">
<div id="a1c150eb" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="" aria-hidden="true" tabindex="-1"></a>by_game_pd <span class="op">=</span> (</span>
<span id="cb69-2"><a href="" aria-hidden="true" tabindex="-1"></a>    tidy_pd</span>
<span id="cb69-3"><a href="" aria-hidden="true" tabindex="-1"></a>    .pivot(</span>
<span id="cb69-4"><a href="" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">"rest"</span>,</span>
<span id="cb69-5"><a href="" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>[<span class="st">"game_id"</span>, <span class="st">"date"</span>],</span>
<span id="cb69-6"><a href="" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span><span class="st">"variable"</span></span>
<span id="cb69-7"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .rename(</span>
<span id="cb69-9"><a href="" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>{<span class="st">"away_team"</span>: <span class="st">"away_rest"</span>, <span class="st">"home_team"</span>: <span class="st">"home_rest"</span>}</span>
<span id="cb69-10"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-11"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-12"><a href="" aria-hidden="true" tabindex="-1"></a>joined_pd <span class="op">=</span> by_game_pd.join(games_pd).assign(</span>
<span id="cb69-13"><a href="" aria-hidden="true" tabindex="-1"></a>    home_win<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">"home_points"</span>] <span class="op">&gt;</span> df[<span class="st">"away_points"</span>],</span>
<span id="cb69-14"><a href="" aria-hidden="true" tabindex="-1"></a>    rest_spread<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">"home_rest"</span>] <span class="op">-</span> df[<span class="st">"away_rest"</span>],</span>
<span id="cb69-15"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-16"><a href="" aria-hidden="true" tabindex="-1"></a>joined_pd</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">away_rest</th>
<th data-quarto-table-cell-role="th">home_rest</th>
<th data-quarto-table-cell-role="th">away_team</th>
<th data-quarto-table-cell-role="th">away_points</th>
<th data-quarto-table-cell-role="th">home_team</th>
<th data-quarto-table-cell-role="th">home_points</th>
<th data-quarto-table-cell-role="th">home_win</th>
<th data-quarto-table-cell-role="th">rest_spread</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">game_id</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td data-quarto-table-cell-role="th">2015-10-28</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>New Orleans Pelicans</td>
<td>94</td>
<td>Portland Trail Blazers</td>
<td>112</td>
<td>True</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td data-quarto-table-cell-role="th">2015-10-28</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>Chicago Bulls</td>
<td>115</td>
<td>Brooklyn Nets</td>
<td>100</td>
<td>False</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1314</td>
<td data-quarto-table-cell-role="th">2016-06-16</td>
<td>2</td>
<td>2</td>
<td>Golden State Warriors</td>
<td>101</td>
<td>Cleveland Cavaliers</td>
<td>115</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1315</td>
<td data-quarto-table-cell-role="th">2016-06-19</td>
<td>2</td>
<td>2</td>
<td>Cleveland Cavaliers</td>
<td>93</td>
<td>Golden State Warriors</td>
<td>89</td>
<td>False</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>1303 rows × 8 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="tidy-nba-data-vizualization" class="slide level2 tiny scrollable">
<h2>Tidy NBA data vizualization</h2>
<div id="51049b2d" class="cell columns column-output-location" data-execution_count="56">
<div class="column">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb70-2"><a href="" aria-hidden="true" tabindex="-1"></a>sns.set_theme(font_scale<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb70-3"><a href="" aria-hidden="true" tabindex="-1"></a>sns.catplot(</span>
<span id="cb70-4"><a href="" aria-hidden="true" tabindex="-1"></a>    tidy_pl.to_pandas(),</span>
<span id="cb70-5"><a href="" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb70-6"><a href="" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"rest"</span>,</span>
<span id="cb70-7"><a href="" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"team"</span>,</span>
<span id="cb70-8"><a href="" aria-hidden="true" tabindex="-1"></a>    col_wrap<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb70-9"><a href="" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"bar"</span>,</span>
<span id="cb70-10"><a href="" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb70-11"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-57-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="tidy-nba-data-vizualization-1" class="slide level2 tiny scrollable">
<h2>Tidy NBA data vizualization</h2>
<p>Побудова графіка розподілу <code>rest_spread</code>:</p>
<div class="panel-tabset">
<ul id="tabset-21" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-21-1">Polars</a></li><li><a href="#tabset-21-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1">
<div id="c8c74879" class="cell columns column-output-location" data-execution_count="57">
<div class="column">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb71-2"><a href="" aria-hidden="true" tabindex="-1"></a>delta_pl <span class="op">=</span> joined_pl[<span class="st">"rest_spread"</span>]</span>
<span id="cb71-3"><a href="" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (</span>
<span id="cb71-4"><a href="" aria-hidden="true" tabindex="-1"></a>    delta_pl</span>
<span id="cb71-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .value_counts()</span>
<span id="cb71-6"><a href="" aria-hidden="true" tabindex="-1"></a>    .drop_nulls()</span>
<span id="cb71-7"><a href="" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb71-8"><a href="" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"rest_spread"</span>)</span>
<span id="cb71-9"><a href="" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"count"</span>]</span>
<span id="cb71-10"><a href="" aria-hidden="true" tabindex="-1"></a>    .reindex(np.arange(delta_pl.<span class="bu">min</span>(), delta_pl.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>), fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb71-11"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort_index()</span>
<span id="cb71-12"><a href="" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">"bar"</span>, color<span class="op">=</span><span class="st">"k"</span>, width<span class="op">=</span><span class="fl">0.9</span>, rot<span class="op">=</span><span class="dv">0</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb71-13"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-14"><a href="" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">"Difference in Rest (Home - Away)"</span>, ylabel<span class="op">=</span><span class="st">"Games"</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-58-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
<div id="tabset-21-2">
<div id="08decf57" class="cell columns column-output-location" data-execution_count="58">
<div class="column">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="" aria-hidden="true" tabindex="-1"></a>delta_pd <span class="op">=</span> joined_pd[<span class="st">"rest_spread"</span>]</span>
<span id="cb72-2"><a href="" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (</span>
<span id="cb72-3"><a href="" aria-hidden="true" tabindex="-1"></a>    delta_pd</span>
<span id="cb72-4"><a href="" aria-hidden="true" tabindex="-1"></a>    .value_counts()</span>
<span id="cb72-5"><a href="" aria-hidden="true" tabindex="-1"></a>    .reindex(np.arange(delta_pd.<span class="bu">min</span>(), delta_pd.<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>), fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-6"><a href="" aria-hidden="true" tabindex="-1"></a>    .sort_index()</span>
<span id="cb72-7"><a href="" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">"bar"</span>, color<span class="op">=</span><span class="st">"k"</span>, width<span class="op">=</span><span class="fl">0.9</span>, rot<span class="op">=</span><span class="dv">0</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb72-8"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">"Difference in Rest (Home - Away)"</span>, ylabel<span class="op">=</span><span class="st">"Games"</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-59-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="tidy-nba-data-vizualization-2" class="slide level2 tiny scrollable">
<h2>Tidy NBA data vizualization</h2>
<p>Побудова графіка відсотка виграшу за <code>rest_spread</code>:</p>
<div class="panel-tabset">
<ul id="tabset-22" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-22-1">Polars</a></li><li><a href="#tabset-22-2">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1">
<div id="bd134ac6" class="cell columns column-output-location" data-execution_count="59">
<div class="column">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-2"><a href="" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb73-3"><a href="" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb73-4"><a href="" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"rest_spread"</span>,</span>
<span id="cb73-5"><a href="" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"home_win"</span>,</span>
<span id="cb73-6"><a href="" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>joined_pl.<span class="bu">filter</span>(pl.col(<span class="st">"rest_spread"</span>).is_between(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, closed<span class="op">=</span><span class="st">"both"</span>)).to_pandas(),</span>
<span id="cb73-7"><a href="" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#4c72b0"</span>,</span>
<span id="cb73-8"><a href="" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb73-9"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-60-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
<div id="tabset-22-2">
<div id="ec62640f" class="cell columns column-output-location" data-execution_count="60">
<div class="column">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb74-2"><a href="" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb74-3"><a href="" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"rest_spread"</span>,</span>
<span id="cb74-4"><a href="" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"home_win"</span>,</span>
<span id="cb74-5"><a href="" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>joined_pd.query(<span class="st">'-3 &lt;= rest_spread &lt;= 3'</span>),</span>
<span id="cb74-6"><a href="" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#4c72b0"</span>,</span>
<span id="cb74-7"><a href="" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb74-8"><a href="" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src=".01_files/figure-revealjs/cell-61-output-1.svg"></p>
</figure>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="щось-ще" class="slide level2 tiny">
<h2>Щось ще?</h2>
<ul>
<li><a href="https://duckdb.org/">DuckDB</a>: схоже на SQLite, але з підтримкою Pandas і Polars.</li>
<li><a href="https://dask.org/">Dask</a>: розподілені обчислення для Pandas.</li>
<li><a href="https://rdatatable.gitlab.io/data.table/index.html">data.table</a>: швидка обробка даних для R.</li>
<li><a href="https://ibis-project.org/">Ibis</a>: обробка даних для Pandas, Polars, SQLAlchemy, DuckDB, PySpark, BigQuery.</li>
<li><a href="https://rapids.ai/">cuDF</a>: обробка даних для GPU.</li>
<li><a href="https://vaex.io/">Vaex</a>: обробка даних для великих наборів даних.</li>
<li><a href="https://arrow.apache.org/">Apache Arrow</a>: універсальний стовпчастий формат і багатомовний інструментарій для швидкого обміну даними та аналітики в пам’яті</li>
<li><a href="https://spark.apache.org/docs/latest/api/python/index.html">PySpark</a>: багатомовний рушій для виконання інженерії даних, науки про дані та машинного навчання на одновузлових машинах або кластерах.</li>
</ul>
</section></section>
<section id="дякую-за-увагу" class="title-slide slide level1 unnumbered unlisted center" data-background-iframe=".01_files/libs/colored-particles/index.html">
<h1>Дякую за увагу!</h1>
<p><br> <br></p>
<p><iconify-icon inline="" icon="solar:book-bold"></iconify-icon> <a href="https://aranaur.rbind.io/lectures/mm_big_data/">Матеріали курсу</a></p>
<p><iconify-icon inline="" icon="mdi:envelope"></iconify-icon> ihor.miroshnychenko@knu.ua</p>
<p><iconify-icon inline="" icon="ic:baseline-telegram"></iconify-icon> <a href="https://t.me/araprof">Data Mirosh</a></p>
<p><iconify-icon inline="" icon="mdi:linkedin"></iconify-icon> <a href="https://www.linkedin.com/in/ihormiroshnychenko/">@ihormiroshnychenko</a></p>
<p><iconify-icon inline="" icon="mdi:github"></iconify-icon> <a href="https://github.com/Aranaur">@aranaur</a></p>
<p><iconify-icon inline="" icon="ion:home"></iconify-icon> <a href="https://aranaur.rbind.io">aranaur.rbind.io</a></p>

</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="fit.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://aranaur.rbind.io/lectures/mm_big_data/">🔗Моделі та методи обробки великих даних</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src=".01_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src=".01_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src=".01_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src=".01_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src=".01_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src=".01_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src=".01_files/libs/revealjs/plugin/verticator/verticator.js"></script>
  <script src=".01_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src=".01_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src=".01_files/libs/revealjs/plugin/search/search.js"></script>
  <script src=".01_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src=".01_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'verticator': {"themetag":"h1","color":"","inversecolor":"","skipuncounted":false,"clickable":true,"position":"auto","offset":"3vmin","autogenerate":true,"tooltip":false,"scale":1},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h.v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: true,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1350,

        height: 759.375,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, Verticator, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Скопійовано!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Скопійовано!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>