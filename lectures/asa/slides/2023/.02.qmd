---
title: "–ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è"
subtitle: "–ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑"
author: "–Ü–≥–æ—Ä –ú—ñ—Ä–æ—à–Ω–∏—á–µ–Ω–∫–æ"
institute: –ö–ù–£ —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞ | –§–Ü–¢
# date: today
# date-format: iso
from: markdown+emoji
title-slide-attributes:
  data-background-iframe: .02_files/libs/colored-particles/index.html
#   data-background-color: "#eef3f8"
language: _language-ua.yml
footer: üîó <a href="https://aranaur.rbind.io/lectures/asa/">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É</a>
format: 
  revealjs:
    transition: fade
    chalkboard: true
    logo: img/fit.png
    code-line-numbers: false
    slide-number: c/t
    mouse-wheel: true
    width: 1350  
    height: 759.375
    highlight-style: github
    pdf-separate-fragments: true
    # fig-height: 7.5
    # fig-width: 15
    fig-align: center
    fig-format: svg
    theme: [default, custom.scss]
jupyter: python3
execute: 
  warning: false
  # cache: true
# editor_options: 
#   chunk_output_type: console
---

```{python}
#| label: setup
#| include: false

# Import libraries
import numpy as np
import pandas as pd
import statsmodels.api as sm
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import norm, uniform

from IPython.display import Markdown
from tabulate import tabulate

# Set seaborn default style
sns.set_style('whitegrid')
sns.set_palette('colorblind')

# Define colors
red_pink   = "#e64173"
turquoise  = "#20B2AA"
orange     = "#FFA500"
red        = "#fb6107"
blue       = "#181485"
navy       = "#150E37FF"
green      = "#8bb174"
yellow     = "#D8BD44"
grey_light = "grey70"
grey_mid   = "grey50"
grey_dark  = "grey20"
purple     = "#6A5ACD"
slate      = "#314f4f"
```

# –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–ª–æ–∂–µ–Ω–Ω—è {background-color="#eef3f8"}

## –ë—ñ–ª—å—à–µ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö

–ú–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –≤—ñ–¥ **–ø—Ä–æ—Å—Ç–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó** (–æ–¥–Ω–∞ [–Ω–µ–∑–∞–ª–µ–∂–Ω–∞]{.purple} –∑–º—ñ–Ω–Ω–∞ —Ç–∞ –æ–¥–Ω–∞ [–∑–∞–ª–µ–∂–Ω–∞]{.pink})

$$ \color{#e64173}{y_i} = \beta_0 + \beta_1 \color{#6A5ACD}{x_i} + u_i $$

–¥–æ **–º–Ω–æ–∂–∏–Ω–Ω–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó** (–¥–µ–∫—ñ–ª—å–∫–∞ [–Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö]{.purple} —Ç–∞ –æ–¥–Ω–∞ [–∑–∞–ª–µ–∂–Ω–∞]{.pink} –∑–º—ñ–Ω–Ω—ñ)

$$ \color{#e64173}{y_i} = \beta_0 + \beta_1 \color{#6A5ACD}{x_{1i}} + \beta_2 \color{#6A5ACD}{x_{2i}} + \cdots + \beta_k \color{#6A5ACD}{x_{ki}} + u_i $$

**–ß–æ–º—É?**

. . .

–ú–∏ –º–æ–∂–µ–º–æ –∫—Ä–∞—â–µ –ø–æ—è—Å–Ω–∏—Ç–∏ –≤–∞—Ä—ñ–∞—Ü—ñ—é $y$, –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏, —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–º—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö ...

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

```{python}
#| label: gen-data
#| include: false
#| cache: true

n = 100
np.random.seed(123)

gen_df = pd.DataFrame({
    'x1': np.random.uniform(-3, 3, n)
})
gen_df['x2'] = np.random.choice([True, False], n, replace=True)
gen_df['u'] = np.random.normal(0, 1, n)
gen_df['y'] = -0.5 + gen_df['x1'] + gen_df['x2'] * 4 + gen_df['u']

mean_a = gen_df[gen_df['x2'] == False]['y'].mean()
mean_b = gen_df[gen_df['x2'] == True]['y'].mean()

gen_df['y_dm'] = gen_df['y'] - mean_a * (gen_df['x2'] == False) - mean_b * (gen_df['x2'] == True)
```

$y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + u_i$, –¥–µ $x_1$ —î –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∏–º, –∞ $x_2$ —î –∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω–∏–º

```{python}
#| label: plot-data
#| echo: false
#| fig-align: center

graph = sns.scatterplot(x='x1', y='y', hue='x2', data=gen_df, palette=sns.color_palette(["darkslategrey", red_pink]))
graph.axvline(0, color='grey', alpha=0.8)
graph.axhline(0, color='grey', alpha=0.8)
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.ylabel('')
plt.xlabel('')
plt.annotate(text='y', xy = (0, 0), xytext = (-0.2, 4.5))
plt.annotate(text='x', xy = (0, 0), xytext = (3.5, -0.2))
plt.box(False)
plt.grid(None)
plt.show()
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

$\beta_0$ —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ $x_2$ –∫–µ—Ä—É—é—Ç—å —Å–µ—Ä–µ–¥–Ω—ñ–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –≥—Ä—É–ø.

```{python}
#| label: plot-data2
#| echo: false
#| fig-align: center

graph = sns.scatterplot(x='x1', y='y', hue='x2', data=gen_df, palette=sns.color_palette(["darkslategrey", red_pink]))
graph.axvline(0, color='grey')
graph.axhline(mean_a, color="darkslategrey", alpha=0.2)
graph.axhline(mean_b, color=red_pink, alpha=0.2)
graph.axhline(0, color='grey')
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.ylabel('')
plt.xlabel('')
plt.annotate(text='y', xy = (0, 0), xytext = (-0.2, 8))
plt.annotate(text='x', xy = (0, 0), xytext = (3.5, -0.2))
plt.box(False)
plt.grid(None)
plt.show()
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

–Ø–∫—â–æ –ø—Ä–∏–±—Ä–∞—Ç–∏ —Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –≥—Ä—É–ø:

```{python}
#| label: plot-data3
#| echo: false
#| fig-align: center

graph = sns.scatterplot(x='x1', y='y_dm', hue='x2', data=gen_df, palette=sns.color_palette(["darkslategrey", red_pink]))
graph.axvline(0, color='grey')
graph.axhline(0, color='grey')
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.ylabel('')
plt.xlabel('')
plt.annotate(text='y', xy = (0, 0), xytext = (-0.2, 4.5))
plt.annotate(text='x', xy = (0, 0), xytext = (3.5, -0.2))
plt.box(False)
plt.grid(None)
plt.show()
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

$\hat{\beta}_1$ –æ—Ü—ñ–Ω—é—î —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –º—ñ–∂ $y$ —ñ $x_1$ –ø—ñ—Å–ª—è –≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—è $x_2$.

```{python}
#| label: plot-data4
#| echo: false
#| fig-align: center

graph = sns.scatterplot(x='x1', y='y_dm', hue='x2', data=gen_df, palette=sns.color_palette(["darkslategrey", red_pink]))
sns.regplot(x='x1', y='y_dm', data=gen_df, scatter=False, color=orange, ci=None)
graph.axvline(0, color='grey')
graph.axhline(0, color='grey')
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.ylabel('')
plt.xlabel('')
plt.annotate(text='y', xy = (0, 0), xytext = (-0.2, 4.5))
plt.annotate(text='x', xy = (0, 0), xytext = (3.5, -0.2))
plt.box(False)
plt.grid(None)
plt.show()
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

–Ü–Ω—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø–æ–≥–ª—è–Ω—É—Ç–∏ –Ω–∞ —Ü–µ:

```{python}
#| label: plot-data5
#| echo: false
#| eval: true
#| fig-align: center

sns.lmplot(x='x1', y='y', hue='x2', data=gen_df, scatter=True, ci=None, palette=sns.color_palette(["darkslategrey", red_pink]), legend_out=False)
plt.axvline(0, color='grey')
plt.axhline(0, color='grey')
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.ylabel('')
plt.xlabel('')
plt.annotate(text='y', xy = (0, 0), xytext = (-0.2, 4.5))
plt.annotate(text='x', xy = (0, 0), xytext = (3.5, -0.2))
plt.gcf().set_size_inches(15, 6.5)
plt.box(False)
plt.grid(False)
plt.show()
```

<!-- ![](img/plot-data5-10.png){align="center"} -->


## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

–ü–æ–≥–ª—è–Ω–µ–º–æ –Ω–∞ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –º–æ–¥–µ–ª—ñ...

–î–ª—è –ø—Ä–æ—Å—Ç–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó $y_i = \beta_0 + \beta_1 x_i + u_i$

$$
\begin{aligned}
  \hat{\beta}_1 &= \\[0.3em]
  &= \dfrac{\sum_i \left( x_i - \overline{x} \right) \left( y_i - \overline{y} \right)}{\sum_i \left( x_i -\overline{x} \right)} \\[0.3em]
  &= \dfrac{\sum_i \left( x_i - \overline{x} \right) \left( y_i - \overline{y} \right)/(n-1)}{\sum_i \left( x_i -\overline{x} \right) / (n-1)} \\[0.3em]
  &= \dfrac{\mathop{\hat{\text{Cov}}}(x,\,y)}{\mathop{\hat{\text{Var}}} \left( x \right)}
\end{aligned}
$$

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è

–ü—Ä–æ—Å—Ç–∞ –ª—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è:

$$ \hat{\beta}_1 = \dfrac{\mathop{\hat{\text{Cov}}}(x,\,y)}{\mathop{\hat{\text{Var}}} \left( x \right)} $$

–ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –¥–æ –º–Ω–æ–∂–∏–Ω–Ω–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó –æ—Ü—ñ–Ω–∫–∞ —Ç—Ä–æ—Ö–∏ –∑–º—ñ–Ω—é—î—Ç—å—Å—è:

$$ \hat{\beta}_1 = \dfrac{\mathop{\hat{\text{Cov}}}(\color{#e64173}{\tilde{x}_1},\,y)}{\mathop{\hat{\text{Var}}} \left( \color{#e64173}{\tilde{x}_1} \right)} $$

–¥–µ $\color{#e64173}{\tilde{x}_1}$ ‚Äî *–∑–∞–ª–∏—à–∫–æ–≤–∞* –∑–º—ñ–Ω–Ω–∞ $x_1$ ‚Äî –∑–º—ñ–Ω–∞, —â–æ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ $x$ –ø—ñ—Å–ª—è –≤—Ä–∞—Ö—É—ñ–≤–Ω–Ω—è —ñ–Ω—à–∏—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è

–ë—ñ–ª—å—à —Ñ–æ—Ä–º–∞–ª—å–Ω–æ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –º–æ–¥–µ–ª—å –º–Ω–æ–∂–∏–Ω–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó

$$ y_i = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + u_i $$

–ù–∞—à–∞ –∑–∞–ª–∏—à–∫–æ–≤–∞ $x_{1}$ (—è–∫—É –º–∏ –Ω–∞–∑–≤–∞–ª–∏ $\color{#e64173}{\tilde{x}_1}$) –ø–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ —Ä–µ–≥—Ä–µ—Å—ñ—ó $x_1$ –∑ intercept —Ç–∞ –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö —ñ –∑–±–∏—Ä–∞—î –∑–∞–ª–∏—à–∫–∏, _—Ç–æ–±—Ç–æ_,

$$
\begin{aligned}
  \hat{x}_{1i} &= \hat{\gamma}_0 + \hat{\gamma}_2 \, x_{2i} + \hat{\gamma}_3 \, x_{3i} \\
  \color{#e64173}{\tilde{x}_{1i}} &= x_{1i} - \hat{x}_{1i}
\end{aligned}
$$

. . .

—â–æ –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º –∫—Ä–∞—â–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –Ω–∞—à—É –æ—Ü—ñ–Ω–∫—É –ú–ù–ö –º–Ω–æ–∂–∏–Ω–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó

$$ \hat{\beta}_1 = \dfrac{\mathop{\hat{\text{Cov}}}(\color{#e64173}{\tilde{x}_1},\,y)}{\mathop{\hat{\text{Var}}} \left( \color{#e64173}{\tilde{x}_1} \right)} $$

---

```{python}
#| label: venn
#| echo: false
#| warning: false
#| fig-align: center

import matplotlib.pyplot as plt
import matplotlib.patches as patches
import pandas as pd

# Colors
venn_colors = ['purple', 'red', 'grey', 'orange']

# Circle locations
venn_df = pd.DataFrame({
    'x': [0.0, -0.5, 1.5, -1.0],
    'y': [0.0, -2.5, -1.8, 2.0],
    'r': [1.9, 1.5, 1.5, 1.3],
    'l': ["$Y$", "$X_1$", "$X_2$", "$X_3$"],
    'xl': [0.0, -0.5, 1.6, -1.0],
    'yl': [0.0, -2.5, -1.9, 2.2]
})

# Create figure and axis
fig, ax = plt.subplots(figsize=(10, 10))

# Draw circles
for i in range(len(venn_df)):
    circle = patches.Circle((venn_df['x'][i], venn_df['y'][i]), venn_df['r'][i],
                            fill=True, color=venn_colors[i], alpha=0.3, edgecolor=venn_colors[i], linewidth=0.75)
    ax.add_patch(circle)

# Plot text labels
for i in range(len(venn_df)):
    ax.text(venn_df['xl'][i], venn_df['yl'][i], venn_df['l'][i], size=14, va='center', ha='center')

# Set axis properties
ax.annotate("–ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è", xy=(-5.5, 3.3), size=14, ha='left')

ax.set_xlim(-5.5, 4.5);
ax.set_ylim(-4.2, 3.4);
ax.set_aspect('equal', adjustable='box')  # Equal aspect ratio

# Remove axes
ax.axis('off');

plt.show()
```

## –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ

–ü–æ–∫–∞–∑–Ω–∏–∫–∏ *—Ö–æ—Ä–æ—à–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ* (–∞–Ω–≥. *goodness of fit*) –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –¥–æ–±—Ä–µ –Ω–∞—à–∞ –º–æ–¥–µ–ª—å –æ–ø–∏—Å—É—î (*–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î*) –¥–∞–Ω–∏–º.

**–ü–æ–ø—É–ª—è—Ä–Ω–∏–π –ø–æ–∫–∞–∑–Ω–∏–∫:** $R^2$ [R-–∫–≤–∞–¥—Ä–∞—Ç] (*–≤—ñ–Ω –∂–µ* –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó)

$$ R^2 = \dfrac{\sum_i (\hat{y}_i - \overline{y})^2}{\sum_i \left( y_i - \overline{y} \right)^2} = 1 - \dfrac{\sum_i \left( y_i - \hat{y}_i \right)^2}{\sum_i \left( y_i - \overline{y} \right)^2} $$

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –Ω–∞—à–æ–≥–æ —Å—Ç–∞—Ä–æ–≥–æ –¥—Ä—É–≥–∞ ESS: $\sum_i \left( y_i - \hat{y}_i \right)^2 = \sum_i e_i^2$.

. . .

$R^2$ –±—É–∫–≤–∞–ª—å–Ω–æ –≤–∫–∞–∑—É—î –Ω–∞–º —á–∞—Å—Ç–∫—É –¥–∏—Å–ø–µ—Ä—Å—ñ—ó –≤ $y$, —è–∫—É –≤—Ä–∞—Ö–æ–≤—É—î –Ω–∞—à–∞ –º–æ–¥–µ–ª—å. –¢–∞–∫–∏–º —á–∏–Ω–æ–º $0 \leq R^2 \leq 1$.

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

**–ü—Ä–æ–±–ª–µ–º–∞:** –∫–æ–ª–∏ –º–∏ –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ –¥–æ –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ, $R^2$ *–ø–æ—Å—Ç—ñ–π–Ω–æ* –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è.

. . .

–©–æ–± –ø–æ–±–∞—á–∏—Ç–∏ —Ü—é –ø—Ä–æ–±–ª–µ–º—É, –º–∏ –º–æ–∂–µ–º–æ –∑–º–æ–¥–µ–ª—é–≤–∞—Ç–∏ –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö —ñ–∑ 10 000 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å –∑–∞ $y$ —ñ 1000 –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö $x_k$. **–ù–µ–º–∞—î –∑–≤‚Äô—è–∑–∫—É –º—ñ–∂ $y$ —ñ $x_k$!**

–ü—Å–µ–≤–¥–æ–∫–æ–¥ —Å–∏–º—É–ª—è—Ü—ñ—ó:

. . .

- –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ 10 000 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å $y$
- –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ 10 000 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å –∑–∞ –∑–º—ñ–Ω–Ω–∏–º–∏ –≤—ñ–¥ $x_1$ –¥–æ $x_{1000}$
- –†–µ–≥—Ä–µ—Å—ñ—è:
    - LM~1~: —Ä–µ–≥—Ä–µ—Å—ñ—è $y$ –Ω–∞ $x_1$; –∑–∞–ø–∏—Å R^2^
    - LM~2~: —Ä–µ–≥—Ä–µ—Å—ñ—è $y$ –Ω–∞ $x_1$ —ñ $x_2$; –∑–∞–ø–∏—Å R^2^
    - LM~1000~: —Ä–µ–≥—Ä–µ—Å—ñ—è $y$ –Ω–∞ $x_1$, $x_2$ —ñ $x_3$; –∑–∞–ø–∏—Å R^2^
    - ...
    - LM<sub>1000</sub>: —Ä–µ–≥—Ä–µ—Å—ñ—è $y$ –Ω–∞ $x_1$, $x_2$, ..., $x_{1000}$; –∑–∞–ø–∏—Å R^2^`

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

**–ü—Ä–æ–±–ª–µ–º–∞:** –∫–æ–ª–∏ –º–∏ –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ –¥–æ –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ, $R^2$ *–ø–æ—Å—Ç—ñ–π–Ω–æ* –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è.

`Python` –∫–æ–¥ –¥–ª—è —Å–∏–º—É–ª—è—Ü—ñ—ó:

```{python}
#| label: r2-sim
#| eval: false
#| echo: true

import numpy as np
import pandas as pd
from sklearn.linear_model import LinearRegression
from joblib import Parallel, delayed

np.random.seed(1234)

n = 10000
k = 1000

y = np.random.normal(size=n)
x = np.random.normal(size=(n, k))

def calculate_r2(i):
    model = LinearRegression()
    model.fit(x[:, :i+2], y)
    r2 = model.score(x[:, :i+2], y)
    adj_r2 = 1 - (1 - r2) * (len(y) - 1) / (len(y) - (i+2))
    return pd.DataFrame({'k': [i+2], 'r2': [r2], 'r2_adj': [adj_r2]})

result = Parallel(n_jobs=-1)(delayed(calculate_r2)(i) for i in range(k))

r_df = pd.concat(result, ignore_index=True)
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

**–ü—Ä–æ–±–ª–µ–º–∞:** –∫–æ–ª–∏ –º–∏ –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ –¥–æ –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ, $R^2$ *–ø–æ—Å—Ç—ñ–π–Ω–æ* –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è.

```{python}
#| label: r2-sim-import
#| include: false

r_df = pd.read_csv('data/r2-sim.csv')
```

```{python}
#| label: r2-plot
#| echo: false
#| fig-align: center

plt.plot(r_df['k'], r_df['r2'], linewidth=4, alpha=0.75, color='darkslategrey')

plt.axhline(y=0, color='black')
plt.axvline(x=0, color='black')

plt.xlabel('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö (k)')
plt.ylabel(r'$R^2$')
plt.title(r'$R^2$ vs. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö')

plt.show()
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

–©–æ —Ä–æ–±–∏—Ç–∏?
**–†—ñ—à–µ–Ω–Ω—è –ø–µ—Ä—à–µ:** [–°–∫–æ—Ä–∏–≥–æ–≤–∞–Ω–∏–π]{.pink} $\color{#e64173}{R^2}$

```{python}
#| label: r2-adj-plot
#| echo: false
#| fig-align: center

plt.plot(r_df['k'], r_df['r2'], linewidth=4, alpha=0.15, color='darkslategrey')
plt.plot(r_df['k'], r_df['r2_adj'], linewidth=4, alpha=0.85, color=red_pink)

plt.axhline(y=0, color='black')
plt.axvline(x=0, color='black')

plt.xlabel('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö (k)')
plt.ylabel(r'$R^2$')
plt.title(r'$R^2$ vs. $R^2_{adj}$ vs. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö')

plt.show()
```

## –ú–Ω–æ–∂–∏–Ω–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è {.smaller}

**–ü—Ä–æ–±–ª–µ–º–∞:** –∫–æ–ª–∏ –º–∏ –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ –¥–æ –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ, $R^2$ *–ø–æ—Å—Ç—ñ–π–Ω–æ* –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è.

**–†—ñ—à–µ–Ω–Ω—è –ø–µ—Ä—à–µ:** –®—Ç—Ä–∞—Ñ—É–≤–∞—Ç–∏ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–º—ñ–Ω–Ω–∏—Ö, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, —Å–∫–æ—Ä–µ–≥–æ–≤–∞–Ω–∏–π $R^2$:

$$ \overline{R}^2 = 1 - \dfrac{\sum_i \left( y_i - \hat{y}_i \right)^2/(n-k-1)}{\sum_i \left( y_i - \overline{y} \right)^2/(n-1)} $$

::: {.callout-note}
–°–∫–æ—Ä–∏–≥–æ–≤–∞–Ω–∏–π $R^2$ –Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤—ñ–¥ 0 –¥–æ 1.
:::

## –ö–æ–º–ø—Ä–æ–º—ñ—Å–∏ {.smaller}

–Ñ –∫–æ–º–ø—Ä–æ–º—ñ—Å–∏, –ø—Ä–æ —è–∫—ñ —Å–ª—ñ–¥ –ø–∞–º'—è—Ç–∞—Ç–∏, –∫–æ–ª–∏ –º–∏ –¥–æ–¥–∞—î–º–æ/–≤–∏–¥–∞–ª—è—î–º–æ –∑–º—ñ–Ω–Ω—ñ:

**–ú–µ–Ω—à–µ –∑–º—ñ–Ω–Ω–∏—Ö**

- –ü–æ—è—Å–Ω—é—î –º–µ–Ω—à–µ –≤–∞—Ä—ñ–∞—Ü—ñ—ó $y$
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—ó —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó
- –ú–æ–∂–ª–∏–≤–æ, –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –ø–æ—Ç—É—Ä–±—É–≤–∞—Ç–∏—Å—è –ø—Ä–æ –∑–º—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö

**–ë—ñ–ª—å—à–µ –∑–º—ñ–Ω–Ω–∏—Ö**

- –ë—ñ–ª—å—à–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –∑–Ω–∞–π—Ç–∏ *—Ö–∏–±–Ω—ñ* –∑–≤'—è–∑–∫–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ —á–µ—Ä–µ–∑ –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å ‚Äî –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ –∑–≤'—è–∑–∫—É –Ω–∞ —Ä—ñ–≤–Ω—ñ –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ)
- –°–∫–ª–∞–¥–Ω—ñ—à–µ –ø—Ä–æ–≤–æ–¥–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—é —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é
- –í–∏ –≤—Å–µ —â–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –≤–∞–∂–ª–∏–≤—ñ –∑–º—ñ–Ω–Ω—ñ ‚Äî –∑–º—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö

# –ó–º—ñ—â–µ–Ω–Ω—è –ø—Ä–∏ –Ω–µ–≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—ñ –≤–ø–ª–∏–≤–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó {background-color="#eef3f8"}

## –ó–º—ñ—â–µ–Ω–Ω—è –ø—Ä–∏ –Ω–µ–≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—ñ –≤–ø–ª–∏–≤–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó

**–ó–º—ñ—â–µ–Ω–Ω—è –ø—Ä–∏ –Ω–µ–≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—ñ –≤–ø–ª–∏–≤–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó** (–∞–Ω–≥. *omitted-variable bias, OVB*) –≤–∏–Ω–∏–∫–∞—î, –∫–æ–ª–∏ –º–∏ –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –∑–º—ñ–Ω–Ω—É, —è–∫–∞

1. –≤–ø–ª–∏–≤–∞—î –Ω–∞ –Ω–∞—à—É –∑–º—ñ–Ω–Ω—É $y$

2. –∫–æ—Ä–µ–ª—é—î –∑ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–æ—é –∑–º—ñ–Ω–Ω–æ—é $x_j$

–Ø–∫ –≤–∏–ø–ª–∏–≤–∞—î –∑ –Ω–∞–∑–≤–∏, —Ü—è —Å–∏—Ç—É–∞—Ü—ñ—è –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–º—ñ—â–µ–Ω–Ω—è –Ω–∞—à–æ—ó –æ—Ü—ñ–Ω–∫–∏ $\beta_j$.

. . .

::: {.callout-note}
OVB –ø—Ä–∏—Ç–∞–º–∞–Ω–Ω–∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ –º–Ω–æ–∂–∏–Ω–Ω—ñ–π —Ä–µ–≥—Ä–µ—Å—ñ—ó, –∞–ª–µ –≤–∏–º–∞–≥–∞—î, —â–æ–± –∫—ñ–ª—å–∫–∞ –∑–º—ñ–Ω–Ω–∏—Ö –≤–ø–ª–∏–≤–∞–ª–∏ –Ω–∞ $y$.
:::

## –ü—Ä–∏–∫–ª–∞–¥

–£—è–≤—ñ–º–æ –ø—Ä–æ—Å—Ç—É –º–æ–¥–µ–ª—å —Å—É–º–∏, —è–∫—É –æ—Ç—Ä–∏–º—É—î –æ–∫—Ä–µ–º–∏–π $i$

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \beta_2 \text{Male}_i + u_i $$

–¥–µ

- $\text{School}_i$ –¥–∞—î –¥–∞–Ω—ñ –ø—Ä–æ —Ä–æ–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è $i$
- $\text{Male}_i$ –ø–æ–∑–Ω–∞—á–∞—î –∑–º—ñ–Ω–Ω—É-—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–æ–≥–æ, —á–∏ —î $i$ —á–æ–ª–æ–≤—ñ–∫–æ–º.

—Ç–∞–∫–∏–º —á–∏–Ω–æ–º

- $\beta_1$: –¥–æ—Ö—ñ–¥ –≤—ñ–¥ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ä–æ–∫—É –Ω–∞–≤—á–∞–Ω–Ω—è (*–∑–∞ —ñ–Ω—à–∏—Ö —Ä—ñ–≤–Ω–∏—Ö —É–º–æ–≤*)
- $\beta_2$: ¬´–ø—Ä–µ–º—ñ—è¬ª –∑–∞ —Ç–µ, —â–æ —Ç–∏ —á–æ–ª–æ–≤—ñ–∫ (*–∑–∞ —ñ–Ω—à–∏—Ö —Ä—ñ–≤–Ω–∏—Ö —É–º–æ–≤*)
<br>–Ø–∫—â–æ $\beta_2 > 0$, —Ç–æ —ñ—Å–Ω—É—î –¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ—è –∂—ñ–Ω–æ–∫ ‚Äî –≤–æ–Ω–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å –º–µ–Ω—à—É –∑–∞—Ä–ø–ª–∞—Ç—É.

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

–ó –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \beta_2 \text{Male}_i + u_i $$

–Ø–∫—â–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–æ –Ω–∞ –∑–≤‚Äô—è–∑–∫—É –º—ñ–∂ –æ–ø–ª–∞—Ç–æ—é –ø—Ä–∞—Ü—ñ —Ç–∞ –æ—Å–≤—ñ—Ç–æ—é, _—Ç–æ–±—Ç–æ_,

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \left(\beta_2 \text{Male}_i + u_i\right) $$

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \varepsilon_i $$

–¥–µ $\varepsilon_i = \beta_2 \text{Male}_i + u_i$.

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ –Ω–∞—à–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è –ø—Ä–æ –µ–∫–∑–æ–≥–µ–Ω–Ω—ñ—Å—Ç—å, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–µ—É–ø–µ—Ä–µ–¥–∂–µ–Ω—ñ—Å—Ç—å OLS. –ê–ª–µ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ $\mathop{\boldsymbol{E}}\left[ u | X \right] = 0$, —Ü–µ –Ω–µ–≤—ñ—Ä–Ω–æ, —â–æ $\mathop{\boldsymbol{E}}\left[ \varepsilon | X \right] = 0$, —è–∫—â–æ $\beta_2 \neq 0$.

---

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

–ó –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \beta_2 \text{Male}_i + u_i $$

–Ø–∫—â–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–æ –Ω–∞ –∑–≤‚Äô—è–∑–∫—É –º—ñ–∂ –æ–ø–ª–∞—Ç–æ—é –ø—Ä–∞—Ü—ñ —Ç–∞ –æ—Å–≤—ñ—Ç–æ—é, _—Ç–æ–±—Ç–æ_,

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \left(\beta_2 \text{Male}_i + u_i\right) $$

$$ \text{Pay}_i = \beta_0 + \beta_1 \text{School}_i + \varepsilon_i $$

–¥–µ $\varepsilon_i = \beta_2 \text{Male}_i + u_i$.

–ó–æ–∫—Ä–µ–º–∞, –µ–∫–∑–æ–≥–µ–Ω–Ω—ñ—Å—Ç—å –≤–∏–º–∞–≥–∞—î, —â–æ–± $\text{School}$ —ñ $\text{Male}$ –Ω–µ –±—É–ª–∏ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ.
<br>**–Ü–Ω–∞–∫—à–µ OLS —î –∑–º—ñ—â–µ–Ω–Ω–∏–º.**

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

```{python}
#| label: ovb-sim-df
#| include: false

np.random.seed(12345)

n = 1000

beta0, beta1, beta2 = 20, 0.5, 10

omit_df = pd.DataFrame({
  'male': np.random.choice([True, False], n, replace=True)})
  
omit_df = omit_df.assign(
  school=lambda x: np.random.uniform(3, 9, n) - 3 * x.male,
  pay=lambda x: beta0 + beta1 * x.school + beta2 * x.male + np.random.normal(0, 6, n)
)

lm_bias = smf.ols('pay ~ school', omit_df).fit()
bb0, bb1 = round(lm_bias.params, 1)

lm_unbias = smf.ols('pay ~ school + male', omit_df).fit()
ub0, ub2, ub1 = round(lm_unbias.params, 1)
```

–°–ø—Ä–æ–±—É—î–º–æ –≤—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏...

–ú–æ–¥–µ–ª—å –ì–°:

$$ \text{Pay}_i = `{python} beta0` + `{python} beta1` \times \text{School}_i + `{python} beta2` \times \text{Male}_i + u_i $$

–ù–∞—à–∞ —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–∞ –º–æ–¥–µ–ª—å, —è–∫–∞ —Å—Ç—Ä–∞–∂–¥–∞—î –≤—ñ–¥ –∑–º—ñ—â–µ–Ω–Ω—è –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö:

$$ \text{Pay}_i = \hat{\beta}_0 + \hat{\beta}_1 \times \text{School}_i + e_i $$

–ù–∞—Ä–µ—à—Ç—ñ, —É—è–≤—ñ—Ç—å, —â–æ –∂—ñ–Ω–∫–∏ –≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –Ω–∞–≤—á–∞—é—Ç—å—Å—è –±—ñ–ª—å—à–µ, –Ω—ñ–∂ —á–æ–ª–æ–≤—ñ–∫–∏.

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

$\text{Pay}_i = `{python} beta0` + `{python} beta1` \times \text{School}_i + `{python} beta2` \times \text{Male}_i + u_i$

–ó–≤'—è–∑–æ–∫ –º—ñ–∂ –æ–ø–ª–∞—Ç–æ—é –ø—Ä–∞—Ü—ñ —Ç–∞ –Ω–∞–≤—á–∞–Ω–Ω—è–º.

```{python}
#| label: ovb-sim-plot-1
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=omit_df, x='school', y='pay', s=60, color='black', alpha=0.4, marker='o')

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

$\text{Pay}_i = `{python} beta0` + `{python} beta1` \times \text{School}_i + `{python} beta2` \times \text{Male}_i + u_i$

–ó–º—ñ—â–µ–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ —Ä–µ–≥—Ä–µ—Å—ñ—ó: $\widehat{\text{Pay}}_i = `{python} bb0` + `{python} bb1` \times \text{School}_i$

```{python}
#| label: ovb-sim-plot-2
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=omit_df, x='school', y='pay', s=60, color='black', alpha=0.4, marker='o')
# add regression line
sns.regplot(x='school', y='pay', data=omit_df, scatter=False, color=orange, ci=None)

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

$\text{Pay}_i = `{python} beta0` + `{python} beta1` \times \text{School}_i + `{python} beta2` \times \text{Male}_i + u_i$

–ü—Ä–æ–ø—É—â–µ–Ω–∞ –∑–º—ñ–Ω–Ω–∞: —Å—Ç–∞—Ç—å (**<font color="#e64173">–∂—ñ–Ω–æ—á–∏–π</font>** —ñ **<font color="#314f4f">—á–æ–ª–æ–≤—ñ—á–∏–π</font>**)

```{python}
#| label: ovb-sim-plot-3
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=omit_df, x='school', y='pay',
                               s=60, hue='male', alpha=0.4, marker='o', legend=False,
                               palette=sns.color_palette(["#e64173", '#314f4f']))
# add regression line
sns.regplot(x='school', y='pay', data=omit_df, scatter=False, color=orange, ci=None)

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)

plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

$\text{Pay}_i = `r beta0` + `r beta1` \times \text{School}_i + `r beta2` \times \text{Male}_i + u_i$

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ–ø—É—â–µ–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó: —Å—Ç–∞—Ç—å (**<font color="#e64173">–∂—ñ–Ω–æ—á–∏–π</font>** —ñ **<font color="#314f4f">—á–æ–ª–æ–≤—ñ—á–∏–π</font>**)

```{python}
#| label: ovb-sim-plot-4
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=omit_df, x='school', y='pay',
                               s=60, hue='male', alpha=0.4, marker='o', legend=False,
                               palette=sns.color_palette(["#e64173", '#314f4f']))
# add regression line
sns.regplot(x='school', y='pay', data=omit_df, scatter=False, color=orange, ci=None, line_kws={'alpha':0.3})

# abline_values = [ub0 + ub1 * i for i in omit_df['school']]
plt.axline((0, ub0), slope=ub1, color="#e64173", linewidth=2)
plt.axline((0, ub0+ub2), slope=ub1, color='#314f4f', linewidth=2)

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)

plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

## –ü—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

$\text{Pay}_i = `r beta0` + `r beta1` \times \text{School}_i + `r beta2` \times \text{Male}_i + u_i$

–ù–µ–∑–º—ñ—â–µ–Ω–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ —Ä–µ–≥—Ä–µ—Å—ñ—ó: $\widehat{\text{Pay}}_i = `{python} ub0` + `{python} ub1` \times \text{School}_i + `{python} ub2` \times \text{Male}_i$

```{python}
#| label: ovb-sim-plot-5
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=omit_df, x='school', y='pay',
                               s=60, hue='male', alpha=0.4, marker='o', legend=False,
                               palette=sns.color_palette(["#e64173", '#314f4f']))
# add regression line
sns.regplot(x='school', y='pay', data=omit_df, scatter=False, color=orange, ci=None, line_kws={'alpha':0.3})

# abline_values = [ub0 + ub1 * i for i in omit_df['school']]
plt.axline((0, ub0), slope=ub1, color="#e64173", linewidth=2)
plt.axline((0, ub0+ub2), slope=ub1, color='#314f4f', linewidth=2)

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)

plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

---

```{python}
#| label: venn-ovb
#| echo: false
#| warning: false
#| fig-align: center

import matplotlib.pyplot as plt
import matplotlib.patches as patches
import pandas as pd

# Colors
venn_colors = ['purple', 'red', 'grey', 'orange']
venn_lines = ['solid', 'solid', 'dashed', 'dashed']

# Circle locations
venn_df = pd.DataFrame({
    'x': [0.0, -0.5, 1.5, -1.0],
    'y': [0.0, -2.5, -1.8, 2.0],
    'r': [1.9, 1.5, 1.5, 1.3],
    'l': ["$Y$", "$X_1$", "$X_2$", "$X_3$"],
    'xl': [0.0, -0.5, 1.6, -1.0],
    'yl': [0.0, -2.5, -1.9, 2.2]
})

# Create figure and axis
fig, ax = plt.subplots(figsize=(10, 10))

# Draw circles
for i in range(len(venn_df)):
    circle = patches.Circle((venn_df['x'][i], venn_df['y'][i]), venn_df['r'][i],
                            fill=True, facecolor=venn_colors[i], alpha=0.3, edgecolor=venn_colors[i], linewidth=3, linestyle=venn_lines[i])
    ax.add_patch(circle)

# Plot text labels
for i in range(len(venn_df)):
    ax.text(venn_df['xl'][i], venn_df['yl'][i], venn_df['l'][i], size=14, va='center', ha='center')

# Set axis properties
ax.annotate("–ü—Ä–æ–ø—É—â–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ", xy=(-5.5, 3.3), size=14, ha='left')

ax.set_xlim(-5.5, 4.5);
ax.set_ylim(-4.2, 3.4);
ax.set_aspect('equal', adjustable='box')  # Equal aspect ratio

# Remove axes
ax.axis('off');

plt.show()
```

## –†—ñ—à–µ–Ω–Ω—è

1. –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ

2. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Ç–∞ –¥–≤–æ–µ—Ç–∞–ø–Ω–∏–π –º–µ—Ç–æ–¥ –Ω–∞–π–º–µ–Ω—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤

::: {.callout-warning}
–ë—É–≤–∞—é—Ç—å —Å–∏—Ç—É–∞—Ü—ñ—ó, —É —è–∫–∏—Ö –∂–æ–¥–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –Ω–µ–º–æ–∂–ª–∏–≤–µ.
:::

# –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ {background-color="#eef3f8"}

## –ù–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –≤–∑–∞—î–º–æ–∑–≤'—è–∑–æ–∫

$$ \text{Pay}_i = \beta_0 + \beta_1 \, \text{School}_i + u_i $$

–¥–µ

- $\text{Pay}_i$ ‚Äî —Ü–µ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —è–∫–∞ –≤–∏–º—ñ—Ä—é—î –æ–ø–ª–∞—Ç—É –ø—Ä–∞—Ü—ñ
- $\text{School}_i$ ‚Äî —Ü–µ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —è–∫–∞ –≤–∏–º—ñ—Ä—é—î —Ä–æ–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è

. . .

**–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è**

- $\beta_0$: $y$-intercept, _—Ç–æ–±—Ç–æ_, $\text{Pay}$, –∫–æ–ª–∏ $\text{School} = 0$
- $\beta_1$: –æ—á—ñ–∫—É–≤–∞–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è $\text{Pay}$ –ø—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ –Ω–∞ –æ–¥–Ω—É –æ–¥–∏–Ω–∏—Ü—é $\text{School}$

## –ù–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

–û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞—Ö–∏–ª—É:

$$
\begin{aligned}
  \mathop{\boldsymbol{E}}\left[ \text{Pay} | \text{School} = \ell + 1 \right] - \mathop{\boldsymbol{E}}\left[ \text{Pay} | \text{School} = \ell \right] &= \\[0.5em]
  \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 (\ell + 1) + u \right] - \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 \ell + u \right] &= \\[0.5em]
  \left[ \beta_0 + \beta_1 (\ell + 1) \right] - \left[ \beta_0 + \beta_1 \ell \right] &= \\[0.5em]
  \beta_0 - \beta_0 + \beta_1 \ell - \beta_1 \ell + \beta_1 &=
  \beta_1
\end{aligned}
$$

. . .

_–¢–æ–±—Ç–æ_, –Ω–∞—Ö–∏–ª –¥–∞—î –æ—á—ñ–∫—É–≤–∞–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞—à–æ—ó –∑–º—ñ–Ω–Ω–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ –Ω–∞ –æ–¥–Ω—É –æ–¥–∏–Ω–∏—Ü—é –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó.

## –ù–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

–Ø–∫—â–æ —É –Ω–∞—Å —î –∫—ñ–ª—å–∫–∞ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_,

$$ \text{Pay}_i = \beta_0 + \beta_1 \, \text{School}_i + \beta_2 \, \text{Ability}_i + u_i $$

—Ç–æ–¥—ñ —Ç–ª—É–º–∞—á–µ–Ω–Ω—è —Ç—Ä–æ—Ö–∏ –∑–º—ñ–Ω—é—î—Ç—å—Å—è.

. . .

$$
\begin{aligned}
  \mathop{\boldsymbol{E}}\left[ \text{Pay} | \text{School} = \ell + 1 \land \text{Ability} = \alpha \right] - & \\
    \mathop{\boldsymbol{E}}\left[ \text{Pay} | \text{School} = \ell \land \text{Ability} = \alpha \right] &= \\
  \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 (\ell + 1) + \beta_2 \alpha + u \right] -
    \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 \ell + \beta_2 \alpha + u \right] &= \\
  \left[ \beta_0 + \beta_1 (\ell + 1) + \beta_2 \alpha \right] -
    \left[ \beta_0 + \beta_1 \ell + \beta_2 \alpha \right] &= \\
  \beta_0 - \beta_0 + \beta_1 \ell - \beta_1 \ell + \beta_1 + \beta_2 \alpha - \beta_2 \alpha &=
  \beta_1
\end{aligned}
$$

. . .

_–¢–æ–±—Ç–æ_, –Ω–∞—Ö–∏–ª –¥–∞—î –æ—á—ñ–∫—É–≤–∞–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞—à–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –ø—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ –Ω–∞ –æ–¥–Ω—É –æ–¥–∏–Ω–∏—Ü—é –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó, **–ø—Ä–∏ –Ω–µ–∑–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö**.

## –ù–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥

–†–æ–∑–≥–ª—è–Ω—å—Ç–µ –º–æ–¥–µ–ª—å

$$ y = \beta_0 + \beta_1 \, x + u $$

–ü–æ—Ö—ñ–¥–Ω–∞:

$$ \dfrac{dy}{dx} = \beta_1 $$

## –ö–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

$$ \text{Pay}_i = \beta_0 + \beta_1 \, \text{Female}_i + u_i $$

–¥–µ

- $\text{Pay}_i$ ‚Äî —Ü–µ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —è–∫–∞ –≤–∏–º—ñ—Ä—é—î –æ–ø–ª–∞—Ç—É –ø—Ä–∞—Ü—ñ
- $\text{Female}_i$ - –¥–≤—ñ–π–∫–æ–≤–∞/—ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —è–∫–∞ –ø—Ä–∏–π–º–∞—î $1$, –∫–æ–ª–∏ $i$ —î –∂—ñ–Ω–æ—á–æ—é

. . .

**–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è**

- $\beta_0$: –æ—á—ñ–∫—É–≤–∞–Ω–∞ $\text{Pay}$ –¥–ª—è —á–æ–ª–æ–≤—ñ–∫—ñ–≤ (_—Ç–æ–±—Ç–æ_, –∫–æ–ª–∏ $\text{Female} = 0$)
- $\beta_1$: –æ—á—ñ–∫—É–≤–∞–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è –≤ $\text{Pay}$ –º—ñ–∂ –∂—ñ–Ω–∫–∞–º–∏ —Ç–∞ —á–æ–ª–æ–≤—ñ–∫–∞–º–∏
- $\beta_0 + \beta_1$: –æ—á—ñ–∫—É–≤–∞–Ω–∞ $\text{Pay}$ –¥–ª—è –∂—ñ–Ω–æ–∫

## –ö–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

$$
\begin{aligned}
 \mathop{\boldsymbol{E}}\left[ \text{Pay} | \text{Male} \right] &=
 \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1\times 0 + u_i \right] \\
 &= \mathop{\boldsymbol{E}}\left[ \beta_0 + 0 + u_i \right] \\
 &= \beta_0
\end{aligned}
$$

. . .

$$
\begin{aligned}
 \mathop{\boldsymbol{E}}\left[ \text{Pay} | \text{Female} \right] &=
 \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1\times 1 + u_i \right] \\
 &= \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 + u_i \right] \\
 &= \beta_0 + \beta_1
\end{aligned}
$$

. . .

::: {.callout-note}
1. –Ø–∫—â–æ –Ω–µ–º–∞—î —ñ–Ω—à–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, —Ç–æ $\hat{\beta}_1$ –¥–æ—Ä—ñ–≤–Ω—é—î —Ä—ñ–∑–Ω–∏—Ü—ñ —Å–µ—Ä–µ–¥–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å –≥—Ä—É–ø–∏, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, $\overline{x}_\text{Female} - \overline{x }_\text{Male}$.
2. –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è *–Ω–µ–∑–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö* —Ç–∞–∫–æ–∂ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö —É  –º–Ω–æ–∂–∏–Ω–Ω—ñ–π —Ä–µ–≥—Ä–µ—Å—ñ—ó.
:::

## –ö–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

$y_i = \beta_0 + \beta_1 x_i + u_i$ –¥–ª—è –¥–≤—ñ–π–∫–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó $x_i = \{\color{#314f4f}{0}, \, \color{#e64173}{1}\}$

```{python}
#| label: cat-data
#| include: false

n = 5000

x = np.random.choice([0, 1], n, replace=True)
y = 3 + 7 * x + np.random.normal(0, 2, n)

cat_df = pd.DataFrame({'y': y, 'x': x})

X = sm.add_constant(cat_df['x'])
cat_reg = sm.OLS(cat_df['y'], X).fit()
```

```{python}
#| label: cat-plot-1
#| echo: false
#| fig-align: center

np.random.seed(12345)

custom_palette = ["darkslategrey", red_pink]

sns.stripplot(x='x', y='y', hue='x', palette=custom_palette,
              data=cat_df, marker='o', alpha=0.5, jitter=0.3, size=3, legend=False)

plt.grid(False)
plt.box(False)
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.xlabel('')
plt.ylabel('')
plt.show()
```

## –ö–∞—Ç–µ–≥–æ—Ä—ñ–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

$y_i = \beta_0 + \beta_1 x_i + u_i$ –¥–ª—è –¥–≤—ñ–π–∫–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó $x_i = \{\color{#314f4f}{0}, \, \color{#e64173}{1}\}$

```{python}
#| label: cat-plot-2
#| echo: false
#| fig-align: center

np.random.seed(12345)

custom_palette = ["darkslategrey", red_pink]

sns.stripplot(x='x', y='y', hue='x', palette=custom_palette,
              data=cat_df, marker='o', alpha=0.5, jitter=0.3, size=3, legend=False)
plt.axhline(y=cat_reg.params[0], color="darkslategrey", linewidth=1)
plt.axhline(y=cat_reg.params[0] + cat_reg.params[1], color=red_pink, linewidth=1)
plt.annotate(r'$\hat{\beta}_0 = \overline{Group}_0$', xy=(0.4, -1 + cat_reg.params[0]), size=7, color="darkslategrey")
plt.annotate(r'$\hat{\beta}_0 + \hat{\beta}_1 = \overline{Group}_1$', xy=(0.3, 1 + cat_reg.params[0] + cat_reg.params[1]), size=7, color=red_pink)


plt.grid(False)
plt.box(False)
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.xlabel('')
plt.ylabel('')
plt.show()
```

## –í–∑–∞—î–º–æ–¥—ñ—ó

–í–∑–∞—î–º–æ–¥—ñ—ó –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤–ø–ª–∏–≤ –æ–¥–Ω—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä—ñ–≤–Ω—è —ñ–Ω—à–æ—ó –∑–º—ñ–Ω–Ω–æ—ó.

**–ü—Ä–∏–∫–ª–∞–¥–∏**

1. –ß–∏ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤–ø–ª–∏–≤ –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–∞ –æ–ø–ª–∞—Ç—É –∑–∞ —Å—Ç–∞—Ç—Ç—é?

1. –ß–∏ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤–ø–ª–∏–≤ —Å—Ç–∞—Ç—ñ –Ω–∞ –æ–ø–ª–∞—Ç—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–∞—Å–∏?

1. –ß–∏ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤–ø–ª–∏–≤ –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∞—Ü—ñ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –¥–æ—Å–≤—ñ–¥—É?

## –í–∑–∞—î–º–æ–¥—ñ—ó

–†–∞–Ω—ñ—à–µ –º–∏ —Ä–æ–∑–≥–ª—è–¥–∞–ª–∏ –º–æ–¥–µ–ª—å, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è–ª–∞ –∂—ñ–Ω–∫–∞–º —ñ —á–æ–ª–æ–≤—ñ–∫–∞–º –º–∞—Ç–∏ —Ä—ñ–∑–Ω—É –∑–∞—Ä–æ–±—ñ—Ç–Ω—É –ø–ª–∞—Ç—É, –∞–ª–µ –º–æ–¥–µ–ª—å –ø—Ä–∏–ø—É—Å–∫–∞–ª–∞, —â–æ –≤–ø–ª–∏–≤ –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∞—Ü—ñ –±—É–¥–µ –æ–¥–Ω–∞–∫–æ–≤–∏–º –¥–ª—è –≤—Å—ñ—Ö:

$$ \text{Pay}_i = \beta_0 + \beta_1 \, \text{School}_i + \beta_2 \, \text{Female}_i + u_i $$

–∞–ª–µ –º–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ–º–æ –ø—Ä–∏–ø—É—Å—Ç–∏—Ç–∏, —â–æ–± –≤–ø–ª–∏–≤ –æ—Å–≤—ñ—Ç–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è–≤—Å—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞—Ç—ñ:

$$ \text{Pay}_i = \beta_0 + \beta_1 \, \text{School}_i + \beta_2 \, \text{Female}_i + \beta_3 \, \text{School}_i\times\text{Female}_i + u_i $$

## –í–∑–∞—î–º–æ–¥—ñ—ó

–ú–æ–¥–µ–ª—å, –∫–æ–ª–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –≤ —à–∫–æ–ª—ñ –º–∞—î –æ–¥–Ω–∞–∫–æ–≤–∏–π –µ—Ñ–µ–∫—Ç –¥–ª—è –≤—Å—ñ—Ö (**<font color="#e64173">F</font>** —ñ **<font color="#314f4f">M</font>**):

```{python}
#| label: int-data
#| include: false

np.random.seed(12345)

n = 1000

beta0, beta1, beta2, beta3 = 20, 0.5, 10, 3

male = np.random.choice([True, False], n, replace=True)
school = np.random.uniform(3, 9, n) - 3 * male
pay = beta0 + beta1 * school + beta2 * male + np.random.normal(scale=7, size = n) + beta3 * male * school

int_df = pd.DataFrame({
  'male': male,
  'school': school,
  'pay': pay
})

reg_noint = smf.ols('pay ~ school + male', int_df).fit()
reg_int = smf.ols('pay ~ school + male + school:male', int_df).fit()
```

```{python}
#| label: int-plot-1
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=int_df, x='school', y='pay',
                               s=60, hue='male', alpha=0.4, marker='o', legend=False,
                               palette=sns.color_palette(["#e64173", '#314f4f']))
# abline_values = [ub0 + ub1 * i for i in omit_df['school']]
plt.axline((0, reg_noint.params[0] + reg_noint.params[1]), slope=reg_noint.params[2], color="#314f4f", linewidth=2)
plt.axline((0, reg_noint.params[0]), slope=reg_noint.params[2], color="#e64173", linewidth=2)

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)

plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

## –í–∑–∞—î–º–æ–¥—ñ—ó

–ú–æ–¥–µ–ª—å, —É —è–∫—ñ–π –≤–ø–ª–∏–≤ —à–∫—ñ–ª—å–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–∂–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞—Ç—ñ (**<font color="#e64173">F</font>** —ñ **<font color="#314f4f">M</font>**):

```{python}
#| label: int-plot-2
#| echo: false
#| fig-align: center

scatter_plot = sns.scatterplot(data=int_df, x='school', y='pay',
                               s=60, hue='male', alpha=0.4, marker='o', legend=False,
                               palette=sns.color_palette(["#e64173", '#314f4f']))
# abline_values = [ub0 + ub1 * i for i in omit_df['school']]
plt.axline((0, reg_noint.params[0] + reg_noint.params[1]), slope=reg_noint.params[2], color="#314f4f", linewidth=2, alpha=0.3)
plt.axline((0, reg_noint.params[0]), slope=reg_noint.params[2], color="#e64173", linewidth=2, alpha=0.3)
plt.axline((0, reg_int.params[0] + reg_int.params[1]), slope=reg_int.params[2] + reg_int.params[3], color="#314f4f", linewidth=2)
plt.axline((0, reg_int.params[0]), slope=reg_int.params[2], color="#e64173", linewidth=2)

# Add horizontal and vertical lines
plt.axhline(0, color='black', linewidth=1)
plt.axvline(0, color='black', linewidth=1)

# Set x and y labels
plt.xlabel("Schooling")
plt.ylabel("Pay")
plt.grid(False)
plt.box(False)

plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)

# Show the plot
plt.show()
```

## –í–∑–∞—î–º–æ–¥—ñ—ó

–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –º–æ–∂–µ –±—É—Ç–∏ –¥–µ—â–æ —Å–∫–ª–∞–¥–Ω–æ—é —É –∑–≤‚Äô—è–∑–∫—É –∑ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏, –∞–ª–µ –≥–æ–ª–æ–≤–Ω–µ ‚Äî —É–≤–∞–∂–Ω–æ –ø—Ä–æ–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫—É.

$$ \text{Pay}_i = \beta_0 + \beta_1 \, \text{School}_i + \beta_2 \, \text{Female}_i + \beta_3 \, \text{School}_i\times\text{Female}_i + u_i $$

–û—á—ñ–∫—É–≤–∞–Ω–∞ –≤—ñ–¥–¥–∞—á–∞ –≤—ñ–¥ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ä–æ–∫—É –Ω–∞–≤—á–∞–Ω–Ω—è –¥–ª—è –∂—ñ–Ω–æ–∫:

$$
\begin{aligned}
 \mathop{\boldsymbol{E}}\left[ \text{Pay}_i | \text{Female} \land \text{School} = \ell + 1 \right] -
    \mathop{\boldsymbol{E}}\left[ \text{Pay}_i | \text{Female} \land \text{School} = \ell \right] &= \\
 \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 (\ell+1) + \beta_2 + \beta_3 (\ell + 1) + u_i \right] -
    \mathop{\boldsymbol{E}}\left[ \beta_0 + \beta_1 \ell + \beta_2 + \beta_3 \ell + u_i  \right] &= \\
 \beta_1 + \beta_3
\end{aligned}
$$

. . .

–ü–æ–¥—ñ–±–Ω–∏–º —á–∏–Ω–æ–º $\beta_1$ –¥–∞—î –æ—á—ñ–∫—É–≤–∞–Ω—É –≤—ñ–¥–¥–∞—á—É –≤—ñ–¥ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ä–æ–∫—É –Ω–∞–≤—á–∞–Ω–Ω—è –¥–ª—è —á–æ–ª–æ–≤—ñ–∫—ñ–≤. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, $\beta_3$ –¥–∞—î **—Ä—ñ–∑–Ω–∏—Ü—é —É –≤—ñ–¥–¥–∞—á—ñ –≤—ñ–¥ –Ω–∞–≤—á–∞–Ω–Ω—è** –¥–ª—è –∂—ñ–Ω–æ–∫ —ñ —á–æ–ª–æ–≤—ñ–∫—ñ–≤.

## –õ–æ–≥-–ª—ñ–Ω—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

–í –µ–∫–æ–Ω–æ–º—ñ—Ü—ñ –≤–∏ —á–∞—Å—Ç–æ –ø–æ–±–∞—á–∏—Ç–µ –∑–º—ñ–Ω–µ–Ω—É –∑–∞–ª–µ–∂–Ω—É –∑–º—ñ–Ω–Ω—É (–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω—É) –∑ –ª—ñ–Ω—ñ–π–Ω–∏–º–∏ (–Ω–µ –ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω—É) –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_,

$$ \log(\text{Pay}_i) = \beta_0 + \beta_1 \, \text{School}_i + u_i $$

–¶—è —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑–º—ñ–Ω—é—î –Ω–∞—à—É —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—é –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –Ω–∞—Ö–∏–ª—É.

**–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è**

- –ó–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞—à–æ—ó –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –Ω–∞ –æ–¥–Ω—É –æ–¥–∏–Ω–∏—Ü—é –∑–±—ñ–ª—å—à—É—î –∑–∞–ª–µ–∂–Ω—É –∑–º—ñ–Ω–Ω—É –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ $\beta_1\times 100$ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤.

- *–ü—Ä–∏–∫–ª–∞–¥:* –î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–∫ –Ω–∞–≤—á–∞–Ω–Ω—è –∑–±—ñ–ª—å—à—É—î –ø–ª–∞—Ç–Ω—é –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 3 –≤—ñ–¥—Å–æ—Ç–∫–∏ (–¥–ª—è $\beta_1 = 0,03$).

## –õ–æ–≥-–ª—ñ–Ω—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

**–í–∏–≤–µ–¥–µ–Ω–Ω—è**

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –ª–æ–≥-–ª—ñ–Ω—ñ–π–Ω—É –º–æ–¥–µ–ª—å

$$ \log(y) = \beta_0 + \beta_1 \, x + u $$

—ñ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª

$$ \dfrac{dy}{y} = \beta_1 dx $$

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –Ω–µ–∑–Ω–∞—á–Ω–∞ –∑–º—ñ–Ω–∞ –≤ $x$ (_—Ç–æ–±—Ç–æ_, $dx$) –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ $\beta_1 dx$ **–≤—ñ–¥—Å–æ—Ç–∫–æ–≤–æ—ó –∑–º—ñ–Ω–∏** –≤ $y$.

## –õ–æ–≥-–ª—ñ–Ω—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

–û—Å–∫—ñ–ª—å–∫–∏ –ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω–æ-–ª—ñ–Ω—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–∞—î —ñ–Ω—à—É —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—é, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–æ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∞—à–æ–º—É –ø—Ä–æ—Ü–µ—Å—É/–º–æ–¥–µ–ª—ñ –≥–µ–Ω–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

$x$ –∑–º—ñ–Ω—é—î $y$ —É –∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–Ω—è—ó (_–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞ 3 –æ–¥–∏–Ω–∏—Ü—ñ) –∞–±–æ —É –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö (_–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –Ω–∞ 10 –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤)?

. . .

_–¢–æ–±—Ç–æ_, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫ –º–∞—î —Å–µ–Ω—Å:

$$ \log(y_i) = \beta_0 + \beta_1 \, x_i + u_i \iff y_i = e^{\beta_0 + \beta_1 x_i + u_i} $$

## –õ–æ–≥-–ª—ñ–Ω—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

```{python}
#| label: log-liner-plot
#| echo: false
#| fig-align: center

np.random.seed(12345)

n = 1000

x = np.random.uniform(0, 3, n)

ll_df = pd.DataFrame({
  'x': x,
  'y': np.exp(-100 + 0.75 * x + np.random.normal(0, 0.5, n))
})

sns.regplot(x='x', y='y', data=ll_df, lowess=True, scatter_kws={'color': "#314f4f", 'alpha': 0.3}, line_kws={'color': red_pink})
plt.axvline(x=0, color='black', linewidth=1)
plt.axhline(y=0, color='black', linewidth=1)
plt.grid(False)
plt.box(False)
plt.tick_params(left = False, right = False , labelleft = False , 
                labelbottom = False, bottom = False)
plt.xlabel('x')
plt.ylabel('y')
plt.show()
```

## –õ–æ–≥-–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

–¢–∞–∫ —Å–∞–º–æ –µ–∫–æ–Ω–æ–º–µ—Ç—Ä–∏—Å—Ç–∏ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω—ñ –º–æ–¥–µ–ª—ñ, –≤ —è–∫–∏—Ö –∑–∞–ª–µ–∂–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –ª–æ–≥–∞—Ä–∏—Ñ–º—É—î—Ç—å—Å—è *—ñ* –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–Ω–∞ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –ª–æ–≥–∞—Ä–∏—Ñ–º—É—î—Ç—å—Å—è

$$ \log(\text{Pay}_i) = \beta_0 + \beta_1 \, \log(\text{School}_i) + u_i $$

**–Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è:**

- –ó–±—ñ–ª—å—à–µ–Ω–Ω—è $x$ –Ω–∞ –æ–¥–∏–Ω –≤—ñ–¥—Å–æ—Ç–æ–∫ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑–º—ñ–Ω–∏ $y$ –Ω–∞ $\beta_1$ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤.
- –ß–∞—Å—Ç–æ —Ç—Ä–∞–∫—Ç—É—î—Ç—å—Å—è —è–∫ –µ–ª–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.

## –õ–æ–≥-–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

**–í–∏–≤–µ–¥–µ–Ω–Ω—è**

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –º–æ–¥–µ–ª—å log-log

$$ \log(y) = \beta_0 + \beta_1 \, \log(x) + u $$


—ñ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª

$$ \dfrac{dy}{y} = \beta_1 \dfrac{dx}{x} $$

—è–∫–∏–π –≥–æ–≤–æ—Ä–∏—Ç—å, —â–æ –ø—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ $x$ –Ω–∞ –æ–¥–∏–Ω –≤—ñ–¥—Å–æ—Ç–æ–∫ –º–∏ –ø–æ–±–∞—á–∏–º–æ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è $y$ –Ω–∞ $\beta_1$ –≤—ñ–¥—Å–æ—Ç–æ–∫. –Ø–∫ –µ–ª–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å:

$$ \dfrac{dy}{dx} \dfrac{x}{y} = \beta_1 $$

## –õ–æ–≥-–ª—ñ–Ω—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑ –±—ñ–Ω–∞—Ä–Ω–æ—é –∑–º—ñ–Ω–Ω–æ—é {.smaller}

::: {.callout-note icon="false"}
–Ø–∫—â–æ —É –≤–∞—Å —î –ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω–æ-–ª—ñ–Ω—ñ–π–Ω–∞ –º–æ–¥–µ–ª—å —ñ–∑ –¥–≤—ñ–π–∫–æ–≤–æ—é –∑–º—ñ–Ω–Ω–æ—é —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞, —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ –¥–ª—è —Ü—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó –∑–º—ñ–Ω—é—î—Ç—å—Å—è.
:::

–†–æ–∑–≥–ª—è–Ω–µ–º–æ

$$ \log(y_i) = \beta_0 + \beta_1 x_1 + u_i $$

–¥–ª—è –¥–≤—ñ–π–∫–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó $x_1$.

–¢–µ–ø–µ—Ä —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è $\beta_1$

- –ö–æ–ª–∏ $x_1$ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∑ 0 –Ω–∞ 1, $y$ –∑–º—ñ–Ω–∏—Ç—å—Å—è –Ω–∞ $100 \times \left( e^{\beta_1} -1 \right)$ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤.
- –ö–æ–ª–∏ $x_1$ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∑ 1 –Ω–∞ 0, $y$ –∑–º—ñ–Ω–∏—Ç—å—Å—è –Ω–∞ $100 \times \left( e^{-\beta_1} -1 \right)$ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤.

## –õ–æ–≥-–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è



# –î—è–∫—É—é –∑–∞ —É–≤–∞–≥—É! {background-color="#eef3f8"}

<br>
<br>

{{< iconify ic baseline-telegram >}} [Data Mirosh](https://t.me/araprof)

{{< iconify mdi github >}} [aranaur](https://github.com/Aranaur)

{{< iconify mdi envelope >}} ihor.miroshnychenko\@knu.ua

{{< iconify mdi linkedin >}} [ihormiroshnychenko](https://www.linkedin.com/in/ihormiroshnychenko/)

{{< iconify ion home >}} [aranaur.rbind.io](https://aranaur.rbind.io)