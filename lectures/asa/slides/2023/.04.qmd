---
title: "–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å"
subtitle: "–ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑"
author: "–Ü–≥–æ—Ä –ú—ñ—Ä–æ—à–Ω–∏—á–µ–Ω–∫–æ"
institute: –ö–ù–£ —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞ | –§–Ü–¢
# date: today
# date-format: iso
from: markdown+emoji
title-slide-attributes:
  data-background-iframe: .04_files/libs/colored-particles/index.html
#   data-background-color: "#eef3f8"
language: _language-ua.yml
footer: üîó <a href="https://aranaur.rbind.io/lectures/asa/">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É</a>
format: 
  revealjs:
    transition: fade
    chalkboard: true
    logo: img/fit.png
    code-line-numbers: false
    slide-number: c/t
    mouse-wheel: true
    width: 1350  
    height: 759.375
    highlight-style: github
    pdf-separate-fragments: true
    # fig-height: 7.5
    # fig-width: 15
    fig-align: center
    fig-format: svg
    theme: [default, custom.scss]
# jupyter: python3
execute: 
  warning: false
  echo: true
  # cache: true

---

```{python}
#| label: setup-python
#| include: false

# Import libraries
import numpy as np
import pandas as pd
import hashlib
import matplotlib.pyplot as plt
import seaborn as sns

from IPython.display import Markdown
from tabulate import tabulate

# Set seaborn default style
sns.set_style('whitegrid')
sns.set_palette('colorblind')

# Define colors
red_pink   = "#e64173"
turquoise  = "#20B2AA"
orange     = "#FFA500"
red        = "#fb6107"
blue       = "#181485"
navy       = "#150E37FF"
green      = "#8bb174"
yellow     = "#D8BD44"
# grey_light = "grey70"
# grey_mid   = "grey50"
# grey_dark  = "grey20"
purple     = "#6A5ACD"
slate      = "#314f4f"
```

```{r}
#| label: setup
#| include: false

library(pacman)
p_load(broom, latex2exp, ggplot2, ggthemes, viridis, extrafont,  dplyr,  magrittr, knitr, parallel, fontawesome)

# Define pink color
red_pink = "#e64173"
grey_light = "grey70"
grey_mid = "grey50"
grey_dark = "grey20"

# A blank theme for ggplot
theme_empty = theme_bw() + theme(
  line = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  plot.margin = structure(c(0, 0, -0.5, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_simple = theme_bw() + theme(
  line = element_blank(),
  panel.grid = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text.x = element_text(size = 18, family = "STIXGeneral"),
  axis.text.y = element_blank(),
  axis.ticks = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  # plot.margin = structure(c(0, 0, -1, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_math = theme_void() + theme(
  text = element_text(family = "MathJax_Math"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_serif = theme_void() + theme(
  text = element_text(family = "MathJax_Main"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes = theme_void() + theme(
  text = element_text(family = "Fira Sans Book"),
  axis.title = element_text(size = 18),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = grey_light,
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
```

# –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π –º—ñ–Ω—ñ–º—É–º {background-color="#eef3f8"}

## –†–æ–∑–ø–æ–¥—ñ–ª $\chi^2$

–†–æ–∑–ø–æ–¥—ñ–ª $\chi^2$ ‚Äî —Ü–µ –ª–∏—à–µ —â–µ –æ–¥–∏–Ω –ø—Ä–∏–∫–ª–∞–¥ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ (—ñ–º–µ–Ω–æ–≤–∞–Ω–æ–≥–æ) —Ä–æ–∑–ø–æ–¥—ñ–ª—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É, —Ä–æ–∑–ø–æ–¥—ñ–ª—É $t$ —ñ —Ä–æ–∑–ø–æ–¥—ñ–ª—É $F$).

–§–æ—Ä–º–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É $\chi^2$ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:

- –ú–∏ –±—É–¥–µ–º–æ –Ω–∞–∑–∏–≤–∞—Ç–∏ —Ü–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä $k$
- –ù–∞—à–∞ —Ç–µ—Å—Ç–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ –∑–∞–ª–µ–∂–∞—Ç–∏ –≤—ñ–¥ $k$ *—Å—Ç—É–ø–µ–Ω—ñ–≤ —Å–≤–æ–±–æ–¥–∏*.

---

## –†–æ–∑–ø–æ–¥—ñ–ª $\chi^2$

–¢—Ä–∏ –ø—Ä–∏–∫–ª–∞–¥–∏ $\chi_k^2$: $\color{#314f4f}{k = 1}$, $\color{#e64173}{k = 2}$ —ñ $\color{orange}{k = 9}$

```{r, chisq1, echo = F, dev = "svg", fig.height = 5.5}
ggplot(data = tibble(x = c(0, 20)), aes(x)) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 2),
    fill = "darkslategrey", alpha = 0.3
  ) +
  stat_function(
    fun = dchisq, args = list(df = 2), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 3),
    fill = red_pink, alpha = 0.3
  ) +
  stat_function(
    fun = dchisq, args = list(df = 3), n = 1e3,
    color = red_pink
  ) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 9),
    fill = "orange", alpha = 0.3
  ) +
  stat_function(
    fun = dchisq, args = list(df = 9), n = 1e3,
    color = "orange"
  ) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

---

## –†–æ–∑–ø–æ–¥—ñ–ª $\chi^2$

–Ü–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –±—ñ–ª—å—à –µ–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ—ó —Ç–µ—Å—Ç–æ–≤–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ $\widehat{\text{LM}}$ –ø—ñ–¥ H~0~

```{r, chisq2, echo = F, dev = "svg", fig.height = 5.5}
ggplot(data = tibble(x = c(0, 8)), aes(x)) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 2),
    fill = "darkslategrey", alpha = 0.05
  ) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 2),
    fill = red_pink, alpha = 0.85,
    xlim = c(5, 8)
  ) +
  stat_function(
    fun = dchisq, args = list(df = 2), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_vline(xintercept = 5, color = grey_dark, size = 0.5, linetype = "dotted") +
  annotate("text", x = 5, y = 1.55 * dchisq(5, df = 2), label = TeX("$\\widehat{LM}$"), family = "MathJax_Main", size = 7) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

# –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–î–∞–≤–∞–π—Ç–µ –∑–≥–∞–¥–∞—î–º–æ **–ø–æ—Ç–æ—á–Ω—ñ –ú–ù–ö –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è**

. . .

1. –ù–∞—à–∞ –≤–∏–±—ñ—Ä–∫–∞ ($x_k$ —Ç–∞ $y_i$) –±—É–ª–∞ [–≤–∏–ø–∞–¥–∫–æ–≤–∏–º —á–∏–Ω–æ–º]{.hi} –≤—ñ–¥—ñ–±—Ä–∞–Ω–∞ –∑ —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ.

. . .

2. $y$ —î [–ª—ñ–Ω—ñ–π–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é]{.hi} $\beta_k$ —ñ $u_i$.

. . .

3. –£ –Ω–∞—à—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ –Ω–µ–º–∞—î —ñ–¥–µ–∞–ª—å–Ω–æ—ó [–º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω–æ—Å—Ç—ñ]{.hi}.

. . .

4. –ü–æ—è—Å–Ω—é–≤–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —î [–µ–∫–∑–æ–≥–µ–Ω–Ω–∏–º–∏]{.hi}: $\mathop{\boldsymbol{E}}\left[ u \middle| X \right] = 0 \left(\implies \mathop{\boldsymbol{E}}\left[ u \right] = 0\right)$.

. . .

5. –ó–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å [–ø–æ—Å—Ç—ñ–π–Ω—É –¥–∏—Å–ø–µ—Ä—Å—ñ—é]{.hi} $\sigma^2$ —ñ [–Ω—É–ª—å–æ–≤–∞ –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—è]{.hi}, _—Ç–æ–±—Ç–æ_,
   - $\mathop{\boldsymbol{E}}\left[ u_i^2 \middle| X \right] = \mathop{\text{Var}} \left( u_i \middle| X \right) = \sigma^2 \implies \mathop{\text{Var}} \left( u_i \right) = \sigma^2$
   - $\mathop{\text{Cov}} \left( u_i, \, u_j \middle| X \right) = \mathop{\boldsymbol{E}}\left[ u_i u_j \middle| X \right] = 0$ –¥–ª—è $i\neq j$

. . .

6. –ó–±—É—Ä–µ–Ω–Ω—è –ø–æ—Ö–æ–¥—è—Ç—å –≤—ñ–¥ [–Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ]{.hi} —Ä–æ–∑–ø–æ–¥—ñ–ª—É, _—Ç–æ–±—Ç–æ_, $u_i \overset{\text{iid}}{\sim} \mathop{\text{N}}\left( 0, \sigma^2 \right)$.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –∑–æ—Å–µ—Ä–µ–¥–∂—É—î–º–æ—Å—å –Ω–∞ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—ñ \#5:

> 5. –ó–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å [–ø–æ—Å—Ç—ñ–π–Ω—É –¥–∏—Å–ø–µ—Ä—Å—ñ—é]{.hi} $\sigma^2$ —ñ [–Ω—É–ª—å–æ–≤–∞ –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—è]{.hi}, _—Ç–æ–±—Ç–æ_,
   - $\mathop{\boldsymbol{E}}\left[ u_i^2 \middle| X \right] = \mathop{\text{Var}} \left( u_i \middle| X \right) = \sigma^2 \implies \mathop{\text{Var}} \left( u_i \right) = \sigma^2$
   - $\mathop{\text{Cov}} \left( u_i, \, u_j \middle| X \right) = \mathop{\boldsymbol{E}}\left[ u_i u_j \middle| X \right] = 0$ –¥–ª—è $i\neq j$

. . .

–ó–æ–∫—Ä–µ–º–∞, –º–∏ –∑–æ—Å–µ—Ä–µ–¥–∏–º–æ—Å—è –Ω–∞ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—ñ [–ø–æ—Å—Ç—ñ–π–Ω–æ—ó –¥–∏—Å–ø–µ—Ä—Å—ñ—ó]{.hi} (—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ–º—É —è–∫ *–≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å*).

. . .

**–ü–æ—Ä—É—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è:**

[–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å:]{.hi} $\mathop{\text{Var}} \left( u_i \right) = \sigma^2_i$ —ñ $\sigma^2_i \neq \sigma^2_j$ –¥–ª—è –¥–µ—è–∫–∏—Ö $i\neq j$ .

. . .

–Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: –Ω–∞—à—ñ –∑–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–ö–ª–∞—Å–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: –≤–æ—Ä–æ–Ω–∫–∞

–î–∏—Å–ø–µ—Ä—Å—ñ—è $u$ –∑—Ä–æ—Å—Ç–∞—î —Ä–∞–∑–æ–º —ñ–∑ $x$

```{r, het ex1, dev = "svg", echo = F, fig.height = 5.5}
set.seed(12345)
ggplot(data = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 4 + 1.5 * x)
), aes(x = x, y = e)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–Ü–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: (–ø–æ–¥–≤—ñ–π–Ω–∞ –≤–æ—Ä–æ–Ω–∫–∞?)

–î–∏—Å–ø–µ—Ä—Å—ñ—è $u$ –∑—Ä–æ—Å—Ç–∞—î –Ω–∞ –∫—Ä–∞–π–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω–Ω—è—Ö $x$

```{r, het ex2 , dev = "svg", echo = F, fig.height = 5.5}
set.seed(12345)
ggplot(data = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2)
), aes(x = x, y = e)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–Ü–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–†—ñ–∑–Ω—ñ –≥—Ä—É–ø–æ–≤—ñ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó $u$ 

```{r, het ex3 , dev = "svg", echo = F, fig.height = 5.5}
set.seed(12345)
ggplot(data = tibble(
  g = sample(c(F,T), 1e3, replace = T),
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 0.5 + 2 * g)
), aes(x = x, y = e, color = g, shape = g, alpha = g)) +
geom_point(size = 2.75) +
scale_color_manual(values = c("darkslategrey", red_pink)) +
scale_shape_manual(values = c(16, 1)) +
scale_alpha_manual(values = c(0.5, 0.8)) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

[–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å]{.hi} –ø—Ä–∏—Å—É—Ç–Ω—è, –∫–æ–ª–∏ –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u$ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∑ –±—É–¥—å-—è–∫–æ—é –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—î—é –Ω–∞—à–∏—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö $x_1$ –¥–æ $x_k$ (–¥–∞–ª—ñ: $X$).

. . .

–¶–µ –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–µ —è–≤–∏—â–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ.

. . .

[–ß–æ–º—É –≤–æ–Ω–∞ –Ω–∞–º –≤–∞–∂–ª–∏–≤–∞:]{.hi} –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –ø–æ–∫–∞–∑—É—î –Ω–∞–º, —è–∫ –Ω–µ–∑–Ω–∞—á–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è –Ω–∞—à–∏—Ö –ø—Ä–∏–ø—É—â–µ–Ω—å –º–æ–∂—É—Ç—å –≤–ø–ª–∏–Ω—É—Ç–∏ –Ω–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ú–ù–ö.

---

## –ù–∞—Å–ª—ñ–¥–∫–∏

–û—Ç–∂–µ, —è–∫—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ? –ó–º—ñ—â–µ–Ω–Ω—è? –ù–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å?

–ü–æ-–ø–µ—Ä—à–µ, –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ, —á–∏ —Ü–µ –º–∞—î –Ω–∞—Å–ª—ñ–¥–∫–∏ –¥–ª—è –Ω–µ–∑–º—ñ—â–µ–Ω–Ω–æ—Å—Ç—ñ –ú–ù–ö

. . .

**–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è~1~:** –Ω–µ–∑–º—ñ—â–µ–Ω–Ω—ñ—Å—Ç—å –ú–ù–ö –æ–∑–Ω–∞—á–∞—î $\mathop{\boldsymbol{E}}\left[ \hat{\beta}_k \middle| X \right] = \beta_k$ –¥–ª—è –≤—Å—ñ—Ö $k$.

. . .

**–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è~2~:** —Ä–∞–Ω—ñ—à–µ –º–∏ –ø–æ–∫–∞–∑—É–≤–∞–ª–∏ $\hat{\beta}_1 = \dfrac{\sum_i\left(y_i-\overline{y}\right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2}$

. . .

–¶–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –¥–æ–ø–æ–º–æ–∂–µ –Ω–∞–º –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —Ü—é –æ—Ü—ñ–Ω–∫—É —è–∫

$$ \hat{\beta}_1 = \beta_1 + \dfrac{\sum_i \left( x_i - \overline{x} \right) u_i}{\sum_i \left( x_i - \overline{x} \right)^2} $$

---

## –ù–∞—Å–ª—ñ–¥–∫–∏

**–î–æ–≤–µ–¥–µ–Ω–Ω—è:** –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ $y_i = \beta_0 + \beta_1 x_i + u_i$

$$
\begin{aligned}
  \hat{\beta}_1
  &= \dfrac{\sum_i\left(y_i-\overline{y}\right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \dfrac{\sum_i\left(\left[ \beta_0 + \beta_1 x_i + u_i \right]- \left[ \beta_0 + \beta_1 \overline{x} + \overline{u} \right] \right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \dfrac{\sum_i\left(\beta_1 \left[ x_i - \overline{x} \right] + \left[u_i - \overline{u}\right]  \right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \dfrac{\sum_i\left(\beta_1 \left[ x_i - \overline{x} \right]^2 + \left[ x_i - \overline{x} \right] \left[u_i - \overline{u}\right]\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) \left(u_i - \overline{u}\right)}{\sum_i\left(x_i -\overline{x}\right)^2}
\end{aligned}
$$

---

## –ù–∞—Å–ª—ñ–¥–∫–∏

$$
\begin{aligned}
  \hat{\beta}_1
  &= \cdots = \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) \left(u_i - \overline{u}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \sum_i\left(x_i - \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \left(\sum_i x_i - \sum_i \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \left(\sum_i x_i - n \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \color{#e64173}{\left(\sum_i x_i - \sum_i x_i\right)}}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i}{\sum_i\left(x_i -\overline{x}\right)^2} \quad \text{üòÖ}
\end{aligned}
$$

---

## –ù–∞—Å–ª—ñ–¥–∫–∏: –∑–º—ñ—â–µ–Ω–Ω—è

–¢–µ–ø–µ—Ä –º–∏ —Ö–æ—á–µ–º–æ –ø–æ–±–∞—á–∏—Ç–∏, —á–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –∑–º—ñ—â—É—î –æ—Ü—ñ–Ω–∫—É –ú–ù–ö –¥–ª—è $\beta_1$.

. . .

$$
\begin{aligned}
  \mathop{\boldsymbol{E}}\left[ \hat{\beta}_1 \middle| X \right]
  &= \mathop{\boldsymbol{E}}\left[ \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i}{\sum_i\left(x_i -\overline{x}\right)^2} \middle| X \right] \\[0.5em]
  &= \beta_1 + \mathop{\boldsymbol{E}}\left[ \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i}{\sum_i\left(x_i -\overline{x}\right)^2} \middle| X \right] \\[0.5em]
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \color{#e64173}{\underbrace{\mathop{\boldsymbol{E}}\left[ u_i \middle| X \right]}_{=0}} \\[0.5em]
  &= \beta_1
\end{aligned}
$$

. . .

–§—É—Ö... [–ú–ù–ö –≤—Å–µ —â–µ –Ω–µ–∑–º—ñ—â–µ–Ω–Ω—ñ]{.hi} –¥–ª—è $\beta_k$.

---

## –ù–∞—Å–ª—ñ–¥–∫–∏: –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

**–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** —ñ **—ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å** –ú–ù–ö –Ω–µ –≤–∏—Ç—Ä–∏–º—É—é—Ç—å –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

- –ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –ú–ù–ö [–Ω–µ —î –±—ñ–ª—å—à–µ –Ω–∞–π–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–º]{.hi} (–Ω–∞–π–∫—Ä–∞—â–∏–π) –ª—ñ–Ω—ñ–π–Ω–∏–º –Ω–µ–∑–º—ñ—â–µ–Ω–∏–º –æ—Ü—ñ–Ω—é–≤–∞—á–µ–º.

. . .

- –ë—É–ª–æ –± –±—ñ–ª—å—à —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–º (–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–º) [–∑–≤–∞–∂–∏—Ç–∏ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è]{.hi} –æ–±–µ—Ä–Ω–µ–Ω–æ –¥–æ —ó—Ö–Ω—å–æ—ó –¥–∏—Å–ø–µ—Ä—Å—ñ—ó $u_i$.

   - –ù–∏–∑—å–∫–∞ –≤–∞–≥–∞ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∑ –≤–∏—Å–æ–∫–æ—é –¥–∏—Å–ø–µ—Ä—Å—ñ—î—é $u_i$.

   - –í–∏—Å–æ–∫–∞ –≤–∞–≥–∞ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∑ –Ω–∏–∑—å–∫–æ—é –¥–∏—Å–ø–µ—Ä—Å—ñ—î—é $u_i$.

   - –¢–µ–ø–µ—Ä —É –≤–∞—Å —î —ñ–¥–µ—è –∑–≤–∞–∂–µ–Ω–∏—Ö –Ω–∞–π–º–µ–Ω—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ (–ó–ú–ù–ö, WLS)

---

## –ù–∞—Å–ª—ñ–¥–∫–∏: —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å

–ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –ú–ù–ö —î –∑–º—ñ—â–µ–Ω–Ω–∏–º–∏]{.hi} .

- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏

- –ü—Ä–æ–±–ª–µ–º–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—ñ–ø–æ—Ç–µ–∑ (—è–∫ $t$, —Ç–∞–∫ —ñ $F$ —Ç–µ—Å—Ç–∏)

---

## –†—ñ—à–µ–Ω–Ω—è

1. **–¢–µ—Å—Ç–∏** –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

2. **–ó–∞—Å–æ–±–∏ –∑–∞—Ö–∏—Å—Ç—É** –¥–ª—è (1) –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ (2) —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—ñ

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–•–æ—á–∞ —É –Ω–∞—Å *–º–æ–∂–ª–∏–≤–æ* —î —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ, –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞—à–∏—Ö –æ—Ü—ñ–Ω—é–≤–∞—á—ñ–≤ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

1. **–¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞**

2. **–¢–µ—Å—Ç –£–∞–π—Ç–∞**

3. **–¢–µ—Å—Ç –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞**

. . .

–ö–æ–∂–µ–Ω —ñ–∑ —Ü–∏—Ö —Ç–µ—Å—Ç—ñ–≤ –∑–æ—Å–µ—Ä–µ–¥–∂—É—î—Ç—å—Å—è –Ω–∞ —Ç–æ–º—É —Ñ–∞–∫—Ç—ñ, —â–æ –º–∏ –º–æ–∂–µ–º–æ [–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–∞–ª–∏—à–∫–∏ –ú–ù–ö]{.hi} $\color{#e64173}{e_i}$ [–¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –ø–æ–ø—É–ª—è—Ü—ñ—ó]{.hi} $\color{#e64173}{u_i}$.

# –¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

## –¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

–ó–æ—Å–µ—Ä–µ–¥–∂—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∏–ø—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: —á–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u_i$ [–º—ñ–∂ –¥–≤–æ–º–∞ –≥—Ä—É–ø–∞–º–∏]{.hi}.

–ü–∞–º'—è—Ç–∞—î—Ç–µ, —è–∫ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –Ω–∞—à—ñ –∑–∞–ª–∏—à–∫–∏ –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ $\sigma^2$?

$$ s^2 = \dfrac{\text{SSE}}{n-1} = \dfrac{\sum_i e_i^2}{n-1} $$

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ —Ü—é —Å–∞–º—É —ñ–¥–µ—é, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —á–∏ —î –¥–æ–∫–∞–∑–∏ —Ç–æ–≥–æ, —â–æ –Ω–∞—à—ñ –¥–≤—ñ –≥—Ä—É–ø–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è –¥–∏—Å–ø–µ—Ä—Å—ñ—è–º–∏ —Å–≤–æ—ó—Ö –∑–±—É—Ä–µ–Ω—å, —Ñ–∞–∫—Ç–∏—á–Ω–æ –ø–æ—Ä—ñ–≤–Ω—é—é—á–∏ $s^2_1$ —ñ $s^2_2$ –≤—ñ–¥ –Ω–∞—à–∏—Ö –¥–≤–æ—Ö –≥—Ä—É–ø.

---

## –¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. –£–ø–æ—Ä—è–¥–∫—É–π—Ç–µ —Å–≤–æ—ó —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞ $x$

2. –†–æ–∑–¥—ñ–ª—ñ—Ç—å –¥–∞–Ω—ñ –Ω–∞ –¥–≤—ñ –≥—Ä—É–ø–∏ —Ä–æ–∑–º—ñ—Ä–æ–º n^‚≠ë^
   - G~1~: –ø–µ—Ä—à–∞ —Ç—Ä–µ—Ç–∏–Ω–∞
   - G~2~: –æ—Å—Ç–∞–Ω–Ω—è —Ç—Ä–µ—Ç–∏–Ω–∞

3. –ü–æ–±—É–¥—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —Ä–µ–≥—Ä–µ—Å—ñ—ó $y$ –≤—ñ–¥ $x$ –¥–ª—è G~1~ —ñ G~2~

4. –†–æ–∑—Ä–∞—Ö—É–π—Ç–µ SSE~1~ —ñ SSE~2~

5. –û–±—á–∏—Å–ª—ñ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ—Å—Ç—É G-Q

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

$$F_{\left(n^{\star}-k,\, n^{\star}-k\right)} = \dfrac{\text{SSE}_2/(n^\star-k)}{\text{SSE}_1/(n^\star-k)} = \dfrac{\text{SSE}_2}{\text{SSE}_1}$$

–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î $F$ —Ä–æ–∑–ø–æ–¥—ñ–ª—É (–∑–∞ –Ω—É–ª—å–æ–≤–æ—é –≥—ñ–ø–æ—Ç–µ–∑–æ—é) —ñ–∑ —Å—Ç—É–ø–µ–Ω—è–º–∏ —Å–≤–æ–±–æ–¥–∏ $n^{\star}-k$ —ñ $n^{\star}-k$[^1].

::: {.callout-note}
- –¢–µ—Å—Ç G-Q –≤–∏–º–∞–≥–∞—î, —â–æ–± –∑–±—É—Ä–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–∞–º.
- G-Q –ø–µ—Ä–µ–¥–±–∞—á–∞—î –¥—É–∂–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π —Ç–∏–ø/—Ñ–æ—Ä–º—É –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.
- –î—É–∂–µ –¥–æ–±—Ä–µ –ø—Ä–∞—Ü—é—î, —è–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ —Ñ–æ—Ä–º—É –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ—ó –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.
:::

[^1]: –ì–æ–ª–¥—Ñ–µ–ª—å–¥ —ñ –ö–≤–∞–Ω–¥—Ç –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞–ª–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ $n^{\star}$ –∑ –≤–∏—Ä–∞–∑—É $(3/8)n$. $k$ —Ü–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Ü—ñ–Ω–µ–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (_—Ç–æ–±—Ç–æ_, $\hat{\beta}_j$).

---

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq1a, echo = F, dev = "svg", fig.height = 4}
set.seed(12345)
# Data
gq_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 4 + 1.5 * x),
  y = 1 + 3 * x + e
)
# Quantiles
gq_x = quantile(gq_df$x, probs = c(3/8, 5/8))
# Regressions
sse1 = lm(y ~ x, data = gq_df %>% filter(x < gq_x[1])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
sse2 = lm(y ~ x, data = gq_df %>% filter(x > gq_x[2])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
ggplot(data = gq_df, aes(x = x, y = e)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq1b, echo = F, dev = "svg", fig.height = 4}
ggplot(data = gq_df, aes(
  x = x, y = e,
  color = cut(x, c(-Inf, gq_x, Inf)),
  alpha = cut(x, c(-Inf, gq_x, Inf)),
  shape = cut(x, c(-Inf, gq_x, Inf))
)) +
geom_vline(
  xintercept = gq_x,
  color = grey_mid,
  size = 0.25
) +
geom_point(size = 2.75) +
labs(x = "x", y = "u") +
scale_color_manual(values = c("darkslategrey", grey_mid, red_pink)) +
scale_shape_manual(values = c(19, 1, 19)) +
scale_alpha_manual(values = c(0.5, 0.8, 0.6)) +
theme_axes_math
```

$F_{375,\,375} = \dfrac{\color{#e64173}{\text{SSE}_2 = `r format(round(sse2, 1), nsmall = 0L, big.mark = ",")`}}{\color{#314f4f}{\text{SSE}_1 = `r format(round(sse1, 1), nsmall = 0L, big.mark = ",")`}} \approx `r format(round(sse2/sse1, 1), nsmall = 0L, big.mark = ",")` \implies$ *p*-value $< 0.001$

$\therefore$ –ú–∏ –≤—ñ–¥—Ö–∏–ª—è—î–º–æ H~0~: $\sigma^2_1 = \sigma^2_2$ —ñ —Ä–æ–±–∏–º–æ –≤–∏—Å–Ω–æ–≤–æ–∫ –ø—Ä–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏—Ö –¥–æ–∫–∞–∑—ñ–≤ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –ü—Ä–æ–±–ª–µ–º–∏ —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq2a, echo = F, dev = "svg", fig.height = 4}
set.seed(12345)
# Data
gq2_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2),
  y = 1 + 3 * x + e
)
# Quantiles
gq_x = quantile(gq2_df$x, probs = c(3/8, 5/8))
# Regressions
sse1b = lm(y ~ x, data = gq2_df %>% filter(x < gq_x[1])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
sse2b = lm(y ~ x, data = gq2_df %>% filter(x > gq_x[2])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
ggplot(data = gq2_df, aes(
  x = x, y = e
)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5, shape = 19) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ü—Ä–æ–±–ª–µ–º–∏ —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq2b, echo = F, dev = "svg", fig.height = 4}
ggplot(data = gq2_df, aes(
  x = x, y = e,
  color = cut(x, c(-Inf, gq_x, Inf)),
  alpha = cut(x, c(-Inf, gq_x, Inf)),
  shape = cut(x, c(-Inf, gq_x, Inf))
)) +
geom_vline(
  xintercept = gq_x,
  color = grey_mid,
  size = 0.25
) +
geom_point(size = 2.75) +
labs(x = "x", y = "u") +
scale_color_manual(values = c("darkslategrey", grey_mid, red_pink)) +
scale_shape_manual(values = c(19, 1, 19)) +
scale_alpha_manual(values = c(0.5, 0.8, 0.6)) +
theme_axes_math
```

$F_{375,\,375} = \dfrac{\color{#e64173}{\text{SSE}_2 = `r format(round(sse2b, 1), nsmall = 0L, big.mark = ",")`}}{\color{#314f4f}{\text{SSE}_1 = `r format(round(sse1b, 1), nsmall = 0L, big.mark = ",")`}} \approx `r format(round(sse2b/sse1b, 1), nsmall = 0L, big.mark = ",")` \implies$ *p*-value $\approx `r round(pf(sse2b/sse1b, 375, 375, lower.tail = F), 3)`$

$\thorefore$ –ù–∞–º –Ω–µ –≤–¥–∞—î—Ç—å—Å—è –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~: $\sigma^2_1 = \sigma^2_2$, —Ö–æ—á–∞ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –æ—á–µ–≤–∏–¥–Ω–æ –ø—Ä–∏—Å—É—Ç–Ω—è.

# –¢–µ—Å—Ç –£–∞–π—Ç–∞

## –¢–µ—Å—Ç –£–∞–π—Ç–∞

**–ë—Ä–æ–π—à —ñ –ü–∞–≥–∞–Ω (1981)** –Ω–∞–º–∞–≥–∞–ª–∏—Å—è –≤–∏—Ä—ñ—à–∏—Ç–∏ —Ü—é –ø—Ä–æ–±–ª–µ–º—É –Ω–∞–¥—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

- –†–µ–≥—Ä–µ—Å—ñ—è $e_i^2$ –≤—ñ–¥ $X = \left[ 1,\, x_1,\, x_2,\, \ldots,\, x_k \right]$ —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–ø—ñ–ª—å–Ω–æ—ó –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ.
- –î–æ–∑–≤–æ–ª—è—î –¥–∞–Ω–∏–º –ø–æ–∫–∞–∑–∞—Ç–∏, —á–∏ –∞–±–æ —è–∫ –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u_i$ –∫–æ—Ä–µ–ª—é—î –∑ $X$.
- –Ø–∫—â–æ $\sigma_i^2$ –∫–æ—Ä–µ–ª—é—î –∑ $X$, —Ç–æ –º–∏ –º–∞—î–º–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.

. . .

–û–¥–Ω–∞–∫ –º–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ —Ö–æ—á–µ–º–æ –∑–Ω–∞—Ç–∏, —á–∏

$$\sigma_1^2 = \sigma_2^2 = \cdots = \sigma_n^2$$

---

## –¢–µ—Å—Ç –£–∞–π—Ç–∞

–î–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ—î—ó –º–µ—Ç–∏ –ì–µ–ª –£–∞–π—Ç —Å–∫–æ—Ä–∏—Å—Ç–∞–≤—Å—è —Ç–∏–º —Ñ–∞–∫—Ç–æ–º, —â–æ –º–∏ –º–æ–∂–µ–º–æ [–∑–∞–º—ñ–Ω–∏—Ç–∏ –≤–∏–º–æ–≥—É –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å–ª–∞–±—à–∏–º –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è–º]{.hi}:

- **–°—Ç–∞—Ä–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è:** $\mathop{\text{Var}} \left( u_i \middle| X \right) = \sigma^2$

- **–ù–æ–≤–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è:** $u^2$ *–Ω–µ–∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ* –∑ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ (_—Ç–æ–±—Ç–æ_, $x_j$ –¥–ª—è –≤—Å—ñ—Ö $j$), —ó—Ö–Ω—ñ–º–∏ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ (_—Ç–æ–±—Ç–æ_, $x_j^2 $), –∞ —Ç–∞–∫–æ–∂ –≤–∑–∞—î–º–æ–¥—ñ—ó –ø–µ—Ä—à–æ–≥–æ —Å—Ç—É–ø–µ–Ω—è (_—Ç–æ–±—Ç–æ_, $x_j x_h$).

. . .

–¶–µ –Ω–æ–≤–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è –ª–µ–≥—à–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ (*–ø—ñ–¥–∫–∞–∑–∫–∞:* —Ä–µ–≥—Ä–µ—Å—ñ—è).

---

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

1\. –†–µ–≥—Ä–µ—Å—ñ—è y –Ω–∞ x~1~, x~2~, ‚Ä¶, x~k~. –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–ª–∏—à–∫–∏ e.

2\. –†–µ–≥—Ä–µ—Å—ñ—è –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ –∑–∞–ª–∏—à–∫—ñ–≤ –¥–ª—è –≤—Å—ñ—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, —ó—Ö–Ω—ñ—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ —ñ –≤–∑–∞—î–º–æ–¥—ñ–π.

$$e^2 = \alpha_0 + \sum_{h=1}^k \alpha_h x_h + \sum_{j=1}^k \alpha_{k+j} x_j^2 + \sum_{\ell = 1}^{k-1} \sum_{m = \ell + 1}^k \alpha_{\ell,m} x_\ell x_m + v_i$$

3\. –ó–∞–ø–∏—Å R~e~^2^.

4\. –û–±—á–∏—Å–ª—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ H~0~: $\alpha_p = 0$ –¥–ª—è –≤—Å—ñ—Ö $p\neq0$.

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

$$ \text{LM} = n \times R_e^2 \qquad \text{–¥–µ H}_0,\, \text{LM} \overset{\text{d}}{\sim} \chi_k^2 $$

–¥–µ $R^2_e$ –ø–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ —Ä–µ–≥—Ä–µ—Å—ñ—ó $e^2$ –Ω–∞ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ, —ó—Ö–Ω—ñ –∫–≤–∞–¥—Ä–∞—Ç–∏ —Ç–∞ —ó—Ö–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó.

$$ e^2 = \alpha_0 + \underbrace{\sum_{h=1}^k \alpha_h x_h}_{\text{–ü–æ—è—Å–Ω. –∑–º—ñ–Ω–Ω—ñ}} + \underbrace{\sum_{j=1}^k \alpha_{k+j} x_j^2}_{\text{–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞ —Ñ–æ—Ä–º–∞}} + \underbrace{\sum_{\ell = 1}^{k-1} \sum_{m = \ell + 1}^k \alpha_{\ell,m} x_\ell x_m}_{\text{–í–∑–∞—î–º–æ–¥—ñ—è}} + v_i $$

::: {.callout-note}
$k$ (–¥–ª—è –Ω–∞—à–æ–≥–æ $\chi_k^2$) –¥–æ—Ä—ñ–≤–Ω—é—î –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ—Ü—ñ–Ω–µ–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —É –Ω–∞–≤–µ–¥–µ–Ω—ñ–π –≤–∏—â–µ —Ä–µ–≥—Ä–µ—Å—ñ—ó ($\alpha_j$), –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º $\left( \alpha_0 \right)$.
:::

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

*–ü—Ä–∏–∫–ª–∞–¥:* –†–æ–∑–≥–ª—è–Ω–µ–º–æ –º–æ–¥–µ–ª—å[^‚Ä†] $y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + u$

[^‚Ä†]: –©–æ–± —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è —Ç—É—Ç, —è –≤—ñ–¥–∫–∏–¥–∞—é —ñ–Ω–¥–µ–∫—Å–∏ $i$.

**–ö—Ä–æ–∫ 1:** –û—Ü—ñ–Ω—ñ—Ç—å –º–æ–¥–µ–ª—å; –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ª–∏—à–∫–∏ $(e)$.

**–ö—Ä–æ–∫ 2:** –†–µ–≥—Ä–µ—Å—ñ—è $e^2$ –≤—ñ–¥ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ —Ç–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó.

$$
\begin{aligned}
  e^2 =
  &\alpha_0 + \alpha_1 x_1 + \alpha_2 x_2 + \alpha_3 x_3 + \alpha_4 x_1^2 + \alpha_5 x_2^2 + \alpha_6 x_3^2 \\
  &+ \alpha_7 x_1 x_2 + \alpha_8 x_1 x_3 + \alpha_9 x_2 x_3 + v
\end{aligned}
$$

–ó–∞–ø–∏—à—ñ—Ç—å R^2^ —ñ–∑ —Ü—å–æ–≥–æ —Ä—ñ–≤–Ω—è–Ω–Ω—è (–Ω–∞–∑–≤—ñ—Ç—å –π–æ–≥–æ $R_e^2$).

**–ö—Ä–æ–∫ 3:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ H~0~: $\alpha_1 = \alpha_2 = \cdots = \alpha_9 = 0$ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é $\text{LM} = n R^2_e \overset{\text{d} }{\sim} \chi_9^2$.

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

```{r, white1, echo = F, dev = "svg", fig.height = 4}
set.seed(12345)
# Data
bp_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2),
  y = 1 + 3 * x + e
)

lm_bp1 = lm(residuals(lm(y ~ x, bp_df))^2 ~ 1 + bp_df$x) %>%
  summary() %$% r.squared %>% multiply_by(1e3)
lm_bp2 = lm(residuals(lm(y ~ x, bp_df))^2 ~ 1 + bp_df$x + I(bp_df$x^2)) %>%
  summary() %$% r.squared %>% multiply_by(1e3)

# The figure
ggplot(data = bp_df, aes(x = x, y = e)) +
geom_point(size = 2.75, color = "darkslategrey", alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

–¢–µ—Å—Ç –£–∞–π—Ç–∞ –¥–ª—è —Ü—ñ—î—ó –ø—Ä–æ—Å—Ç–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó.

$$
\begin{aligned}
 e_i^2 &= \hat{\alpha}_0 + \hat{\alpha}_1 x_{1i} \color{#e64173}{+ \hat{\alpha}_2 x^2_{1i}} & \widehat{\text{LM}} &= `r round(lm_bp2, 2)` &\mathit{p}\text{-value} < 0.001
\end{aligned}
$$

# –ü—Ä–∏–∫–ª–∞–¥–∏

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

**–ú–µ—Ç–∞:** –û—Ü—ñ–Ω–∏—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫ –º—ñ–∂ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (–∑–∞–ª–µ–∂–Ω–∞ –∑–º—ñ–Ω–Ω–∞) —ñ (1) —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è–º —Å—Ç—É–¥–µ–Ω—Ç/–≤–∏–∫–ª–∞–¥–∞—á —ñ (2) –¥–æ—Ö–æ–¥–æ–º, _—Ç–æ–±—Ç–æ_,

$$ \left(\text{Test score}\right)_i = \beta_0 + \beta_1 \text{Ratio}_{i} + \beta_2 \text{Income}_{i} + u_i \tag{1} $$

**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:** –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å... —ñ –º–∏ –Ω–µ –∑–Ω–∞—î–º–æ $u_i$.

**–†—ñ—à–µ–Ω–Ω—è:**

1. –û—Ü—ñ–Ω—ñ—Ç—å —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –≤ $(1)$ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ú–ù–ö.
2. –¢–µ—Å—Ç –Ω–∞ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.
   - –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥-–ö–≤–∞–Ω–¥—Ç
   - –£–∞–π—Ç–∞
   
---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–ú–∏ –±—É–¥–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö `Caschool` –≤ –ø–∞–∫–µ—Ç—ñ `Ecdat`.

```{r, ex data}
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤
library(pacman)
p_load(tidyverse, Ecdat)
# –í—ñ–¥–±—ñ—Ä —Ç–∞ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö
test_df  <- select(Caschool, test_score = testscr, ratio = str, income = avginc)
# –§–æ—Ä–º–∞—Ç —Ç—ñ–±–±–ª
test_df <- as_tibble(test_df)
# –ü–µ—Ä—à—ñ 2 —Ä—è–¥–∫–∏
head(test_df, 2)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–ü–æ—á–Ω–µ–º–æ –∑ –æ—Ü—ñ–Ω–∫–∏ –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ

$$ \left(\text{Test score}\right)_i = \beta_0 + \beta_1 \text{Ratio}_{i} + \beta_2 \text{Income}_{i} + u_i $$

```{r, ex gq1}
# –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ
est_model = lm(test_score ~ ratio + income, data = test_df)
# –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
tidy(est_model)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ –ø–æ–¥–∏–≤–∏–º–æ—Å—è, —â–æ –≥–æ–≤–æ—Ä—è—Ç—å –∑–∞–ª–∏—à–∫–∏ –ø—Ä–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

```{r, ex gq2}
# –î–æ–¥–∞–º–æ –∑–∞–ª–∏—à–∫–∏ –¥–æ –¥–∞–Ω–∏—Ö
test_df$e = residuals(est_model)
```

```{r, gq3, echo = F, dev = "svg", fig.height = 4.25}
# Plot residuals against income
plot1 = ggplot(data = test_df, aes(x = income, y = e)) +
  geom_point(size = 2.5, alpha = 0.5, color = red_pink) +
  labs(x = "Income", y = TeX("\\textit{e}")) +
  theme_axes_serif
# Plot residuals against student-teacher ratio
plot2 = ggplot(data = test_df, aes(x = ratio, y = e)) +
  geom_point(size = 2.5, alpha = 0.5, color = "darkslategrey") +
  labs(x = "Student-to-teacher ratio", y = TeX("\\textit{e}")) +
  theme_axes_serif
# The grid
gridExtra::grid.arrange(plot1, plot2, nrow = 1)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–î–æ—Ö—ñ–¥ –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

```{r, ex gq4, eval = F}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–î–æ—Ö—ñ–¥ –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

```{r, ex gq5, eval = F}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model2 = lm(test_score ~ ratio + income, data = head(test_df, 158))
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–î–æ—Ö—ñ–¥ –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

```{r, ex gq6}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model2 = lm(test_score ~ ratio + income, data = head(test_df, 158))
# –ë–µ—Ä–µ–º–æ –∑–∞–ª–∏—à–∫–∏ –≤—ñ–¥ –∫–æ–∂–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó
e_model1 = residuals(est_model1)
e_model2 = residuals(est_model2)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–î–æ—Ö—ñ–¥ –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

```{r, ex gq7}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model2 = lm(test_score ~ ratio + income, data = head(test_df, 158))
# –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ SSE –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó
sse_model1 = sum(e_model1^2)
sse_model1
sse_model2 = sum(e_model2^2)
sse_model2
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

$F_{n^\star-k,\,n^\star-k} = \dfrac{\text{SSE}_2}{\text{SSE}_1}$

. . .

$\approx\dfrac{`r round(sse_model2, 2) %>% format(big.mark = ",")`}{`r round(sse_model1, 2) %>% format(big.mark = ",")`}$

. . .

$\approx`r round(sse_model2/sse_model1, 2)`$

. . .

$F_{158-3,\,158-3}$

. . .

```{r, ex gq8}
# G-Q —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
(f_gq = sse_model2/sse_model1)
```

. . .

```{r, ex gq9}
# p-value
pf(q = f_gq, df1 = 158-3, df2 = 158-3, lower.tail = F)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–ö—Ä–∏—Ç–µ—Ä—ñ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞ —Ç–∞ –π–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª

```{r, ex gq10, echo = F, dev = "svg", fig.height = 5}
ggplot(data = tibble(x = c(0, f_gq * 1.3)), aes(x)) +
  geom_area(
    stat = "function", fun = df, args = list(df1 = 158, df2 = 158),
    fill = "darkslategrey", alpha = 0.05
  ) +
  geom_area(
    stat = "function", fun = df, args = list(df1 = 158, df2 = 158),
    fill = red_pink, alpha = 0.85,
    xlim = c(f_gq, f_gq * 1.3)
  ) +
  stat_function(
    fun = df, args = list(df1 = 158, df2 = 158), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_vline(xintercept = f_gq, color = grey_dark, size = 0.5, linetype = "dotted") +
  annotate(
    "text", x = f_gq, y = 5 * df(f_gq, df1 = 158, df2 = 158),
    label = TeX("$\\widehat{F}=1.53$"),
    family = "MathJax_Main", size = 7
  ) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–ó—ñ–±—Ä–∞–≤—à–∏ –≤—Å–µ —Ä–∞–∑–æ–º:

H~0~: $\sigma_1^2 = \sigma_2^2$ * –ø—Ä–æ—Ç–∏* H~A~: $\sigma_1^2 \neq \sigma_2^2$

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –ì–æ–ª–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞: $F \approx `r round(f_gq, 2)`$

*p*-–∑–Ω–∞—á–µ–Ω–Ω—è $\approx `r round(pf(q = f_gq, df1 = 158-3, df2 = 158-3, lower.tail = F), 5)`$

‚à¥ –í—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~ (*p*-–∑–Ω–∞—á–µ–Ω–Ω—è –º–µ–Ω—à–µ 0,05).

**–í–∏—Å–Ω–æ–≤–æ–∫:** –Ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ —Ç–æ–≥–æ, —â–æ $\sigma_1^2 \neq \sigma_2^2$. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –∑–Ω–∞—Ö–æ–¥–∏–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ (–Ω–∞ 5-–≤—ñ–¥—Å–æ—Ç–∫–æ–≤–æ–º—É —Ä—ñ–≤–Ω—ñ –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ).

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–©–æ, —è–∫–±–∏ –º–∏ –≤–∏—Ä—ñ—à–∏–ª–∏ –∑–æ—Å–µ—Ä–µ–¥–∏—Ç–∏—Å—è –Ω–∞ —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—ñ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —ñ –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤?

. . .

```{r, ex gq11}
# –í–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è
test_df = arrange(test_df, ratio)
# –ú–æ–¥–µ–ª—ñ
est_model3 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model4 = lm(test_score ~ ratio + income, data = head(test_df, 158))
# –ó–∞–ª–∏—à–∫–∏
e_model3 = residuals(est_model3)
e_model4 = residuals(est_model4)
# SSE
(sse_model3 = sum(e_model3^2))
(sse_model4 = sum(e_model4^2))
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

$F_{n^\star-k,\,n^\star-k} = \dfrac{\text{SSE}_4}{\text{SSE}_3} \approx\dfrac{`r round(sse_model4, 2) %>% format(big.mark = ",")`}{`r round(sse_model3, 2) %>% format(big.mark = ",")`} \approx`r round(sse_model4 / sse_model3, 2)`$

—è–∫–µ –º–∞—î *p*-–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏–±–ª–∏–∑–Ω–æ `r round(pf(sse_model4 / sse_model3, 158-3, 158-3, lower.tail = F), 4)`.

. . .

‚à¥ –ú–∏ –± –Ω–µ –∑–º–æ–≥–ª–∏ –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~, –¥—ñ–π—à–æ–≤—à–∏ –≤–∏—Å–Ω–æ–≤–∫—É, —â–æ –Ω–∞–º –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —Ç—É —Å–∞–º—É –º–æ–¥–µ–ª—å —ñ –¥–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞.

*–ù–∞–≥–∞–¥—É—î–º–æ:* –º–∏ –∑–±–µ—Ä–µ–≥–ª–∏ –Ω–∞—à—ñ –∑–∞–ª–∏—à–∫–∏ —è–∫ `e` —É –Ω–∞—à–æ–º—É –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö, _—Ç–æ–±—Ç–æ_,

```{r, white recall, eval = F}
# –ú–æ–¥–µ–ª—å
est_model = lm(test_score ~ ratio + income, data = test_df)
# –ó–∞–ª–∏—à–∫–∏
test_df$e = residuals(est_model)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

[**–¢–µ—Å—Ç –£–∞–π—Ç–∞** –¥–æ–¥–∞—î –∑–º—ã–Ω–Ω—ã –≤ –∫–≤–∞–¥—Ä–∞—Ç—ñ —Ç–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó]{.pink} –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó (–ø—Ä–∞–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞)

$$
\begin{align}
 \color{#314f4f}{u_{i}^2} =& \color{#314f4f}{\alpha_{0} + \alpha_{1} \text{Ratio}_{i} + \alpha_{2} \text{Income}_{i} } \\
 &+ \color{#e64173}{\alpha_{3} \text{Ratio}_{i}^2 + \alpha_{4} \text{Income}_{i}^2 + \alpha_{5} \text{Ratio}_{i}\times\text{Income}_{i}} \\
 &+ \color{#314f4f}{w_{i}}
\end{align}
$$

[**White test**]{.pink} –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω—É–ª—å–æ–≤—É –≥—ñ–ø–æ—Ç–µ–∑—É
<br>[H~0~:]{.pink} $\color{#e64173}{\alpha_1 = \alpha_2 = \alpha_3 = \alpha_4 = \alpha_5 = 0}$

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

::: {.callout-note}
`R` –º–∞—î –Ω–æ—Ç–∞—Ü—ñ—é –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∏—Ö —Ñ–æ—Ä–º —ñ –≤–∑–∞—î–º–æ–¥—ñ–π —É `lm()`:

- **–ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ —Ñ–æ—Ä–º–∏** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `I()`, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, `lm(y ~ I(x^2))`

- **–í–∑–∞—î–º–æ–¥—ñ—ó** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `:` –º—ñ–∂ –∑–º—ñ–Ω–Ω–∏–º–∏, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, `lm(y ~ x1:x2)`

*–ü—Ä–∏–∫–ª–∞–¥:* –†–µ–≥—Ä–µ—Å—ñ—è `y` –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥ `x1` —ñ `x2`:

```{r, ex quad, eval = F}
lm(y ~ x1 + x2 + I(x1^2) + I(x2^2) + x1:x2, data = pretend_df)
```
:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 1:** –†–µ–≥—Ä–µ—Å—ñ—è $e_i^2$ –Ω–∞ 1^st^ —Å—Ç—É–ø–µ–Ω—ñ, 2^nd^ —Å—Ç—É–ø—ñ–Ω—å —ñ –≤–∑–∞—î–º–æ–¥—ñ—ó

```{r, ex white1, eval = F}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
(white_r2 = summary(white_model)$r.squared)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 2:** –ó–±–µ—Ä—ñ—Ç—å $R_e^2$ –∑ —Ä–µ–≥—Ä–µ—Å—ñ—ó.

```{r, ex white2, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
(white_r2 = summary(white_model)$r.squared)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 3:** –û–±—á–∏—Å–ª—ñ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ $\text{LM} = n \times R_e^2 \approx 420 \times `r round(white_r2, 3)`$

```{r, ex white3, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
white_r2 = summary(white_model)$r.squared
# White test statistic
(white_stat = 420 * white_r2)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 4:** –û–±—á–∏—Å–ª—ñ—Ç—å *p*-–∑–Ω–∞—á–µ–Ω–Ω—è (–¥–µ $\text{LM} \overset{d}{\sim} \chi_k^2$); —Ç—É—Ç $k=5$

```{r, ex white4, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
white_r2 = summary(white_model)$r.squared
# White test statistic
white_stat = 420 * white_r2
# p-value
pchisq(q = white_stat, df = 5, lower.tail = F)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

–¢–µ–ø–µ—Ä –≤—Å–µ —Ä–∞–∑–æ–º:

. . .

H~0~: $\alpha_1 = \alpha_2 = \alpha_3 = \alpha_4 = \alpha_5 = 0$
. . .
 *vs.* H~A~: $\alpha_i \neq 0$ –¥–ª—è $i \in \{1,\, 2,\,\ldots,\, 5\}$
. . .
$$
\begin{align}
u_i^2 =& \alpha_0 + \alpha_1 \text{Ratio}_i + \alpha_2 \text{Income}_i \\
&+ \alpha_3 \text{Ratio}_i^2 + \alpha_4 \text{Income}_i^2 \\
&+ \alpha_5 \text{Ratio}_i \times \text{Income}_i + w_i
\end{align}
$$

. . .

–ù–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—ñ–ª–æ–≥–æ —Ç–µ—Å—Ç—É: $\text{LM} = n \times R_e^2 \approx 420 \times `r round(white_r2, 3)` \approx `r round(white_stat, 2)`$

. . .

–ó–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º $\chi_5^2$ —Ü–µ–π $\widehat{\text{LM}}$ –º–∞—î *p*-–∑–Ω–∞—á–µ–Ω–Ω—è –º–µ–Ω—à–µ 0,001.

. . .

‚à¥ –ú–∏ [–≤—ñ–¥—Ö–∏–ª—è—î–º–æ H~0~]{.hi} —ñ —Ä–æ–±–∏–º–æ –≤–∏—Å–Ω–æ–≤–æ–∫ –ø—Ä–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å [—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏—Ö –¥–æ–∫–∞–∑—ñ–≤ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ]{.hi} (–Ω–∞ 5-–≤—ñ–¥—Å–æ—Ç–∫–æ–≤–æ–º—É —Ä—ñ–≤–Ω—ñ).

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ —Ç–∞ —ó—ó —Ä–æ–∑–ø–æ–¥—ñ–ª

```{r, ex white plot, echo = F, dev = "svg", fig.height = 5}
ggplot(data = tibble(x = c(0, white_stat * 1.1)), aes(x)) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 5),
    fill = "darkslategrey", alpha = 0.05
  ) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 5),
    fill = red_pink, alpha = 0.85,
    xlim = c(white_stat, white_stat * 1.1)
  ) +
  stat_function(
    fun = dchisq, args = list(df = 5), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_vline(xintercept = white_stat, color = grey_dark, size = 0.5, linetype = "dotted") +
  annotate(
    "text", x = white_stat, y = 0.01,
    label = TeX("$\\widehat{LM}=30.8$"),
    family = "MathJax_Main", size = 7,
    hjust = 0.5
  ) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

# –¢–µ—Å—Ç –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

## –¢–µ—Å—Ç –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–ë—Ä–æ–π—à–∞ —ñ –ü–∞–≥–∞–Ω (1981) –Ω–∞–º–∞–≥–∞–ª–∏—Å—è –≤–∏—Ä—ñ—à–∏—Ç–∏ —Ü—é –ø—Ä–æ–±–ª–µ–º—É –∑–∞–Ω–∞–¥—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

- –î–æ–∑–≤–æ–ª—è—î –¥–∞–Ω–∏–º –ø–æ–∫–∞–∑–∞—Ç–∏, —á–∏/—è–∫ –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u_i$ –∫–æ—Ä–µ–ª—é—î –∑ $X$.

- –Ø–∫—â–æ $\sigma_i^2$ –∫–æ—Ä–µ–ª—é—î –∑ $X$, —Ç–æ –º–∏ –º–∞—î–º–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.

- –ë—É–¥—É–Ñ —Ä–µ–≥—Ä–µ—Å—ñ—é $e_i^2$ –≤—ñ–¥ $X = \left[ 1,\, x_1,\, x_2,\, \ldots,\, x_k \right]$ —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Å–ø—ñ–ª—å–Ω—É –∑–Ω–∞—á—É—â—ñ—Å—Ç—å.

---

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

1\. –†–µ–≥—Ä–µ—Å—ñ—è y –¥–æ intercept, x~1~, x~2~, ‚Ä¶, x~k~.

2\. –ó–∞–ø–∏—Å –∑–∞–ª–∏—à–∫—ñ–≤ e.

3\. –†–µ–≥—Ä–µ—Å—ñ—è e^2^ –¥–æ intercept, x~1~, x~2~, ‚Ä¶, x~k~.

$$ e_i^2 = \alpha_0 + \alpha_1 x_{1i} + \alpha_2 x_{2i} + \cdots + \alpha_k x_{ki} + v_i $$

4\. –ó–∞–ø–∏—Å R^2^.

5\. –¢–µ—Å—Ç –≥—ñ–ø–æ—Ç–µ–∑–∏ H~0~: $\alpha_1 = \alpha_2 = \cdots = \alpha_k = 0$

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É B-P

$$ \text{LM} = n \times R^2_{e} $$

–¥–µ $R^2_e$ ‚Äî $R^2$ –∑ —Ä–µ–≥—Ä–µ—Å—ñ—ó

$$ e_i^2 = \alpha_0 + \alpha_1 x_{1i} + \alpha_2 x_{2i} + \cdots + \alpha_k x_{ki} + v_i $$

$\text{LM}$ –∞—Å–∏–º–ø—Ç–æ—Ç–∏—á–Ω–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—è—î—Ç—å—Å—è —è–∫ $\chi^2_k$.

. . .

–¶—è —Ç–µ—Å—Ç–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î H~0~: $\alpha_1 = \alpha_2 = \cdots = \alpha_k = 0$.

–í—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è –Ω—É–ª—å–æ–≤–æ—ó –≥—ñ–ø–æ—Ç–µ–∑–∏ –æ–∑–Ω–∞—á–∞—î –¥–æ–∫–∞–∑ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –¢–µ—Å—Ç –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –º–∏ –≤—Å–µ —â–µ –ø—Ä–∏–ø—É—Å–∫–∞—î–º–æ –¥–æ—Å–∏—Ç—å –æ–±–º–µ–∂–µ–Ω—É [—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—É —Ñ–æ—Ä–º—É]{.hi} –º—ñ–∂ –Ω–∞—à–∏–º–∏ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ $X$ —ñ –¥–∏—Å–ø–µ—Ä—Å—ñ—è–º–∏ –Ω–∞—à–∏—Ö –∑–±—É—Ä–µ–Ω—å $\sigma^2_i$.

. . .

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** B-P *–º–æ–∂–µ* –≤—Å–µ —â–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç–∏ –¥–æ—Å–∏—Ç—å –ø—Ä–æ—Å—Ç—ñ —Ñ–æ—Ä–º–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –¢–µ—Å—Ç –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–¢–µ—Å—Ç –ë—Ä–µ–π—à–∞-–ü–µ–π–≥–∞–Ω–∞ –≤—Å–µ —â–µ [—á—É—Ç–ª–∏–≤–∏–π –¥–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏]{.hi}.

```{r, bp1, echo = F, dev = "svg", fig.height = 3.75}
set.seed(12345)
# Data
bp_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2),
  y = 1 + 3 * x + e
)
# Regressions
lm_bp1 = lm(residuals(lm(y ~ x, bp_df))^2 ~ 1 + bp_df$x) %>%
  summary() %$% r.squared %>% multiply_by(1e3)
lm_bp2 = lm(residuals(lm(y ~ x, bp_df))^2 ~ 1 + bp_df$x + I(bp_df$x^2)) %>%
  summary() %$% r.squared %>% multiply_by(1e3)
# The figure
ggplot(data = bp_df, aes(x = x, y = e)) +
geom_point(size = 2.75, color = "darkslategrey", alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

$$
\begin{aligned}
  e_i^2 &= \hat{\alpha}_0 + \hat{\alpha}_1 x_{1i} & \widehat{\text{LM}} &= `r round(lm_bp1, 2)` &\mathit{p}\text{-value} \approx `r round(pchisq(lm_bp1, 1, lower.tail = F), 3)` \\
  e_i^2 &= \hat{\alpha}_0 + \hat{\alpha}_1 x_{1i} \color{#e64173}{+ \hat{\alpha}_2 x^2_{1i}} & \widehat{\text{LM}} &= `r round(lm_bp2, 2)` &\mathit{p}\text{-value} < 0.001
\end{aligned}
$$

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —Ç—É –∂ –º–æ–¥–µ–ª—å –∑ B-P.

*–ù–∞–≥–∞–¥—É—î–º–æ:* –º–∏ –∑–±–µ—Ä–µ–≥–ª–∏ –Ω–∞—à—ñ –∑–∞–ª–∏—à–∫–∏ —è–∫ `e` —É –Ω–∞—à–æ–º—É –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö, _—Ç–æ–±—Ç–æ_,

```{r, bp recall, eval = F}
test_df$e = residuals(est_model)
```

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–£ B-P –º–∏ —Å–ø–æ—á–∞—Ç–∫—É –±—É–¥—É—î–º–æ –º–æ–¥–µ–ª—å $e_i^2$ –≤—ñ–¥ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö,

```{r, ex bp1}
# –º–æ–¥–µ–ª—å –∫–≤–∞–¥—Ä–∞—Ç—É –∑–∞–ª–∏—à–∫—ñ–≤
bp_model = lm(I(e^2) ~ ratio + income, data = test_df)
```

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–£ B-P –º–∏ —Å–ø–æ—á–∞—Ç–∫—É –±—É–¥—É—î–º–æ –º–æ–¥–µ–ª—å $e_i^2$ –≤—ñ–¥ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö,

```{r, ex bp2}
# –º–æ–¥–µ–ª—å –∫–≤–∞–¥—Ä–∞—Ç—É –∑–∞–ª–∏—à–∫—ñ–≤
bp_model = lm(I(e^2) ~ ratio + income, data = test_df)
# R-–∫–≤–∞–¥—Ä–∞—Ç
bp_r2 = summary(bp_model)$r.squared
bp_r2
```

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞-–ü–∞–≥–∞–Ω–∞ —î

$\text{LM} = n \times R^2_e$

$\approx 420 \times `r bp_r2 %>% round(7) %>% format(nsmall = 7, scientific = F)`$

$\approx `r round(nrow(test_df) * bp_r2, 4)`$

—è–∫–∏–π –º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ $\chi_k^2$ (—Ç—É—Ç: $k=2$)

. . .

```{r, ex bp3}
# B-P test
bp_stat = 420 * bp_r2
# p-value
pchisq(q = bp_stat, df = 2, lower.tail = F)
```

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

H~0~: $\alpha_1 = \alpha_2 = 0$ *–ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑* H~A~: $\alpha_1 \neq 0$ —Ç–∞/–∞–±–æ $\alpha_2 \neq 0$

–¥–ª—è –º–æ–¥–µ–ª—ñ $u_i^2 = \alpha_0 + \alpha_1 \text{Ratio}_i + \alpha_2 \text{Income}_i + w_i$

. . .

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É: $\widehat{\text{LM}} \approx `r round(bp_stat, 3)`$

. . .

*p*-value $\approx `r pchisq(q = bp_stat, df = 2, lower.tail = F) %>% round(3)`$

. . .

‚à¥ –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~ (*p*-value –±—ñ–ª—å—à–µ 0,05)

. . .

**–í–∏—Å–Ω–æ–≤–æ–∫:** –ú–∏ –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏—Ö –¥–æ–∫–∞–∑—ñ–≤ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ (–ú–∏ –Ω–µ –∑–Ω–∞—Ö–æ–¥–∏–º–æ –¥–æ–∫–∞–∑—ñ–≤ *–ª—ñ–Ω—ñ–π–Ω–æ–≥–æ* –∑–≤‚Äô—è–∑–∫—É –º—ñ–∂ $u_i^2$ —ñ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏.)

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞

```{r, ex bp plot, echo = F, dev = "svg", fig.height = 5}
ggplot(data = tibble(x = c(0, 7)), aes(x)) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 2),
    fill = "darkslategrey", alpha = 0.05
  ) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 2),
    fill = red_pink, alpha = 0.85,
    xlim = c(bp_stat, 7)
  ) +
  stat_function(
    fun = dchisq, args = list(df = 2), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_vline(xintercept = bp_stat, color = grey_dark, size = 0.5, linetype = "dotted") +
  annotate(
    "text", x = bp_stat, y = 5 * dchisq(bp_stat, df = 2),
    label = TeX("$\\widehat{LM}=0.014$"),
    family = "MathJax_Main", size = 7,
    hjust = 0
  ) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

# –î—è–∫—É—é –∑–∞ —É–≤–∞–≥—É! {background-color="#eef3f8"}

<br>
<br>

{{< iconify ic baseline-telegram >}} [@araprof](https://t.me/araprof)

{{< iconify mdi youtube >}} [@datamirosh](https://www.youtube.com/@datamirosh)

{{< iconify ion home >}} [aranaur.rbind.io](https://aranaur.rbind.io)

{{< iconify mdi github >}} [aranaur](https://github.com/Aranaur)

{{< iconify mdi envelope >}} <ihor.miroshnychenko@knu.ua>

{{< iconify mdi linkedin >}} [ihormiroshnychenko](https://www.linkedin.com/in/ihormiroshnychenko/)
