---
title: "–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å"
subtitle: "–ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑"
author: "–Ü–≥–æ—Ä –ú—ñ—Ä–æ—à–Ω–∏—á–µ–Ω–∫–æ"
institute: –ö–ù–£ —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞ | –§–Ü–¢
# date: today
# date-format: iso
from: markdown+emoji
title-slide-attributes:
  data-background-iframe: .04_files/libs/colored-particles/index.html
#   data-background-color: "#eef3f8"
language: _language-ua.yml
footer: üîó <a href="https://aranaur.rbind.io/lectures/asa/">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É</a>
format: 
  revealjs:
    transition: fade
    chalkboard: true
    logo: img/fit.png
    code-line-numbers: false
    slide-number: c/t
    mouse-wheel: true
    width: 1350  
    height: 759.375
    highlight-style: github
    pdf-separate-fragments: true
    # fig-height: 7.5
    # fig-width: 15
    fig-align: center
    fig-format: svg
    theme: [default, custom.scss]
    toc: true
    toc-depth: 1
    fig-width: 15
# jupyter: python3
execute: 
  warning: false
  echo: true
  # cache: true

---

```{python}
#| label: setup-python
#| include: false

# Import libraries
import numpy as np
import pandas as pd
import hashlib
import matplotlib.pyplot as plt
import seaborn as sns

from IPython.display import Markdown
from tabulate import tabulate

# Set seaborn default style
sns.set_style('whitegrid')
sns.set_palette('colorblind')

# Define colors
red_pink   = "#e64173"
turquoise  = "#20B2AA"
orange     = "#FFA500"
red        = "#fb6107"
blue       = "#181485"
navy       = "#150E37FF"
green      = "#8bb174"
yellow     = "#D8BD44"
# grey_light = "grey70"
# grey_mid   = "grey50"
# grey_dark  = "grey20"
purple     = "#6A5ACD"
slate      = "#314f4f"
```

```{r}
#| label: setup
#| include: false

library(pacman)
p_load(broom, latex2exp, ggplot2, ggthemes, viridis, extrafont,  dplyr,  magrittr, knitr, parallel, fontawesome, kableExtra)

# Define pink color
red_pink   = "#e64173"
turquoise  = "#20B2AA"
orange     = "#FFA500"
red        = "#fb6107"
blue       = "#3b3b9a"
green      = "#8bb174"
grey_light = "grey70"
grey_mid   = "grey50"
grey_dark  = "grey20"
purple     = "#6A5ACD"
slate      = "#23373b"


# A blank theme for ggplot
theme_empty = theme_bw() + theme(
  line = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  plot.margin = structure(c(0, 0, -0.5, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_simple = theme_bw() + theme(
  line = element_blank(),
  panel.grid = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text.x = element_text(size = 18, family = "STIXGeneral"),
  axis.text.y = element_blank(),
  axis.ticks = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  # plot.margin = structure(c(0, 0, -1, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_math = theme_void() + theme(
  text = element_text(family = "MathJax_Math"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_serif = theme_void() + theme(
  text = element_text(family = "MathJax_Main"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes = theme_void() + theme(
  text = element_text(family = "Fira Sans Book"),
  axis.title = element_text(size = 18),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = grey_light,
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
```

#  {.unlisted .unnumbered}

::: {.callout-important}
## –ü—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –ø—Ä–∏ —Å–∏–≥–Ω–∞–ª—ñ "–ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞" –ø—ñ–¥ —á–∞—Å –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è

1. –ü—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —Å–∏–≥–Ω–∞–ª—É **"–ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞" –≤ –º—ñ—Å—Ç—ñ –ö–∏—î–≤—ñ** –ª–µ–∫—Ü—ñ–π–Ω–µ –∑–∞–Ω—è—Ç—Ç—è **–ø—Ä–∏–ø–∏–Ω—è—î—Ç—å—Å—è**, –∞ —Å—Ç—É–¥–µ–Ω—Ç–∏ –º–∞—é—Ç—å –ø–µ—Ä–µ–π—Ç–∏ **–¥–æ —É–∫—Ä–∏—Ç—Ç—ñ–≤** –∑–∞ –º—ñ—Å—Ü–µ–º –ø–µ—Ä–µ–±—É–≤–∞–Ω–Ω—è. –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É **"–í—ñ–¥–±—ñ–π –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏"** –ª–µ–∫—Ü—ñ–π–Ω–µ –∑–∞–Ω—è—Ç—Ç—è –±—É–¥–µ **–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–æ**.
2. –ü—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —Å–∏–≥–Ω–∞–ª–∏ **"–ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞" –≤ —ñ–Ω—à–∏—Ö —Ä–µ–≥—ñ–æ–Ω–∞—Ö –£–∫—Ä–∞—ó–Ω–∏**, —Å—Ç—É–¥–µ–Ω—Ç–∏ –º–∞—é—Ç—å **–≤—ñ–¥'—î–¥–Ω–∞—Ç–∏—Å—è** –≤—ñ–¥ –ª–µ–∫—Ü—ñ–π–Ω–æ–≥–æ –∑–∞–Ω—è—Ç—Ç—è —Ç–∞ –ø–µ—Ä–µ–π—Ç–∏ **–¥–æ —É–∫—Ä–∏—Ç—Ç—ñ–≤** –∑–∞ –º—ñ—Å—Ü–µ–º –ø–µ—Ä–µ–±—É–≤–∞–Ω–Ω—è. –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É **"–í—ñ–¥–±—ñ–π –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏"** —Å—Ç—É–¥–µ–Ω—Ç–∏ –º–æ–∂—É—Ç—å **–ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è** –¥–æ –ª–µ–∫—Ü—ñ–π–Ω–æ–≥–æ –∑–∞–Ω—è—Ç—Ç—è.
:::



# –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–ª–æ–∂–µ–Ω–Ω—è

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å {.smaller}

–î–∞–≤–∞–π—Ç–µ –∑–≥–∞–¥–∞—î–º–æ **–ø–æ—Ç–æ—á–Ω—ñ –ú–ù–ö –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è**

. . .

1. –ù–∞—à–∞ –≤–∏–±—ñ—Ä–∫–∞ ($x_k$ —Ç–∞ $y_i$) –±—É–ª–∞ [–≤–∏–ø–∞–¥–∫–æ–≤–∏–º —á–∏–Ω–æ–º]{.hi} –≤—ñ–¥—ñ–±—Ä–∞–Ω–∞ –∑ —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ.

. . .

2. $y$ —î [–ª—ñ–Ω—ñ–π–Ω–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é]{.hi} $\beta_k$ —ñ $u_i$.

. . .

3. –£ –Ω–∞—à—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ –Ω–µ–º–∞—î —ñ–¥–µ–∞–ª—å–Ω–æ—ó [–º—É–ª—å—Ç–∏–∫–æ–ª—ñ–Ω–µ–∞—Ä–Ω–æ—Å—Ç—ñ]{.hi}.

. . .

4. –ù–µ–∑–∞–ª–µ–∂–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —î [–µ–∫–∑–æ–≥–µ–Ω–Ω–∏–º–∏]{.hi}: $\mathop{\boldsymbol{E}}\left[ u \middle| X \right] = 0 \left(\implies \mathop{\boldsymbol{E}}\left[ u \right] = 0\right)$.

. . .

5. –ó–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å [–ø–æ—Å—Ç—ñ–π–Ω—É –¥–∏—Å–ø–µ—Ä—Å—ñ—é]{.hi} $\sigma^2$ —ñ [–Ω—É–ª—å–æ–≤—É –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—é]{.hi}, _—Ç–æ–±—Ç–æ_,
   - $\mathop{\boldsymbol{E}}\left[ u_i^2 \middle| X \right] = \mathop{\text{Var}} \left( u_i \middle| X \right) = \sigma^2 \implies \mathop{\text{Var}} \left( u_i \right) = \sigma^2$
   - $\mathop{\text{Cov}} \left( u_i, \, u_j \middle| X \right) = \mathop{\boldsymbol{E}}\left[ u_i u_j \middle| X \right] = 0$ –¥–ª—è $i\neq j$

. . .

6. –ó–±—É—Ä–µ–Ω–Ω—è –ø–æ—Ö–æ–¥—è—Ç—å –≤—ñ–¥ [–Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ]{.hi} —Ä–æ–∑–ø–æ–¥—ñ–ª—É, _—Ç–æ–±—Ç–æ_, $u_i \overset{\text{iid}}{\sim} \mathop{\text{N}}\left( 0, \sigma^2 \right)$.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å {.smaller}

–°—å–æ–≥–æ–¥–Ω—ñ –º–∏ –∑–æ—Å–µ—Ä–µ–¥–∂—É—î–º–æ—Å—å –Ω–∞ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—ñ \#5:

> 5. –ó–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å [–ø–æ—Å—Ç—ñ–π–Ω—É –¥–∏—Å–ø–µ—Ä—Å—ñ—é]{.hi} $\sigma^2$ —ñ [–Ω—É–ª—å–æ–≤—É –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—é]{.hi}, _—Ç–æ–±—Ç–æ_,
   - $\mathop{\boldsymbol{E}}\left[ u_i^2 \middle| X \right] = \mathop{\text{Var}} \left( u_i \middle| X \right) = \sigma^2 \implies \mathop{\text{Var}} \left( u_i \right) = \sigma^2$
   - $\mathop{\text{Cov}} \left( u_i, \, u_j \middle| X \right) = \mathop{\boldsymbol{E}}\left[ u_i u_j \middle| X \right] = 0$ –¥–ª—è $i\neq j$

. . .

–ó–æ–∫—Ä–µ–º–∞, –º–∏ –∑–æ—Å–µ—Ä–µ–¥–∏–º–æ—Å—è –Ω–∞ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—ñ [–ø–æ—Å—Ç—ñ–π–Ω–æ—ó –¥–∏—Å–ø–µ—Ä—Å—ñ—ó]{.hi} (—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ–º—É —è–∫ *–≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å*).

. . .

**–ü–æ—Ä—É—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è:**

[–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å:]{.hi} $\mathop{\text{Var}} \left( u_i \right) = \sigma^2_i$ —ñ $\sigma^2_i \neq \sigma^2_j$ –¥–ª—è –¥–µ—è–∫–∏—Ö $i\neq j$ .

. . .

–Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: –Ω–∞—à—ñ –∑–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å —Ä—ñ–∑–Ω—É –¥–∏—Å–ø–µ—Ä—Å—ñ—é.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–ö–ª–∞—Å–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: –≤–æ—Ä–æ–Ω–∫–∞

–î–∏—Å–ø–µ—Ä—Å—ñ—è $u$ –∑—Ä–æ—Å—Ç–∞—î —Ä–∞–∑–æ–º —ñ–∑ $x$

```{r}
#| label: het-ex1
#| echo: false
#| fig-align: center

set.seed(12345)
ggplot(data = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 4 + 1.5 * x)
), aes(x = x, y = e)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–Ü–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: (–ø–æ–¥–≤—ñ–π–Ω–∞ –≤–æ—Ä–æ–Ω–∫–∞?)

–î–∏—Å–ø–µ—Ä—Å—ñ—è $u$ –∑—Ä–æ—Å—Ç–∞—î –Ω–∞ –∫—Ä–∞–π–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω–Ω—è—Ö $x$

```{r, het ex2 , dev = "svg", echo = F, fig.height = 5.5}
set.seed(12345)
ggplot(data = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2)
), aes(x = x, y = e)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

–Ü–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–†—ñ–∑–Ω—ñ –≥—Ä—É–ø–æ–≤—ñ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó $u$ 

```{r, het ex3 , dev = "svg", echo = F, fig.height = 5.5}
set.seed(12345)
ggplot(data = tibble(
  g = sample(c(F,T), 1e3, replace = T),
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 0.5 + 2 * g)
), aes(x = x, y = e, color = g, shape = g, alpha = g)) +
geom_point(size = 2.75) +
scale_color_manual(values = c("darkslategrey", red_pink)) +
scale_shape_manual(values = c(16, 1)) +
scale_alpha_manual(values = c(0.5, 0.8)) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

[–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å]{.hi} –ø—Ä–∏—Å—É—Ç–Ω—è, –∫–æ–ª–∏ –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u$ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –∑ –±—É–¥—å-—è–∫–æ—é –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—î—é –Ω–∞—à–∏—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö $x_1$ –¥–æ $x_k$ (–¥–∞–ª—ñ: $X$).

. . .

–¶–µ –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–µ —è–≤–∏—â–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ.

. . .

[–ß–æ–º—É –≤–æ–Ω–∞ –Ω–∞–º –≤–∞–∂–ª–∏–≤–∞:]{.hi} –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –ø–æ–∫–∞–∑—É—î –Ω–∞–º, —è–∫ –Ω–µ–∑–Ω–∞—á–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è –Ω–∞—à–∏—Ö –ø—Ä–∏–ø—É—â–µ–Ω—å –º–æ–∂—É—Ç—å –≤–ø–ª–∏–Ω—É—Ç–∏ –Ω–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ú–ù–ö.

---

## –ù–∞—Å–ª—ñ–¥–∫–∏

–û—Ç–∂–µ, —è–∫—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ? –ó–º—ñ—â–µ–Ω–Ω—è? –ù–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å?

–ü–æ-–ø–µ—Ä—à–µ, –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ, —á–∏ —Ü–µ –º–∞—î –Ω–∞—Å–ª—ñ–¥–∫–∏ –¥–ª—è –Ω–µ–∑–º—ñ—â–µ–Ω–Ω–æ—Å—Ç—ñ –ú–ù–ö

. . .

**–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è~1~:** –Ω–µ–∑–º—ñ—â–µ–Ω–Ω—ñ—Å—Ç—å –ú–ù–ö –æ–∑–Ω–∞—á–∞—î $\mathop{\boldsymbol{E}}\left[ \hat{\beta}_k \middle| X \right] = \beta_k$ –¥–ª—è –≤—Å—ñ—Ö $k$.

. . .

**–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è~2~:** —Ä–∞–Ω—ñ—à–µ –º–∏ –ø–æ–∫–∞–∑—É–≤–∞–ª–∏ $\hat{\beta}_1 = \dfrac{\sum_i\left(y_i-\overline{y}\right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2}$

. . .

–¶–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –¥–æ–ø–æ–º–æ–∂–µ –Ω–∞–º –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ —Ü—é –æ—Ü—ñ–Ω–∫—É —è–∫

$$ \hat{\beta}_1 = \beta_1 + \dfrac{\sum_i \left( x_i - \overline{x} \right) u_i}{\sum_i \left( x_i - \overline{x} \right)^2} $$

---

## –ù–∞—Å–ª—ñ–¥–∫–∏ {.smaller}

**–î–æ–≤–µ–¥–µ–Ω–Ω—è:** –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ $y_i = \beta_0 + \beta_1 x_i + u_i$

$$
\begin{aligned}
  \hat{\beta}_1
  &= \dfrac{\sum_i\left(y_i-\overline{y}\right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \dfrac{\sum_i\left(\left[ \beta_0 + \beta_1 x_i + u_i \right]- \left[ \beta_0 + \beta_1 \overline{x} + \overline{u} \right] \right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \dfrac{\sum_i\left(\beta_1 \left[ x_i - \overline{x} \right] + \left[u_i - \overline{u}\right]  \right)\left(x_i-\overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \dfrac{\sum_i\left(\beta_1 \left[ x_i - \overline{x} \right]^2 + \left[ x_i - \overline{x} \right] \left[u_i - \overline{u}\right]\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) \left(u_i - \overline{u}\right)}{\sum_i\left(x_i -\overline{x}\right)^2}
\end{aligned}
$$

---

## –ù–∞—Å–ª—ñ–¥–∫–∏ {.smaller}

$$
\begin{aligned}
  \hat{\beta}_1
  &= \cdots = \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) \left(u_i - \overline{u}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \sum_i\left(x_i - \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \left(\sum_i x_i - \sum_i \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \left(\sum_i x_i - n \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i - \overline{u} \color{#e64173}{\left(\sum_i x_i - \sum_i x_i\right)}}{\sum_i\left(x_i -\overline{x}\right)^2} \\
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i}{\sum_i\left(x_i -\overline{x}\right)^2} \quad \text{üòÖ}
\end{aligned}
$$

---

## –ù–∞—Å–ª—ñ–¥–∫–∏: –∑–º—ñ—â–µ–Ω–Ω—è {.smaller}

–¢–µ–ø–µ—Ä –º–∏ —Ö–æ—á–µ–º–æ –ø–æ–±–∞—á–∏—Ç–∏, —á–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –∑–º—ñ—â—É—î –æ—Ü—ñ–Ω–∫—É –ú–ù–ö –¥–ª—è $\beta_1$.

. . .

$$
\begin{aligned}
  \mathop{\boldsymbol{E}}\left[ \hat{\beta}_1 \middle| X \right]
  &= \mathop{\boldsymbol{E}}\left[ \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i}{\sum_i\left(x_i -\overline{x}\right)^2} \middle| X \right] \\[0.5em]
  &= \beta_1 + \mathop{\boldsymbol{E}}\left[ \dfrac{\sum_i\left(x_i - \overline{x}\right) u_i}{\sum_i\left(x_i -\overline{x}\right)^2} \middle| X \right] \\[0.5em]
  &= \beta_1 + \dfrac{\sum_i\left(x_i - \overline{x}\right)}{\sum_i\left(x_i -\overline{x}\right)^2} \color{#e64173}{\underbrace{\mathop{\boldsymbol{E}}\left[ u_i \middle| X \right]}_{=0}} \\[0.5em]
  &= \beta_1
\end{aligned}
$$

. . .

–§—É—Ö... [–ú–ù–ö –≤—Å–µ —â–µ –Ω–µ–∑–º—ñ—â–µ–Ω–Ω—ñ]{.hi} –¥–ª—è $\beta_k$.

---

## –ù–∞—Å–ª—ñ–¥–∫–∏: –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

**–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** —ñ **—ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å** –ú–ù–ö –Ω–µ –≤–∏—Ç—Ä–∏–º—É—é—Ç—å –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

- –ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –ú–ù–ö [–Ω–µ —î –±—ñ–ª—å—à–µ –Ω–∞–π–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–º]{.hi} (–Ω–∞–π–∫—Ä–∞—â–∏–π) –ª—ñ–Ω—ñ–π–Ω–∏–º –Ω–µ–∑–º—ñ—â–µ–Ω–∏–º –æ—Ü—ñ–Ω—é–≤–∞—á–µ–º.

. . .

- –ë—É–ª–æ –± –±—ñ–ª—å—à —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–º (–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–º) [–∑–≤–∞–∂–∏—Ç–∏ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è]{.hi} –æ–±–µ—Ä–Ω–µ–Ω–æ –¥–æ —ó—Ö–Ω—å–æ—ó –¥–∏—Å–ø–µ—Ä—Å—ñ—ó $u_i$.

   - –ù–∏–∑—å–∫–∞ –≤–∞–≥–∞ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∑ –≤–∏—Å–æ–∫–æ—é –¥–∏—Å–ø–µ—Ä—Å—ñ—î—é $u_i$.

   - –í–∏—Å–æ–∫–∞ –≤–∞–≥–∞ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∑ –Ω–∏–∑—å–∫–æ—é –¥–∏—Å–ø–µ—Ä—Å—ñ—î—é $u_i$.

   - –¢–µ–ø–µ—Ä —É –≤–∞—Å —î —ñ–¥–µ—è –∑–≤–∞–∂–µ–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É –Ω–∞–π–º–µ–Ω—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ (–ó–ú–ù–ö, WLS)

---

## –ù–∞—Å–ª—ñ–¥–∫–∏: —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å

–ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ—Ö–∏–±–∫–∏ –ú–ù–ö —î –∑–º—ñ—â–µ–Ω–Ω–∏–º–∏]{.hi} .

- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏

- –ü—Ä–æ–±–ª–µ–º–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—ñ–ø–æ—Ç–µ–∑ (—è–∫ $t$, —Ç–∞–∫ —ñ $F$ —Ç–µ—Å—Ç–∏)

---

## –†—ñ—à–µ–Ω–Ω—è

1. **–¢–µ—Å—Ç–∏** –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

2. **–ó–∞—Å–æ–±–∏ –∑–∞—Ö–∏—Å—Ç—É** –¥–ª—è (1) –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ (2) —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–æ–≤–∞–Ω—ñ—Å—Ç—ñ

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–•–æ—á–∞ —É –Ω–∞—Å *–º–æ–∂–ª–∏–≤–æ* —î —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ, –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞—à–∏—Ö –æ—Ü—ñ–Ω—é–≤–∞—á—ñ–≤ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

1. **–¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞**

2. **–¢–µ—Å—Ç –£–∞–π—Ç–∞**

3. **–¢–µ—Å—Ç –ë—Ä–æ–π—à–∞ ‚Äî –ü–∞–≥–∞–Ω–∞**

. . .

–ö–æ–∂–µ–Ω —ñ–∑ —Ü–∏—Ö —Ç–µ—Å—Ç—ñ–≤ –∑–æ—Å–µ—Ä–µ–¥–∂—É—î—Ç—å—Å—è –Ω–∞ —Ç–æ–º—É —Ñ–∞–∫—Ç—ñ, —â–æ –º–∏ –º–æ–∂–µ–º–æ [–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–∞–ª–∏—à–∫–∏ –ú–ù–ö]{.hi} $\color{#e64173}{e_i}$ [–¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ]{.hi} $\color{#e64173}{u_i}$.

# –¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

## –¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

–ó–æ—Å–µ—Ä–µ–¥–∂—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∏–ø—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: —á–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u_i$ [–º—ñ–∂ –¥–≤–æ–º–∞ –≥—Ä—É–ø–∞–º–∏]{.hi}.

–ü–∞–º'—è—Ç–∞—î—Ç–µ, —è–∫ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –Ω–∞—à—ñ –∑–∞–ª–∏—à–∫–∏ –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ $\sigma^2$?

$$ s^2 = \dfrac{\text{SSE}}{n-1} = \dfrac{\sum_i e_i^2}{n-1} $$

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ —Ü—é —Å–∞–º—É —ñ–¥–µ—é, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —á–∏ —î –¥–æ–∫–∞–∑–∏ —Ç–æ–≥–æ, —â–æ –Ω–∞—à—ñ –¥–≤—ñ –≥—Ä—É–ø–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è –¥–∏—Å–ø–µ—Ä—Å—ñ—è–º–∏ —Å–≤–æ—ó—Ö –∑–±—É—Ä–µ–Ω—å, —Ñ–∞–∫—Ç–∏—á–Ω–æ –ø–æ—Ä—ñ–≤–Ω—é—é—á–∏ $s^2_1$ —ñ $s^2_2$ –≤—ñ–¥ –Ω–∞—à–∏—Ö –¥–≤–æ—Ö –≥—Ä—É–ø.

---

## –¢–µ—Å—Ç –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. –í–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å –∑–∞ $x$

2. –†–æ–∑–¥—ñ–ª—ñ—Ç—å –¥–∞–Ω—ñ –Ω–∞ –¥–≤—ñ –≥—Ä—É–ø–∏ —Ä–æ–∑–º—ñ—Ä–æ–º n^‚≠ë^
   - G~1~: –ø–µ—Ä—à–∞ —Ç—Ä–µ—Ç–∏–Ω–∞
   - G~2~: –æ—Å—Ç–∞–Ω–Ω—è —Ç—Ä–µ—Ç–∏–Ω–∞

3. –ü–æ–±—É–¥—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —Ä–µ–≥—Ä–µ—Å—ñ—ó $y$ –≤—ñ–¥ $x$ –¥–ª—è G~1~ —ñ G~2~

4. –†–æ–∑—Ä–∞—Ö—É–π—Ç–µ SSE~1~ —ñ SSE~2~

5. –û–±—á–∏—Å–ª—ñ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ—Å—Ç—É G-Q

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞ {.smaller}

$$F_{\left(n^{\star}-k,\, n^{\star}-k\right)} = \dfrac{\text{SSE}_2/(n^\star-k)}{\text{SSE}_1/(n^\star-k)} = \dfrac{\text{SSE}_2}{\text{SSE}_1}$$

–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î $F$ —Ä–æ–∑–ø–æ–¥—ñ–ª—É (–∑–∞ –Ω—É–ª—å–æ–≤–æ—é –≥—ñ–ø–æ—Ç–µ–∑–æ—é) —ñ–∑ —Å—Ç—É–ø–µ–Ω—è–º–∏ —Å–≤–æ–±–æ–¥–∏ $n^{\star}-k$ —ñ $n^{\star}-k$[^1].

::: {.callout-note}
- –¢–µ—Å—Ç G-Q –≤–∏–º–∞–≥–∞—î, —â–æ–± –∑–±—É—Ä–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–∞–º.
- G-Q –ø–µ—Ä–µ–¥–±–∞—á–∞—î –¥—É–∂–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π —Ç–∏–ø/—Ñ–æ—Ä–º—É –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.
- –î—É–∂–µ –¥–æ–±—Ä–µ –ø—Ä–∞—Ü—é—î, —è–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ —Ñ–æ—Ä–º—É –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ—ó –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.
:::

[^1]: –ì–æ–ª–¥—Ñ–µ–ª—å–¥ —ñ –ö–≤–∞–Ω–¥—Ç –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞–ª–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ $n^{\star}$ –∑ –≤–∏—Ä–∞–∑—É $(3/8)n$. –ó–Ω–∞—á–µ–Ω–Ω—è $k$ --- —Ü–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Ü—ñ–Ω–µ–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (_—Ç–æ–±—Ç–æ_, $\hat{\beta}_j$).

---

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq1a, echo = F, dev = "svg", fig.height = 4}
set.seed(12345)
# Data
gq_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 4 + 1.5 * x),
  y = 1 + 3 * x + e
)
# Quantiles
gq_x = quantile(gq_df$x, probs = c(3/8, 5/8))
# Regressions
sse1 = lm(y ~ x, data = gq_df %>% filter(x < gq_x[1])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
sse2 = lm(y ~ x, data = gq_df %>% filter(x > gq_x[2])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
ggplot(data = gq_df, aes(x = x, y = e)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq1b, echo = F, dev = "svg", fig.height = 4}
ggplot(data = gq_df, aes(
  x = x, y = e,
  color = cut(x, c(-Inf, gq_x, Inf)),
  alpha = cut(x, c(-Inf, gq_x, Inf)),
  shape = cut(x, c(-Inf, gq_x, Inf))
)) +
geom_vline(
  xintercept = gq_x,
  color = grey_mid,
  size = 0.25
) +
geom_point(size = 2.75) +
labs(x = "x", y = "u") +
scale_color_manual(values = c("darkslategrey", grey_mid, red_pink)) +
scale_shape_manual(values = c(19, 1, 19)) +
scale_alpha_manual(values = c(0.5, 0.8, 0.6)) +
theme_axes_math
```

$F_{375,\,375} = \dfrac{\color{#e64173}{\text{SSE}_2 = `r format(round(sse2, 1), nsmall = 0L, big.mark = ",")`}}{\color{#314f4f}{\text{SSE}_1 = `r format(round(sse1, 1), nsmall = 0L, big.mark = ",")`}} \approx `r format(round(sse2/sse1, 1), nsmall = 0L, big.mark = ",")` \implies$ *p*-value $< 0.001$

$\therefore$ –ú–∏ –≤—ñ–¥—Ö–∏–ª—è—î–º–æ H~0~: $\sigma^2_1 = \sigma^2_2$ —ñ —Ä–æ–±–∏–º–æ –≤–∏—Å–Ω–æ–≤–æ–∫ –ø—Ä–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏—Ö –¥–æ–∫–∞–∑—ñ–≤ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –ü—Ä–æ–±–ª–µ–º–∏ —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq2a, echo = F, dev = "svg", fig.height = 4}
set.seed(12345)
# Data
gq2_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2),
  y = 1 + 3 * x + e
)
# Quantiles
gq_x = quantile(gq2_df$x, probs = c(3/8, 5/8))
# Regressions
sse1b = lm(y ~ x, data = gq2_df %>% filter(x < gq_x[1])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
sse2b = lm(y ~ x, data = gq2_df %>% filter(x > gq_x[2])) %>%
  residuals() %>% raise_to_power(2) %>% sum()
ggplot(data = gq2_df, aes(
  x = x, y = e
)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5, shape = 19) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –ü—Ä–æ–±–ª–µ–º–∏ —Ç–µ—Å—Ç—É –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞

```{r, gq2b, echo = F, dev = "svg", fig.height = 4}
ggplot(data = gq2_df, aes(
  x = x, y = e,
  color = cut(x, c(-Inf, gq_x, Inf)),
  alpha = cut(x, c(-Inf, gq_x, Inf)),
  shape = cut(x, c(-Inf, gq_x, Inf))
)) +
geom_vline(
  xintercept = gq_x,
  color = grey_mid,
  size = 0.25
) +
geom_point(size = 2.75) +
labs(x = "x", y = "u") +
scale_color_manual(values = c("darkslategrey", grey_mid, red_pink)) +
scale_shape_manual(values = c(19, 1, 19)) +
scale_alpha_manual(values = c(0.5, 0.8, 0.6)) +
theme_axes_math
```

$F_{375,\,375} = \dfrac{\color{#e64173}{\text{SSE}_2 = `r format(round(sse2b, 1), nsmall = 0L, big.mark = ",")`}}{\color{#314f4f}{\text{SSE}_1 = `r format(round(sse1b, 1), nsmall = 0L, big.mark = ",")`}} \approx `r format(round(sse2b/sse1b, 1), nsmall = 0L, big.mark = ",")` \implies$ *p*-value $\approx `r round(pf(sse2b/sse1b, 375, 375, lower.tail = F), 3)`$

$\therefore$ –ù–∞–º –Ω–µ –≤–¥–∞—î—Ç—å—Å—è –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~: $\sigma^2_1 = \sigma^2_2$, —Ö–æ—á–∞ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –æ—á–µ–≤–∏–¥–Ω–æ –ø—Ä–∏—Å—É—Ç–Ω—è.

# –¢–µ—Å—Ç –£–∞–π—Ç–∞

## –¢–µ—Å—Ç –£–∞–π—Ç–∞

**–ë—Ä–æ–π—à —ñ –ü–∞–≥–∞–Ω (1981)** –Ω–∞–º–∞–≥–∞–ª–∏—Å—è –≤–∏—Ä—ñ—à–∏—Ç–∏ —Ü—é –ø—Ä–æ–±–ª–µ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

- –†–µ–≥—Ä–µ—Å—ñ—è $e_i^2$ –≤—ñ–¥ $X = \left[ 1,\, x_1,\, x_2,\, \ldots,\, x_k \right]$ —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ.
- –î–æ–∑–≤–æ–ª—è—î –¥–∞–Ω–∏–º –ø–æ–∫–∞–∑–∞—Ç–∏, —á–∏ –∞–±–æ —è–∫ –¥–∏—Å–ø–µ—Ä—Å—ñ—è $u_i$ –∫–æ—Ä–µ–ª—é—î –∑ $X$.
- –Ø–∫—â–æ $\sigma_i^2$ –∫–æ—Ä–µ–ª—é—î –∑ $X$, —Ç–æ –º–∏ –º–∞—î–º–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.

. . .

–û–¥–Ω–∞–∫ –º–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ —Ö–æ—á–µ–º–æ –∑–Ω–∞—Ç–∏, —á–∏

$$\sigma_1^2 = \sigma_2^2 = \cdots = \sigma_n^2$$

---

## –¢–µ—Å—Ç –£–∞–π—Ç–∞

–î–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ü—ñ—î—ó –º–µ—Ç–∏ –ì–µ–ª –£–∞–π—Ç —Å–∫–æ—Ä–∏—Å—Ç–∞–≤—Å—è —Ç–∏–º —Ñ–∞–∫—Ç–æ–º, —â–æ –º–∏ –º–æ–∂–µ–º–æ [–∑–∞–º—ñ–Ω–∏—Ç–∏ –≤–∏–º–æ–≥—É –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å–ª–∞–±—à–∏–º –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è–º]{.hi}:

- **–°—Ç–∞—Ä–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è:** $\mathop{\text{Var}} \left( u_i \middle| X \right) = \sigma^2$

- **–ù–æ–≤–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è:** $u^2$ *–Ω–µ–∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ* –∑ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ (_—Ç–æ–±—Ç–æ_, $x_j$ –¥–ª—è –≤—Å—ñ—Ö $j$), —ó—Ö–Ω—ñ–º–∏ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ (_—Ç–æ–±—Ç–æ_, $x_j^2$), –∞ —Ç–∞–∫–æ–∂ –≤–∑–∞—î–º–æ–¥—ñ—ó –ø–µ—Ä—à–æ–≥–æ —Å—Ç—É–ø–µ–Ω—è (_—Ç–æ–±—Ç–æ_, $x_j x_h$).

. . .

–¶–µ –Ω–æ–≤–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è –ª–µ–≥—à–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ (*–ø—ñ–¥–∫–∞–∑–∫–∞:* —Ä–µ–≥—Ä–µ—Å—ñ—è).

---

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

1\. –†–µ–≥—Ä–µ—Å—ñ—è y –Ω–∞ x~1~, x~2~, ‚Ä¶, x~k~. –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–ª–∏—à–∫–∏ e.

2\. –†–µ–≥—Ä–µ—Å—ñ—è –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ –∑–∞–ª–∏—à–∫—ñ–≤ –¥–ª—è –≤—Å—ñ—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, —ó—Ö–Ω—ñ—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ —ñ –≤–∑–∞—î–º–æ–¥—ñ–π.

$$e^2 = \alpha_0 + \sum_{h=1}^k \alpha_h x_h + \sum_{j=1}^k \alpha_{k+j} x_j^2 + \sum_{\ell = 1}^{k-1} \sum_{m = \ell + 1}^k \alpha_{\ell,m} x_\ell x_m + v_i$$

3\. –ó–∞–ø–∏—Å R~e~^2^.

4\. –û–±—á–∏—Å–ª—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ H~0~: $\alpha_p = 0$ –¥–ª—è –≤—Å—ñ—Ö $p\neq0$.

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ {.smaller}

$$ \text{LM} = n \times R_e^2 \qquad \text{–¥–µ H}_0,\, \text{LM} \overset{\text{d}}{\sim} \chi_k^2 $$

–¥–µ $R^2_e$ –ø–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ —Ä–µ–≥—Ä–µ—Å—ñ—ó $e^2$ –Ω–∞ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ, —ó—Ö–Ω—ñ –∫–≤–∞–¥—Ä–∞—Ç–∏ —Ç–∞ —ó—Ö–Ω—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó.

$$ e^2 = \alpha_0 + \underbrace{\sum_{h=1}^k \alpha_h x_h}_{\text{–ü–æ—è—Å–Ω. –∑–º—ñ–Ω–Ω—ñ}} + \underbrace{\sum_{j=1}^k \alpha_{k+j} x_j^2}_{\text{–ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞ —Ñ–æ—Ä–º–∞}} + \underbrace{\sum_{\ell = 1}^{k-1} \sum_{m = \ell + 1}^k \alpha_{\ell,m} x_\ell x_m}_{\text{–í–∑–∞—î–º–æ–¥—ñ—è}} + v_i $$

::: {.callout-note}
$k$ (–¥–ª—è –Ω–∞—à–æ–≥–æ $\chi_k^2$) –¥–æ—Ä—ñ–≤–Ω—é—î –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ—Ü—ñ–Ω–µ–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —É –Ω–∞–≤–µ–¥–µ–Ω—ñ–π –≤–∏—â–µ —Ä–µ–≥—Ä–µ—Å—ñ—ó ($\alpha_j$), –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º $\left( \alpha_0 \right)$.
:::

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ {.smaller}

*–ü—Ä–∏–∫–ª–∞–¥:* –†–æ–∑–≥–ª—è–Ω–µ–º–æ –º–æ–¥–µ–ª—å[^‚Ä†] $y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 + u$

[^‚Ä†]: –©–æ–± —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è —Ç—É—Ç, —è –≤—ñ–¥–∫–∏–¥–∞—é —ñ–Ω–¥–µ–∫—Å–∏ $i$.

**–ö—Ä–æ–∫ 1:** –û—Ü—ñ–Ω—ñ—Ç—å –º–æ–¥–µ–ª—å; –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–ª–∏—à–∫–∏ $(e)$.

**–ö—Ä–æ–∫ 2:** –†–µ–≥—Ä–µ—Å—ñ—è $e^2$ –≤—ñ–¥ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ —Ç–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó.

$$
\begin{aligned}
  e^2 =
  &\alpha_0 + \alpha_1 x_1 + \alpha_2 x_2 + \alpha_3 x_3 + \alpha_4 x_1^2 + \alpha_5 x_2^2 + \alpha_6 x_3^2 \\
  &+ \alpha_7 x_1 x_2 + \alpha_8 x_1 x_3 + \alpha_9 x_2 x_3 + v
\end{aligned}
$$

–ó–∞–ø–∏—à—ñ—Ç—å R^2^ —ñ–∑ —Ü—å–æ–≥–æ —Ä—ñ–≤–Ω—è–Ω–Ω—è (–Ω–∞–∑–≤—ñ—Ç—å –π–æ–≥–æ $R_e^2$).

**–ö—Ä–æ–∫ 3:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ H~0~: $\alpha_1 = \alpha_2 = \cdots = \alpha_9 = 0$ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é $\text{LM} = n R^2_e \overset{\text{d} }{\sim} \chi_9^2$.

---

## –ü—Ä–∏–∫–ª–∞–¥ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

```{r, white1, echo = F, dev = "svg", fig.height = 4}
set.seed(12345)
# Data
bp_df = tibble(
  x = runif(1e3, -3, 3),
  e = rnorm(1e3, 0, sd = 2 + x^2),
  y = 1 + 3 * x + e
)

lm_bp1 = lm(residuals(lm(y ~ x, bp_df))^2 ~ 1 + bp_df$x) %>%
  summary() %$% r.squared %>% multiply_by(1e3)
lm_bp2 = lm(residuals(lm(y ~ x, bp_df))^2 ~ 1 + bp_df$x + I(bp_df$x^2)) %>%
  summary() %$% r.squared %>% multiply_by(1e3)

# The figure
ggplot(data = bp_df, aes(x = x, y = e)) +
geom_point(size = 2.75, color = "darkslategrey", alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

–¢–µ—Å—Ç –£–∞–π—Ç–∞ –¥–ª—è —Ü—ñ—î—ó –ø—Ä–æ—Å—Ç–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó.

$$
\begin{aligned}
 e_i^2 &= \hat{\alpha}_0 + \hat{\alpha}_1 x_{1i} \color{#e64173}{+ \hat{\alpha}_2 x^2_{1i}} & \widehat{\text{LM}} &= `r round(lm_bp2, 2)` &\mathit{p}\text{-value} < 0.001
\end{aligned}
$$

# –ü—Ä–∏–∫–ª–∞–¥–∏

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ {.smaller}

**–ú–µ—Ç–∞:** –û—Ü—ñ–Ω–∏—Ç–∏ –∑–≤‚Äô—è–∑–æ–∫ –º—ñ–∂ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (–∑–∞–ª–µ–∂–Ω–∞ –∑–º—ñ–Ω–Ω–∞) —ñ (1) —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è–º —Å—Ç—É–¥–µ–Ω—Ç/–≤–∏–∫–ª–∞–¥–∞—á —ñ (2) –¥–æ—Ö–æ–¥–æ–º, _—Ç–æ–±—Ç–æ_,

$$ \left(\text{Test score}\right)_i = \beta_0 + \beta_1 \text{Ratio}_{i} + \beta_2 \text{Income}_{i} + u_i \tag{1} $$

**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:** –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å... —ñ –º–∏ –Ω–µ –∑–Ω–∞—î–º–æ $u_i$.

**–†—ñ—à–µ–Ω–Ω—è:**

1. –û—Ü—ñ–Ω—ñ—Ç—å –º–æ–¥–µ–ª—å $(1)$ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ú–ù–ö.
2. –¢–µ—Å—Ç –Ω–∞ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.
   - –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥-–ö–≤–∞–Ω–¥—Ç
   - –£–∞–π—Ç–∞
   
---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–ú–∏ –±—É–¥–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö `Caschool` –≤ –ø–∞–∫–µ—Ç—ñ `Ecdat`.

::: {.panel-tabset}

### R

```{r, ex-data-r}
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤
library(pacman)
p_load(tidyverse, Ecdat)
# –í—ñ–¥–±—ñ—Ä —Ç–∞ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä—É –¥–∞–Ω–∏—Ö
test_df  <- select(Caschool, test_score = testscr, ratio = str, income = avginc)
# –§–æ—Ä–º–∞—Ç —Ç—ñ–±–±–ª
test_df <- as_tibble(test_df)
# –ü–µ—Ä—à—ñ 2 —Ä—è–¥–∫–∏
head(test_df, 2)
```

### Python

```{python, ex-data-py}
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤
import pandas as pd
from statsmodels.datasets import get_rdataset
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
caschool = get_rdataset("Caschool", "Ecdat")
# –í—ñ–¥–±—ñ—Ä —Ç–∞ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö
test_df = caschool.data[["testscr", "str", "avginc"]]
test_df.columns = ["test_score", "ratio", "income"]
# –ü–µ—Ä—à—ñ 2 —Ä—è–¥–∫–∏
test_df.head(2)
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ {.smaller}

–ü–æ—á–Ω–µ–º–æ –∑ –æ—Ü—ñ–Ω–∫–∏ –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ

$$ \left(\text{Test score}\right)_i = \beta_0 + \beta_1 \text{Ratio}_{i} + \beta_2 \text{Income}_{i} + u_i $$

::: {.panel-tabset}

### R

```{r, ex gq1 r}
# –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ
est_model = lm(test_score ~ ratio + income, data = test_df)
# –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
tidy(est_model) %>% knitr::kable()
```

### Python

```{python, ex gq1 p}
# –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ
from statsmodels.formula.api import ols
est_model = ols("test_score ~ ratio + income", data = test_df).fit()
# –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
est_model.summary().tables[1]
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ

–¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ –ø–æ–¥–∏–≤–∏–º–æ—Å—è, —â–æ –≥–æ–≤–æ—Ä—è—Ç—å –∑–∞–ª–∏—à–∫–∏ –ø—Ä–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å

::: {.panel-tabset}

### R

```{r, ex gq2 r}
# –î–æ–¥–∞–º–æ –∑–∞–ª–∏—à–∫–∏ –¥–æ –¥–∞–Ω–∏—Ö
test_df$e = residuals(est_model)
```

### Python

```{python, ex gq2 p}
# –î–æ–¥–∞–º–æ –∑–∞–ª–∏—à–∫–∏ –¥–æ –¥–∞–Ω–∏—Ö
test_df["e"] = est_model.resid
```

:::

```{r, gq3, echo = F, dev = "svg", fig.height = 4.25}
# Plot residuals against income
plot1 = ggplot(data = test_df, aes(x = income, y = e)) +
  geom_point(size = 2.5, alpha = 0.5, color = red_pink) +
  labs(x = "Income", y = TeX("\\textit{e}")) +
  theme_axes_serif
# Plot residuals against student-teacher ratio
plot2 = ggplot(data = test_df, aes(x = ratio, y = e)) +
  geom_point(size = 2.5, alpha = 0.5, color = "darkslategrey") +
  labs(x = "Student-to-teacher ratio", y = TeX("\\textit{e}")) +
  theme_axes_serif
# The grid
gridExtra::grid.arrange(plot1, plot2, nrow = 1)
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

`income` –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

::: {.panel-tabset}

### R

```{r, ex gq4 r, eval = F}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
```

### Python

```{python, ex gq4 p, eval = F}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = test_df.sort_values("income")
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

`income` –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

::: {.panel-tabset}

### R

```{r, ex gq5 r, eval = F}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model2 = lm(test_score ~ ratio + income, data = head(test_df, 158))
```

### Python

```{python, ex gq5 p, eval = F}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = test_df.sort_values("income")
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = ols("test_score ~ ratio + income", data = test_df.tail(158)).fit()
est_model2 = ols("test_score ~ ratio + income", data = test_df.head(158)).fit()
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

`income` –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

::: {.panel-tabset}

### R

```{r, ex gq6 r}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model2 = lm(test_score ~ ratio + income, data = head(test_df, 158))
# –ë–µ—Ä–µ–º–æ –∑–∞–ª–∏—à–∫–∏ –≤—ñ–¥ –∫–æ–∂–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó
e_model1 = residuals(est_model1)
e_model2 = residuals(est_model2)
```

### Python

```{python, ex gq6 p}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = test_df.sort_values("income")
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = ols("test_score ~ ratio + income", data = test_df.tail(158)).fit()
est_model2 = ols("test_score ~ ratio + income", data = test_df.head(158)).fit()
# –ë–µ—Ä–µ–º–æ –∑–∞–ª–∏—à–∫–∏ –≤—ñ–¥ –∫–æ–∂–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó
e_model1 = est_model1.resid
e_model2 = est_model2.resid
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

`income` –≤–∏–≥–ª—è–¥–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º; –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —á–µ—Ä–µ–∑ Goldfeld-Quandt.

::: {.panel-tabset}

### R

```{r, ex gq7 r}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = arrange(test_df, income)
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model2 = lm(test_score ~ ratio + income, data = head(test_df, 158))
# –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ SSE –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó
sse_model1 = sum(e_model1^2)
sse_model1
sse_model2 = sum(e_model2^2)
sse_model2
```

### Python

```{python, ex gq7 p}
# –í–ø–æ—Ä—è–¥–∫–æ–≤—É—î–º–æ –¥–∞–Ω—ñ
test_df = test_df.sort_values("income")
# –ü–µ—Ä–µ–æ—Ü—ñ–Ω—é—î–º–æ –º–æ–¥–µ–ª—å –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —ñ –ø–µ—Ä—à–∏—Ö 158 —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
est_model1 = ols("test_score ~ ratio + income", data = test_df.tail(158)).fit()
est_model2 = ols("test_score ~ ratio + income", data = test_df.head(158)).fit()
# –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ SSE –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó
sse_model1 = (e_model1**2).sum()
sse_model1
sse_model2 = (e_model2**2).sum()
sse_model2
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi} {.smaller}

–†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

$F_{n^\star-k,\,n^\star-k} = \dfrac{\text{SSE}_2}{\text{SSE}_1}$

. . .

$\approx\dfrac{`r round(sse_model2, 2) %>% format(big.mark = ",")`}{`r round(sse_model1, 2) %>% format(big.mark = ",")`}$

. . .

$\approx`r round(sse_model2/sse_model1, 2)`$

. . .

$F_{158-3,\,158-3}$

. . .

::: {.panel-tabset}

### R

```{r, ex gq8 r}
# G-Q —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
(f_gq = sse_model2/sse_model1)
```

```{r, ex gq9 r}
# p-value
pf(q = f_gq, df1 = 158-3, df2 = 158-3, lower.tail = F)
```

### Python

```{python, ex gq8 p}
# G-Q —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
f_gq = sse_model2/sse_model1
f_gq
```

```{python, ex gq9 p}
# p-value
from scipy.stats import f
f.sf(f_gq, 158-3, 158-3)
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–ö—Ä–∏—Ç–µ—Ä—ñ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ì–æ–ª—å–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞ —Ç–∞ –π–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª

```{r, ex gq10, echo = F, dev = "svg", fig.height = 5}
ggplot(data = tibble(x = c(0, f_gq * 1.3)), aes(x)) +
  geom_area(
    stat = "function", fun = df, args = list(df1 = 158, df2 = 158),
    fill = "darkslategrey", alpha = 0.05
  ) +
  geom_area(
    stat = "function", fun = df, args = list(df1 = 158, df2 = 158),
    fill = red_pink, alpha = 0.85,
    xlim = c(f_gq, f_gq * 1.3)
  ) +
  stat_function(
    fun = df, args = list(df1 = 158, df2 = 158), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_vline(xintercept = f_gq, color = grey_dark, size = 0.5, linetype = "dotted") +
  annotate(
    "text", x = f_gq, y = 5 * df(f_gq, df1 = 158, df2 = 158),
    label = TeX("$\\widehat{F}=1.53$"),
    family = "MathJax_Main", size = 7
  ) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–ó—ñ–±—Ä–∞–≤—à–∏ –≤—Å–µ —Ä–∞–∑–æ–º:

H~0~: $\sigma_1^2 = \sigma_2^2$ *–ø—Ä–æ—Ç–∏* H~A~: $\sigma_1^2 \neq \sigma_2^2$

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –ì–æ–ª–¥—Ñ–µ–ª—å–¥–∞-–ö–≤–∞–Ω–¥—Ç–∞: $F \approx `r round(f_gq, 2)`$

*p*-–∑–Ω–∞—á–µ–Ω–Ω—è $\approx `r round(pf(q = f_gq, df1 = 158-3, df2 = 158-3, lower.tail = F), 5)`$

‚à¥ –í—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~ (*p*-–∑–Ω–∞—á–µ–Ω–Ω—è –º–µ–Ω—à–µ 0,05).

**–í–∏—Å–Ω–æ–≤–æ–∫:** –Ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ —Ç–æ–≥–æ, —â–æ $\sigma_1^2 \neq \sigma_2^2$. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –∑–Ω–∞—Ö–æ–¥–∏–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ (–Ω–∞ 5-–≤—ñ–¥—Å–æ—Ç–∫–æ–≤–æ–º—É —Ä—ñ–≤–Ω—ñ –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ).

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

–©–æ, —è–∫–±–∏ –º–∏ –≤–∏—Ä—ñ—à–∏–ª–∏ –∑–æ—Å–µ—Ä–µ–¥–∏—Ç–∏—Å—è –Ω–∞ `ratio`?

. . .

::: {.panel-tabset}

### R

```{r, ex gq11 r}
# –í–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è
test_df = arrange(test_df, ratio)
# –ú–æ–¥–µ–ª—ñ
est_model3 = lm(test_score ~ ratio + income, data = tail(test_df, 158))
est_model4 = lm(test_score ~ ratio + income, data = head(test_df, 158))
# –ó–∞–ª–∏—à–∫–∏
e_model3 = residuals(est_model3)
e_model4 = residuals(est_model4)
# SSE
(sse_model3 = sum(e_model3^2))
(sse_model4 = sum(e_model4^2))
```

### Python

```{python, ex gq11 p}
# –í–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è
test_df = test_df.sort_values("ratio")
# –ú–æ–¥–µ–ª—ñ
est_model3 = ols("test_score ~ ratio + income", data = test_df.tail(158)).fit()
est_model4 = ols("test_score ~ ratio + income", data = test_df.head(158)).fit()
# –ó–∞–ª–∏—à–∫–∏
e_model3 = est_model3.resid
e_model4 = est_model4.resid
# SSE
sse_model3 = (e_model3**2).sum()
sse_model4 = (e_model4**2).sum()
sse_model3, sse_model4
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [G-Q]{.hi}

$F_{n^\star-k,\,n^\star-k} = \dfrac{\text{SSE}_4}{\text{SSE}_3} \approx\dfrac{`r round(sse_model4, 2) %>% format(big.mark = ",")`}{`r round(sse_model3, 2) %>% format(big.mark = ",")`} \approx`r round(sse_model4 / sse_model3, 2)`$

—è–∫–µ –º–∞—î *p*-–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏–±–ª–∏–∑–Ω–æ `r round(pf(sse_model4 / sse_model3, 158-3, 158-3, lower.tail = F), 4)`.

. . .

‚à¥ –ú–∏ –± –Ω–µ –∑–º–æ–≥–ª–∏ –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ H~0~, –¥—ñ–π—à–æ–≤—à–∏ –≤–∏—Å–Ω–æ–≤–∫—É, —â–æ –Ω–∞–º –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —Ç—É —Å–∞–º—É –º–æ–¥–µ–ª—å —ñ –¥–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞.

*–ù–∞–≥–∞–¥—É—î–º–æ:* –º–∏ –∑–±–µ—Ä–µ–≥–ª–∏ –Ω–∞—à—ñ –∑–∞–ª–∏—à–∫–∏ —è–∫ `e` —É –Ω–∞—à–æ–º—É –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö, _—Ç–æ–±—Ç–æ_,

::: {.panel-tabset}

### R

```{r, white recall r, eval = F}
# –ú–æ–¥–µ–ª—å
est_model = lm(test_score ~ ratio + income, data = test_df)
# –ó–∞–ª–∏—à–∫–∏
test_df$e = residuals(est_model)
```

### Python

```{python, white recall p, eval = F}
# –ú–æ–¥–µ–ª—å
est_model = ols("test_score ~ ratio + income", data = test_df).fit()
# –ó–∞–ª–∏—à–∫–∏
test_df["e"] = est_model.resid
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi} {.smaller}

[**–¢–µ—Å—Ç –£–∞–π—Ç–∞** –¥–æ–¥–∞—î –∑–º—ñ–Ω–Ω—ñ –≤ –∫–≤–∞–¥—Ä–∞—Ç—ñ —Ç–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó]{.pink} –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó (–ø—Ä–∞–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞)

$$
\begin{align}
 \color{#314f4f}{u_{i}^2} =& \color{#314f4f}{\alpha_{0} + \alpha_{1} \text{Ratio}_{i} + \alpha_{2} \text{Income}_{i} } \\
 &+ \color{#e64173}{\alpha_{3} \text{Ratio}_{i}^2 + \alpha_{4} \text{Income}_{i}^2 + \alpha_{5} \text{Ratio}_{i}\times\text{Income}_{i}} \\
 &+ \color{#314f4f}{w_{i}}
\end{align}
$$

[**–¢–µ—Å—Ç –£–∞–π—Ç–∞**]{.pink} –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω—É–ª—å–æ–≤—É –≥—ñ–ø–æ—Ç–µ–∑—É
<br>[H~0~:]{.pink} $\color{#e64173}{\alpha_1 = \alpha_2 = \alpha_3 = \alpha_4 = \alpha_5 = 0}$

::: {.callout-note}
`R` —Ç–∞ `Python` –º–∞—î –Ω–æ—Ç–∞—Ü—ñ—é –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∏—Ö —Ñ–æ—Ä–º —ñ –≤–∑–∞—î–º–æ–¥—ñ–π —É `lm()`/`ols()`:

- **–ö–≤–∞–¥—Ä–∞—Ç–Ω—ñ —Ñ–æ—Ä–º–∏** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `I()`, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, `lm(y ~ I(x^2))`

- **–í–∑–∞—î–º–æ–¥—ñ—ó** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `:` –º—ñ–∂ –∑–º—ñ–Ω–Ω–∏–º–∏, _–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, `lm(y ~ x1:x2)`

*–ü—Ä–∏–∫–ª–∞–¥:* –†–µ–≥—Ä–µ—Å—ñ—è `y` –¥–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥ `x1` —ñ `x2`:

```{r, ex quad, eval = F}
lm(y ~ x1 + x2 + I(x1^2) + I(x2^2) + x1:x2, data = pretend_df)
```
:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 1:** –†–µ–≥—Ä–µ—Å—ñ—è $e_i^2$ –≤—ñ–¥ 1^—ó^ —Å—Ç—É–ø–µ–Ω—ñ, 2^—ó^ —Å—Ç—É–ø—ñ–Ω—å —ñ –≤–∑–∞—î–º–æ–¥—ñ—ó

::: {.panel-tabset}

### R

```{r, ex white0 r, eval = F}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
```

### Python

```{python, ex white0 p, eval = F}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏
white_model = ols("I(e**2) ~ ratio + income + I(ratio**2) + I(income**2) + ratio:income", data = test_df).fit()
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 2:** –ó–±–µ—Ä—ñ—Ç—å $R_e^2$ –∑ —Ä–µ–≥—Ä–µ—Å—ñ—ó.

::: {.panel-tabset}

### R

```{r, ex white1 r, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
(white_r2 = summary(white_model)$r.squared)
```

### Python

```{python, ex white1 p, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏
white_model = ols("I(e**2) ~ ratio + income + I(ratio**2) + I(income**2) + ratio:income", data = test_df).fit()
# R-squared
white_r2 = white_model.rsquared
white_r2
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 3:** –û–±—á–∏—Å–ª—ñ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ $\text{LM} = n \times R_e^2 \approx 420 \times `r round(white_r2, 3)`$

::: {.panel-tabset}

### R

```{r, ex white3 r, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
white_r2 = summary(white_model)$r.squared
# White test statistic
(white_stat = 420 * white_r2)
```

### Python

```{python, ex white3 p, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏
white_model = ols("I(e**2) ~ ratio + income + I(ratio**2) + I(income**2) + ratio:income", data = test_df).fit()
# R-squared
white_r2 = white_model.rsquared
# White test statistic
white_stat = 420 * white_r2
white_stat
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

**–ö—Ä–æ–∫ 4:** –û–±—á–∏—Å–ª—ñ—Ç—å *p*-–∑–Ω–∞—á–µ–Ω–Ω—è (–¥–µ $\text{LM} \overset{d}{\sim} \chi_k^2$); —Ç—É—Ç $k=5$

::: {.panel-tabset}

### R

```{r, ex white4 r, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏ 
white_model = lm(
  I(e^2) ~ ratio + income + I(ratio^2) + I(income^2) + ratio:income,
  data = test_df
)
# R-squared
white_r2 = summary(white_model)$r.squared
# White test statistic
white_stat = 420 * white_r2
# p-value
pchisq(q = white_stat, df = 5, lower.tail = F)
```

### Python

```{python, ex white4 p, eval = T}
# –ú–æ–¥–µ–ª—å –∑ –∫–≤–∞–¥—Ä–∞—Ç–∞–º–∏ —ñ –≤–∑–∞—î–º–æ–¥—ñ—è–º–∏
white_model = ols("I(e**2) ~ ratio + income + I(ratio**2) + I(income**2) + ratio:income", data = test_df).fit()
# R-squared
white_r2 = white_model.rsquared
# White test statistic
white_stat = 420 * white_r2
# p-value
from scipy.stats import chi2
chi2.sf(white_stat, 5)
```

:::

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi} {.smaller}

–¢–µ–ø–µ—Ä –≤—Å–µ —Ä–∞–∑–æ–º:

. . .

H~0~: $\alpha_1 = \alpha_2 = \alpha_3 = \alpha_4 = \alpha_5 = 0$ *vs.* H~A~: $\alpha_i \neq 0$ –¥–ª—è $i \in \{1,\, 2,\,\ldots,\, 5\}$

. . .

$$
\begin{align}
u_i^2 =& \alpha_0 + \alpha_1 \text{Ratio}_i + \alpha_2 \text{Income}_i \\
&+ \alpha_3 \text{Ratio}_i^2 + \alpha_4 \text{Income}_i^2 \\
&+ \alpha_5 \text{Ratio}_i \times \text{Income}_i + w_i
\end{align}
$$

. . .

–ù–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—ñ–ª–æ–≥–æ —Ç–µ—Å—Ç—É: $\text{LM} = n \times R_e^2 \approx 420 \times `r round(white_r2, 3)` \approx `r round(white_stat, 2)`$

. . .

–ó–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º $\chi_5^2$ —Ü–µ–π $\widehat{\text{LM}}$ –º–∞—î *p*-–∑–Ω–∞—á–µ–Ω–Ω—è –º–µ–Ω—à–µ 0,001.

. . .

‚à¥ –ú–∏ [–≤—ñ–¥—Ö–∏–ª—è—î–º–æ H~0~]{.hi} —ñ —Ä–æ–±–∏–º–æ –≤–∏—Å–Ω–æ–≤–æ–∫ –ø—Ä–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å [—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏—Ö –¥–æ–∫–∞–∑—ñ–≤ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ]{.hi} (–Ω–∞ 5-–≤—ñ–¥—Å–æ—Ç–∫–æ–≤–æ–º—É —Ä—ñ–≤–Ω—ñ).

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ: [–£–∞–π—Ç]{.hi}

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ —Ç–∞ —ó—ó —Ä–æ–∑–ø–æ–¥—ñ–ª

```{r, ex white plot, echo = F, dev = "svg", fig.height = 5}
ggplot(data = tibble(x = c(0, white_stat * 1.1)), aes(x)) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 5),
    fill = "darkslategrey", alpha = 0.05
  ) +
  geom_area(
    stat = "function", fun = dchisq, args = list(df = 5),
    fill = red_pink, alpha = 0.85,
    xlim = c(white_stat, white_stat * 1.1)
  ) +
  stat_function(
    fun = dchisq, args = list(df = 5), n = 1e3,
    color = "darkslategrey"
  ) +
  geom_vline(xintercept = white_stat, color = grey_dark, size = 0.5, linetype = "dotted") +
  annotate(
    "text", x = white_stat, y = 0.01,
    label = TeX("$\\widehat{LM}=30.8$"),
    family = "MathJax_Main", size = 7,
    hjust = 0.5
  ) +
  labs(x = "x", y = "f") +
  theme_axes_math
```

# –ñ–∏—Ç—Ç—è –∑ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—é

## –ñ–∏—Ç—Ç—è –∑ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—é {.smaller}

–ü—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –ú–ù–ö —î

- –≤—Å–µ —â–µ [–Ω–µ–∑–º—ñ—â–µ–Ω–æ—é]{.hi}
- [–±—ñ–ª—å—à–µ –Ω–µ –Ω–∞–π–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–π]{.hi} –Ω–µ–∑–º—ñ—â–µ–Ω–∏–π –ª—ñ–Ω—ñ–π–Ω–∏–π –æ—Ü—ñ–Ω—é–≤–∞—á

–£ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –º–∏ –æ—Ç—Ä–∏–º—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å, –∞–ª–µ –∑ –±—ñ–ª—å—à–∏–º —à—É–º–æ–º (–º–µ–Ω—à–æ—é —Ç–æ—á–Ω—ñ—Å—Ç—é).
<br> *–¢–∞–∫–æ–∂:* –ù–∞—à—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ —î –∑–º—ñ—â–µ–Ω–∏–º–∏

. . .

**–©–æ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏:**

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [—Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é]{.hi} —Ä–µ–≥—Ä–µ—Å—ñ—ó .
2. –ó–Ω–∞–π–¥—ñ—Ç—å –Ω–æ–≤–∏–π, –±—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π [–Ω–µ–∑–º—ñ—â–µ–Ω–∏–π –æ—Ü—ñ–Ω—é–≤–∞—á]{.hi} –¥–ª—è $\beta_j$.
3. –ñ–∏—Ç–∏ –∑ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é –ú–ù–ö; –∑–Ω–∞–π—Ç–∏ [–Ω–æ–≤–∏–π –∑–∞—Å—ñ–± –æ—Ü—ñ–Ω–∫–∏ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó]{.hi}.
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏
   - –î–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏
   - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥—ñ–ø–æ—Ç–µ–∑

---

## –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

–Ø–∫ –º–∏ –≤–∂–µ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–∏, —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤–∞—à–æ—ó –º–æ–¥–µ–ª—ñ —Ä–µ–≥—Ä–µ—Å—ñ—ó –º–∞—î –≤–µ–ª–∏–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –Ω–µ—É–ø–µ—Ä–µ–¥–∂–µ–Ω–æ—Å—Ç—ñ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤–∞—à–æ–≥–æ –æ—Ü—ñ–Ω—é–≤–∞—á–∞.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å \#1:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∞—à–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

---

## –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è {.smaller}

*–ü—Ä–∏–∫–ª–∞–¥:* –ù–µ—Ö–∞–π –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —É –ì–° –±—É–¥–µ $$ y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + u_i $$

–∑ $\mathop{\boldsymbol{E}}\left[ u_i \middle| x_i \right] = 0$ —ñ $\mathop{\text{Var}} \left( u_i \middle| x_i \right) = \sigma^2$.

–û–¥–Ω–∞–∫ –º–∏ –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ $x^2$ —ñ –æ—Ü—ñ–Ω—é—î–º–æ $$ y_i = \gamma_0 + \gamma_1 x_i + w_i $$

–¢–æ–¥—ñ $$ w_i = u_i + \beta_2 x_i^2 \implies \mathop{\text{Var}} \left( w_i \right) = f(x_i) $$

_–¢–æ–±—Ç–æ_, –¥–∏—Å–ø–µ—Ä—Å—ñ—è $w_i$ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ –∑ $x_i$ (–≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å).

---

## –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

```{r, spec data, include = F}
# Set the seed
set.seed(1234)
# Generate data
spec_df <- tibble(x = runif(1e3, 0, 3), y = exp(0.5 + 0.6 * x + rnorm(1e3, sd = 0.3)))
# Add residuals ('w': wrong specification; 'c': correct specification)
spec_df %<>% mutate(
  e_w = lm(y ~ x, data = spec_df) %>% residuals(),
  e_c = lm(log(y) ~ x, data = spec_df) %>% residuals()
)
```

[–Ü—Å—Ç–∏–Ω–∞:]{.pink} $\color{#e64173}{\log\left(y_i\right) = \beta_0 + \beta_1 x_i + u_i}$ 

[–•–∏–±–Ω–∞:]{.slate} $\color{#314f4f}{y_i = \beta_0 + \beta_1 x_i + v_i}$

```{r, spec plot1, echo = F, dev = "svg", fig.height = 5}
ggplot(data = spec_df, aes(x = x)) +
  geom_point(aes(y = e_w), color = "darkslategrey", size = 2.75, alpha = 0.5, shape = 16) +
  geom_point(aes(y = e_c), color = red_pink, size = 2.5, alpha = 0, shape = 19) +
  labs(x = "x", y = "e") +
  theme_axes_math
```

---

## –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è

[–Ü—Å—Ç–∏–Ω–∞:]{.pink} $\color{#e64173}{\log\left(y_i\right) = \beta_0 + \beta_1 x_i + u_i}$ 

[–•–∏–±–Ω–∞:]{.slate} $\color{#314f4f}{y_i = \beta_0 + \beta_1 x_i + v_i}$

```{r, spec plot2, echo = F, dev = "svg", fig.height = 5}
ggplot(data = spec_df, aes(x = x)) +
  geom_point(aes(y = e_w), color = "darkslategrey", size = 2.75, alpha = 0.25, shape = 1) +
  geom_point(aes(y = e_c), color = red_pink, size = 2.5, alpha = 0.5, shape = 19) +
  labs(x = "x", y = "e") +
  theme_axes_math
```

---

## –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è {.smaller}

**–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–æ—ó –º–æ–¥–µ–ª—ñ –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å (—Å–µ—Ä–µ–¥ —ñ–Ω—à–∏—Ö –ø—Ä–æ–±–ª–µ–º).

. . .

**–†—ñ—à–µ–Ω–Ω—è:** üí° –ó—Ä–æ–±—ñ—Ç—å —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ (_–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ $x^2$).

. . .

**–ù–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:**

- –ú–∏ —á–∞—Å—Ç–æ –Ω–µ –∑–Ω–∞—î–º–æ *–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó* —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
- –ú–∏ —Ö–æ—Ç—ñ–ª–∏ –± –±—ñ–ª—å—à —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

. . .

**–í–∏—Å–Ω–æ–≤–æ–∫: ** –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–∞—Å—Ç–æ –Ω–µ ¬´–≤–∏—Ä—ñ—à–∏—Ç—å¬ª –ø—Ä–æ–º–ª–µ–º—É –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.
<br> –û–¥–Ω–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ –≤—Å–µ –æ–¥–Ω–æ —î –¥—É–∂–µ –≤–∞–∂–ª–∏–≤–∏–º.

---

## –ó–≤–∞–∂–µ–Ω–∏–π –ú–ù–ö {.smaller}

–ó–≤–∞–∂–µ–Ω–∏–π –ú–ù–ö (WLS) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —ñ–Ω—à–∏–π –ø—ñ–¥—Ö—ñ–¥.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å \#2:** –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —à–ª—è—Ö–æ–º –∑–≤–∞–∂—É–≤–∞–Ω–Ω—è –Ω–∞—à–∏—Ö —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å.

. . .

–ù–µ—Ö–∞–π —ñ—Å—Ç–∏–Ω–Ω–µ —Ä—ñ–≤–Ω—è–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ –±—É–¥–µ

$$
\begin{align}
   y_i = \beta_0 + \beta_1 x_{i} + u_i \tag{1}
\end{align}
$$

–∑ $u_i \sim \mathop{N} \left( 0,\, \sigma_i^2 \right)$.

. . .

–¢–µ–ø–µ—Ä –ø–µ—Ä–µ—Ç–≤–æ—Ä—ñ—Ç—å $(1)$, –ø–æ–¥—ñ–ª–∏–≤—à–∏ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞ $\sigma_i$, _—Ç–æ–±—Ç–æ_,

$$
\begin{align}
   \dfrac{y_i}{\sigma_i} &= \beta_0 \dfrac{1}{\sigma_i} + \beta_1 \dfrac{x_{i}}{\sigma_i} + \dfrac{u_i}{\sigma_i} \tag{ 2}
\end{align}
$$

---

## –ó–≤–∞–∂–µ–Ω–∏–π –ú–ù–ö

$$
\begin{align}
  y_i &= \beta_0 + \beta_1 x_{i} + u_i \tag{1} \\[1em]
  \dfrac{y_i}{\sigma_i} &= \beta_0 \dfrac{1}{\sigma_i} + \beta_1 \dfrac{x_{i}}{\sigma_i} + \dfrac{u_i}{\sigma_i} \tag{2}
\end{align}
$$

–¢–æ–¥—ñ —è–∫ $(1)$ —î –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º, –∞ $\color{#e64173}{(2)}$ [–≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º]{.hi}.

‚à¥ –ú–ù–ö –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π —ñ –Ω–µ–∑–º—ñ—â–µ–Ω–Ω–∏–π –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ $\beta_k$ —É $(2)$!

. . .

–ß–æ–º—É $(2)$ —î –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º?

$\mathop{\text{Var}} \left( \dfrac{u_i}{\sigma_i} \middle| x_i \right) =$
 $\dfrac{1}{\sigma_i^2} \mathop{\text{Var}} \left( u_i \middle| x_i \right) =$
 $\dfrac{1}{\sigma_i^2} \sigma_i^2 =$
 $1$

---

## –ó–≤–∞–∂–µ–Ω–∏–π –ú–ù–ö

–ó–ú–ù–ö ‚Äî —Ü–µ —á—É–¥–æ–≤–æ, –∞–ª–µ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏ $\sigma_i^2$, —â–æ, —è–∫ –ø—Ä–∞–≤–∏–ª–æ, –º–∞–ª–æ–π–º–æ–≤—ñ—Ä–Ω–æ.

–ú–∏ –º–æ–∂–µ–º–æ *—Ç—Ä–æ—Ö–∏* –ø–æ—Å–ª–∞–±–∏—Ç–∏ —Ü—é –≤–∏–º–æ–≥—É ‚Äî –∑–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –≤–∏–º–∞–≥–∞—Ç–∏

1. $\mathop{\text{Var}} \left( u_i | x_i \right) = \sigma_i^2 = \sigma^2 h(x_i)$

2. –ú–∏ –∑–Ω–∞—î–º–æ $h(x)$.

. . .

–Ø–∫ —ñ —Ä–∞–Ω—ñ—à–µ, –º–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î–º–æ –Ω–∞—à—É –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—É –º–æ–¥–µ–ª—å —É –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—É –º–æ–¥–µ–ª—å. –¶—å–æ–≥–æ —Ä–∞–∑—É –º–∏ –¥—ñ–ª–∏–º–æ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è[^3] –Ω–∞ $\sqrt{h(x_i)}$.

[^3]: –†–æ–∑–¥—ñ–ª—ñ—Ç—å *—É—Å—ñ* –¥–∞–Ω—ñ –Ω–∞ $\sqrt{h(x_i)}$, –≤–∫–ª—é—á–Ω–æ –∑ intercept.

---

## –ó–≤–∞–∂–µ–Ω–∏–π –ú–ù–ö

$$
\begin{align}
  y_i &= \beta_0 + \beta_1 x_{i} + u_i \tag{1} \\[1em]
  \dfrac{y_i}{\sqrt{h(x_i)}} &= \beta_0 \dfrac{1}{\sqrt{h(x_i)}} + \beta_1 \dfrac{x_{i}}{\sqrt{h(x_i)}} + \dfrac{u_i}{\sqrt{h(x_i)}} \tag{2}
\end{align}
$$

–∑ $\mathop{\text{Var}} \left( u_i | x_i \right) = \sigma^2 h(x_i)$.

. . .

–¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ, —â–æ $(2)$ —Å–ø—Ä–∞–≤–¥—ñ —î –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º.

$\mathop{\text{Var}} \left( \dfrac{u_i}{\sqrt{h(x_i)}} \middle| x_i \right) =$
  $\dfrac{1}{h(x_i)} \mathop{\text{Var}} \left( u_i \middle| x_i \right) =$
  $\dfrac{1}{h(x_i)} \sigma^2 h(x_i) =$
  $\color{#e64173}{\sigma^2}$

[–≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å!]{.hi}

---

## –ó–≤–∞–∂–µ–Ω–∏–π –ú–ù–ö {.smaller}

–û—Ü—ñ–Ω—é–≤–∞—á [WLS]{.hi} ‚Äî —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–ª–∞—Å –æ—Ü—ñ–Ω–æ–∫ [—É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –Ω–∞–π–º–µ–Ω—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤]{.hi} (GLS), –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∏—Ö –Ω–∞ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

. . .

$$
  y_i = \beta_0 + \beta_1 x_{1i} + u_i \quad \color{#e64173}{\text{ vs. }} \quad
  \dfrac{y_i}{\sigma_i} = \beta_0 \dfrac{1}{\sigma_i} + \beta_1 \dfrac{x_{1i}}{\sigma_i} + \dfrac{u_i}{\sigma_i}
$$

*–ü—Ä–∏–º—ñ—Ç–∫–∏:*

1. WLS **–ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î** –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—É –º–æ–¥–µ–ª—å –Ω–∞ –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—É –º–æ–¥–µ–ª—å.
2. **–ó–≤–∞–∂—É–≤–∞–Ω–Ω—è:** WLS –∑–Ω–∏–∂—É—î –≤–∞–≥—É —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å —ñ–∑ –≤–∏—â–æ—é –¥–∏—Å–ø–µ—Ä—Å—ñ—î—é $u_i$.
3. **–ó–Ω–∞—á–Ω–∞ –≤–∏–º–æ–≥–∞:** WLS –≤–∏–º–∞–≥–∞—î, —â–æ–± –º–∏ *–∑–Ω–∞–ª–∏* $\sigma_i^2$ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è.
4. WLS, —è–∫ –ø—Ä–∞–≤–∏–ª–æ, **–Ω–µ–º–æ–∂–ª–∏–≤–∏–π**. *–î–æ—Å—Ç—É–ø–Ω–∏–π* GLS (FGLS) –ø—Ä–æ–ø–æ–Ω—É—î —Ä—ñ—à–µ–Ω–Ω—è.
5. –ó–≥—ñ–¥–Ω–æ –∑ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è–º–∏: WLS —î **–Ω–∞–π–∫—Ä–∞—â–∏–º –ª—ñ–Ω—ñ–π–Ω–∏–º –Ω–µ–∑–º—ñ—â–µ–Ω–∏–º –æ—Ü—ñ–Ω—é–≤–∞—á–µ–º**.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ {.smaller}

**Heteroskedasticity-robust standard errors**

**–í—ñ–¥–ø–æ–≤—ñ–¥—å \#3:**

- –Ü–≥–Ω–æ—Ä—É–≤–∞—Ç–∏ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å OLS (–ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ).
- –ó–æ—Å–µ—Ä–µ–¥—å—Ç–µ—Å—è –Ω–∞ [–Ω–µ–∑–º—ñ—â–µ–Ω–æ—Å—Ç—ñ –æ—Ü—ñ–Ω–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫]{.hi}.
- –Ø–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫.

. . .

**Q:** –©–æ —Ç–∞–∫–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø–æ–º–∏–ª–∫–∞?
<br>**A:** [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –æ—Ü—ñ–Ω—é–≤–∞—á–∞]{.hi}.

. . .

–û—Ü—ñ–Ω—é–≤–∞—á—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, $\hat{\beta}_1$) —î –≤–∏–ø–∞–¥–∫–æ–≤–∏–º–∏ –≤–µ–ª–∏—á–∏–Ω–∞–º–∏, —Ç–æ–º—É –≤–æ–Ω–∏ –º–∞—é—Ç—å —Ä–æ–∑–ø–æ–¥—ñ–ª.

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –¥–∞—é—Ç—å –Ω–∞–º —É—è–≤–ª–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –≤–∞—Ä—ñ–∞—Ç–∏–≤–Ω–∏–º —î –Ω–∞—à –æ—Ü—ñ–Ω—é–≤–∞—á.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ {.smaller}

*–ù–∞–≥–∞–¥—É—î–º–æ*: –º–∏ –º–æ–∂–µ–º–æ –∑–∞–ø–∏—Å–∞—Ç–∏ –æ—Ü—ñ–Ω–∫—É –ú–ù–ö –¥–ª—è $\beta_1$ —è–∫

$$ \hat{\beta}_1 = \beta_1 + \dfrac{\sum_i \left( x_i - \overline{x} \right) u_i}{\sum_i \left( x_i - \overline{x} \right)^2} = \beta_1 + \dfrac{\sum_i \left( x_i - \overline{x} \right) u_i}{\text{SST}_x} \tag{3} $$

. . .

–ù–µ—Ö–∞–π $\mathop{\text{Var}} \left( u_i \middle| x_i \right) = \sigma_i^2$.

. . .

–ú–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ $(3)$, —â–æ–± –∑–∞–ø–∏—Å–∞—Ç–∏ –¥–∏—Å–ø–µ—Ä—Å—ñ—é $\hat{\beta}_1$, _—Ç–æ–±—Ç–æ_,

$$ \mathop{\text{Var}} \left( \hat{\beta}_1 \middle| x_i \right) = \dfrac{\sum_i \left( x_i - \overline{x} \right)^2 \sigma_i^2}{\text{SST}_x^2} \tag{4} $$

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ {.smaller}

–Ø–∫—â–æ –º–∏ —Ö–æ—á–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–µ–∑–º—ñ—â–µ–Ω—É –æ—Ü—ñ–Ω–∫—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫, –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–µ–∑–º—ñ—â–µ–Ω–∞ –æ—Ü—ñ–Ω–∫–∞

$$ \dfrac{\sum_i \left( x_i - \overline{x} \right)^2 \sigma_i^2}{\text{SST}_x^2} $$

–ù–∞—à —Å—Ç–∞—Ä–∏–π –¥—Ä—É–≥ –ì–µ–ª –£–∞–π—Ç –Ω–∞–¥–∞–≤ —Ç–∞–∫–∏–π –æ—Ü—ñ–Ω—é–≤–∞—á:[^2]

$$ \widehat{\mathop{\text{Var}}} \left( \hat{\beta}_1 \right) = \dfrac{\sum_i \left( x_i - \overline{x} \right)^2 e_i ^2}{\text{SST}_x^2} $$

–¥–µ $e_i$ –ø–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ —Ä–µ–≥—Ä–µ—Å—ñ—ó –ú–ù–ö

[^2]: –¶–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–µ —Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ—ó –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ {.smaller}

–ù–∞—à—ñ —Å—Ç—ñ–π–∫—ñ –¥–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –æ—Ü—ñ–Ω–∫–∏ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏ $\beta_j$.

[–í–∏–ø–∞–¥–æ–∫ 1]{.hi} –ü—Ä–æ—Å—Ç–∞ –ª—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è, $y_i = \beta_0 + \beta_1 x_i + u_i$

$$ \widehat{\mathop{\text{Var}}} \left( \hat{\beta}_1 \right) = \dfrac{\sum_i \left( x_i - \overline{x} \right)^2 e_i^2}{\text{SST}_x^2} $$

[–í–∏–ø–∞–¥–æ–∫ 2]{.hi} –ú–Ω–æ–∂–∏–Ω–Ω–∞ –ª—ñ–Ω—ñ–π–Ω–∞ —Ä–µ–≥—Ä–µ—Å—ñ—è, $y_i = \beta_0 + \beta_1 x_{1i} + \cdots + \beta_k x_{ki} + u_i$

$$ \widehat{\mathop{\text{Var}}} \left( \hat{\beta}_j \right) = \dfrac{\sum_i \hat{r}_{ij}^2 e_i^2}{\text{SST}_{x_j^2}} $$

–¥–µ $\hat{r}_{ij}$ –ø–æ–∑–Ω–∞—á–∞—î $i$ –∑–∞–ª–∏—à–æ–∫ –≤—ñ–¥ —Ä–µ–≥—Ä–µ—Å—ñ—ó $x_j$ –¥–ª—è –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏

–ó —Ü–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º–∏ –ø–æ–º–∏–ª–∫–∞–º–∏ –º–∏ –º–æ–∂–µ–º–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ–≥–æ –≤–∏—Å–Ω–æ–≤–∫—É

_–ù–∞–ø—Ä–∏–∫–ª–∞–¥_, –º–∏ –º–æ–∂–µ–º–æ –æ–Ω–æ–≤–∏—Ç–∏ –Ω–∞—à—É –ø–æ–ø–µ—Ä–µ–¥–Ω—é —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—É —Ñ–æ—Ä–º—É–ª—É $t$ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—à–∏—Ö –Ω–æ–≤–∏—Ö —Å—Ç—ñ–π–∫–∏—Ö –¥–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫.

$$ t = \dfrac{\text{Estimate} - \text{Hypothesized value}}{\text{Standard error}} $$

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ {.smaller}

**–ü—Ä–∏–º—ñ—Ç–∫–∏**

- –ú–∏ –≤—Å–µ —â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ [OLS –æ—Ü—ñ–Ω–∫–∏ –¥–ª—è]{.hi} $\color{#e64173}{\beta_j}$
- –ù–∞—à—ñ —Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å [—ñ–Ω—à–∏–π –æ—Ü—ñ–Ω—é–≤–∞—á]{.hi}.
- –ì–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å
   - –ó–≤–∏—á–∞–π–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó OLS –±—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞.
   - Het.-robust –≤—Å–µ —â–µ –Ω–µ–∑–º—ñ—â–µ–Ω–∞
- –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å
   - –ó–≤–∏—á–∞–π–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó –ú–ù–ö —î –∑–º—ñ—â–µ–Ω–æ—é.
   - Het.-—Ä–æ–±–∞—Å—Ç–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó —î –Ω–µ–∑–º—ñ—â–µ–Ω–æ—é.

---

## –ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏

–¶—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –º–∞—é—Ç—å –±–∞–≥–∞—Ç–æ –Ω–∞–∑–≤

- Heteroskedasticity-robust standard errors
- Het.-robust standard errors
- White standard errors
- Eicker-White standard errors
- Huber standard errors
- Eicker-Huber-White standards errors
- (–¥–µ—è–∫—ñ —ñ–≥—à—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó Eicker, Huber, and White)

# –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

## –ü—Ä–∏–∫–ª–∞–¥

–ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ –Ω–∞—à–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É‚Ä¶

::: {.panel-tabset}

### R

```{r, ex test data r}
library(pacman)
p_load(tidyverse, Ecdat)

test_df <- Caschool %>% select(
  test_score = testscr, ratio = str, income = avginc, enrollment = enrltot
) %>% as_tibble()

head(test_df, 2)
```

### Python

```{python, ex test data p}
import pandas as pd
from statsmodels.datasets import get_rdataset

caschool = get_rdataset("Caschool", "Ecdat")

test_df = caschool.data[["testscr", "str", "avginc", "enrltot"]]
test_df.columns = ["test_score", "ratio", "income", "enrollment "]

test_df.head(2)
```

:::

---

## –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

–ú–∏ –≤–∏—è–≤–∏–ª–∏ –∑–Ω–∞—á–Ω—ñ –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ, —á–∏ —Ü–µ —Å—Ç–∞–ª–æ—Å—è —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é –Ω–∞—à–æ—ó –º–æ–¥–µ–ª—ñ.

---

## –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

Model[1]{.sub}: $\text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i$

```{r, ex spec1, echo = F, dev = "svg", fig.height = 4.75}
# Model 1: test ~ ratio + income
test_df %<>% mutate(e1 = lm(test_score ~ ratio + income, data = test_df) %>% residuals())
# Plot
ggplot(data = test_df, aes(x = income, y = e1)) +
geom_point(size = 3, alpha = 0.5, color = red_pink) +
labs(x = "Income", y = TeX("\\textit{e}")) +
theme_axes_serif
```

---

## –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

Model[2]{.sub}: $\log\left(\text{Score}_i\right) = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i$


```{r, ex spec2, echo = F, dev = "svg", fig.height = 4.75}
# Model 1: test ~ ratio + income
test_df %<>% mutate(e2 = lm(log(test_score) ~ ratio + income, data = test_df) %>% residuals())
# Plot
ggplot(data = test_df, aes(x = income)) +
geom_point(aes(y = e2), size = 3, alpha = 0.5, color = red_pink) +
labs(x = "Income", y = TeX("\\textit{e}")) +
theme_axes_serif
```

---

## –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

Model[3]{.sub}: $\log\left(\text{Score}_i\right) = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \log\left(\text{Income}_i\right) + u_i$

```{r, ex spec3, echo = F, dev = "svg", fig.height = 4.75}
# Model 1: test ~ ratio + income
test_df %<>% mutate(e3 = lm(log(test_score) ~ ratio + log(income), data = test_df) %>% residuals())
# Plot
ggplot(data = test_df, aes(x = log(income))) +
geom_point(aes(y = e3), size = 3, alpha = 0.5, color = red_pink) +
labs(x = "Log(Income)", y = TeX("\\textit{e}")) +
theme_axes_serif
```

---

## –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ {.smaller}

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ —Ü—é –Ω–æ–≤—É —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞ –Ω–∞ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å.

Model[3]{.sub}: $\log\left(\text{Score}_i\right) = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \log\left(\text{Income}_i\right) + u_i$

```{r, ex spec test, include = F}
white_r2_spec <- lm(e3^2 ~
  ratio * log(income) + I(ratio^2) + I(log(income)^2),
  data = test_df
) %>% summary() %$% r.squared
white_stat_spec <- white_r2_spec %>% multiply_by(420)
```

. . .

–†–µ–≥—Ä–µ—Å—ñ—è –¥–ª—è —Ç–µ—Å—Ç—É –£–∞–π—Ç–∞

. . .

$$
\begin{align}
  e_i^2 = &\alpha_0 + \alpha_1 \text{Ratio}_i + \alpha_2 \log\left(\text{Income}_i\right) + \alpha_3 \text{Ratio}_i^2 + \alpha_4 \left(\log\left(\text{Income}_i\right)\right)^2 \\
  &+ \alpha_5 \left(\text{Ratio}_i\times\log\left(\text{Income}_i\right)\right) + v_i
\end{align}
$$

. . .

 $R_e^2\approx`r round(white_r2_spec, 3)`$
—ñ —Ç–µ—Å—Ç–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
 $\widehat{\text{LM}} = n\times R_e^2 \approx `r round(white_stat_spec, 1)`$.

. . .

H~0~ $\text{LM}$ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ —è–∫ $\chi_5^2$ $\implies$ *p*-value $\approx$ `r pchisq(white_stat_spec, 5, lower.tail = F) %>% round(3)`.

. . .

‚à¥ [–í—ñ–¥—Ö–∏–ª—è—î–º–æ H~0~]{.hi} [–í–∏—Å–Ω–æ–≤–æ–∫:]{.hi}  –Ü—Å–Ω—É—é—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â—ñ –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –Ω–∞ –ø‚Äô—è—Ç–∏–≤—ñ–¥—Å–æ—Ç–∫–æ–≤–æ–º—É —Ä—ñ–≤–Ω—ñ.

---

## –ü—Ä–∏–∫–ª–∞–¥: –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ

–ì–∞—Ä–∞–∑–¥, –º–∏ —Å–ø—Ä–æ–±—É–≤–∞–ª–∏ —Å–∫–æ—Ä–µ–≥—É–≤–∞—Ç–∏ –Ω–∞—à—É —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é, –∞–ª–µ –≤—Å–µ —â–µ —î –¥–æ–∫–∞–∑–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ.

**–î–∞–ª—ñ:** –ó–∞–≥–∞–ª–æ–º, –≤–∏ –∑–≤–µ—Ä–Ω–µ—Ç–µ—Å—è –¥–æ —Å—Ç—ñ–π–∫–∏—Ö –¥–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫.

- OLS –≤—Å–µ —â–µ –Ω–µ—É–ø–µ—Ä–µ–¥–∂–µ–Ω–∏–π –¥–ª—è [–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤]{.hi} ($\beta_j$')

- –°—Ç—ñ–π–∫—ñ –¥–æ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ —î –Ω–µ–∑–º—ñ—â–µ–Ω–∏–º–∏ –¥–ª—è [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫]{.hi} $\hat{\beta}_j$, _—Ç–æ–±—Ç–æ_, $\sqrt{\mathop{\text{Var}} \left( \hat{\beta}_j \right)}$.

# –ü—Ä–∏–∫–ª–∞–¥: Het.-robust standard errors

## –ü—Ä–∏–∫–ª–∞–¥: Het.-robust standard errors

–ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ –º–æ–¥–µ–ª—ñ

$$ \text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i $$

–ú–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞–∫–µ—Ç `fixest` —É `R` –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫.

–ê–±–æ –º–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `statsmodels` —É `Python`.

---

## –ü—Ä–∏–∫–ª–∞–¥: Het.-robust standard errors

$$ \text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i $$

::: {.panel-tabset}

### R

1\. –ü–æ–±—É–¥—É–π—Ç–µ —Ä–µ–≥—Ä–µ—Å—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `lm()`

```{r, fixest1 r}
test_reg <- lm(test_score ~ ratio + income, data = test_df)
```

### Python

1\. –ü–æ–±—É–¥—É–π—Ç–µ —Ä–µ–≥—Ä–µ—Å—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `statsmodels`

```{python, fixest1 p}
import statsmodels.formula.api as smf

test_reg = smf.ols("test_score ~ ratio + income", data = test_df).fit()
```

:::

---

## –ü—Ä–∏–∫–ª–∞–¥: Het.-robust standard errors {.smaller}

$$ \text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i $$

::: {.panel-tabset}

### R

2\. –û—Ü—ñ–Ω—ñ—Ç—å het.-robust standard errors –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–ø—Ü—ñ—ó `coeftest()` –∑ `lmtest` + `vcovHC()` –∑ `sandwich`

```{r, fixest2a r, eval = T}
library(lmtest)
library(sandwich)

coeftest(test_reg, vcov = vcovHC(test_reg, type = "HC0"))[, 1:4] %>% 
  as_tibble() %>% knitr::kable()
```

### Python

2\. –û—Ü—ñ–Ω—ñ—Ç—å het.-robust standard errors –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `cov_type = 'HC0'`

```{python, fixest2 p, eval = T}

# Het.-robust standard errors with 'cov_type = 'HC3''
test_reg.get_robustcov_results(cov_type = "HC0").summary().tables[1]
```

:::

```{r, fixest3, include = F}

p_load(fixest)
# Regress log score on ratio and log income
test_reg <- feols(test_score ~ ratio + income, data = test_df)
test_het_out <- summary(test_reg, vcov = 'hetero') %>% capture.output()
test_hom_out <- summary(test_reg, vcov = 'iid') %>% capture.output()
```

# –ü—Ä–∏–∫–ª–∞–¥: WLS

## –ü—Ä–∏–∫–ª–∞–¥: WLS

–ú–∏ –∑–≥–∞–¥—É–≤–∞–ª–∏, —â–æ WLS —á–∞—Å—Ç–æ –Ω–µ–º–æ–∂–ª–∏–≤–∏–π ‚Äî –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—É —Ñ–æ—Ä–º—É –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ ‚Äî –∞–±–æ

**A**\. $\sigma_i^2$

–∞–±–æ

**B**\. $h(x_i)$, –¥–µ $\sigma_i^2 = \sigma^2 h(x_i)$

. . .

–Ñ –≤–∏–ø–∞–¥–∫–∏, –∫–æ–ª–∏ –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–∞—Ç–∏ $h(x_i)$.

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS {.smaller}

–£—è–≤—ñ—Ç—å, —â–æ –æ–∫—Ä–µ–º—ñ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –≥–µ–Ω–µ—Ä–∞–ª—å–Ω—ñ–π —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ –º–∞—é—Ç—å –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ —Ä–æ–∑–ª–∞–¥–∏.

–û–¥–Ω–∞–∫ –∑–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ –æ–∫—Ä–µ–º–∏–º–∏ –¥–∞–Ω–∏–º–∏, –º–∏ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î–º–æ (—É –¥–∞–Ω–∏—Ö) —Å–µ—Ä–µ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –≥—Ä—É–ø (_–Ω–∞–ø—Ä–∏–∫–ª–∞–¥_, –º—ñ—Å—Ç, –æ–∫—Ä—É–≥—ñ–≤, —à–∫—ñ–ª—å–Ω–∏—Ö –æ–∫—Ä—É–≥—ñ–≤).

–Ø–∫—â–æ —Ü—ñ –≥—Ä—É–ø–∏ –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏, —Ç–æ–¥—ñ –Ω–∞—à –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –±—É–¥–µ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–∏–º.

**–ù–∞–≥–∞–¥—É—î–º–æ:** –î–∏—Å–ø–µ—Ä—Å—ñ—è –≤–∏–±—ñ—Ä–∫–æ–≤–æ–≥–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ä–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫–∏,
$$ \mathop{\text{Var}} \left( \overline{x} \right) = \dfrac{\sigma_x^2}{n} $$

. . .

**–ü—Ä–∏–∫–ª–∞–¥:** –ù–∞—à—ñ –¥–∞–Ω—ñ —à–∫—ñ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —É—Å–µ—Ä–µ–¥–Ω–µ–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ —à–∫–æ–ª–∏.

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS {.smaller}

*–ü—Ä–∏–∫–ª–∞–¥:* –ù–∞—à—ñ –¥–∞–Ω—ñ —à–∫—ñ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —É—Å–µ—Ä–µ–¥–Ω–µ–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ —à–∫–æ–ª–∏.

–Ø–∫—â–æ –æ–∫—Ä–µ–º—ñ —É—á–Ω—ñ –º–∞—é—Ç—å –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è, —É —à–∫–æ–ª–∞—Ö –±—É–¥—É—Ç—å –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—è, _—Ç–æ–±—Ç–æ_,

**–ú–æ–¥–µ–ª—å —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è:** $\quad \text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i$

**–ú–æ–¥–µ–ª—å —à–∫—ñ–ª—å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è:** $\quad \overline{\text{Score}}_s = \beta_0 + \beta_1 \overline{\text{Ratio}}_s + \beta_2 \overline{\text{Income}}_s + \overline{u}_s$

–¥–µ —ñ–Ω–¥–µ–∫—Å $s$ –ø–æ–∑–Ω–∞—á–∞—î –æ–∫—Ä–µ–º—É —à–∫–æ–ª—É (—Ç–∞–∫ —Å–∞–º–æ, —è–∫ $i$ —ñ–Ω–¥–µ–∫—Å—É—î –æ–∫—Ä–µ–º—É –æ—Å–æ–±—É).

$$ \mathop{\text{Var}} \left( \overline{u}_s \right) = \dfrac{\sigma^2}{n_s} $$

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS

–î–ª—è WLS –º–∏ —à—É–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é $h(x_s)$ —Ç–∞–∫—É, —â–æ $\mathop{\text{Var}} \left( \overline{u}_s | x_s \right) = \sigma^2 h(x_s )$.

. . .

–ú–∏ —â–æ–π–Ω–æ –ø–æ–∫–∞–∑–∞–ª–∏, —â–æ $\mathop{\text{Var}} \left( \overline{u}_s |x_s \right) = \dfrac{\sigma^2}{ n_s}$.

. . .

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, $h(x_s) = 1/n_s$, –¥–µ $n_s$ ‚Äì –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–Ω—ñ–≤ —É —à–∫–æ–ª—ñ $s$.

. . .

–©–æ–± —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ WLS, –º–∏ –¥—ñ–ª–∏–º–æ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞ $1/\sqrt{h(x_s)}$, —Ç–æ–±—Ç–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–º–Ω–æ–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ—ó —à–∫–æ–ª–∏ –Ω–∞ $\sqrt{n_s}$.

. . .

–ó–º—ñ–Ω–Ω–∞ `enrollment` —É –Ω–∞–±–æ—Ä—ñ –¥–∞–Ω–∏—Ö `test_df` —î –Ω–∞—à–∏–º $n_s$.

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è WLS –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ $\text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i$

**–ö—Ä–æ–∫ 1:** –ü–æ–º–Ω–æ–∂—Ç–µ –∫–æ–∂–Ω—É –∑–º—ñ–Ω–Ω—É –Ω–∞ $1/\sqrt{h(x_i)} = \sqrt{\text{Enrollment}_i}$

::: {.panel-tabset}

### R

```{r, wls1 r}
test_df <- mutate(test_df,
  test_score_wls = test_score * sqrt(enrollment),
  ratio_wls      = ratio * sqrt(enrollment),
  income_wls     = income * sqrt(enrollment),
  intercept_wls  = 1 * sqrt(enrollment)
)
```

### Python

```{python, include = F}
import pandas as pd
from statsmodels.datasets import get_rdataset

caschool = get_rdataset("Caschool", "Ecdat")

test_df = caschool.data[["testscr", "str", "avginc", "enrltot"]]
test_df.columns = ["test_score", "ratio", "income", "enrollment"]
```

```{python, wls1 p}
test_df["test_score_wls"] = test_df["test_score"] * (test_df["enrollment"] ** 0.5)
test_df["ratio_wls"] = test_df["ratio"] * (test_df["enrollment"] ** 0.5)
test_df["income_wls"] = test_df["income"] * (test_df["enrollment"] ** 0.5)
test_df["intercept_wls"] = 1 * (test_df["enrollment"] ** 0.5)
```

:::

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è `intercept`

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è WLS –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ $\text{Score}_i = \beta_0 + \beta_1 \text{Ratio}_i + \beta_2 \text{Income}_i + u_i$

**–ö—Ä–æ–∫ 2:** –ó–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–∞—à—É —Ä–µ–≥—Ä–µ—Å—ñ—é WLS (—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–æ–≤–∞–Ω—É).

::: {.panel-tabset}

### R

```{r, wls2 r}
wls_reg <- lm(
  test_score_wls ~ -1 + intercept_wls + ratio_wls + income_wls,
  data = test_df
)
```

### Python

```{python, wls2 p}
wls_reg = smf.ols(
  "test_score_wls ~ -1 + intercept_wls + ratio_wls + income_wls",
  data = test_df
).fit()
```

:::

. . .

*–ü—Ä–∏–º—ñ—Ç–∫–∞: * ¬´-1¬ª —É –Ω–∞—à—ñ–π —Ä–µ–≥—Ä–µ—Å—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª—è—î –Ω–µ –¥–æ–¥–∞–≤–∞—Ç–∏ `intercept`, –æ—Å–∫—ñ–ª—å–∫–∏ –º–∏ –¥–æ–¥–∞—î–º–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–∏–π `intercept` (`intercept_wls`).

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS

[O—Ü—ñ–Ω–∫–∏ WLS —ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏:]{.hi}

```{r, wls3, echo = F}
# Grab the summary
test_wls_out <- summary(wls_reg) %>% capture.output()
# Print the coefficients
test_wls_out[11:14] %>% paste0("\n") %>% cat()
```

. . .

<br>
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ [–ú–ù–ö]{.hi} —ñ [het.-robust:]{.hi}

```{r, wls4, echo = F}
# Print the coefficients
test_het_out[4:7] %>% paste0("\n") %>% cat()
```

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS
`R`: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –≤–ª–∞—Å–Ω–æ–º—É –∑–≤–∞–∂—É–≤–∞–Ω–Ω—é: –Ω–∞–¥–∞–π—Ç–µ `lm()` –¥–µ—è–∫—ñ `weights`.

```{r, wls5 r, eval = F}
lm(test_score ~ ratio + income, data = test_df, weights = enrollment)
```

`Python`: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –≤–ª–∞—Å–Ω–æ–º—É –∑–≤–∞–∂—É–≤–∞–Ω–Ω—é: –Ω–∞–¥–∞–π—Ç–µ `smf.wls()` –¥–µ—è–∫—ñ `weights`.

```{python, wls5 p, eval = F}
smf.wls("test_score ~ ratio + income", data = test_df, weights = test_df["enrollment"]).fit()
```

---

## –ü—Ä–∏–∫–ª–∞–¥: WLS {.smaller}

–£ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ

- [–ì–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ-—Ä–æ–±–∞—Å—Ç—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏]{.hi} –Ω–µ —Å–∏–ª—å–Ω–æ –∑–º—ñ–Ω–∏–ª–∏ –Ω–∞—à—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ (–ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ –ø—Ä–æ—Å—Ç–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º–∏ –ø–æ–º–∏–ª–∫–∞–º–∏ OLS).

- [WLS]{.hi} –¥–µ—â–æ –∑–º—ñ–Ω–∏–≤ –Ω–∞—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ ‚Äî –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ —Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏.

. . .

–¶—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –ø—ñ–¥–∫—Ä–µ—Å–ª–∏–ª–∏ –∫—ñ–ª—å–∫–∞ —Ä–µ—á–µ–π:

1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ü—ñ–Ω—é–≤–∞—á–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ *–º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è*.

2. –°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –Ω–µ –∑–∞–≤–∂–¥–∏ –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å –æ—á–µ–≤–∏–¥–Ω–æ *–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π* –º–∞—Ä—à—Ä—É—Ç.

. . .

–©–æ–± –ø–æ–±–∞—á–∏—Ç–∏ \#1, –¥–∞–≤–∞–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏–º–æ —Å–∏–º—É–ª—è—Ü—ñ—é.

---

## –°–∏–º—É–ª—è—Ü—ñ—è {.smaller}

```{r, sim params, include = F}
b0 <- 1L
b1 <- 10L
```

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –ø—Ä–æ—Å—Ç—É –º–æ–¥–µ–ª—å –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó –∑ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—é.

$$ y_i = \underbrace{\beta_0}_{=`r b0`} + \underbrace{\beta_1}_{=`r b1`} x_i + u_i $$
–¥–µ $\mathop{\text{Var}} \left( u_i | x_i \right) = \sigma_i^2 = \sigma^2 x_i^2$.

. . .

```{r, sim plot y, echo = F, fig.height = 4}
set.seed(12345)
ggplot(data = tibble(
  x = runif(1e3, 0.5, 1.5),
  y = b0 + b1 * x + rnorm(1e3, 0, sd = x^2)
), aes(x = x, y = y)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
geom_abline(intercept = b0, slope = b1, color = "orange", size = 1.5, alpha = 0.85) +
labs(x = "x", y = "y") +
theme_axes_math
```

---

## –°–∏–º—É–ª—è—Ü—ñ—è {.smaller}

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –ø—Ä–æ—Å—Ç—É –º–æ–¥–µ–ª—å –ª—ñ–Ω—ñ–π–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó –∑ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—é.

$$ y_i = \underbrace{\beta_0}_{=`r b0`} + \underbrace{\beta_1}_{=`r b1`} x_i + u_i $$
–¥–µ $\mathop{\text{Var}} \left( u_i | x_i \right) = \sigma_i^2 = \sigma^2 x_i^2$.

```{r, sim plot u, echo = F, fig.height = 4}
set.seed(12345)
ggplot(data = tibble(
  x = runif(1e3, 0.5, 1.5),
  u = rnorm(1e3, 0, sd = x^2)
), aes(x = x, y = u)) +
geom_point(color = "darkslategrey", size = 2.75, alpha = 0.5) +
labs(x = "x", y = "u") +
theme_axes_math
```

---

## –°–∏–º—É–ª—è—Ü—ñ—è

*–ü—Ä–∏–º—ñ—Ç–∫–∞ —â–æ–¥–æ WLS:*

–û—Å–∫—ñ–ª—å–∫–∏ $\mathop{\text{Var}} \left( u_i | x_i \right) = \sigma^2 x_i^2$,

$$ \mathop{\text{Var}} \left( u_i | x_i \right) = \sigma^2 h(x_i) \implies h(x_i) = x_i^2 $$

WLS –º–Ω–æ–∂–∏—Ç—å –∫–æ–∂–Ω—É –∑–º—ñ–Ω–Ω—É –Ω–∞ $1/\sqrt{h(x_i)} = 1/x_i$.

---

## –°–∏–º—É–ª—è—Ü—ñ—è {.smaller}

–£ —Ü—ñ–π —Å–∏–º—É–ª—è—Ü—ñ—ó –º–∏ —Ö–æ—á–µ–º–æ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏

1. **–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**
   - OLS
   - WLS –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –≤–∞–≥–∞–º–∏: $h(x_i) = x_i$
   - WLS –∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –≤–∞–≥–∞–º–∏: $h(x_i) = \sqrt{x_i}$

2. –ù–∞—Å–∫—ñ–ª—å–∫–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –Ω–∞—à—ñ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏** (—á–µ—Ä–µ–∑ –¥–æ–≤—ñ—Ä—á—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) –∑—ñ
   - –ó–≤–∏—á–∞–π–Ω—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ OLS
   - Heteroskedasticity-robust standard errors
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ WLS

---

## –°–∏–º—É–ª—è—Ü—ñ—è {.smaller}

–ê–ª–≥–æ—Ä–∏—Ç–º —Å–∏–º—É–ª—è—Ü—ñ—ó:

–í–∏–∫–æ–Ω–∞–π—Ç–µ 10 000 —Ä–∞–∑—ñ–≤:

1. –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –≤–∏–±—ñ—Ä–∫—É —Ä–æ–∑–º—ñ—Ä–æ–º 30 —ñ–∑ —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ

2. –û–±—á–∏—Å–ª—ñ—Ç—å/–∑–±–µ—Ä–µ–∂—ñ—Ç—å –æ—Ü—ñ–Ω–∫–∏ OLS —Ç–∞ WLS (√ó2) –¥–ª—è Œ≤~1~

3. –û–±—á–∏—Å–ª—ñ—Ç—å/–∑–±–µ—Ä–µ–∂—ñ—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Œ≤~1~.
   - –ó–≤–∏—á–∞–π–Ω—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ OLS
   - Heteroskedasticity-robust standard errors
   - WLS (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   - WLS (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

<!-- ---

## –°–∏–º—É–ª—è—Ü—ñ—è

**–î–ª—è –æ–¥–Ω—ñ—î—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó —Å–∏–º—É–ª—è—Ü—ñ—ó:**

–ö–æ–¥ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...

```{r, sim one iteration 1, eval = F}
# Parameters
b0 <- 1
b1 <- 10
s2 <- 1
# Sample size
n <- 30
# Generate data
sample_df <- tibble(
  x = runif(n, 0.5, 1.5),
  y = b0 + b1 * x + rnorm(n, 0, sd = s2 * x^2)
)
```

---

## –°–∏–º—É–ª—è—Ü—ñ—è

**–î–ª—è –æ–¥–Ω—ñ—î—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó —Å–∏–º—É–ª—è—Ü—ñ—ó:**

–ö–æ–¥ –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –Ω–∞—à–∏—Ö –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ —ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫...

```{r, sim one iteration 2, eval = F}
# OLS
ols <- feols(y ~ x, data = sample_df)
# WLS: Correct weights
wls_t <- lm(y ~ x, data = sample_df, weights = 1/x^2)
# WLS: Correct weights
wls_f <- lm(y ~ x, data = sample_df, weights = 1/x)
# Coefficients and standard errors
summary(ols, vcov = 'iid')
summary(ols, vcov = 'hetero')
summary(wls_t)
summary(wls_f)
```

–ü–æ—Ç—ñ–º –∑–±–µ—Ä–µ–∂—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏.

--- -->

## –°–∏–º—É–ª—è—Ü—ñ—è: –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏

```{r, sim df, include = F, cache = T}
# Parameters
b0 <- 1
b1 <- 10
s2 <- 1
# Sample size
n <- 30
# Number of iterations
n_iter <- 1e3
# Set seed
set.seed(1234)
# The simulation
sim_df <- mclapply(X = 1:n_iter, FUN = function(i, size) {
  # Generate data
  sample_df <- tibble(
    x = runif(size, 0.5, 1.5),
    y = b0 + b1 * x + rnorm(size, 0, sd = s2 * x^2)
  )
  # OLS
  ols <- feols(y ~ x, data = sample_df)
  # WLS: Correct weights
  wls_t <- lm(y ~ x, data = sample_df, weights = 1/x^2)
  # WLS: Correct weights
  wls_f <- lm(y ~ x, data = sample_df, weights = 1/x)
  # Save results
  iter_df <- rbind(
    summary(ols, vcov = 'iid') %>% coeftable() %>% magrittr::extract(2, 1:2),
    summary(ols, vcov = 'hetero') %>% coeftable() %>% magrittr::extract(2, 1:2),
    summary(wls_t) %>% coef() %>% magrittr::extract(2,1:2),
    summary(wls_f) %>% coef() %>% magrittr::extract(2,1:2)
  ) %>%
  as_tibble() %>%
  mutate(
    model = c("OLS Hom.", "OLS Het.", "WLS T", "WLS F"),
    iter = i
  )
  # Return the data
  return(iter_df)
}, size = n) %>% bind_rows()
# Change names
names(sim_df) <- c("coef", "se", "model", "iter")
```

```{r, sim plot efficiency, echo = F, fig.height = 6.25}
ggplot(data = sim_df %>% filter(model != "OLS Hom."), aes(x = coef, color = model, fill = model)) +
geom_vline(xintercept = 10, linetype = "dashed") +
geom_density(alpha = 0.1) +
geom_hline(yintercept = 0) +
labs(x = "Estimated coefficient", y = "Density") +
scale_color_viridis_d("",
  labels = c("OLS", "WLS Incorrect", "WLS Correct"),
  end = 0.9, option = "C"
) +
scale_fill_viridis_d("",
  labels = c("OLS", "WLS Incorrect", "WLS Correct"),
  end = 0.9, option = "C"
) +
theme_pander(base_size = 22, base_family = "Fira Sans") +
theme(
  legend.position = c(.85,.9),
  # legend.background = element_blank(),
  legend.key.size = unit(1, "cm")
)
```

---

## –°–∏–º—É–ª—è—Ü—ñ—è: –≤–∏—Å–Ω–æ–≤–æ–∫

```{r, sim plot t stat, echo = F, fig.height = 6.25}
ggplot(data = sim_df, aes(x = (coef-10)/se, color = model, fill = model)) +
geom_vline(xintercept = qt(c(0.025, 0.975), df = 28), linetype = "dashed") +
geom_density(alpha = 0.1) +
geom_hline(yintercept = 0) +
labs(x = "t statistic testing the true value", y = "Density") +
scale_color_viridis_d("",
  labels = c("OLS + Het.-robust", "Plain OLS", "WLS Incorrect", "WLS Correct"),
  end = 0.9, option = "C"
) +
scale_fill_viridis_d("",
labels = c("OLS + Het.-robust", "Plain OLS", "WLS Incorrect", "WLS Correct"),
  end = 0.9, option = "C"
) +
theme_pander(base_size = 22, base_family = "Fira Sans") +
theme(
  legend.position = c(.85,.9),
  # legend.background = element_blank(),
  legend.key.size = unit(1, "cm")
)
```

---

## –°–∏–º—É–ª—è—Ü—ñ—è: —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –Ω–∞—à–æ–≥–æ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è (10 000 —ñ—Ç–µ—Ä–∞—Ü—ñ–π)

:::: {.columns}

::: {.column width="40%"}
**–û—Ü—ñ–Ω–∫–∞**: Summary $\hat{\beta}_1$
```{r, sim table coef, eval = T, echo = F}
sim_df %>%
  filter(model != "OLS Hom.") %>%
  mutate(Estimator = recode(model,
    "OLS Het." = "OLS",
    "WLS F" = "WLS Incorrect",
    "WLS T" = "WLS Correct"
  )) %>%
  group_by(Estimator) %>%
  summarize(Mean = mean(coef) %>% round(3), "S.D." = sd(coef) %>% round(3)) %>%
  kable() %>%
  kable_styling(full_width = T)
```
:::

::: {.column width="60%"}
**–í–∏—Å–Ω–æ–≤–æ–∫: ** % –≤–∏–ø–∞–¥–∫—ñ–≤ –º–∏ –≤—ñ–¥—Ö–∏–ª—è—î–º–æ $\beta_1$
```{r, sim table se, eval = T, echo = F}
sim_df %>%
  mutate(Estimators = recode(model,
    "OLS Hom." = "OLS + Homosk.",
    "OLS Het." = "OLS + Het.-robust",
    "WLS F" = "WLS Incorrect",
    "WLS T" = "WLS Correct"
  )) %>%
  group_by(Estimators) %>%
  summarize(`% Reject` = mean(abs(coef-10)/se > qt(0.975, 28)) %>% multiply_by(100) %>% round(1)) %>%
  kable() %>%
  kable_styling(full_width = T)
```
:::

::::

---

## –ü—Ä–∏–ø—É—â–µ–Ω–Ω—è

–ó–≥–∞–¥–∞–π—Ç–µ –Ω–∞—à–µ —Å—Ç–∞—Ä–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è, —è–∫–µ –ø—Ä–∏–∑–≤–µ–ª–æ –¥–æ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ:

> 5\. –ó–±—É—Ä–µ–Ω–Ω—è –º–∞—é—Ç—å [**–ø–æ—Å—Ç—ñ–π–Ω—É –¥–∏—Å–ø–µ—Ä—Å—ñ—è**]{.slate} $\sigma^2$ <br>—Ç–∞ [–Ω—É–ª—å–æ–≤—É –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—é]{.hi}, _—Ç–æ–±—Ç–æ_,
  - $\color{#314f4f}{\mathop{\boldsymbol{E}}\left[ u_i^2 \middle| X_i \right] = \mathop{\text{Var}} \left( u_i \middle| X_i \right) = \sigma^2 \implies \mathop{\text{Var}} \left( u_i \right) = \sigma^2}$
  - $\color{#e64173}{\mathop{\text{Cov}} \left( u_i, \, u_j \middle| X_i,\,X_j \right) = \mathop{\boldsymbol{E}}\left[ u_i u_j \middle| X_i,\,X_j \right] = 0}$ for $i\neq j$

. . .

[**–ü–æ—Ä—É—à–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–π–Ω–æ—ó –¥–∏—Å–ø–µ—Ä—Å—ñ—ó**]{.slate} $=$ [**heteroskedasticity**]{.slate}

–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ (—ñ–º–æ–≤—ñ—Ä–Ω–æ), —â–æ [–∑–±—É—Ä–µ–Ω–Ω—è –∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ]{.pink}.

–Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ—Ä–µ–ª—è—Ü—ñ—ó —â–µ –±—ñ–ª—å—à –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ –¥–ª—è –≤–∏—Å–Ω–æ–≤–∫—ñ–≤.

---

## –ü—Ä–æ–±–ª–µ–º–∞ {.smaller}

–£ –±–∞–≥–∞—Ç—å–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö [–∑–±—É—Ä–µ–Ω–Ω—è —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å]{.pink} $\left(u_i,\,u_j\right)$ [–º–æ–∂—É—Ç—å –±—É—Ç–∏ –∫–æ—Ä–µ–ª—é–≤–∞–Ω—ñ]{.pink}.

*–ó–∞–ø–∞–º'—è—Ç–∞–π*

- [–∑–±—É—Ä–µ–Ω–Ω—è]{.pink} –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –Ω–µ–≤–∫–ª—é—á–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ, —è–∫—ñ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ $y$.
- –î–µ—è–∫—ñ [—Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è]{.pink} —É –≤–∏–±—ñ—Ä—Ü—ñ –º–æ–∂—É—Ç—å *–∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ* –∑ —ñ–Ω—à–∏–º–∏ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è–º–∏.

–Ø–∫—â–æ —Ü—ñ –≤–∑–∞—î–º–æ–∑–≤‚Äô—è–∑–∫–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–æ—à–∏—Ä—é—é—Ç—å—Å—è –Ω–∞ –∑–º—ñ–Ω–Ω—ñ –≤ –∑–±—É—Ä–µ–Ω–Ω—ñ, —Ç–æ–¥—ñ –∑–±—É—Ä–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –∫–æ—Ä–µ–ª—é–≤–∞—Ç–∏.

$\implies \mathop{\text{Cov}} \left( u_i, \, u_j \middle| X_i,\,X_j \right) \color{#e64173}{\neq} 0$.

. . .

–Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è —Ü—ñ—î—ó –∫–æ—Ä–µ–ª—è—Ü—ñ—ó –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ **–≤–µ–ª–∏–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏** —É –≤–∞—à–æ–º—É –≤–∏—Å–Ω–æ–≤–∫—É.

---

## –Ü–Ω—Ç—É—ó—Ü—ñ—è

–ß–æ–º—É —ñ–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞–∫–æ—ó –∫–æ—Ä–µ–ª—è—Ü—ñ—ó –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø—Ä–æ–±–ª–µ–º?

**–ü–æ–º–∏–ª–∫–æ–≤–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å**: –º–∏ –º–æ–∂–µ–º–æ —Å—Ç–∞—Ç–∏ ¬´–Ω–∞–¥—Ç–æ –≤–ø–µ–≤–Ω–µ–Ω–∏–º–∏¬ª —É —Å–≤–æ—ó—Ö –∑–Ω–∞–Ω–Ω—è—Ö.

**–ï–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥**: —è–∫—â–æ –¥—É–±–ª—é–≤–∞—Ç–∏ —Å–≤—ñ–π –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö (—Å–∫–ª–∞–¥–∞—Ç–∏ –π–æ–≥–æ –ø–æ–≤–µ—Ä—Ö —Å–∞–º–æ–≥–æ —Å–µ–±–µ), –∑–≤–∏—á–∞–π–Ω—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ OLS –∑–º–µ–Ω—à—É–≤–∞—Ç–∏–º—É—Ç—å—Å—è –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –≤–∏ –¥—É–±–ª—é–≤–∞—Ç–∏–º–µ—Ç–µ –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö.

---

```{r, dup-data, echo = F, cache = TRUE}
# And an id
test_df %<>% mutate(id = 1:nrow(test_df))
# Stack the dataset a bunch of times
dup_df = lapply(X = 1:20, FUN = function(x) mutate(test_df, dup = x)) %>% bind_rows()
# Now run a regression
dup_est = lapply(
  X = 1:20,
  FUN = function(x) feols(test_score ~ ratio + income, data = dup_df %>% filter(dup <= x))
)
# Grab standard errors
dup_se = lapply(
  X = seq_along(dup_est),
  FUN = function(x) {
    data.frame(
      dups = x - 1,
      se_iid = dup_est[[x]] %>% summary(vcov = 'iid') %>% coeftable() %>% magrittr::extract(2,2),
      se_cl = dup_est[[x]] %>% summary(cluster = 'id') %>% coeftable() %>% magrittr::extract(2,2)
    )
  }
) %>% bind_rows()
```

–í–ø–ª–∏–≤ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –Ω–∞—à–∏—Ö –¥–∞–Ω–∏—Ö –Ω–∞ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –ú–ù–ö]{.pink} –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `ratio`.

```{r, dup-plot1, echo = FALSE}
ggplot(
  data = dup_se,
  aes(x = dups, y = se_iid)
) +
geom_hline(yintercept = 0) +
geom_line(color = red_pink, size = 0.5) +
geom_point(color = red_pink, size = 3.5) +
labs(x = "Number of times dataset is duplicated", y = "Standard error") +
theme_pander(base_size = 22, base_family = "Fira Sans Condensed")
```

---

–í–∏–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞—à—ñ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏]{.orange} (–∫–æ—Ä–µ–ª—è—Ü—ñ—è —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å).

```{r, dup-plot2, echo = FALSE}
ggplot(
  data = dup_se,
  aes(x = dups)
) +
geom_hline(yintercept = 0) +
geom_line(aes(y = se_iid), color = red_pink, size = 0.5, alpha = 0.25) +
geom_point(aes(y = se_iid), color = red_pink, size = 3.5, alpha = 0.25) +
geom_line(aes(y = se_cl), color = orange, size = 0.5) +
geom_point(aes(y = se_cl), color = orange, size = 3.5) +
labs(x = "Number of times dataset is duplicated", y = "Standard error") +
theme_pander(base_size = 22, base_family = "Fira Sans Condensed")
```

---

## –ü—Ä–∏–∫–ª–∞–¥–∏

¬´–†–µ–∞–ª—å–Ω—ñ¬ª –ø—Ä–∏–∫–ª–∞–¥–∏, –∫–æ–ª–∏ –∑–±—É—Ä–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –∫–æ—Ä–µ–ª—é–≤–∞—Ç–∏:

- –£—á–Ω—ñ –≤ –∫–ª–∞—Å—ñ (–¥—ñ–ª—è—Ç—å—Å—è –≤—á–∏—Ç–µ–ª–µ–º, –Ω–∞–≤—á–∞–ª—å–Ω–∏–º –ø–ª–∞–Ω–æ–º —Ç–æ—â–æ)
- –ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞ –≤ –º—ñ—Å—Ç—ñ
- –ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ –¥–Ω—ñ —É –≤–∏–±—ñ—Ä—Ü—ñ (–ø–æ–¥—ñ–ª—ñ—Ç—å—Å—è –ø–æ–¥—ñ—è–º–∏, –ø–æ–≥–æ–¥–æ—é —Ç–æ—â–æ)

---

## –†—ñ—à–µ–Ω–Ω—è

–ü–æ–¥—ñ–±–Ω–æ –¥–æ —Ç–æ–≥–æ, —è–∫ –º–∏ –æ–±—á–∏—Å–ª—é—î–º–æ *heteroskedasticity*-robust standard errors, –º–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ–º–æ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –ø–æ–º–∏–ª–∫–∏, —Å—Ç—ñ–π–∫—ñ –¥–æ –∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω–∏—Ö –∑–±—É—Ä–µ–Ω—å.

–¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è [*cluster-robust standard errors*]{.pink} (–∞–±–æ –ø—Ä–æ—Å—Ç–æ *clustered*).

---

## –ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Å–Ω–æ–≤–∫–∏

1. –í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–≤–∞–∂–∞—Ç–∏, —â–æ –≤–∞—à—ñ –¥–∞–Ω—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ

2. –ü–æ–¥—É–º–∞–π—Ç–µ –ø—Ä–æ —Ç–µ, —è–∫ –≤–∞—à—ñ –ø–æ—è—Å–Ω—é–≤–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Ç–∞/–∞–±–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è –∫–æ—Ä–µ–ª—é—é—Ç—å –º—ñ–∂ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è–º–∏.

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏

### R

- [`olsrr`: Tools for Building OLS Regression Models](https://cran.r-project.org/web/packages/olsrr/)
- [Heteroskedasticity Robust Standard Errors in R](https://www.r-econometrics.com/methods/hcrobusterrors/)
- [Heteroskedasticity and Homoskedasticity](https://www.econometrics-with-r.org/5.4-hah.html"")

### Python

- [`statsmodels`: Weighted Least Squares](https://www.statsmodels.org/dev/examples/notebooks/generated/wls.html)
- [`statsmodels`: `test_heteroskedasticity()`](https://www.statsmodels.org/dev/generated/statsmodels.tsa.arima.model.ARIMAResults.test_heteroskedasticity.html)
- [Python for Introductory Econometrics: Heteroskedasticity](https://solomonegash.com/econometrics/wooldridge_python/iexample8_py.html)

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è {.smaller}

1. –©–æ —Ç–∞–∫–µ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å —É —Å—Ç–∞—Ç–∏—Å—Ç–∏—Ü—ñ?
2. –Ø–∫–∞ —Ä–æ–ª—å –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –≤ –∞–Ω–∞–ª—ñ–∑—ñ –¥–∞–Ω–∏—Ö?
3. –Ø–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏—á–∏–Ω–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ?
4. –Ø–∫ –≤–ø–ª–∏–≤–∞—î –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –Ω–∞ –æ—Ü—ñ–Ω–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –º–æ–¥–µ–ª—ñ?
5. –Ø–∫—ñ –º–µ—Ç–æ–¥–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ —ñ—Å–Ω—É—é—Ç—å?
6. –Ø–∫—ñ –º–µ—Ç–æ–¥–∏ –∫–æ—Ä–µ–∫—Ü—ñ—ó –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –º–æ–∂–Ω–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏?
7. –Ø–∫—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏ –º–æ–∂–µ –º–∞—Ç–∏ —ñ–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –∞–Ω–∞–ª—ñ–∑—ñ –¥–∞–Ω–∏—Ö?
8. –ß–∏–º –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å –≤—ñ–¥ –≥–æ–º–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ?
9. –Ø–∫—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∏—è–≤–∏—Ç–∏ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω—ñ—Å—Ç—å?
10. –Ø–∫—ñ –º–æ–∂–ª–∏–≤—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –¥—ñ–π –ø—Ä–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—ñ –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ –≤ –¥–∞–Ω–∏—Ö?


# –î—è–∫—É—é –∑–∞ —É–≤–∞–≥—É! {background-color="#eef3f8" .unlisted}

<br>
<br>

{{< iconify ic baseline-telegram >}} [@araprof](https://t.me/araprof)

{{< iconify mdi youtube >}} [@datamirosh](https://www.youtube.com/@datamirosh)

{{< iconify ion home >}} [aranaur.rbind.io](https://aranaur.rbind.io)

{{< iconify mdi github >}} [aranaur](https://github.com/Aranaur)

{{< iconify mdi envelope >}} <ihor.miroshnychenko@knu.ua>

{{< iconify mdi linkedin >}} [ihormiroshnychenko](https://www.linkedin.com/in/ihormiroshnychenko/)
