---
title: "A/B-—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è"
subtitle: "–ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑"
author: "–Ü–≥–æ—Ä –ú—ñ—Ä–æ—à–Ω–∏—á–µ–Ω–∫–æ"
institute: –ö–ù–£ —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞ | –§–Ü–¢
# date: today
# date-format: iso
from: markdown+emoji
title-slide-attributes:
  data-background-iframe: .03_files/libs/colored-particles/index.html
#   data-background-color: "#eef3f8"
language: _language-ua.yml
footer: üîó <a href="https://aranaur.rbind.io/lectures/asa/">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É</a>
format: 
  revealjs:
    transition: fade
    chalkboard: true
    logo: img/fit.png
    code-line-numbers: false
    slide-number: c/t
    mouse-wheel: true
    width: 1350  
    height: 759.375
    highlight-style: github
    pdf-separate-fragments: true
    # fig-height: 7.5
    # fig-width: 15
    fig-align: center
    fig-format: svg
    theme: [default, custom.scss]
jupyter: python3
execute: 
  warning: false
  echo: true
  # cache: true

---

```{python}
#| label: setup
#| include: false

# Import libraries
import numpy as np
import pandas as pd
import hashlib
import matplotlib.pyplot as plt
import seaborn as sns

from IPython.display import Markdown
from tabulate import tabulate

# Set seaborn default style
sns.set_style('whitegrid')
sns.set_palette('colorblind')

# Define colors
red_pink   = "#e64173"
turquoise  = "#20B2AA"
orange     = "#FFA500"
red        = "#fb6107"
blue       = "#181485"
navy       = "#150E37FF"
green      = "#8bb174"
yellow     = "#D8BD44"
# grey_light = "grey70"
# grey_mid   = "grey50"
# grey_dark  = "grey20"
purple     = "#6A5ACD"
slate      = "#314f4f"
```

# –Ü–¥–µ—ó —Ç–∞ –≥—ñ–ø–æ—Ç–µ–∑–∏ {background-color="#eef3f8"}

## –í—Å–µ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ —ñ–¥–µ—ó

**–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç** - –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞, –∫–æ–ª–∏ –≤ –Ω–∞—Å —É–∂–µ —Å—Ñ–æ—Ä–º—É–ª—å–æ–≤–∞–Ω–∞ –¥–µ—è–∫–∞ –≥—ñ–ø–æ—Ç–µ–∑–∞, —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º –≤–∞–ª—ñ–¥–æ–≤–∞–Ω–∞. –ú–∏ —Ä–æ–∑—É–º—ñ—î–º–æ, –Ω–∞ —è–∫—É —á–∞—Å—Ç–∏–Ω—É –ø—Ä–æ–¥—É–∫—Ç—É –≤–æ–Ω–∞ –≤–ø–ª–∏–≤–∞—î —ñ —è–∫–æ—é –º–µ—Ç—Ä–∏–∫–æ—é —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏. –ê–ª–µ –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ —Å—Ñ–æ—Ä–º—É–ª—é—î—Ç—å—Å—è –≥—ñ–ø–æ—Ç–µ–∑–∞, –∑–≤—ñ–¥–∫–∏—Å—å –±–µ—Ä–µ—Ç—å—Å—è —ñ–¥–µ—è. –ó–≤—ñ–¥–∫–∏?

**–Ü–¥–µ—è** - —â–µ –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞ –≥—ñ–ø–æ—Ç–µ–∑–∞. –ì—ñ–ø–æ—Ç–µ–∑–∞ –Ω–∞—Ä–æ–¥–∂—É—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–Ω–∏—Ö. –°–∞–º—ñ –¥–∞–Ω—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω—ñ —Ä—ñ–∑–Ω–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏. –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —à–ª—è—Ö–æ–º –≤–∏–≤—á–µ–Ω–Ω—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤, –∞–Ω–∞–ª—ñ–∑–æ–º –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª—É —Ä–∏–Ω–∫—É, –∞–±–æ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ç–≤–æ—Ä—á–∏—Ö –º–µ—Ö–∞–Ω—ñ–∫ (–≤–æ—Ä–∫—à–æ–ø–∏, —Ö–∞–∫–∞—Ç–æ–Ω–∏).

## –ö–æ–∂–Ω—ñ–π —ñ–¥–µ—ó - —Å–≤—ñ–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

–ö—Ä—ñ–º –∫—ñ–ª—å–∫—ñ—Å–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –∞–Ω–∞–ª—ñ–∑—É –¥–∞–Ω–∏—Ö –º–æ–∂—É—Ç—å –±—É—Ç–∏:

- **–ì–ª–∏–±–∏–Ω–Ω—ñ —ñ–Ω—Ç–µ—Ä–≤'—é** - —Å–ø—ñ–ª–∫—É—î–º–æ—Å—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏, –∑'—è—Å–æ–≤—É—î–º–æ –ø—Ä–æ–±–ª–µ–º–∏,
—Ä–æ–∑–º—ñ—Ä–∫–æ–≤—É—î–º–æ
- **–û–ø–∏—Ç—É–≤–∞–Ω–Ω—è** - –∑–∞–ø–∏—Ç—É—î–º–æ —â–æ-–Ω–µ–±—É–¥—å –æ—á–Ω–æ –∞–±–æ –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–∏–º –∫–∞–Ω–∞–ª–æ–º (–Ω–∞–ø—Ä. —Ä–æ–∑—Å–∏–ª–∫–∞)
- **–Æ–∑–∞–±—ñ–ª—ñ—Ç—ñ-—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**

## –î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—ñ–ø–æ—Ç–µ–∑–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —É–º–æ–≤–∏ {.smaller}

- **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ñ–∞–∫—Ç–æ—Ä—ñ–≤**, —â–æ –≤–ø–ª–∏–≤–∞—é—Ç—å, –∫—Ä—ñ–º —Å–∞–º–æ—ó —Ç–µ—Å—Ç–æ–≤–∞–Ω–æ—ó –∑–º—ñ–Ω–∏: –∫–æ–ª–∏ –º–∏ —Ö–æ—á–µ–º–æ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –¥–≤—ñ –≤–µ—Ä—Å—ñ—ó, –º–∞—î –≤–ø–ª–∏–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑–º—ñ–Ω–∞, –∂–æ–¥–Ω–∏—Ö —ñ–Ω—à–∏—Ö –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —á–∏–Ω–Ω–∏–∫—ñ–≤.
- **–†–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–∞ –æ—Ü—ñ–Ω–∫–∞**: —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å - –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –≤–∏–±—ñ—Ä–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ, —Ç–æ–±—Ç–æ –∫–æ–ª–∏ –≤–∏–±—ñ—Ä–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ. 

> –ü—Ä–∏–∫–ª–∞–¥ —É —Ü—å–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ: —î –≤–∏–±—ñ—Ä–∫–∞ –ê —ñ –≤–∏–±—ñ—Ä–∫–∞ –ë. –£ –≤–∏–±—ñ—Ä—Ü—ñ –ê —î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –ö–∏—î–≤–∞. –Ø–∫—â–æ –≤–∏–±—ñ—Ä–∫–∞ —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–∞, —Ç–æ —ñ –≤ –ê —ñ –≤ –ë –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –ö–∏—î–≤–∞ –±—É–¥–µ –ø–æ 30%. –Ø–∫—â–æ –≤ –ê –±—É–¥–µ 25%, –∞ –≤ –ë - 10%, —Ç–æ —î –∑–º—ñ—â–µ–Ω–Ω—è —ñ –≤–∏–±—ñ—Ä–∫–∏ –Ω–µ —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω—ñ. –¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è —á–µ—Å–Ω–æ–≥–æ –ê/–í-—Ç–µ—Å—Ç—É: —è–∫—â–æ —î –¥–∏—Å–±–∞–ª–∞–Ω—Å, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –º–æ–∂–µ –ø–æ—è—Å–Ω—é–≤–∞—Ç–∏—Å—è –Ω–µ —Ç–∏–º, —â–æ –≤ –Ω–∞—Å —Ö–æ—Ä–æ—à–∞ –≥—ñ–ø–æ—Ç–µ–∑–∞, –∞ —Ç–∏–º, —â–æ –ø–æ—Ä—É—à—É—î—Ç—å—Å—è —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å (–Ω–∞–ø—Ä. —ñ–Ω—à–æ—é –∫—É–ø—ñ–≤–µ–ª—å–Ω–æ—é —Å–ø—Ä–æ–º–æ–∂–Ω—ñ—Å—Ç—é).

- **–¢–æ—á–Ω—ñ—Å—Ç—å –æ—Ü—ñ–Ω–∫–∏:** –∑–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å –æ—Ü—ñ–Ω–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –∫—Ä–∏—Ç–µ—Ä—ñ—ó, —â—ñ–ª—å–Ω—ñ—Å—Ç—å —ñ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –º–µ—Ç—Ä–∏–∫. –¢–æ—á–Ω—ñ—Å—Ç—å –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ø–æ–º–∏–ª–∫–∏ —ñ –Ω–∞ —è–∫—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤.

# –©–æ —Ç–∞–∫–µ A/B —Ç–µ—Å—Ç–∏ {background-color="#eef3f8"}

## –©–æ —Ç–∞–∫–µ A/B —Ç–µ—Å—Ç–∏

–ó —á–æ–≥–æ –≤—Å–µ –ø–æ—á–∏–Ω–∞–ª–æ—Å—è? –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —è–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—è –¥–ª—è –∫–ª—ñ–Ω—ñ—á–Ω–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å. –ó–∞–≤–¥—è–∫–∏ —Ü–∏–º –∑–∞–≤–¥–∞–Ω–Ω—è–º –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ–∑–≤–∏–≤–∞–ª–∞—Å—è.

A/B —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è - —Ü–µ –¥–µ:

- **–ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –¥–≤–∞ —ñ –±—ñ–ª—å—à–µ** –≤–∞—Ä—ñ–∞–Ω—Ç–∏ (–∫–æ–Ω—Ç—Ä–æ–ª—å —ñ —Ç–µ—Å—Ç) –∑ –º–µ—Ç–æ—é –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–π–±—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ
- —Å—Ç—É–ø—ñ–Ω—å **–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ** –≤–∏–º—ñ—Ä—é—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ—Ä–∞—Ö–æ–≤–∞–Ω–∏—Ö –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π **—Ö–∏–±–Ω–æ–ø–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö** —ñ **—Ö–∏–±–Ω–æ–Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö** –≤–∏–ø–∞–¥–∫—ñ–≤

## –†—ñ—à–µ–Ω–Ω—è

1. **–•–∏–±–Ω–æ–ø–æ–∑–∏—Ç–∏–≤–Ω—ñ** (*False Positive*, –ø–æ–º–∏–ª–∫–∞ I —Ä–æ–¥—É): –≤–∏—è–≤–ª—è—î–º–æ –∑–º—ñ–Ω–∏, —è–∫—ñ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å.
2. **–•–∏–±–Ω–æ–Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ** (*False Negativ*e, –ø–æ–º–∏–ª–∫–∞ II —Ä–æ–¥—É): –∫–æ—Ä–∏—Å–Ω—ñ –∑–º—ñ–Ω–∏ –Ω–µ –±–µ—Ä—É—Ç—å—Å—è –¥–æ —É–≤–∞–≥–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞—Ñ—ñ–∫—Å—É–≤–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —è–∫ –Ω–µ –∑–Ω–∞—á—É—â–∏–π, —Ö–æ—á–∞ –≤—ñ–Ω –∑–Ω–∞—á—É—â–∏–π.

## –ü—Ä–∏–∫–ª–∞–¥–∏ {.smaller}

**1. –•–∏–±–Ω–æ–ø–æ–∑–∏—Ç–∏–≤–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è**

*–ì—ñ–ø–æ—Ç–µ–∑–∞*: –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ç–∏–∂–Ω–µ–≤–æ—ó —Ü—ñ–Ω–∏ –ø–µ—Ä–µ–¥–ø–ª–∞—Ç–∏ –∑ 1 –¥–æ 2

*–ü—ñ–¥—Å—É–º–æ–∫*: –Ω–∞ –ø–µ—Ä—à–∏—Ö 2 –¥–Ω—è—Ö –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –±—É–ª–æ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–æ–¥–∞–∫—Ç —ñ –∞–Ω–∞–ª—ñ—Ç–∏–∫ —É—Ö–≤–∞–ª–∏–ª–∏ —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —è–∫ —É—Å–ø—ñ—à–Ω–∏–π, –∞ –ø—ñ—Å–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó –∑–º—ñ–Ω–∏ –Ω–∞ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ - –∫–ª—é—á–æ–≤–∏–π –ø–æ–∫–∞–∑–Ω–∏–∫ –∑–º—ñ–Ω–∏–≤—Å—è –≤ –≥—ñ—Ä—à–∏–π –±—ñ–∫. –¢–∞–∫, –ø—Ä–∏–π–Ω—è–ª–∏ –∑–∞ —ñ—Å—Ç–∏–Ω—É —Ç–µ, —â–æ –Ω–µ—é –Ω–µ —î.

**2. –•–∏–±–Ω–æ–Ω–µ–≥–∞—Ç–∏–≤–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è**

–ü—Ä–æ–≤–æ–¥–∏–ª–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2 –¥–Ω—ñ, –Ω–µ –±–∞—á–∏–ª–∏ —Ä—ñ–∑–Ω–∏—Ü—ñ, –∑—É–ø–∏–Ω–∏–ª–∏

*–ü—ñ–¥—Å—É–º–æ–∫*: –æ—Å–∫—ñ–ª—å–∫–∏ –≤ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ –±—É–ª–æ –æ—Ö–æ–ø–ª–µ–Ω–æ —Ç—ñ–ª—å–∫–∏ 2 –¥–Ω—ñ, –º–∏ –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—î–º–æ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –∞—É–¥–∏—Ç–æ—Ä—ñ—ó –≤ —ñ–Ω—à—ñ –¥–Ω—ñ —Ç–∏–∂–Ω—è. –ú–æ–∂–ª–∏–≤–æ, –∑–º—ñ–Ω–∞ –º–∞—î –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–∏–π –µ—Ñ–µ–∫—Ç: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É –ø–æ–Ω–µ–¥—ñ–ª–æ–∫ –ø–æ—Ç—Ä–∞–ø–∏–≤ —É —Ç–µ—Å—Ç–æ–≤—É –≥—Ä—É–ø—É, –∞ –≤ –ø'—è—Ç–Ω–∏—Ü—é –ø—Ä–∏–π–Ω—è–≤ —Ä—ñ—à–µ–Ω–Ω—è

## –Ø–∫ –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏ {.smaller}

::: {.r-stack}
![](img/fp-fn-2.jpg){.fragment .absolute left=0 top=160 width="450"}

![](img/fp-fn.jpg){.fragment .absolute right=0 top=160 width="450"}

![](img/fp-fn-3.jpg){.fragment width="350"}
:::

. . .

**–ü–æ–º–∏–ª–∫–∞ I —Ä–æ–¥—É** --- —Ö–ª–æ–ø—á–∏–∫ –∑–∞–∫—Ä–∏—á–∞–≤ "–≤–æ–≤–∫!", –∂–∏—Ç–µ–ª—ñ –ø–æ–≤—ñ—Ä–∏–ª–∏, —Ö–æ—á–∞ –≤–æ–≤–∫–∞ –Ω–µ –±—É–ª–æ.

**–ü–æ–º–∏–ª–∫–∞ II —Ä–æ–¥—É** --- —Ö–ª–æ–ø—á–∏–∫ –∑–∞–∫—Ä–∏—á–∞–≤ "–≤–æ–≤–∫!", –∂–∏—Ç–µ–ª—ñ –Ω–µ –ø–æ–≤—ñ—Ä–∏–ª–∏, —Ö–æ—á–∞ –≤–æ–≤–∫ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –±—É–≤.

# –ú–µ—Ç—Ä–∏–∫–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É {background-color="#eef3f8"}

## –†—ñ–≤–Ω—ñ –º–µ—Ç—Ä–∏–∫

- **–¶—ñ–ª—å–æ–≤—ñ** - –ø–æ–∫–∞–∑–Ω–∏–∫–∏, –Ω–∞ —è–∫—ñ —Å–ø—Ä—è–º–æ–≤–∞–Ω–∞ –∑–º—ñ–Ω–∞ (–∫–æ–Ω–≤–µ—Ä—Å—ñ—è, —Å–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫)
- **–í–∏–ø–µ—Ä–µ–¥–∂–∞–ª—å–Ω—ñ** - –ø–æ–∫–∞–∑–Ω–∏–∫–∏, –¥–æ–±—Ä–µ –∫–æ—Ä–µ–ª—å–æ–≤–∞–Ω—ñ –∑ —Ü—ñ–ª—å–æ–≤–∏–º–∏, —â–æ –¥–∞—é—Ç—å –ø—Ä–µ–¥–∏–∫—Ç —ñ –∫–æ—Ä–∏—Å–Ω—ñ —Ç–æ–¥—ñ, –∫–æ–ª–∏ –Ω–µ–º–∞—î —á–∞—Å—É —á–µ–∫–∞—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É –º–µ—Ç—Ä–∏–∫—É
- **Guardrail** - –ø–æ–∫–∞–∑–Ω–∏–∫–∏, –Ω–∞ —è–∫—ñ —Å–ø—Ä—è–º–æ–≤–∞–Ω–æ –≤–ø–ª–∏–≤–∞—î –∑–º—ñ–Ω–∞, –∞–ª–µ —è–∫—ñ –Ω–µ —î —Ü—ñ–ª—å–æ–≤–∏–º–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑–∞ –Ω–∏–º–∏ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ —ñ –Ω–∞ —ó—Ö–Ω—ñ–π –æ—Å–Ω–æ–≤—ñ —Ç–∞–∫–æ–∂ —É—Ö–≤–∞–ª—é–≤–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è

## –ü—Ä–∏–∫–ª–∞–¥: e-commerce, —Ç–µ—Å—Ç –Ω–æ–≤–æ–≥–æ UI –∫–æ—à–∏–∫–∞

- **–¶—ñ–ª—å–æ–≤—ñ**: –∫–æ–Ω–≤–µ—Ä—Å—ñ—è –≤ –ø–æ–∫—É–ø–∫—É, —Å–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫, ARPU (—Å–µ—Ä–µ–¥–Ω—ñ–π –¥–æ—Ö—ñ–¥ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞), ARPPU (—Å–µ—Ä–µ–¥–Ω—ñ–π –¥–æ—Ö—ñ–¥ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ —Å–ø–ª–∞—á—É—î)
- **–í–∏–ø–µ—Ä–µ–¥–∂–∞–ª—å–Ω—ñ**: –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É –≤ –∫–æ—à–∏–∫ –Ω–∞ —Å–µ—Å—ñ—é, –ø–µ—Ä–µ–≥–ª—è–¥–∏ —Ç–æ–≤–∞—Ä—ñ–≤ –Ω–∞ —Å–µ—Å—ñ—é, –≤—ñ–¥—Ç—ñ–∫ —á–µ–∫–∞—É—Ç–∞, –ø–æ–º–∏–ª–∫–∏ –Ω–∞ —á–µ–∫–∞—É—Ç—ñ
- **Guardrail**: —á–∞—Å –≤—ñ–¥ –≤—Ö–æ–¥—É –≤ –∫–æ—à–∏–∫ –¥–æ –π–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è, —á–∞—Å—Ç–∫–∞ –ø–æ—à—É–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ —ñ–∑ –∫–æ—à–∏–∫–∞, –≤–∑–∞—î–º–æ–¥—ñ—è –∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π–Ω–∏–º–∏ –±–ª–æ–∫–∞–º–∏ –≤ –∫–æ—à–∏–∫—É

## –ü—Ä–∏–∫–ª–∞–¥: –æ—Å–≤—ñ—Ç–Ω—ñ–π –ø—Ä–æ–¥—É–∫—Ç, —Ç–µ—Å—Ç –Ω–æ–≤–æ–≥–æ –æ—Å–≤—ñ—Ç–Ω—å–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É

- **–¶—ñ–ª—å–æ–≤—ñ**: –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è, —Å–µ—Ä–µ–¥–Ω—ñ–π –¥–æ—Ö—ñ–¥ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ —Å–ø–ª–∞—á—É—î (ARPPU)
- **–í–∏–ø–µ—Ä–µ–¥–∂–∞–ª—å–Ω—ñ**: —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞–≤—á–∞–Ω–Ω—è, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ —É –º–æ–º–µ–Ω—Ç –Ω–∞–≤—á–∞–Ω–Ω—è, —á–∞—Å—Ç–æ—Ç–∞ –∑–≤–µ—Ä–Ω–µ–Ω—å –¥–æ —Å–ª—É–∂–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏, —Ç–µ—Ö–Ω—ñ—á–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —è–∫–æ—Å—Ç—ñ –≤—ñ–¥–µ–æ
- **Guardrail**: —á–∞—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–π –∑–∞ –æ–¥–Ω–∏–º –∑–∞–Ω—è—Ç—Ç—è–º, –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è –∑–∞–Ω—è—Ç—å, –ø–µ—Ä–µ–º–æ—Ç—É–≤–∞–Ω–Ω—è

## –¢–∏–ø–∏ –º–µ—Ç—Ä–∏–∫ {.smaller}

- **–ß–∞—Å—Ç–∫–∏**
  + –≤–µ–ª–∏—á–∏–Ω–∞, —è–∫–∞ –±–µ—Ä–µ—Ç—å—Å—è –∑ –±—ñ–Ω–∞—Ä–Ω–æ—ó –æ–∑–Ω–∞–∫–∏, –∫–æ–ª–∏ —î –¥–≤—ñ –≥—Ä–∞–¥–∞—Ü—ñ—ó - 0 –∞–±–æ 1: —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, —É—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞ 7 –¥–µ–Ω—å [0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1]
- **–ù–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ**
  + —Å–µ—Ä–µ–¥–Ω—î –≤–∏–±—ñ—Ä–∫–æ–≤–µ –∑ –¥–µ—è–∫–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∏—Ö –≤–µ–ª–∏—á–∏–Ω: —á–∞—Å —É —Å–µ–∫./—Ö–≤./—Ç–æ—â–æ, —á–µ–∫ —É –≥—Ä–∏–≤–Ω—ñ [1123.32, 324.4, 823.21, 924.91].
- **–í—ñ–¥–Ω–æ—Å–Ω—ñ**
  + –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –¥–≤–æ—Ö –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –≤–µ–ª–∏—á–∏–Ω: –ø–æ—ó–∑–¥–æ–∫ –Ω–∞ –≤–æ–¥—ñ—è, –∫–ª—ñ–∫—ñ–≤ –Ω–∞ —Å–µ—Å—ñ—ó, —Ü—ñ–Ω–∞ –∑–∞ 1000 –ø–æ–∫–∞–∑—ñ–≤ [10/123 = 0.081, 4129.2/12488 = 0.33, 1/100=0.01]

## –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –º–µ—Ç—Ä–∏–∫ {.smaller}

–°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–µ—Ç—Ä–∏–∫ - –¥–∞—î –∑–º–æ–≥—É –∫—Ä–∞—â–µ —ñ —à–≤–∏–¥—à–µ —É—Ö–≤–∞–ª—é–≤–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è, –∫–æ–ª–∏ –º–µ—Ç—Ä–∏–∫ –±–∞–≥–∞—Ç–æ. 

–Ø–∫—â–æ –Ω–µ–º–∞—î —Ä–æ–∑—É–º—ñ–Ω–Ω—è –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É - –ø—Ä–∏–π–Ω—è—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è –¥–æ—Å–∏—Ç—å —Å–∫–ª–∞–¥–Ω–æ.

–ù–∞ —Ä—ñ–∑–Ω–∏—Ö —Å—Ç–∞–¥—ñ—è—Ö —Ä–æ–∑–≤–∏—Ç–∫—É –ø—Ä–æ–¥—É–∫—Ç—É —Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –º–æ–∂–µ –∑–Ω–∞—á–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è - —Ü–µ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ—Å—Ç—ñ–π–Ω–æ —É—Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—é–≤–∞—Ç–∏.

. . .

**–î–æ–≤–≥—ñ –º–µ—Ç—Ä–∏–∫–∏ vs. –®–≤–∏–¥–∫—ñ –º–µ—Ç—Ä–∏–∫–∏**

–£ –∫–æ–∂–Ω–æ—ó –º–µ—Ç—Ä–∏–∫–∏ —î "–≤—ñ–∫–Ω–æ" - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –≤—ñ–¥—Ä–∞–∑—É —É—Ö–≤–∞–ª—é—î —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ –±–∞–∂–∞–Ω—É –¥—ñ—é –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç—É. –í–∞–∂–ª–∏–≤–æ —à—É–∫–∞—Ç–∏ "—à–≤–∏–¥–∫—ñ" –º–µ—Ç—Ä–∏–∫–∏, —è–∫—ñ –∑–∞–ª–µ–∂–Ω—ñ –≤—ñ–¥ "–¥–æ–≤–≥–∏—Ö" —ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü—å–æ–≥–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —ñ –≤—Å—é —ñ—î—Ä–∞—Ä—Ö—ñ—é

# –¢–∏–ø–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤ {background-color="#eef3f8"}

## A/B —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ß–∏–º –∫–æ—Ä–∏—Å–Ω–∏–π:** –í–∏–º—ñ—Ä—è—Ç–∏ –µ—Ñ–µ–∫—Ç –≤—ñ–¥ –∑–º—ñ–Ω–∏

**–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- –∫–æ–∂–Ω–∞ –≥—Ä—É–ø–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –±–∞—á–∏—Ç—å —Å–≤—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç
- –≥—Ä—É–ø–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ
- –≥—Ä—É–ø–∏ –≤–∑—è—Ç—ñ –∑ –æ–¥–Ω—ñ—î—ó –ì–°
- —Ä–æ–∑–ø–æ–¥—ñ–ª –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ—Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–º

## A/A —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ß–∏–º –∫–æ—Ä–∏—Å–Ω–∏–π:**

- –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–ø–ª—ñ—Ç-—Å–∏—Å—Ç–µ–º—É
- –≤–∏–±—Ä–∞—Ç–∏ –≥–æ–º–æ–≥–µ–Ω–Ω—ñ –≥—Ä—É–ø–∏

**–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- –≥—Ä—É–ø–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ
- –≥—Ä—É–ø–∏ –≤–∑—è—Ç—ñ –∑ –æ–¥–Ω—ñ—î—ó –ì–°
- —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å–∏–º—É–ª—è—Ü—ñ–π

## A/B/n —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ß–∏–º –∫–æ—Ä–∏—Å–Ω–∏–π:** –¢–æ–π —Å–∞–º–∏–π A/B, —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤—ñ–¥ 2 —ñ –±—ñ–ª—å—à–µ –∑–º—ñ–Ω.

**–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- –≥—Ä—É–ø–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ
- –≥—Ä—É–ø–∏ –≤–∑—è—Ç—ñ –∑ –æ–¥–Ω—ñ—î—ó –ì–°
- –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –ø—Ä–æ–±–ª–µ–º–æ—é –º–Ω–æ–∂–∏–Ω–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—ñ–ø–æ—Ç–µ–∑

## TDI (team draft interleaving) - —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω

**–ß–∏–º –∫–æ—Ä–∏—Å–Ω–∏–π:** –∑–º—ñ–Ω–∏ —É —Ä–∞–Ω–∂—É–≤–∞–Ω–Ω—ñ, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è—Ö, –ø–æ—à—É–∫—É

**–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- –æ–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –æ–¥—Ä–∞–∑—É –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
- –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –ø–æ—à—É–∫—É —ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è—Ö
- –≤–∏–±—ñ—Ä–∫–∏ –∑–∞–ª–µ–∂–Ω—ñ - —â–æ –Ω–∞–∫–ª–∞–¥–∞—î –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

## A/B vs. TDI

![](img/ab_vs_interleaving.png)

## –ü—Ä–∏–∫–ª–∞–¥ TDI: –¥–≤–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –ø–æ—à—É–∫—É {.smaller}

–ú–µ—Ç–æ–¥ TDI –¥–∞—î –∑–º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–¥–∞—á—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–≥–æ –∑–∞–ø–∏—Ç—É —ñ–∑ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è–º –¥–≤–æ—Ö –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏—Ä—ñ—à—É—î –∫–ª—ñ–∫–æ–º, —è–∫–∏–π –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º –¥–∞–≤ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å. –ü–æ–¥—ñ–ª—É –Ω–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Ç—É—Ç –Ω–µ–º–∞—î. –°–∞–º—ñ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —Ä—ñ–∑–Ω–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –±—É–¥—É—Ç—å –ø–µ—Ä–µ–º—ñ—à—É–≤–∞—Ç–∏—Å—è, —â–æ–± —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –Ω–µ –±—É–≤ –∑–∞–ª–µ–∂–Ω–∏–π –≤—ñ–¥ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è.

![](img/tdi-1.png)

## Diff-in-Diff (—Ä—ñ–∑–Ω–∏—Ü—è –≤ —Ä—ñ–∑–Ω–∏—Ü—ñ)

**–ß–∏–º –∫–æ—Ä–∏—Å–Ω–∏–π:** –∫–æ–ª–∏ –Ω–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–æ–¥—ñ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –≥—Ä—É–ø–∏ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç —á–∞—Å—É

**–ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- –≥—Ä—É–ø–∏ –∑–∞–ª–µ–∂–Ω—ñ —Ç–∞ —Ä–æ–∑–Ω–µ—Å–µ–Ω—ñ –≤ —á–∞—Å—ñ
- –æ–¥–∏–Ω —ñ–∑ —Ç–∏–ø—ñ–≤ —Ä–µ–≥—Ä–µ—Å—ñ–π

## –ü—Ä–∏–∫–ª–∞–¥ Diff-in-Diff: –µ–∫–æ–Ω–æ–º—ñ—á–Ω–∞ –∑–º—ñ–Ω–∞ –≤ –¥–µ—Ä–∂–∞–≤—ñ {.smaller}

–Ñ –¥–≤—ñ –≥—Ä—É–ø–∏ (—Ç–µ—Å—Ç —ñ –∫–æ–Ω—Ç—Ä–æ–ª—å) —ñ –¥–≤–∞ –ø–µ—Ä—ñ–æ–¥–∏ - –ø–µ—Ä—ñ–æ–¥ –¥–æ –≤–∑–∞—î–º–æ–¥—ñ—ó —Ç–∞ –ø—ñ—Å–ª—è. 

–û–¥–Ω–∞ –∑ –≥—Ä—É–ø —Å—Ö–∏–ª—å–Ω–∞ –¥–æ –≤–ø–ª–∏–≤—É, –∞–±–æ –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –¥–µ—è–∫—ñ–π –ø—Ä–æ–≥—Ä–∞–º—ñ, —É –¥—Ä—É–≥–æ–º—É –ø–µ—Ä—ñ–æ–¥—ñ, –∞–ª–µ –Ω–µ –≤ –ø–µ—Ä—à–æ–º—É. –î—Ä—É–≥–∞ –≥—Ä—É–ø–∞ –Ω–µ –ø—ñ–¥–¥–∞—î—Ç—å—Å—è –≤–ø–ª–∏–≤—É –≤ –∂–æ–¥–Ω–æ–º—É –∑ –ø–µ—Ä—ñ–æ–¥—ñ–≤. –ú–µ—Ç–æ–¥ —É—Å—É–≤–∞—î –∑–º—ñ—â–µ–Ω–Ω—è –ø—ñ–¥ —á–∞—Å –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É —Ç–µ—Å—Ç–æ–≤—ñ–π —ñ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ–π –≥—Ä—É–ø–∞—Ö —Ç—ñ–ª—å–∫–∏ –≤ –¥—Ä—É–≥–æ–º—É –ø–µ—Ä—ñ–æ–¥—ñ, —è–∫–µ –º–æ–∂–µ –±—É—Ç–∏ –Ω–∞—Å–ª—ñ–¥–∫–æ–º –ø–æ—Å—Ç—ñ–π–Ω–∏—Ö –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç–µ–π –º—ñ–∂ —Ü–∏–º–∏ –≥—Ä—É–ø–∞–º–∏.

![](img/diff-in-diff.png)


# Bootstrap {background-color="#eef3f8"}

## –©–æ —Ç–∞–∫–µ Bootstrap

**–ë—É—Ç—Å—Ç—Ä–∞–ø** - —Ü—ñ–ª–µ —Å—ñ–º–µ–π—Å—Ç–≤–æ –º–µ—Ç–æ–¥—ñ–≤, —â–æ –¥–∞—î –∑–º–æ–≥—É –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –≥—ñ–ø–æ—Ç–µ–∑–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –≤–∏–±—ñ—Ä–æ–∫.

## –ü—Ä–∏–∫–ª–∞–¥: –∫–µ–π—Å —ñ–∑ —Ñ—É–¥-—Ä–∏—Ç–µ–π–ª—É {.smaller}

–î–æ–¥–∞–ª–∏ –Ω–æ–≤—É –≤—ñ—Ç—Ä–∏–Ω—É "–í–∞—à—ñ –º–∏–Ω—É–ª—ñ –ø–æ–∫—É–ø–∫–∏" –Ω–∞ —á–µ–∫–∞—É—Ç. –¶—ñ–∫–∞–≤–æ, —è–∫ –∑–º—ñ–Ω–∏–≤—Å—è —Å–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫. –Ø–∫ –æ—Ü—ñ–Ω–∏—Ç–∏ –≤–ø–ª–∏–≤ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –Ω–∞ –ø—Ä–∏–±—É—Ç–æ–∫? –ú–æ–∂–µ–º–æ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è –Ω–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª, –æ–ø–∏—Å–æ–≤—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ —Ç–µ—Å—Ç —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–Ω–∞—á—É—â—ñ—Å—Ç—å –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç–µ–π.

```{python}
#| label: bootstrap-data
#| echo: false
#| fig-align: center

# –≥–µ–Ω–µ—Ä—É—î–º–æ –¥–∞–Ω—ñ –∑ –ø—Ä–∞–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—é –∞—Å–∏–º–µ—Ç—Ä—ñ—î—é
np.random.seed(1234)
shape = 3
size = 1000
mean_c = 5253
mean_t = 5486

data_c = np.random.pareto(shape, 1000)
data_t = np.random.pareto(shape, 1000)

control = data_c * mean_c / np.mean(data_c)
test = data_t * mean_t / np.mean(data_t)

# plot data
fig, ax = plt.subplots(figsize=(10, 5))
sns.histplot(test, ax=ax, color=blue, label='$AVG_t$: {:.2f}'.format(np.mean(test)))
sns.histplot(control, ax=ax, color=red, label='$AVG_c$: {:.2f}'.format(np.mean(control)))
ax.legend()
ax.set_title('–†–æ–∑–ø–æ–¥—ñ–ª –¥–æ—Ö–æ–¥—É')
plt.xlim(0, 40000)
plt.show()
```

–ù–∞ –æ–∫–æ –∑–¥–∞—î—Ç—å—Å—è, —â–æ –≤ —Ç–µ—Å—Ç–æ–≤—ñ–π –≥—Ä—É–ø—ñ –º–∏ —Å—Ç–∞–ª–∏ –∑–∞—Ä–æ–±–ª—è—Ç–∏ –±—ñ–ª—å—à–µ. 

–ê–ª–µ –±—ñ–∑–Ω–µ—Å—É –∑–∞—Ö–æ—á–µ—Ç—å—Å—è –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —á–∏–º –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è —Ü—è –º—ñ–Ω–ª–∏–≤—ñ—Å—Ç—å (—Ä—ñ–∑–Ω–∏—Ü—è, —è–∫—É –º–∏ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î–º–æ), –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ —è–∫–æ—ó –∞—É–¥–∏—Ç–æ—Ä—ñ—ó –¥–æ—Å—è–≥–ª–∏ –µ—Ñ–µ–∫—Ç—É?

## –ü—Ä–∏–∫–ª–∞–¥: –∫–µ–π—Å —ñ–∑ —Ñ—É–¥-—Ä–∏—Ç–µ–π–ª—É {.smaller}

:::: columns

::: column

::: {.incremental}
- –©–æ –±—É–¥–µ –∫—Ä–∞—â–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É —Ç–µ–Ω–¥–µ–Ω—Ü—ñ—é? 
- –ú–µ–¥—ñ–∞–Ω–∞!
- –ß–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É –≥—Ä–∞–Ω–∏—á–Ω—É —Ç–µ–æ—Ä–µ–º—É –¥–ª—è —â–æ–± –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –î–Ü –¥–ª—è –º–µ–¥—ñ–∞–Ω–∏?
- –ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç –Ω–µ –∑–º–æ–∂–µ–º–æ, —Ç–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω —è–∫–∏–π—Å—å –º–µ—Ç–æ–¥ –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è
:::

:::

::: column

```{python}
#| label: bootstrap-data-question
#| echo: false
#| fig-align: center

fig, ax = plt.subplots(figsize=(10, 5))
sns.histplot(test, ax=ax, color=blue, label='$AVG_t$: {:.2f}'.format(np.mean(test)))
sns.histplot(control, ax=ax, color=red, label='$AVG_c$: {:.2f}'.format(np.mean(control)))
ax.legend()
ax.set_title('–†–æ–∑–ø–æ–¥—ñ–ª –¥–æ—Ö–æ–¥—É')
plt.xlim(0, 40000)
plt.show()
```
:::
::::

## –ü—Ä–∏–∫–ª–∞–¥: –∫–µ–π—Å —ñ–∑ —Ñ—É–¥-—Ä–∏—Ç–µ–π–ª—É

–ú–∞—é—á–∏ —Ç—ñ–ª—å–∫–∏ –¥–∞–Ω—ñ –∑–∞ –Ω–∞—è–≤–Ω–æ—é –≤–∏–±—ñ—Ä–∫–æ—é, —ñ—Å–Ω—É—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ü—ñ–Ω–∏—Ç–∏ –±—É–¥—å-—è–∫–∏–π —ó—ó –ø–∞—Ä–∞–º–µ—Ç—Ä, –ø–æ–±—É–¥—É–≤–∞–≤—à–∏ **–µ–º–ø—ñ—Ä–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –ø–∞—Ä–∞–º–µ—Ç—Ä–∞**.

–£ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –Ω–∞—à–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –∑ –º–µ–¥—ñ–∞–Ω–æ—é - –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª –º–µ–¥—ñ–∞–Ω —ñ –¥–∞–ª—ñ –∑–∞ –Ω–∏–º –æ–±—á–∏—Å–ª–∏—Ç–∏ –¥–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª:

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ø—ñ–¥–≤–∏–±—ñ—Ä–∫–∏ –∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏ –∑ –Ω–∞—è–≤–Ω–æ—ó –≤–∏–±—ñ—Ä–∫–∏ 
2. –û–±—á–∏—Å–ª–∏—Ç–∏ –º–µ–¥—ñ–∞–Ω—É –¥–ª—è –ø—ñ–¥–≤–∏–±—ñ—Ä–∫–∏
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∫—Ä–æ–∫–∏ 1-2 N —Ä–∞–∑—ñ–≤
4. –ü–æ–±—É–¥—É–≤–∞—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª –º–µ–¥—ñ–∞–Ω
5. –û–±—á–∏—Å–ª–∏—Ç–∏ –¥–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª

## –ü—Ä–∏–∫–ª–∞–¥: –∫–µ–π—Å —ñ–∑ —Ñ—É–¥-—Ä–∏—Ç–µ–π–ª—É {.smaller}

```{python}
#| label: bootstrap-median
#| fig-align: center
#| output-location: slide

# bootstrap
def bootstrap(data, n=9999):
    """Bootstrap function"""
    return np.random.choice(data, size=(n, len(data)), replace=True)

# bootstrap median
def bootstrap_median(data, n=9999):
    """Bootstrap median function"""
    return np.median(bootstrap(data, n), axis=1)

# bootstrap median for control and test
median_c = bootstrap_median(control)
median_t = bootstrap_median(test)

# plot data
fig, ax = plt.subplots(figsize=(10, 5))
sns.histplot(median_t, ax=ax, color=blue, label='–°–µ—Ä–µ–¥–Ω—î –≤–∏–±—ñ—Ä–∫–æ–≤–æ—ó –º–µ–¥—ñ–∞–Ω–∏ –¥–ª—è —Ç–µ—Å—Ç—É: {:.2f}'.format(np.mean(median_t)))
sns.histplot(median_c, ax=ax, color=red, label='–°–µ—Ä–µ–¥–Ω—î –≤–∏–±—ñ—Ä–∫–æ–≤–æ—ó –º–µ–¥—ñ–∞–Ω–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é: {:.2f}'.format(np.mean(median_c)))
ax.legend()
ax.set_title('–†–æ–∑–ø–æ–¥—ñ–ª –º–µ–¥—ñ–∞–Ω–∏ –¥–æ—Ö–æ–¥—É')
plt.show()
```

## –ü—Ä–∏–∫–ª–∞–¥: –∫–µ–π—Å —ñ–∑ —Ñ—É–¥-—Ä–∏—Ç–µ–π–ª—É

–ú–µ–¥—ñ–∞–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `scipy`:

```{python}
#| label: bootstrap-median-scipy

from scipy.stats import bootstrap

# bootstrap median for control and test
median_c = bootstrap(data=(control,), statistic=np.median, confidence_level=0.95)
median_t = bootstrap(data=(test,), statistic=np.median, confidence_level=0.95)

print(f'–î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó –≥—Ä—É–ø–∏ = {median_c.confidence_interval}')
print(f'–î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –≥—Ä—É–ø–∏ = {median_t.confidence_interval}')
```

## –ü—Ä–∏–∫–ª–∞–¥: –∫–µ–π—Å —ñ–∑ —Ñ—É–¥-—Ä–∏—Ç–µ–π–ª—É {.smaller}

–°–µ—Ä–µ–¥–Ω—î –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `scipy`:

```{python}
#| label: bootstrap-mean-scipy

from scipy.stats import bootstrap

# bootstrap median for control and test
mean_c = bootstrap(data=(control,), statistic=np.mean, confidence_level=0.95)
mean_t = bootstrap(data=(test,), statistic=np.mean, confidence_level=0.95)

print(f'–î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó –≥—Ä—É–ø–∏ = {mean_c.confidence_interval}')
print(f'–î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –≥—Ä—É–ø–∏ = {mean_t.confidence_interval}')
```

–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–∑–ø–æ–¥—ñ–ª—É —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `scipy`:

```{python}
#| label: bootstrap-mean-scipy-plot
#| fig-align: center
#| output-location: column

# plot data
sns.histplot(mean_t.bootstrap_distribution)
plt.axvline(mean_t.confidence_interval[0], color='red', linestyle='--')
plt.axvline(mean_t.confidence_interval[1], color='red', linestyle='--')
plt.axvline(np.mean(test), color='blue', linestyle='--')
ax.set_title('–†–æ–∑–ø–æ–¥—ñ–ª —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ –¥–æ—Ö–æ–¥—É')
plt.show()
```

## –ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–ª–∞—Å–∏—á–Ω–∏–π –∫—Ä–∏—Ç–µ—Ä—ñ–π? {.smaller}

- –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –∫—Ä–∏—Ç–µ—Ä—ñ–π –ú–∞–Ω–Ω–∞-–í—ñ—Ç–Ω—ñ –Ω–∞–π–∫—Ä–∞—â–µ –ø—ñ–¥—ñ–π–¥–µ –¥–ª—è –∑–∞–≤–¥–∞–Ω–Ω—è. –í—ñ–Ω –¥–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, —á–∏ –∑–Ω–∞—á—É—â–µ —Ä—ñ–∑–Ω—è—Ç—å—Å—è —Ä–æ–∑–ø–æ–¥—ñ–ª–∏, —á–∏ –Ω—ñ.

- –î–æ —Ç–æ–≥–æ –∂, —É –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é —Å–≤–æ—î –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è, —è–∫–µ –≤–∏–º–∞–≥–∞—î –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è –Ω–∏–∑–∫–∏ –ø—Ä–∏–ø—É—â–µ–Ω—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–¥–Ω–∞–∫–æ–≤–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—è/–æ–¥–Ω–∞–∫–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä –≤–∏–±—ñ—Ä–∫–∏/–æ–¥–Ω–∞–∫–æ–≤–∞ —Ñ–æ—Ä–º–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ–≤ —Ç–æ—â–æ). –¢–∞–∫–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–µ –∑–∞–≤–∂–¥–∏ —î.

```{python}
#| label: classic-test

from scipy.stats import mannwhitneyu

# mann-whitney test
stat, p = mannwhitneyu(control, test)
print('Statistics=%.3f, p=%.3f' % (stat, p))
```

## –ü—ñ–¥—Å—É–º–æ–∫ {.smaller}

- –ë—É—Ç—Å—Ç—Ä–∞–ø –¥–∞—î –∑–º–æ–≥—É –±—É–¥—É–≤–∞—Ç–∏ –¥–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—É, –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—á–∏ –¥–ª—è —Ü—å–æ–≥–æ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—É —Ñ–æ—Ä–º—É–ª—É
- –û—Å–Ω–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ –ë—É—Ç—Å—Ç—Ä–∞–ø - –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –≥—ñ–ø–æ—Ç–µ–∑–∏ –¥–ª—è –±—É–¥—å-—è–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∞–±–æ –º–æ–¥–µ–ª–µ–π: –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª—ñ/–ö–≤–∞–Ω—Ç–∏–ª—ñ/–î–µ—Ü–∏–ª—ñ —Ç–æ—â–æ.
- –ë—É—Ç—Å—Ç—Ä–∞–ø –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –≥—ñ–ø–æ—Ç–µ–∑–∏ –±–µ–∑ –æ–ø–æ—Ä–∏ –Ω–∞ –ø–µ–≤–Ω–∏–π —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –¥–∞–Ω–∏—Ö (–Ω–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ –∫–ª–∞—Å–∏—á–Ω–∏—Ö —Å—Ç–∞—Ç. –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤)
- –ë—É—Ç—Å—Ç—Ä–∞–ø –¥–∞—î –∑–º–æ–≥—É –∑—Ä–æ–±–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É –±—É–¥—å-—è–∫–æ–≥–æ "—Å–∫–ª–∞–¥–Ω–æ–≥–æ" –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —à–ª—è—Ö–æ–º –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –¥–æ–≤—ñ—Ä—á–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤ –¥–ª—è –Ω—å–æ–≥–æ. –ê –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≥—ñ–ø–æ—Ç–µ–∑ - —à–ª—è—Ö–æ–º –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —ó—Ö–Ω—å–æ—ó —Ä—ñ–∑–Ω–∏—Ü—ñ.

## –ì—ñ–ø–æ—Ç–µ–∑–∏ —ñ –±—É—Ç—Å—Ç—Ä–∞–ø

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –ë—É–¥—É—î—Ç–µ –±—É—Ç—Å—Ç—Ä–∞–ø-—Ä–æ–∑–ø–æ–¥—ñ–ª –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ –ê —ñ –ë
2. –û–±—á–∏—Å–ª—é—î—Ç–µ —ó—Ö–Ω—é —Ä—ñ–∑–Ω–∏—Ü—é (–≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è –º–∞—Ç—Ä–∏—Ü—å)
3. –í –æ—Ç—Ä–∏–º–∞–Ω–æ–º—É —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ —Ä—ñ–∑–Ω–∏—Ü—å —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –¥–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª
4. –Ø–∫—â–æ –¥–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –Ω–µ –º—ñ—Å—Ç–∏—Ç—å 0 - –≥—ñ–ø–æ—Ç–µ–∑–∞ –ø—Ä–æ —Ä—ñ–≤–Ω—ñ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –≤—ñ–¥—Ö–∏–ª—è—î—Ç—å—Å—è

## p-value —ñ –±—É—Ç—Å—Ç—Ä–∞–ø {.smaller}

::: {style="font-size: 70%;"}

–ó–∞–≥–∞–¥–∞—î–º–æ, —è–∫ —Ä–∞—Ö—É—î—Ç—å—Å—è p-value –¥–ª—è t-–∫—Ä–∏—Ç–µ—Ä—ñ—é:

- –ù—É–ª—å–æ–≤–∞ –≥—ñ–ø–æ—Ç–µ–∑–∞: —Ä–æ–∑–ø–æ–¥—ñ–ª–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ

$$ H_0: \mu_x = \mu_y $$

- –†–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—Ä–∏—Ç–µ—Ä—ñ—é, —è–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ü—ñ –≤—ñ–¥ –Ω—É–ª—è –∑–∞ t-—Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º:

$$ t = \frac{\bar{x} - \bar{y}}{\sqrt{\frac{s_x^2}{n_x} + \frac{s_y^2}{n_y}}} $$

- –ù–∞ –∫–æ–∂–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –±—É—Ç—Å—Ç—Ä–∞–ø—É –º–∏ —Ä–∞—Ö—É—î–º–æ —Ä—ñ–∑–Ω–∏—Ü—é, –¥–µ 0 --- —ó—ó –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è
- –î–∞–ª—ñ –Ω–∞–º –±–∏ —Ö–æ—Ç—ñ–ª–æ—Å—è –∑'—è—Å—É–≤–∞—Ç–∏, –∑ —è–∫–æ—é –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é –º–∏ –± –±–∞—á–∏–ª–∏ —Ç–∞–∫—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ –∑–∞ —É–º–æ–≤–∏ –≤—ñ—Ä–Ω–æ—Å—Ç—ñ –Ω—É–ª—å–æ–≤–æ—ó –≥—ñ–ø–æ—Ç–µ–∑–∏. –¢–æ–º—É –º–∏ –º–æ–∂–µ–º–æ –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —Ç–∞–∫–æ–≥–æ –≤–∏–ø–∞–¥–∫—É, –ø–æ—Ä–∞—Ö—É–≤–∞–≤—à–∏ —Å—É–º—É –≤–∏–ø–∞–¥–∫—ñ–≤ –∑—ñ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è–º–∏ –≤—ñ–¥ –Ω—É–ª—è —ñ –ø–æ–¥—ñ–ª–∏–≤—à–∏ –Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—Å—ñ—Ö –æ—Ü—ñ–Ω–æ–∫. –¶–µ —ñ –±—É–¥–µ p-value:

> –ó–∞ —É–º–æ–≤–∏ –≤—ñ—Ä–Ω–æ—Å—Ç—ñ –Ω—É–ª—å–æ–≤–æ—ó –≥—ñ–ø–æ—Ç–µ–∑–∏, –±—É—Ç—Å—Ç—Ä–∞–ø –≤–∏–±—ñ—Ä–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—å –ø–æ–≤–∏–Ω–Ω–∞ –º–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –∑ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–º —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è–º 0 (–¶–ì–¢). –¢–æ–º—É, —è–∫—â–æ –º–∏ –ø–æ—Ä–∞—Ö—É—î–º–æ –≤—ñ–¥—Å–æ—Ç–æ–∫ –≤–∏–ø–∞–¥–∫—ñ–≤, –∫–æ–ª–∏ —Ä—ñ–∑–Ω–∏—Ü—è –≤—ñ–¥—Ö–∏–ª—è—î—Ç—å—Å—è –≤—ñ–¥ –Ω—É–ª—è, —Ç–æ —Ü–µ —ñ –±—É–¥–µ p-value.

:::

## p-value —ñ –±—É—Ç—Å—Ç—Ä–∞–ø {.smaller}

–ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –Ω–∞ Python –∑ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–º —Ä—ñ–∑–Ω–∏—Ü—å, –î–Ü —ñ p-value:

```{python}
#| label: bootstrap-pvalue

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.stats import norm
from tqdm import tqdm

# –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é
def get_bootstrap(
    data_column_1, # —á–∏—Å–ª–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä—à–æ—ó –≤–∏–±—ñ—Ä–∫–∏
    data_column_2, # —á–∏—Å–ª–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –¥—Ä—É–≥–æ—ó –≤–∏–±—ñ—Ä–∫–∏
    boot_it = 1000, # –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ñ—Ç–µ—Ä–∞—Ü—ñ–π –±—É—Ç—Å—Ç—Ä–µ–ø–∞
    statistic = np.mean, # —è–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—Ö—É—î–º–æ
    bootstrap_conf_level = 0.95 # —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ
):
    boot_len = max([len(data_column_1), len(data_column_2)]) # –¥–æ–≤–∂–∏–Ω–∞ –≤–∏–±—ñ—Ä–∫–∏
    boot_data = [] # –±—É–¥—É–≤–∞—Ç–∏–º–µ–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª —Ç—É—Ç
    for i in tqdm(range(boot_it)): # —Å—Ç–≤–æ—Ä—é—î–º–æ –ø—ñ–¥–≤–∏–±—ñ—Ä–∫–∏
        samples_1 = data_column_1.sample(
            boot_len, 
            replace = True # –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
        ).values
        
        samples_2 = data_column_2.sample(
            boot_len, 
            replace = True
        ).values
        
        boot_data.append(statistic(samples_1-samples_2)) # —Ä–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        
    pd_boot_data = pd.DataFrame(boot_data) # –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º
        
    left_quant = (1 - bootstrap_conf_level)/2 # –ª—ñ–≤–∞ –∫–≤–∞–Ω—Ç–∏–ª—å
    right_quant = 1 - (1 - bootstrap_conf_level) / 2 # –ø—Ä–∞–≤–∞ –∫–≤–∞–Ω—Ç–∏–ª—å
    ci = pd_boot_data.quantile([left_quant, right_quant]) # –î–Ü
    # —Ä–∞—Ö—É—î–º–æ p-value    
    p_1 = norm.cdf(
        x = 0, 
        loc = np.mean(boot_data), 
        scale = np.std(boot_data)
    )
    p_2 = norm.cdf(
        x = 0, 
        loc = -np.mean(boot_data), 
        scale = np.std(boot_data)
    )
    p_value = min(p_1, p_2) * 2 # –ø–æ–¥–≤–æ—é—î–º–æ, –±–æ –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –∫—Ä–∏—Ç–µ—Ä—ñ–π
        
    # –í—ñ–∑—É–∞–ª—ñ–∑—É—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª
    plt.hist(pd_boot_data[0], bins = 50)
    plt.vlines(ci, ymin=0, ymax=50, linestyle='--', color='red')
    plt.xlabel('boot_data')
    plt.ylabel('frequency')
    plt.title("Histogram of boot_data")
    plt.show()
       
    return {"boot_data": boot_data, 
            "ci": ci, 
            "p_value": p_value}
```

## –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ –ø—Ä–∏–∫–ª–∞–¥—É

```{python}
#| label: bootstrap-pvalue-example
#| fig-align: center
#| output-location: slide

# bootstrap
booted_data = get_bootstrap(
    data_column_1=pd.Series(control), 
    data_column_2=pd.Series(test), 
    boot_it=10000, 
    statistic=np.median, 
    bootstrap_conf_level=0.95
)

print(f'–ó–Ω–∞—á–µ–Ω–Ω—è p-value {booted_data["p_value"]}')
print(f'–î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª {booted_data["ci"]}')
```

# A/A —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è {background-color="#eef3f8"}

## –î–ª—è —á–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ A/A —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è {.smaller}

–ü–µ—Ä–µ–≤–∞–∂–Ω–æ, –∑–∞–≤–¥–∞–Ω–Ω—è A/A —Ç–µ—Å—Ç—ñ–≤ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —á–∏ –ø—Ä–∞—Ü—é—î —Å–∏—Å—Ç–µ–º–∞ —Å–ø–ª—ñ—Ç—É–≤–∞–Ω–Ω—è –∫–æ—Ä–µ–∫—Ç–Ω–æ, —á–∏ –Ω—ñ.

–í –ê/–ê-—Ç–µ—Å—Ç–∞—Ö –º–∏ —Ö–æ—á–µ–º–æ –ø—Ä–∏–π–º–∞—Ç–∏ –Ω—É–ª—å–æ–≤—É –≥—ñ–ø–æ—Ç–µ–∑—É –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ OEC (Overall Evaluation Criterion) - —á–∏ —î —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –≥—Ä—É–ø–∞–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ –∑–Ω–∞—á—É—â–æ—é:

$$ OEC_{control_{1}} = OEC_{control_{2}} $$

–ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è –≤ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏ —Å–ø–ª—ñ—Ç—É–≤–∞–Ω–Ω—è –º–æ–∂–Ω–∞ —à–ª—è—Ö–æ–º –¥–≤–æ–µ—Ç–∞–ø–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:

- **–ß–µ—Å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –º—ñ–∂ –≥—Ä—É–ø–∞–º–∏**. –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞ —á–∞—Å—Ç–∫–∞–º–∏ —ñ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó: —Å–ø–ª—ñ—Ç–æ–≤–∞–ª–∫–∞ –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –≤—ñ–¥–¥–∞–≤–∞—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –±—É–¥—å-—è–∫—ñ–π —ñ–∑ –≥—Ä—É–ø –∑–∞ –±—É–¥—å-—è–∫–æ—é –æ–∑–Ω–∞–∫–æ—é, —á–µ—Ä–µ–∑ —â–æ –º–æ–∂–µ —Å—Ç–∞—Ç–∏—Å—è –¥–∏—Å–±–∞–ª–∞–Ω—Å ‚Üí –∑–º—ñ–Ω–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó —Ç–∞ —Å–µ—Ä–µ–¥–Ω—ñ—Ö
- **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ FPR –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –±—ñ–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫**. –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö –ø—Ä–æ–∫—Ä–∞—Å—ñ–≤ –º–µ—Ç—Ä–∏–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥,
–∫–æ–Ω–≤–µ—Ä—Å—ñ—è —ñ —Å–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫) –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤–∏—â–æ—é –∑–∞ –∑–∞–¥–∞–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 5%).

## –ï—Ç–∞–ø–∏ A/A —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. –ü—Ä–æ–≤–æ–¥–∏–º–æ A/A —Ç–µ—Å—Ç. –ß–∞—Å –Ω–∞ A/A –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, —â–æ–± –æ—Ö–æ–ø–∏—Ç–∏ —è–∫–æ–º–æ–≥–∞ –±—ñ–ª—å—à–µ —Ñ–∞–∫—Ç–æ—Ä—ñ–≤ –≤–ø–ª–∏–≤—É –Ω–∞ –º–µ—Ç—Ä–∏–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ç–∏–∂–Ω–µ–≤–∞ —Å–µ–∑–æ–Ω–Ω—ñ—Å—Ç—å)
2. –°–∏–º—É–ª—é—î–º–æ –Ω–æ–≤—ñ A/A. –¢–µ—Å—Ç –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è ‚â• 10 —Ç–∏—Å. —Ä–∞–∑—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∏–º—É–ª—è—Ü—ñ—ó –Ω–æ–≤–∏—Ö "—Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–∏—Ö" A/A
3. –†–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç. –∑–Ω–∞—á—É—â—ñ—Å—Ç—å. –£ –∫–æ–∂–Ω–æ–º—É —Ç–µ—Å—Ç—ñ —Ä–∞—Ö—É—î—Ç—å—Å—è p-value –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Ü—ñ–Ω—é–≤–∞—á–∞ (–±—É—Ç—Å—Ç—Ä–∞–ø, t-—Ç–µ—Å—Ç —Ç–æ—â–æ)
4. –†–∞—Ö—É—î–º–æ –º–µ—Ç—Ä–∏–∫—É —è–∫–æ—Å—Ç—ñ FPR (False Positive Rate)
5. –†–æ–±–∏–º–æ –≤–∏—Å–Ω–æ–≤–∫–∏. –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —É–º–æ–≤–∞ FPR < $\alpha$, —ñ —è–∫—â–æ —É–º–æ–≤–∞ –¥–æ—Ç—Ä–∏–º—É—î—Ç—å—Å—è, —Ç–æ —Å–ø–ª—ñ—Ç–æ–≤–∞–ª–∫–∞ –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ

## –ü–æ–∫–∞–∑–Ω–∏–∫ —è–∫–æ—Å—Ç—ñ FPR {.smaller}

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —è–∫–æ—Å—Ç—ñ —Å–ø–ª—ñ—Ç–æ–≤–∞–ª–∫–∏ —Ä–∞—Ö—É—î–º–æ —á–∞—Å—Ç–∫—É —Ö–∏–±–Ω–æ –ø–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö –æ—Ü—ñ–Ω–æ–∫ (FPR): 

$$ FPR = \frac{FP}{FP + TN} = \frac{FP}{N_{sim}}$$

–ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ FPR –Ω–∞ –∫–æ–∂–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ: —á–∞—Å—Ç–æ—Ç–∞ —Ö–∏–±–Ω–∏—Ö –ø—Ä–æ—Ñ–∞—Ä–±–æ–≤—É–≤–∞–Ω—å –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤–∏—â–æ—é –∑–∞ –∑–∞–¥–∞–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ. FPR –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ 0.05 –¥–ª—è Œ± = 0.05. –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ —ñ –¥–ª—è 0.01, 0.005 —Ç–æ—â–æ.

## –ó–∞–≤–∏—â–µ–Ω–∏–π FPR

–û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏ –∫—Ä–∏—é—Ç—å—Å—è –≤ –∑–ª–∞–º–∞–Ω–æ–º—É —Å–ø–ª—ñ—Ç-–∞–ª–≥–æ—Ä–∏—Ç–º—ñ.

–ü—Ä–∏—á–∏–Ω–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —à—É–∫–∞—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ, –¥–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç —ñ –π–æ–≥–æ –∑–∞–ø—É—Å–∫. –ß–∞—Å—Ç—ñ –∫–µ–π—Å–∏:

- –î–æ–≤–≥–µ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å–µ—Ä–≤–µ—Ä–∞ —â–æ–¥–æ –ø—Ä–∏—Å–≤–æ—î–Ω–Ω—è id –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É —ñ —Å–ø–ª—ñ—Ç—É
- –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç —Ç—ñ–π —á–∏ —ñ–Ω—à—ñ–π –≥—Ä—É–ø—ñ
- –ù–µ –Ω–∞ –≤—Å—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö / –∫–µ–π—Å–∞—Ö —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–ø–ª—ñ—Ç-–∞–ª–≥–æ—Ä–∏—Ç–º
- –ë–∞–Ω–∞–ª—å–Ω–æ "–∑–ª–∞–º–∞–Ω–∏–π" —Ä–∞–Ω–¥–æ–º (–∑–∞–ª–∏—à–æ–∫ –≤—ñ–¥ –¥—ñ–ª–µ–Ω–Ω—è –∑–∞ —Å—É–º–æ—é —Ö–µ—à–∞?)

## –ü–æ—à—É–∫ –ø—Ä–∏—á–∏–Ω–∏

**–î–∏—Å–±–∞–ª–∞–Ω—Å —É –≥—Ä—É–ø–∞—Ö –∑–∞ –æ–ø–∏—Å–æ–≤–∏–º–∏ –æ–∑–Ω–∞–∫–∞–º–∏.**

–î–ª—è –ø–æ—à—É–∫—É –¥–∏—Å–±–∞–ª–∞–Ω—Å—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –ø–æ–¥—ñ–ª –≥—Ä—É–ø —ñ–∑ –≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –æ–∑–Ω–∞–∫. –¶—ñ–ª–∫–æ–º –ø—ñ–¥—ñ–π–¥—É—Ç—å:

- —Ä–µ–≥—ñ–æ–Ω
- –¥–∂–µ—Ä–µ–ª–æ —Ç—Ä–∞—Ñ—ñ–∫—É
- —Ç–∏–ø –±—Ä–∞—É–∑–µ—Ä–∞
- —Ç–æ—â–æ

## –°–∏–ª—å–Ω–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≥—Ä—É–ø

–î–ª—è –ø–æ—à—É–∫—É –ø—Ä–∏—á–∏–Ω–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Å—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≥—Ä–∞–¥–∞—Ü—ñ–π –º—ñ–∂ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —ñ —Ç–µ—Å—Ç–æ–º:

- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ p-value –Ω–∞ —Ä—ñ–≤–Ω—ñ $\alpha$
- –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ FPR –Ω–∞ —Ä—ñ–≤–Ω—ñ $\alpha$ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

## –ö—Ä–∏—Ç–µ—Ä—ñ–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–∏—Å–±–∞–ª–∞–Ω—Å—É

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ–∞–∫—Ç–∏—á–Ω–∏—Ö —á–∞—Å—Ç–æ–∫ –∑ —ó—Ö–Ω—ñ–º —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–º —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∫—Ä–∏—Ç–µ—Ä—ñ—ó –∑–≥–æ–¥–∏. 

–£ —Å–∏—Ç—É–∞—Ü—ñ—ó –∑ –ê/–ê –ø—ñ–¥—ñ–π–¥–µ –∫—Ä–∏—Ç–µ—Ä—ñ–π **CMH** (Cochran-Mantel-Haenszel) –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü—å —Å–ø—Ä—è–∂–µ–Ω–æ—Å—Ç—ñ **2 —Ö 2 x K**, –¥–µ *K* - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–∞–¥–∞—Ü—ñ–π –∑–∞ –∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—é –æ–∑–Ω–∞–∫–æ—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –±—Ä–∞—É–∑–µ—Ä 1, –±—Ä–∞—É–∑–µ—Ä 2 —Ç–æ—â–æ).

–í Python —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –≤ `statsmodels.stats.contingency_tables.StratifiedTable`.

## –Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è StratifiedTable {.smaller}

–ó–∞ —Å–≤–æ—î—é —Å—É—Ç—Ç—é —Å—Ç—Ä–∞—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ —è–≤–ª—è—é—Ç—å —Å–æ–±–æ—é —Ä—ñ–∑–Ω–æ–≤–∏–¥ —Ç–∞–∫ –∑–≤–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å —Å–ø—Ä—è–∂–µ–Ω–æ—Å—Ç—ñ - –º–µ—Ç–æ–¥—ñ–≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∑–∞—î–º–æ–∑–≤'—è–∑–∫—É –º—ñ–∂ –¥–≤–æ–º–∞ –Ω–æ–º—ñ–Ω–∞—Ç–∏–≤–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏.

–ê–ª–µ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –≤ —Å—Ç—Ä–∞—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö –º–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–≤–æ—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

```{python}
#| label: titanic-table

import seaborn as sns
import pandas as pd

titanic = sns.load_dataset('titanic')

pd.crosstab([titanic.sex, titanic.survived], titanic.pclass)
```

## –ü—Ä–∏–∫–ª–∞–¥ StratifiedTable {.smaller}

–°—Ç—Ä–∞—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ –≤–Ω–æ—Å—è—Ç—å —Ç—Ä–µ—Ç—ñ–π –≤–∏–º—ñ—Ä —É –ø—Ä–æ—Ü–µ—Å. –£—è–≤—ñ—Ç—å, —â–æ –º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç—É —Å–∞–º—É –≥—ñ–ø–æ—Ç–µ–∑—É –ø—Ä–æ –∑–≤'—è–∑–æ–∫ —Å—Ç–∞—Ç—ñ —Ç–∞ –≤–∏–∂–∏–≤–∞–π–º–æ—Å—Ç—ñ, –ø—Ä–æ—Ç–µ –Ω–∞–º —Ü—ñ–∫–∞–≤–æ: –∞ —á–∏ –æ–¥–Ω–∞–∫–æ–≤–∏–π —Ü–µ–π –≤–∑–∞—î–º–æ–∑–≤'—è–∑–æ–∫ —É —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å–∞—Ö? –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ, –∫–ª–∞—Å —Ç—É—Ç –±—É–¥–µ —Å—Ç—Ä–∞—Ç–∏—Ñ—ñ–∫—É—é—á–æ—é –∑–º—ñ–Ω–Ω–æ—é, —ñ –≤ –Ω–∞—Å –æ–¥—Ä–∞–∑—É –¥–≤—ñ –Ω—É–ª—å–æ–≤—ñ –≥—ñ–ø–æ—Ç–µ–∑–∏ (—è–∫—â–æ –≥—Ä—É–±–æ):

- —Ä–æ–∑–ø–æ–¥—ñ–ª —á–∞—Å—Ç–æ—Ç –∑–Ω–∞—á–µ–Ω—å –∑–º—ñ–Ω–Ω–∏—Ö —Å—Ç–∞—Ç—ñ —ñ –≤–∏–∂–∏–≤–∞–π–º–æ—Å—Ç—ñ (–∑–º—ñ–Ω–Ω—ñ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ –æ–¥–Ω–∞ –≤—ñ–¥ –æ–¥–Ω–æ—ó) —Ü–µ–π —Ä–æ–∑–ø–æ–¥—ñ–ª –æ–¥–Ω–∞–∫–æ–≤–∏–π —É –≤—Å—ñ—Ö –∫–ª–∞—Å–∞—Ö
- —Ü–µ–π —Ä–æ–∑–ø–æ–¥—ñ–ª –æ–¥–Ω–∞–∫–æ–≤–∏–π —É –≤—Å—ñ—Ö –∫–ª–∞—Å–∞—Ö

## –ü—Ä–∏–∫–ª–∞–¥ StratifiedTable {.smaller .scrollable}

```{python}
#| label: stratified-table-eval
#| eval: false

from statsmodels.stats.contingency_tables import StratifiedTable

StratifiedTable.from_data(var1='sex', var2='survived', strata='pclass', data=titanic).summary()
```

:::: {.columns}

::: {.column width="40%"}
–¢—É—Ç –Ω–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å p-value. 

- –ü–µ—Ä—à–∏–π —Ä—è–¥–æ–∫ (`Test of OR=1`) - —Ü–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥—ñ–ø–æ—Ç–µ–∑–∏ –ø—Ä–æ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –∑–º—ñ–Ω–Ω–∏—Ö,
- –î—Ä—É–≥–∏–π —Ä—è–¥–æ–∫ (`Test constant OR`) - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥—ñ–ø–æ—Ç–µ–∑–∏ –ø—Ä–æ –æ–¥–Ω–∞–∫–æ–≤—ñ—Å—Ç—å –∑–≤'—è–∑–∫—É –∑–∞ –≤—Å—ñ–º–∞ —Ä—ñ–≤–Ω—è–º–∏ —Å—Ç—Ä–∞—Ç–∏—Ñ—ñ–∫—É—é—á–æ—ó –∑–º—ñ–Ω–Ω–æ—ó. 

–¢–∞–∫, —É —Ü—ñ–π —Ç–∞–±–ª–∏—Ü—ñ –≤–∏–¥–Ω–æ, —â–æ –º—ñ–∂ –∑–º—ñ–Ω–Ω–∏–º–∏ —î –∑–≤'—è–∑–æ–∫, —ñ —Ü–µ–π –∑–≤'—è–∑–æ–∫ —Ä—ñ–∑–Ω–∏–π —É –≤—Å—ñ—Ö –∫–ª–∞—Å–∞—Ö.
:::

::: {.column width="60%"}
```{python}
#| label: stratified-table-echo
#| echo: false

from statsmodels.stats.contingency_tables import StratifiedTable

StratifiedTable.from_data(var1='sex', var2='survived', strata='pclass', data=titanic).summary()
```
:::

::::

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å

- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–∞—é—Ç—å —Ä—ñ–∑–Ω–∏–π —Å–º–∞–∫ —ñ –≤–µ–¥—É—Ç—å —Å–µ–±–µ –ø–æ —Ä—ñ–∑–Ω–æ–º—É
- –•–æ—á–µ–º–æ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ —Ä—ñ–∑–Ω—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–µ–π–ª–∏—Å—Ç—ñ–≤
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ –ø–æ–∫–∞–∑–Ω–∏–∫–∏:
  + CTR (click-through rate) - —á–∞—Å—Ç–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç
  + –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å —Å–µ—Ä–≤—ñ—Å—É
  + –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª—ñ–∫—ñ–≤ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç
  + –ß–∏ –ø–æ—á–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–ª—É—Ö–∞—Ç–∏ –ø–ª–µ–π–ª–∏—Å—Ç

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å {.smaller}

- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ –ë–µ—Ç–∞-—Ä–æ–∑–ø–æ–¥—ñ–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó CTR.
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ –ª–æ–≥–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å.
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–ª—ñ–∫—ñ–≤.
- –ë—ñ–Ω–∞—Ä–Ω—É –∑–º—ñ–Ω–Ω—É, —á–∏ –ø–æ—á–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å–ª—É—Ö–∞—Ç–∏ –ø–ª–µ–π–ª–∏—Å—Ç, –∑–≥–µ–Ω–µ—Ä—É—î–º–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

```{python}
#| label: aa-data-gen

np.random.seed(1234)

# –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
n_users = 1000

# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ CTR
mean_ctr = 0.2
beta = 20
alpha = mean_ctr * beta / (1 - mean_ctr)

# –ì–µ–Ω–µ—Ä—É—î–º–æ –¥–∞–Ω—ñ
ctr = np.random.beta(alpha, beta, size=n_users)
views = np.random.lognormal(mean=1, sigma=1, size=n_users).astype(int) + 1
clicks = np.random.binomial(n=views, p=ctr)

sessions = []
for v, c in zip(views, clicks):
    sessions += [1] * c + [0] * (v - c)
```

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å

–í—ñ–∑—É–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏ —Ç—Ä—å–æ—Ö –∑–º—ñ–Ω–Ω–∏—Ö

```{python}
#| label: aa-data-plot
#| fig-align: center
#| output-location: slide

import matplotlib.pyplot as plt
import seaborn as sns

sns.set_style('whitegrid')
sns.set_palette('colorblind')

fig, ax = plt.subplots(2, 2, figsize=(15, 7))

sns.histplot(ctr, ax=ax[0, 0])
sns.histplot(views, ax=ax[0, 1], bins=25)
sns.histplot(clicks, ax=ax[1, 0], bins=10)
sns.histplot(sessions, ax=ax[1, 1])

ax[0, 0].set_title('CTR')
ax[0, 1].set_title('Views')
ax[1, 0].set_title('Clicks')
ax[1, 1].set_title('Session')

plt.show()
display(Markdown(f'–í —Å–µ—Ä–µ–¥–Ω—å–æ–º—É {np.mean(sessions):.2%} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç'))
```

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å {.smaller}

–†–æ–∑–±–∏–≤–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –≥—Ä—É–ø–∏ —ñ –ø–æ—Ä—ñ–≤–Ω—é—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏
```{python}
#| label: aa-data-split

from statsmodels.stats.proportion import proportions_ztest

def get_pvalue(): 
    user_ctr = np.random.beta(alpha, beta, size=users_num)
    views = np.random.lognormal(mean=1, sigma=1, size=users_num).astype(int) + 1
    clicks = np.random.binomial(views, user_ctr)

    mask = np.random.rand(len(views)) < 0.5
    views_1, clicks_1 = views[mask], clicks[mask]
    views_2, clicks_2 = views[~mask], clicks[~mask]
    
    sessions_1 = []
    for v, c in zip(views_1, clicks_1):
        sessions_1 += [1] * c + [0] * (v - c) 

    sessions_2 = []
    for v, c in zip(views_2, clicks_2):
        sessions_2 += [1] * c + [0] * (v - c) 
        
    return proportions_ztest(
        count=[sum(sessions_1), sum(sessions_2)],
        nobs=[len(sessions_1), len(sessions_2)]
    )[1]
```

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å {.smaller}

–ü—Ä–æ–≤–æ–¥–∏–º–æ 10000 A/A-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤ —ñ —Ä–∞—Ö—É—î–º–æ p-value

```{python}
#| label: aa-data-pvalue
#| fig-align: center

np.random.seed(1234)

users_num = 1000
pvalues = [get_pvalue() for _ in range(10000)]

sns.histplot(pvalues)
plt.title('p-value')
plt.show()

display(Markdown(f'–í —Å–µ—Ä–µ–¥–Ω—å–æ–º—É {np.mean(np.array(pvalues) < 0.05):.2%} p-value –º–µ–Ω—à–µ 0.05'))
```

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å

- –î–∞–Ω—ñ –∑ –æ–¥–Ω—ñ—î—ó –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ
- –ê–ª–µ –ø—Ä–∏ —Ä—ñ–≤–Ω—ñ –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ $\alpha = 0.05$ –º–∏ –≤–∏—Ö–∏–ª—è—î–º–æ –Ω—É–ª—å–æ–≤—É –≥—ñ–ø–æ—Ç–µ–∑—É –≤ `{python} round(np.mean(np.array(pvalues) < 0.05) / 0.05, 2)` —Ä–∞–∑–∏ —á–∞—Å—Ç—ñ—à–µ, –Ω—ñ–∂ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è

. . .

–ß–æ–º—É —Ç–∞–∫ –≤–∏–π—à–ª–æ?

. . .

–°–µ—Å—ñ—è **–∑–∞–ª–µ–∂–∏—Ç—å** –≤—ñ–¥ –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤ —ñ –∫–ª—ñ–∫—ñ–≤ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç, –∞ –Ω–µ –≤—ñ–¥ —Ä–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏.

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å {.smaller}

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ –∫–ª—ñ–∫–∏ –º—ñ–∂ –≥—Ä—É–ø–∞–º–∏

```{python}
#| label: aa-data-split-2

from scipy.stats import mannwhitneyu

def get_pvalue(): 
    user_ctr = np.random.beta(alpha, beta, size=users_num)
    views = np.random.lognormal(mean=1, sigma=1, size=users_num).astype(int) + 1
    clicks = np.random.binomial(views, user_ctr)

    mask = np.random.rand(len(views)) < 0.5
    views_1, clicks_1 = views[mask], clicks[mask]
    views_2, clicks_2 = views[~mask], clicks[~mask]

    return mannwhitneyu(clicks_1, clicks_2)[1]
```

## –ü—Ä–∏–∫–ª–∞–¥: —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–∏–π –º—É–∑–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å {.smaller}

–ü—Ä–æ–≤–æ–¥–∏–º–æ 10000 A/A-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤ –∑–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–º —Å—Ü–µ–Ω–∞—Ä—ñ—î–º —ñ —Ä–∞—Ö—É—î–º–æ p-value

```{python}
#| label: aa-data-pvalue-2
#| fig-align: center

pvalues = [get_pvalue() for _ in range(10000)]

sns.histplot(pvalues)
plt.xlabel('p-values')
plt.show()

display(Markdown(f'–í —Å–µ—Ä–µ–¥–Ω—å–æ–º—É {np.mean(np.array(pvalues) < 0.05):.2%} p-value –º–µ–Ω—à–µ 0.05'))
```

## –ê–ª–≥–æ—Ä–∏—Ç–º –ê/–ê-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É

1. –í–∑—è—Ç–∏ –≤–∏–±—ñ—Ä–∫—É –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–±–∞–∂–∞–Ω–æ –±–µ–∑ –µ–∫—Å–ø–µ—Ä–µ–º–µ–Ω—Ç—ñ–≤)
2. –°–∏–º—É–ª—é—î–º–æ –ê/–ê-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏ (–¥–µ—Å—è—Ç–∫–∏ —Ç–∏—Å—è—á —Ä–∞–∑—ñ–≤)
3. –û—Ü—ñ–Ω—é—î–º–æ p-value —É –∫–æ–∂–Ω–æ–º—É –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ —ñ –ø–æ—Ä—ñ–≤–Ω—é—î–º–æ –∑ —Ä—ñ–≤–Ω–µ–º –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ $\alpha$
4. –û—Ü—ñ–Ω—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ –ø–µ—Ä—à–æ–≥–æ —Ä–æ–¥—É (—Ö–∏–±–Ω–æ–ø–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö) —ñ –¥–∏–≤–∏–º–æ—Å—å —Ä–æ–∑–ø–æ–¥—ñ–ª p-value
5. –ü–æ—Ä—ñ–≤–Ω—é—î–º–æ –∑ –æ—á—ñ–∫—É–≤–∞–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø–æ–º–∏–ª–æ–∫ –ø–µ—Ä—à–æ–≥–æ —Ä–æ–¥—É 

## –û–±–º–µ–∂–µ–Ω–Ω—è —ñ —ñ–Ω—à—ñ –º–æ–º–µ–Ω—Ç–∏

- –ê/–ê –±–∞–∂–∞–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç–∏ —è–∫–æ–º–æ–≥–∞ –¥–æ–≤—à–µ, —â–æ–± –¥–æ—Å—è–≥—Ç–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ—ó —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç—ñ (–æ—Ö–æ–ø–∏—Ç–∏ —Ç–∏–∂–Ω–µ–≤—É —Å–µ–∑–æ–Ω–Ω—ñ—Å—Ç—å —ñ —Ä—ñ–∑–Ω—ñ –≥—Ä—É–ø–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
- –£ —Ä–∞–∑—ñ, —è–∫—â–æ –Ω–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —á–µ–∫–∞—Ç–∏, —Ç–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ "–¥–æ–≤–≥–æ–≥—Ä–∞—é—á—ñ" –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–ø–ª—ñ—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –°2 - –∫–æ–Ω–≤–µ—Ä—Å—ñ—è –≤ –ø–æ–∫—É–ø–∫—É)
- –ü–æ—Å—Ç-—Å–∏–º—É–ª—è—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏ –±–µ–∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å —É —Å–ø–ª—ñ—Ç–∞—Ö
- –î–ª—è –ø–æ—Å—Ç-—Å–∏–º—É–ª—è—Ü—ñ–π –Ω–∞–π–∫—Ä–∞—â–µ –ø—ñ–¥—ñ–π–¥–µ –±—É—Ç—Å—Ç—Ä–∞–ø, –∑–∞–≤–¥—è–∫–∏ —Å–≤–æ—ó–π —Ç–æ—á–Ω–æ—Å—Ç—ñ

## –î–µ —â–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å A/A-—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

- A/A/B –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –≤—Ç—Ä—É—á–∞–Ω–Ω—è —ñ–Ω—à–∏—Ö (–ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö) –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤
- –ü—ñ–¥–±—ñ—Ä —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö –≥—Ä—É–ø –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º—ñ–∂ —Å–æ–±–æ—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–æ—à—É–∫ –±–ª–∏–∑—å–∫–∏—Ö —Ä–µ–≥—ñ–æ–Ω—ñ–≤)
- –°–∏–º—É–ª—è—Ü—ñ—ó –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Ü—ñ–Ω—é–≤–∞—á–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –¥–ª—è —Ç–µ—Å—Ç—É –ø—Ä–∏ —Ä—ñ–∑–Ω–∏—Ö treatment –µ—Ñ–µ–∫—Ç–∞—Ö)

# –í–∏–±—ñ—Ä –º–µ—Ç–æ–¥–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è {background-color="#eef3f8"}

## –ë–ª–æ–∫ —Å—Ö–µ–º–∞ –≤–∏–±–æ—Ä—É –º–µ—Ç–æ–¥–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è {.smaller .scrollable}

```{mermaid}
%%| label: test-choose
%%| echo: false
flowchart TD
    
    A[–¢–∏–ø –¥–∞–Ω–∏—Ö] -->|–ù–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ|B[–¢–∏–ø –ø–∏—Ç–∞–Ω–Ω—è?]
    A -->|–î–∏—Å–∫—Ä–µ—Ç–Ω—ñ|C[–•—ñ-–∫–≤–∞–¥—Ä–∞—Ç]
    B --> |–í–∑–∞—î–º–æ–∑–≤—è–∑–æ–∫| D[–ß–∏ —î –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –∑–º—ñ–Ω–Ω–∞?]
    B --> |–†—ñ–∑–Ω–∏—Ü—è| E[–†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ —á–∏–º?]
    D --> |–¢–∞–∫| F[–†–µ–≥—Ä–µ—Å—ñ–π–Ω–∏–π –∞–Ω–∞–ª—ñ–∑]
    D --> |–ù—ñ| G[–ö–æ—Ä–µ–ª—è—Ü—ñ–π–Ω–∏–π –∞–Ω–∞–ª—ñ–∑]
    G --> |–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–∏–π| T[–ö–æ—Ä–µ–ª—è—Ü—ñ—è –ü—ñ—Ä—Å–æ–Ω–∞]
    G --> |–ù–µ–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–∏–π| U[–ö–æ—Ä–µ–ª—è—Ü—ñ—è –°–ø—ñ—Ä–º–µ–Ω–∞]
    E --> |–¢–µ—Å—Ç –æ–¥–Ω–∞–∫–æ–≤–æ—Å—Ç—ñ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó| H[F —Ç–µ—Å—Ç,<br/> –¢–µ—Å—Ç –ë—Ä–∞—É–Ω–∞-–§–æ—Ä—Å–∞–π—Ç–∞,<br/> –¢–µ—Å—Ç –ë–∞—Ä—Ç–ª–µ—Ç—Ç–∞]
    E --> |–°–µ—Ä–µ–¥–Ω—ñ—Ö| I[–°–∫—ñ–ª—å–∫–∏ –≥—Ä—É–ø?]
    I --> |2| J[–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è?]
    I --> |> 2| K[–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è?]
    J --> |–¢–∞–∫| L[t-—Ç–µ—Å—Ç –¥–ª—è –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö –≤–∏–±—ñ—Ä–æ–∫,<br/> t-—Ç–µ—Å—Ç –¥–ª—è –∑–∞–ª–µ–∂–Ω–∏—Ö –≤–∏–±—ñ—Ä–æ–∫]
    J --> |–ù—ñ| M[–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –ø—Ä–∞—Ü—é—î?]
    M --> |–¢–∞–∫| L
    M --> |–ù—ñ| N[–ú–∞–Ω–Ω–∞-–£—ó—Ç–Ω—ñ,<br/> –í—ñ–ª–∫–æ–∫—Å–æ–Ω]
    K --> |–¢–∞–∫| O[ANOVA]
    K --> |–ù—ñ| P[–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –ø—Ä–∞—Ü—é—î?]
    P --> |–¢–∞–∫| O
    P --> |–ù—ñ| Q[–ö—Ä–∏—Ç–µ—Ä—ñ–π –ö—Ä–∞—Å–∫–µ–ª–∞-–£–æ–ª–ª—ñ—Å–∞]
    O --> R[–ü–æ—Å—Ç-–∞–Ω–∞–ª—ñ–∑: <br/>–¢–µ—Å—Ç –¢—å—é–∫—ñ, <br/>–ë–æ–Ω—Ñ–µ—Ä—Ä–æ–Ω—ñ]
    Q --> S[–ü–æ—Å—Ç-–∞–Ω–∞–ª—ñ–∑: <br/>–¢–µ—Å—Ç –î–∞–Ω–Ω–∞]

    style noteA opacity:0
    style noteA color:#0000
    subgraph noteA ["`**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ —É–º–æ–≤–∏:**<br/>1. –ù–æ—Ä–º–∞–ª—å–Ω—ñ—Å—Ç—å<br/>2. –†—ñ–≤–Ω—ñ—Å—Ç—å –¥–∏—Å–ø–µ—Ä—Å—ñ–π<br/>3. –ù–µ–∑–∞–ª–µ–∂–Ω—ñ, –Ω–µ–∑–º—ñ—â–µ–Ω–Ω—ñ –≤–∏–±—ñ—Ä–∫–∏`"]
    end
```

# –†–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏ {background-color="#eef3f8"}

## –†–æ–∑–±–∏—Ç—Ç—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –≥—Ä—É–ø–∏

- –û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞ --- —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É —ñ —Ç–µ—Å—Ç–æ–≤—É –≤–∏–±—ñ—Ä–∫—É —Ç–∞–∫, —â–æ–± –≤–æ–Ω–∏ –±—É–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å—Ö–æ–∂—ñ
- –î–æ—Å—è–≥–∞—î—Ç—å—Å—è –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –≥—Ä—É–ø–∏
- –†–æ–∑–±–∏—Ç—Ç—è –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –≤—ñ–¥—Ç–≤–æ—Ä—é–≤–∞–Ω–∏–º
- –ó–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–ª—ñ–∑—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è [—Ö–µ—à-—Ñ—É–Ω–∫—Ü—ñ—ó]{.hi} –≤—ñ–¥ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø–µ–≤–Ω–æ—é [—Å—ñ–ª–ª—é]{.purple}

## –•–µ—à-—Ñ—É–Ω–∫—Ü—ñ—è —Ç–∞ —Å—ñ–ª—å

- –•–µ—à-—Ñ—É–Ω–∫—Ü—ñ—è - —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –±—É–¥—å-—è–∫–∏–π –æ–±'—î–∫—Ç –Ω–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –Ω–∞–±—ñ—Ä –±–∞–π—Ç—ñ–≤
- –•–µ—à-—Ñ—É–Ω–∫—Ü—ñ—è –º–∞—î –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å, —â–æ –ø—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö –≤–æ–Ω–∞ –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°—ñ–ª—å - —Ü–µ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —è–∫–∏–π –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- –°—ñ–ª—å –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö–µ—à-—Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—â–æ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è

## –ü—Ä–∏–∫–ª–∞–¥ {.smaller}

–ó–≥–µ–Ω–µ—Ä—É—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è —Ä–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏:

```{python}
#| label: data-gen

import pandas as pd
import numpy as np

np.random.seed(1234)

n_users = 1000

user_id = np.random.choice(range(1000), size=n_users, replace=False)

df = pd.DataFrame({'user_id': user_id})
df.head()
```

## –ü—Ä–∏–∫–ª–∞–¥ {.smaller}

–í–∏–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ md5-—Ö–µ—à-—Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è —Ä–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏:

```{python}
#| label: hash

import hashlib

# –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
salt = 'test'
user = 'id_999'

# –û–±'—î–¥–Ω—É—î–º–æ –¥–∞–Ω—ñ
value_str = user + salt

# –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –≤ –±–∞–π—Ç–∏
value_num = int(hashlib.md5(value_str.encode('utf-8')).hexdigest(), 16)

# –†–æ–∑–±–∏–≤–∞—î–º–æ –Ω–∞ –≥—Ä—É–ø–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ—Å—Ç–∞—á—ñ –≤—ñ–¥ –¥—ñ–ª–µ–Ω–Ω—è
value_num % 100
```

## –ü—Ä–∏–∫–ª–∞–¥ {.smaller}

–ó–∞—Å—Ç–æ—Å—É—î–º–æ –¥–æ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

```{python}
#| label: hash-apply

# –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è —Ä–æ–∑–±–∏—Ç—Ç—è –Ω–∞ –≥—Ä—É–ø–∏
def hash_group(user_id, salt, n_groups):
    value_str = str(user_id) + str(salt)
    value_num = int(hashlib.md5(value_str.encode()).hexdigest(), 16)
    return value_num % n_groups

salt = 'test_1'
n_groups = 2

# –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
df['group'] = df['user_id'].apply(hash_group, args=(salt, n_groups))

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
df['group'].value_counts()
```

## –ü—Ä–∏–∫–ª–∞–¥ {.smaller}

```{python}
#| label: aa-del-group
#| include: false

# –í–∏–¥–∞–ª—è—î–º–æ –≥—Ä—É–ø—É
df.drop('group', axis=1, inplace=True)
```

```{python}
#| label: aa

np.random.seed(1234)

# –ß–∏ –∫–ª—ñ–∫–Ω—É–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ —Ä–µ–∫–ª–∞–º—É
df['clicks'] = np.random.choice(range(2), size=n_users, replace=True)

# –†–æ–∑–±–∏–≤–∞—î–º–æ –Ω–∞ –≥—Ä—É–ø–∏
df['aa_1'] = df['user_id'].apply(hash_group, args=('aa_1', n_groups))
df['aa_2'] = df['user_id'].apply(hash_group, args=('aa_2', n_groups))
df['aa_3'] = df['user_id'].apply(hash_group, args=('aa_3', n_groups))

df.head()
```

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–ø–ª—ñ—Ç—ñ–≤

- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ—Å–Ω–æ–≤–Ω—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ—Å—Ç—å
- –†–æ–∑–º—ñ—Ä –≥—Ä—É–ø –º–∞—î –±—É—Ç–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–ª–∏–∑—å–∫–∏–º –æ–¥–∏–Ω –¥–æ –æ–¥–Ω–æ–≥–æ
- –í–∞–∂–ª–∏–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Ä–æ–∑–º—ñ—Ä–∏ –æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∏—Ö –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤, —Ç–æ–±—Ç–æ –∫–æ–ª–∏ –ø—Ä–æ–≤–æ–¥—è—Ç—å—Å—è –¥–≤–∞ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏, –∞–ª–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ä–æ–∑–±–∏–≤–∞—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä—ñ–∑–Ω–∏—Ö —Å–æ–ª–µ–π.

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é {.smaller}

–ó–≥–µ–Ω–µ—Ä—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É:

```{python}
#| label: power

users_num = 1000

mean_user_ctr = 0.2
beta = 20

def get_clicks(effect=0.01):
    new_mean_user_ctr = mean_user_ctr + effect
    alpha = new_mean_user_ctr * beta / (1 - new_mean_user_ctr)
    user_ctr = np.random.beta(alpha, beta, size=users_num)
    views = np.random.lognormal(mean=1, sigma=1, size=users_num).astype(int) + 1
    return np.random.binomial(views, user_ctr)

def get_pvalue(): 
    clicks_1 = get_clicks(effect=0)
    clicks_2 = get_clicks(effect=0.03)
    return mannwhitneyu(clicks_1, clicks_2)[1]

pvalues = [get_pvalue() for _ in range(10000)]
```

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é {.smaller}

–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–∑–ø–æ–¥—ñ–ª—É p-value:

```{python}
#| label: power-plot
#| fig-align: center

sns.histplot(pvalues)
plt.xlabel('p-values')
plt.show()

display(Markdown(f'–í —Å–µ—Ä–µ–¥–Ω—å–æ–º—É {np.mean(np.array(pvalues) < 0.05):.2%} p-value –º–µ–Ω—à–µ 0.05'))
```

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é {.smaller}

–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é –ø—Ä–∏ –æ—Ü—ñ–Ω—Ü—ñ —á–∏—Å–ª–∞ –∫–ª—ñ–∫—ñ–≤:

```{python}
#| label: power-plot-2
#| fig-align: center
#| output-location: slide

from scipy.stats import rankdata

sorted_pvalues = np.sort(pvalues)
position = rankdata(sorted_pvalues, method='ordinal')
cdf = position / sorted_pvalues.shape[0]
sorted_data = np.hstack((sorted_pvalues, 1))
cdf = np.hstack((cdf, 1))

plt.plot(sorted_data, cdf, linestyle='solid')
plt.axvline(0.05, color='k', alpha=0.5)
plt.xlim(-0.05,1.02)
plt.ylim(-0.02,1.02)
plt.xlabel(r'$\alpha$')
plt.ylabel('–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å')
plt.title('–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é –ú–∞–Ω–Ω–∞-–£—ñ—Ç–Ω—ñ –ø—Ä–∏ –æ—Ü—ñ–Ω—Ü—ñ —á–∏—Å–ª–∞ –∫–ª—ñ–∫—ñ–≤')
plt.tight_layout()
plt.savefig('power.pdf')
plt.show()

display(Markdown(f'–ß–∏–º –≤–∏—â–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é, —á–∞—Å—Ç—ñ—à–µ –º–∏ –ø—Ä–∏–ø—É—Å–∫–∞—î–º–æ –ø–æ–º–∏–ª–∫–∏ –ø–µ—Ä—à–æ–≥–æ —Ä–æ–¥—É.\n–¢–æ–±—Ç–æ –¥–ª—è –¥–∞–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É, –ø—Ä–∏–±–ª–∏–∑–Ω–æ —É 65% –≤–∏–ø–∞–¥–∫—ñ–≤ –º–∏ –∑–º–æ–∂–µ–º–æ –≤–∏—è–≤–∏—Ç–∏ –µ—Ñ–µ–∫—Ç, –∞ —É 35% –≤–∏–ø–∞–¥–∫—ñ–≤ - –Ω—ñ.'))
```

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é

–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:

- **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é**
  + –ö—Ä–∏—Ç–µ—Ä—ñ—ó, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ä–∞–Ω–≥–∏, –º–∞—é—Ç—å –±—ñ–ª—å—à—É –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å
  + –ö—Ä–∏—Ç–µ—Ä—ñ—ó, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è, –º–∞—é—Ç—å –º–µ–Ω—à—É –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å

–°–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏, —è–∫—ñ –∫—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å –∫—Ä–∞—â–µ –¥–ª—è –Ω–∞—à–∏—Ö –¥–∞–Ω–∏—Ö

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é

–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:

- **–î–∏—Å–ø–µ—Ä—Å—ñ—ó –¥–∞–Ω–∏—Ö**

```{python}
#| label: power-plot-3
#| fig-align: center
#| echo: false
#| layout-ncol: 2

from scipy.stats import lognorm, norm

x = np.linspace(-7, 15, 100)

pdf = norm(loc=3, scale=3).pdf(x)
plt.plot(x, pdf, label='control')

pdf = norm(loc=4, scale=3).pdf(x)
plt.plot(x, pdf, label='test')

plt.legend(loc=1)
plt.tight_layout()
plt.show()


x = np.linspace(-7, 15, 100)

pdf = norm(loc=3, scale=1).pdf(x)
plt.plot(x, pdf, label='control')

pdf = norm(loc=4, scale=1).pdf(x)
plt.plot(x, pdf, label='test')

plt.legend(loc=1)
plt.tight_layout()
plt.show()
```

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é

–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:

- **–†–æ–∑–º—ñ—Ä –µ—Ñ–µ–∫—Ç—É** --- —á–∏–º –±—ñ–ª—å—à–∏–π –µ—Ñ–µ–∫—Ç, —Ç–∏ –ª–µ–≥—à–µ –π–æ–≥–æ –≤–∏—è–≤–∏—Ç–∏

```{python}
#| label: power-plot-4
#| fig-align: center
#| echo: false
#| layout-ncol: 2

x = np.linspace(-7, 15, 100)

pdf = norm(loc=3, scale=3).pdf(x)
plt.plot(x, pdf, label='control')

pdf = norm(loc=4, scale=3).pdf(x)
plt.plot(x, pdf, label='test')

plt.legend(loc=1)
plt.tight_layout()
plt.show()

x = np.linspace(-7, 15, 100)

pdf = norm(loc=3, scale=3).pdf(x)
plt.plot(x, pdf, label='control')

pdf = norm(loc=6, scale=3).pdf(x)
plt.plot(x, pdf, label='test')

plt.legend(loc=1)
plt.tight_layout()
plt.show()
```

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é {.smaller}

–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:

- **–†–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫–∏** --- —á–∏–º –±—ñ–ª—å—à–∞ –≤–∏–±—ñ—Ä–∫–∞, —Ç–∏–º –ª–µ–≥—à–µ –≤–∏—è–≤–∏—Ç–∏ –µ—Ñ–µ–∫—Ç

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∫—Ä–∏—Ç–µ—ñ—é –°—Ç—é–¥–µ–Ω—Ç–∞ --- –∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è –ø—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ –≤–∏–±—ñ—Ä–∫–∏

$$T_N=\frac{\overline{X}-\mu}{\frac{S}{\sqrt{N}}}$$

–£ —Ü—å–æ–º—É –∫—Ä–∏—Ç–µ—Ä—ñ—é –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑—Ä–æ—Å—Ç–∞—é –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–æ $\sqrt{N}$, —Ç–æ–±—Ç–æ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –∑–º–µ–Ω—à–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É –≤–¥–≤—ñ—á—ñ, –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ –≤–∏–±—ñ—Ä–∫—É –≤ —á–æ—Ç–∏—Ä–∏ —Ä–∞–∑–∏

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ –ê/–ê-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏ {.smaller}

–¢–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –æ—Ü—ñ–Ω—é–≤–∞—Ç–∏ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é —á–µ—Ä–µ–∑ –ê/–ê-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏. –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:

–®—Ç—É—á–Ω–æ –±—É–¥–µ–º–æ –∑–±—ñ–ª—å—à–∏–º–æ –µ—Ñ–µ–∫—Ç –¥–ª—è –æ–¥–Ω—ñ—î—ó –≥—Ä—É–ø–∏:

```{python}
#| label: power-aa

users_num = 1000

mean_user_ctr = 0.2
beta = 20

def get_clicks(effect=0.01):
    new_mean_user_ctr = mean_user_ctr + effect
    alpha = new_mean_user_ctr * beta / (1 - new_mean_user_ctr)
    user_ctr = np.random.beta(alpha, beta, size=users_num)
    views = np.random.lognormal(mean=1, sigma=1, size=users_num).astype(int) + 1
    return np.random.binomial(views, user_ctr)

def get_pvalue(effect):
    clicks_1 = get_clicks(effect=0)
    clicks_2 = get_clicks(effect=effect)
    return mannwhitneyu(clicks_1, clicks_2)[1]
```

## –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ –ê/–ê-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏ {.smaller .scrollable}

–ü—Ä–æ–≤–æ–¥–∏–º–æ 10000 –ê/–ê-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤, —Ä–∞—Ö—É—î–º–æ p-value —ñ –æ—Ü—ñ–Ω—é—î–º–æ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—é:

```{python}
#| label: power-aa-plot
#| fig-align: center
#| output-location: slide

np.random.seed(1)
effects = np.arange(0, 0.07, 0.01)
power = []

for effect in effects:
    pvalues = [get_pvalue(effect=effect) for _ in range(1000)]
    power.append(np.mean(np.array(pvalues) < 0.05))

plt.plot(effects, power, 'o-')
plt.xlabel('–ï—Ñ–µ–∫—Ç')
plt.ylabel('–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å')
plt.show()
```

- –ö–æ–ª–∏ –µ—Ñ–µ–∫—Ç –º–∞–ª–µ–Ω—å–∫–∏–π, —Ç–æ —ñ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –±–ª–∏–∑—å–∫–∞ –¥–æ –Ω—É–ª—è.
- –ö–æ–ª–∏ –µ—Ñ–µ–∫—Ç –∑—Ä–æ—Å—Ç–∞—î, —Ç–æ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –Ω–∞–±–ª–∏–∂–∞—î—Ç—å—Å—è –¥–æ 1
- –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏, —â–æ–± –Ω–µ –≤–∏—è–≤–∏–ª–æ—Å—è, —â–æ –≤–æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å 20% - —Ç—ñ–ª—å–∫–∏ –∫–æ–∂–µ–Ω 5-–π —É—Å–ø—ñ—à–Ω–∏–π –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –º–æ–∂–µ –±—É—Ç–∏ –¥–µ—Ç–µ–∫—Ç—É–≤–∞–Ω–∏–π.
- –ù–µ–≤–µ–ª–∏–∫—ñ –µ—Ñ–µ–∫—Ç–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–æ—Ñ–∞—Ä–±–æ–≤—É—é—Ç—å –Ω–∞—Å–∏–ª—É - –Ω–µ–≤–µ–ª–∏–∫—ñ –µ—Ñ–µ–∫—Ç–∏ –Ω–∞–≤—Ä—è–¥ —á–∏ –¥–æ–ø–æ–º–æ–∂—É—Ç—å –Ω–∞—à—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó –≤–∏—Ä–æ—Å—Ç–∏.


# –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É {background-color="#eef3f8"}

## –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É

–†–æ–∑–º—ñ—Ä –≤–∏–±—ñ—Ä–∫–∏ –≤–∏–∑–Ω–∞—á–∞—î —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É.

–Ø–∫—â–æ –º–∏ —Ö–æ—á–µ–º–æ –≤–∏—è–≤–∏—Ç–∏ –µ—Ñ–µ–∫—Ç 1%, —Ç–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—ñ–±—Ä–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö, –Ω—ñ–∂ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –µ—Ñ–µ–∫—Ç—É 10%

–¢–æ–±—Ç–æ –≤ –Ω–∞—Å —î –¥–≤—ñ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:

- –ó–±—ñ–ª—å—à–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –≤–∏–±—ñ—Ä–∫–∏
- –ó–±—ñ–ª—å—à–∏—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É

## –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É

–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–æ—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞–ª—å–Ω–æ—ó —Å—É–∫—É–ø–Ω–æ—Å—Ç—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –ø–æ–≤–Ω—ñ —Ç–∏–∂–Ω—ñ.

–°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –Ω–∞–º —Ç—Ä–µ–±–∞?

. . .

–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç, —è–∫–∏–π –º–æ–∂–Ω–∞ –≤–∏—è–≤–∏—Ç–∏ (MDE, –∞–Ω–≥–ª. *Minimal detectable effect*)

## MDE {.smaller}

MDE - —Ü–µ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç, —è–∫–∏–π –º–∏ –∑–º–æ–∂–µ–º–æ –≤–∏—è–≤–∏—Ç–∏ –¥–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ $\alpha$ —Ç–∞ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –∫—Ä–∏—Ç–µ—Ä—ñ—é $\beta$.

–í–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é –æ–∫—Ä–µ–º–æ.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∫—Ä–∏—Ç–µ—Ä—ñ—é –°—é–¥–µ–Ω—Ç–∞:

$$\delta = (t_{1-\alpha/2} + t_{\beta}) \sigma\frac{2}{\sqrt{N}}$$

- –ß–∏–º –º–µ–Ω—à–∏–π —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞—á—É—â–æ—Å—Ç—ñ, —Ç–∏–º –±—ñ–ª—å—à—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–≤–∞–Ω—Ç–∏–ª—è —É t-—Ä–æ–∑–ø–æ–¥—ñ–ª—É –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ.
- –ß–∏–º –±—ñ–ª—å—à—É –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –º–∏ —Ö–æ—á–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏, —Ç–∏–º –±—ñ–ª—å—à–∏–π –∫–≤–∞–Ω—Ç–∏–ª—å t-—Ä–æ–∑–ø–æ–¥—ñ–ª—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∑—è—Ç–∏.
- –ß–∏–º –±—ñ–ª—å—à–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—è –≤ –¥–∞–Ω–∏—Ö, —Ç–∏–º –µ—Ñ–µ–∫—Ç –±—ñ–ª—å—à–∏–π. –ß–∏–º –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö - —Ç–∏–º –º–µ–Ω—à–∏–π MDE.

## MDE

–Ø–∫—â–æ –º–∏ –∑–Ω–∞—î–º–æ —Ä–æ–∑–ø–æ–¥—ñ–ª –º–µ—Ç—Ä–∏–∫, —è–∫–∞ –≤ –Ω–∏—Ö –¥–∏—Å–ø–µ—Ä—Å—ñ—è, —è–∫—É –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —Ö–æ—á–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ —è–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ–º–æ - –º–∏ –º–æ–∂–µ–º–æ –æ–±—á–∏—Å–ª–∏—Ç–∏ MDE.

```{python}
#| label: mde

N = 10000
sigma = 5
alpha = 0.05
power = 0.8

from scipy.stats import t

S = sigma * np.sqrt(2 / N)
M = t(N-1).ppf(q=1-alpha/2) + t(N-1).ppf(q=power)
S * M
```

–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –µ—Ñ–µ–∫—Ç, —è–∫–∏–π –º–æ–∂–Ω–∞ –≤–∏—è–≤–∏—Ç–∏, —Å–∫–ª–∞–¥–∞—î `{python} round(S * M, 2)`.

## MDE {.smaller}

–ì—Ä–∞—Ñ—ñ–∫ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ MDE –≤—ñ–¥ —Ä–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫–∏:

```{python}
#| label: mde-plot
#| fig-align: center
#| output-location: slide

def calc_mde(N):
    S = sigma * np.sqrt(2 / N)
    M = t(N-1).ppf(q=1-alpha/2) + t(N-1).ppf(q=power)
    return M * S

x = np.linspace(100, 10000, 100)
mde = [calc_mde(n) for n in x]

plt.plot(x, mde)
plt.xlabel('N')
plt.ylabel('MDE')
plt.title('sigma=5, alpha=0.05, power=0.8')
plt.tight_layout()
plt.show()
```

## –†–æ–∑–º—ñ—Ä –≤–∏–±—ñ—Ä–∫–∏

–£ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –±—ñ–∫ –º–æ–∂–Ω–∞ –∑–∞ –æ—á—ñ–∫—É–≤–∞–Ω–∏–º –µ—Ñ–µ–∫—Ç–æ–º –æ–±—á–∏—Å–ª–∏—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –≤–∏–±—ñ—Ä–∫–∏:

$$N = \frac{2\sigma^2(t_{1-\alpha/2} + t_{\beta})^2}{effect^2}$$

# –ú–µ—Ç–æ–¥–∏ –∑–º–µ–Ω—à–µ–Ω–Ω—è –¥–∏—Å–ø–µ—Ä—Å—ñ—ó {background-color="#eef3f8"}

## –©–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å

- –í–∏–±—ñ—Ä –∫—Ä–∏—Ç–µ—Ä—ñ—é
- –í–µ–ª–∏—á–∏–Ω–∞ –µ—Ñ–µ–∫—Ç—É
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å
- –î–∏—Å–ø–µ—Ä—Å—ñ—è –¥–∞–Ω–∏—Ö

## –©–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å

- –í–∏–±—ñ—Ä –∫—Ä–∏—Ç–µ—Ä—ñ—é - –±–µ—Ä–µ–º–æ –∫—Ä–∞—â—ñ–π
- –í–µ–ª–∏—á–∏–Ω–∞ –µ—Ñ–µ–∫—Ç—É - —è–∫–∞ —î
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å - —á–∏–º –±—ñ–ª—å—à–µ, —Ç–∏–º –∫—Ä–∞—â–µ
- –î–∏—Å–ø–µ—Ä—Å—ñ—è –¥–∞–Ω–∏—Ö - ?

## –í–µ–ª–∏—á–∏–Ω–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó

- –ß–∏–º –±—ñ–ª—å—à–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—è, —Ç–∏–º —Å–∫–ª–∞–¥–Ω—ñ—à–µ –≤–∏—è–≤–∏—Ç–∏ –µ—Ñ–µ–∫—Ç

```{python}
#| label: power-plot-new
#| fig-align: center
#| echo: false
#| layout-ncol: 2

from scipy.stats import lognorm, norm

x = np.linspace(-7, 15, 100)

pdf = norm(loc=3, scale=3).pdf(x)
plt.plot(x, pdf, label='control')

pdf = norm(loc=4, scale=3).pdf(x)
plt.plot(x, pdf, label='test')
plt.ylim(0, 0.45)
plt.legend(loc=1)
plt.tight_layout()
plt.show()


x = np.linspace(-7, 15, 100)

pdf = norm(loc=3, scale=1).pdf(x)
plt.plot(x, pdf, label='control')

pdf = norm(loc=4, scale=1).pdf(x)
plt.plot(x, pdf, label='test')
plt.ylim(0, 0.45)
plt.legend(loc=1)
plt.tight_layout()
plt.show()
```

## –î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª

- –î–æ–≤—ñ—Ä—á–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª - —Ü–µ —ñ–Ω—Ç–µ—Ä–≤–∞–ª, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –∑ –∑–∞–¥–∞–Ω–æ—é –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é

$$ \overline{X} \pm t_{N-1,1-\frac{\alpha}{2}} \frac{S}{\sqrt{N}}$$

## CUPED

–£—è–≤—ñ–º–æ, —â–æ –≤ –Ω–∞—Å —î 2 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ:

- –î–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –≤ –ø–µ—Ä—à–æ–≥–æ –±—É–ª–æ 3 –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Ç—Ä–µ–∫—ñ–≤, —É –¥—Ä—É–≥–æ–≥–æ - 15
- –ü—ñ–¥ —á–∞—Å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É —Å—Ç–∞–ª–æ 4 —ñ 16 –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ
- –î–∏—Å–ø–µ—Ä—Å—ñ—è –ø–æ–º—ñ—Ç–Ω–æ –±—ñ–ª—å—à–∞, –Ω—ñ–∂ –µ—Ñ–µ–∫—Ç
- –Ø–∫ –Ω–∞–º –≤–∏–∫–ª—é—á–∏—Ç–∏ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∞ –¥–∏–≤–∏—Ç–∏—Å—è –Ω–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—É –∑–º—ñ–Ω—É?

## CUPED

- –í–∏–∫–ª—é—á–∞—î–º–æ –µ—Ñ–µ–∫—Ç —ñ–∑ –º–µ—Ç—Ä–∏–∫–∏
- –í–≤–æ–¥–∏–º–æ –Ω–æ–≤—É –º–µ—Ç—Ä–∏–∫—É:

$$ Y_{cuped} = Y - \theta X$$

- $Y$ - –ø–æ—á–∞—Ç–∫–æ–≤–∞ –º–µ—Ç—Ä–∏–∫–∞
- $X$ - –¥–µ—è–∫–∏–π –ø–æ–∫–∞–∑–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–æ—Ç—Ä–∞–ø–ª—è–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –≥—Ä—É–ø—É
- $\theta$ - –∑–∞–≥–∞–ª—å–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä

–©–æ –∑–∞ $X$ —ñ –¥–µ –≤–∑—è—Ç–∏ $\theta$?

## CUPED

–î–∏—Å–ø–µ—Ä—Å—ñ—è –Ω–æ–≤–æ—ó –º–µ—Ç—Ä–∏–∫–∏:

$$Var(Y_{cuped}) = Var(Y) + \theta^2 Var(X) - 2\theta Cov(Y, X)$$

—Ç–æ–¥—ñ:

$$\theta = \frac{Cov(Y, X)}{Var(X)}$$

## CUPED

$$\theta = \frac{Cov(Y, X)}{Var(X)}$$

–ü—ñ–¥—Å—Ç–≤–∏–º–æ:

$$ Var(Y_{cuped}) = Var(Y) + \theta^2 Var(X) - 2\theta Cov(Y, X) = \\ Var(Y) + \frac{Cov(Y, X)^2}{Var(X)} - 2\frac{Cov(Y, X)^2}{Var(X)} = \\ Var(Y) - \frac{Cov(Y, X)^2}{Var(Y)Var(X)} = Var(Y)(1 - \rho^2(Y,X))$$

## CUPED

- –ó–≤—ñ—Ç–∫–∏ –≤–∑—è—Ç–∏ $X$? –Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫, —â–æ–± –µ–∫—Å–ø–µ—Ä–µ–º–µ–Ω—Ç –Ω–∞ –Ω—å–æ–≥–æ –Ω–µ –≤–ø–ª–∏–≤–∞–≤?

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∑—è—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É:

$$Y_{cuped}= Y - \frac{Cov(Y, Y_{prev})}{Var(Y_{prev})}Y_{prev}$$

–∞–±–æ

$$Y_{cuped}= Y - \frac{Cov(Y, Y_{prev})}{Var(Y_{prev})}(Y_{prev}-\overline{Y_{prev}})$$

## CUPED: –ø—Ä–∏–∫–ª–∞–¥ {.smaller}

- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ–±–ª—è—Ç—å –ø–æ–∫—É–ø–∫–∏
- –£ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ä—ñ–∑–Ω–∞ —Å–µ—Ä–µ–¥–Ω—è —Å—É–º–∞ –∫–æ—Ä–∑–∏–Ω–∏ —ñ —î —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –ø–æ–∫—É–ø–∫–∞–º–∏

```{python}
#| label: cuped

np.random.seed(1234)

users_num = 1000

df = pd.DataFrame()
df['user'] = range(users_num)
df['group'] = np.random.rand(users_num) < 0.5

df['user_mean'] = np.random.uniform(400, 1000, size=users_num)
df['cost_before'] = df['user_mean'] + np.random.normal(0, 50, size=users_num)
df['cost'] = df['user_mean'] + np.random.normal(0, 50, size=users_num)
df.head()
```

## CUPED: –ø—Ä–∏–∫–ª–∞–¥ {.smaller}

–†–∞—Ö—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä $\theta$:

$$\theta = \frac{Cov(Y, X)}{Var(X)}$$

```{python}
#| label: cuped-2

theta = np.cov(df['cost'], df['cost_before'])[0, 1] / np.var(df['cost_before'])
theta
```

–°—Ç–∏–≤–∏–º–æ –Ω–æ–≤—É –º–µ—Ç—Ä–∏–∫—É:

$$Y_{cuped}= Y - \frac{Cov(Y, Y_{prev})}{Var(Y_{prev})}(Y_{prev}-\overline{Y_{prev}})$$

```{python}
#| label: cuped-3

df['cost_cuped'] = df['cost'] - theta * (df['cost_before'] - df['cost_before'].mean())
```

## CUPED: –ø—Ä–∏–∫–ª–∞–¥ {.smaller}

–ü–æ—Ä—ñ–≤–Ω—è—î–º–æ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ—ó –≥—Ä—É–ø–∏ —ñ –≤—ñ–¥—Å–æ—Ç–æ–∫ –∑–º–µ–Ω—à–µ–Ω–Ω—è –¥–∏—Å–ø–µ—Ä—Å—ñ—ó:

```{python}
#| label: cuped-4

df.groupby('group').agg({'cost': np.var, 'cost_cuped': np.var}) \
  .assign(diff=lambda x: (x['cost'] / x['cost_cuped']))
```

## CUPED: –ø—ñ–¥—Å—É–º–∫–∏ {.smaller}

- –î–æ–ø–æ–º–∞–≥–∞—î –∑–º–µ–Ω—à–∏—Ç–∏ –¥–∏—Å–ø–µ—Ä—Å—ñ—é –Ω–∞ 20-30%
- –ö–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –¥–∏—Å–ø–µ—Ä—Å–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫, –Ω–∞ –º–µ–Ω—à –¥–∏—Å–ø–µ—Ä—Å–Ω–∏—Ö –º–æ–∂–µ –¥–∞–≤–∞—Ç–∏ –±–ª–∏–∑—å–∫–æ–Ω—É–ª—å–æ–≤–∏–π –±—É—Å—Ç
- –ó–±–µ—Ä—ñ–≥–∞—î –µ—Ñ–µ–∫—Ç —ñ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—î–º–æ (–≤–∑—è–ª–∏ –Ω–æ–≤—É –º–µ—Ç—Ä–∏–∫—É, —è–∫–∞ –≤–∏—á–∏—â–µ–Ω–∞ —Å—Ç–∞—Ä–∞)

# A/B —Ç–µ—Å—Ç–∏ —ñ –≤—ñ–¥–Ω–æ—Å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏ {background-color="#eef3f8"}

## –í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è –∫–ª—ñ–∫—ñ–≤

- –ë—ñ–ª—å—à–∞ —á–∞—Å—Ç–∏–Ω–∞ –º–µ—Ç—Ä–∏–∫ —î –±—ñ–Ω–∞—Ä–Ω–æ—é: –∫–ª—ñ–∫–Ω—É–≤ —á–∏ –Ω—ñ, –∫—É–ø–∏–≤ —á–∏ –Ω—ñ, –ø—ñ–¥–ø–∏—Å–∞–≤—Å—è —á–∏ –Ω—ñ
- –Ø–∫—â–æ –º–∏ –≤–∏–º—ñ—Ä—é—î–º–æ –∫–ª—ñ–∫–∏, —Ç–æ –º–∏ –º–æ–∂–µ–º–æ –≤–∏–º—ñ—Ä—è—Ç–∏ —ó—Ö —è–∫ –∞–±—Å–æ–ª—é—Ç–Ω—É –≤–µ–ª–∏—á–∏–Ω—É, —Ç–∞–∫ —ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ –¥–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ–∫–∞–∑—ñ–≤
- –•–æ—á–µ—Ç—å—Å—è –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ CTR (click-through rate) - –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –∫–ª—ñ–∫—ñ–≤ –¥–æ –ø–æ–∫–∞–∑—ñ–≤:
  + –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –≤—Å—å–æ–≥–æ —Å–∞–π—Ç—É
  + –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –æ–∫—Ä–µ–º–æ —ñ —É—Å–µ—Ä–µ–¥–Ω–∏—Ç–∏

$$CTR = \frac{clicks}{views}$$

## –î–∞–Ω—ñ

–ó–≥–µ–Ω–µ—Ä—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥—É:

```{python}
#| label: ctr

np.random.seed(1234)

users_num = 10000

mean_user_ctr = 0.2
beta = 20
alpha = mean_user_ctr * beta / (1 - mean_user_ctr)

df = pd.DataFrame()
df['user'] = range(users_num)
df['group'] = np.random.rand(users_num) < 0.5

df['base_user_ctr'] = np.random.beta(alpha, beta, size=users_num)
df['views'] = np.random.lognormal(mean=1, sigma=1, size=users_num).astype(int) + 1
df['clicks'] = np.random.binomial(df['views'], df['base_user_ctr'])
```

## –î–∞–Ω—ñ: –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è {.smaller}

```{python}
#| label: ctr-plot
#| fig-align: center
#| layout-ncol: 2

sns.histplot(df['views'], bins=20)
plt.xlabel('views')
plt.show()

sns.histplot(df['clicks'], bins=15)
plt.xlabel('clicks')
plt.show()
```

## –Ø–∫ –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ CTR

**–ù–∞—ó–≤–Ω–æ:**

- –ö–æ–∂–µ–Ω –∫–ª—ñ–∫ --- —Ü–µ –≤–∏–ø–∞–¥–∫–æ–≤–∞ –≤–µ–ª–∏—á–∏–Ω–∞ –∑ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –ë–µ—Ä–Ω—É–ª–ª—ñ
- –î–∞–≤–∞–π—Ç–µ –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ –¥–≤—ñ –≥—Ä—É–ø–∏ –∑–∞ —Ä—ñ–≤–Ω—ñ—Å—Ç—é $p$ –≤ —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ –ë–µ—Ä–Ω—É–ª–ª—ñ
- –ö—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç: Z-–∫—Ä–∏—Ç–µ—Ä—ñ–π –¥–ª—è —Ä—ñ–∑–Ω–∏—Ü—ñ –¥–≤–æ—Ö –¥–æ–ª–µ–π

. . .

**–ê–ª–µ:**

- –ü–æ—Ä—É—à—É—î—Ç—å—Å—è –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å --- –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ –ø–æ–º–∏–ª–∫–∏ –ø–µ—Ä—à–æ–≥–æ —Ä–æ–¥—É

. . .

**–í—Å–µ –ø—Ä–æ–ø–∞–ª–æ...**

## –Ø–∫ –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ CTR {.smaller}

**–ü–æ—Ä—ñ–≤–Ω—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª—ñ–∫—ñ–≤:**

- –†–∞—Ö—É—î–º–æ –ø–æ –∫–æ–∂–Ω–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª—ñ–∫—ñ–≤
- –ü–æ—Ä—ñ–≤–Ω—é—î–º–æ –¥–≤—ñ –≥—Ä—É–ø–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é t-–∫—Ä–∏—Ç–µ—Ä—ñ—é –°—Ç—é–¥–µ–Ω—Ç–∞ –∞–±–æ U-–∫—Ä–∏—Ç–µ—Ä—ñ—é –ú–∞–Ω–Ω–∞-–£—ñ—Ç–Ω—ñ

```{python}
#| label: clicks-ctr

from scipy.stats import mannwhitneyu

mannwhitneyu(df[df.group == 0].clicks, df[df.group == 1].clicks)[1]
```

## –Ø–∫ –≤–∏–º—ñ—Ä—é–≤–∞—Ç–∏ CTR {.smaller}

–ê–ª–µ —Ö–æ—Ç—ñ–ª–æ—Å—è –± –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏

- –ì—Ä—É–ø–æ–≤–∏–π CTR:

$$CTR = \frac{\sum_{i=1}^{N} clicks_i}{\sum_{i=1}^{N} views_i}$$

## CTR —ñ –±—É—Ç—Å—Ç—Ä–∞–ø

- –§–æ—Ä–º—É—î–º–æ –≤–∏–±—ñ—Ä–∫–∏ –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º
- –î–ª—è –∫–æ–∂–Ω–æ—ó –≤–∏–±—ñ—Ä–∫–∏ —Ä–∞—Ö—É—î–º–æ –≥—Ä—É–ø–æ–≤–∏–π CTR
- –û—Ü—ñ–Ω—é—î–º–æ –∑–Ω–∞—á—É—â—ñ—Å—Ç—å —Ä—ñ–∑–Ω–∏—Ü—ñ –≥—Ä—É–ø–æ–≤–∏—Ö CTR

```{python}
#| label: ctr-bootstrap

n_iter = 1000

data_1 = df[df.group == 0]
data_2 = df[df.group == 1]

stats = []
for _ in range(n_iter):
    sampled_data_1 = data_1.sample(n=len(data_1), replace=True)
    sampled_data_2 = data_2.sample(n=len(data_2), replace=True)

    ctr_1 = sampled_data_1.clicks.sum() / sampled_data_1.views.sum()
    ctr_2 = sampled_data_2.clicks.sum() / sampled_data_2.views.sum()
    stats.append(ctr_1 - ctr_2)

stats = np.array(stats)
```

## CTR —ñ –±—É—Ç—Å—Ç—Ä–∞–ø

```{python}
#| label: ctr-bootstrap-plot
#| fig-align: center

sns.histplot(stats)
plt.xlabel('–†—ñ–∑–Ω–∏—Ü—è CTR')
plt.show()

display(Markdown(f'p-value = {2 * min(sum(stats <= 0), sum(stats >= 0)) / len(stats)}'))
```

## –ë–∞–∫–µ—Ç–∏–Ω–≥ {.smaller}

- –†–æ–∑–±–∏–≤–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –±–∞–∫–µ—Ç–∏ (100 –≥—Ä—É–ø) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ö–µ—à-—Ñ—É–Ω–∫—Ü—ñ—ó
- –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–∞–∫–µ—Ç—É —Ä–∞—Ö—É—î–º–æ –≥—Ä—É–ø–æ–≤–∏–π CTR
- –ü–æ—Ä—ñ–≤–Ω—é—î–º–æ –¥–≤—ñ –≤–∏–±—ñ—Ä–∫–∏ –ø–æ 100 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é t-–∫—Ä–∏—Ç–µ—Ä—ñ—é –°—Ç—é–¥–µ–Ω—Ç–∞ –∞–±–æ U-–∫—Ä–∏—Ç–µ—Ä—ñ—é –ú–∞–Ω–Ω–∞-–£—ñ—Ç–Ω—ñ

```{python}
#| label: ctr-bucketing
#| fig-align: center
#| output-location: column-fragment

import hashlib

df['bucket'] = df['user'].apply(
    lambda x: int(hashlib.md5((str(x) + 'my_salt').encode()).hexdigest(), 16) % 100
)

sns.histplot(df.bucket)
plt.show()
```

## –ë–∞–∫–µ—Ç–∏–Ω–≥ {.smaller}

–†–∞—Ö—É—î–º–æ –º–µ—Ç—Ä–∏–∫–∏:

```{python}
#| label: ctr-bucketing-2

new_df = df.groupby(['group', 'bucket']).sum(['views', 'ctr']).reset_index()
new_df['ctr'] = new_df.clicks / new_df.views

new_df.head()
```

–†–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```{python}
#| label: ctr-bucketing-3

mannwhitneyu(new_df[new_df.group == 0].ctr, new_df[new_df.group == 1].ctr)
```

## –õ—ñ–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è

$$ CTR_{line}=Click - A \times Views$$

- $A$ - –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –ø–æ–∫–∞–∑—ñ–≤ –¥–æ –∫–ª—ñ–∫—ñ–≤ —É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ–π –≥—Ä—É–ø—ñ
- –ö—Ä–∞—â–∞ —á—É—Ç–ª–∏–≤—ñ—Å—Ç—å
- –ú–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–≤–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏

## –õ—ñ–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è

```{python}
#| label: ctr-linear
#| fig-align: center

coef = df[df.group == 0].clicks.sum() / df[df.group == 0].views.sum()
df['linearized_clicks'] = df.clicks - coef * df.views

sns.histplot(df['linearized_clicks'], bins=50)
plt.show()
```

## –õ—ñ–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è

–†–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```{python}
#| label: ctr-linear-2

mannwhitneyu(df[df.group == 0].linearized_clicks, df[df.group == 1].linearized_clicks)
```

# –î—è–∫—É—é –∑–∞ —É–≤–∞–≥—É! {background-color="#eef3f8"}

<br>
<br>

{{< iconify ic baseline-telegram >}} [@araprof](https://t.me/araprof)

{{< iconify mdi youtube >}} [@datamirosh](https://www.youtube.com/@datamirosh)

{{< iconify ion home >}} [aranaur.rbind.io](https://aranaur.rbind.io)

{{< iconify mdi github >}} [aranaur](https://github.com/Aranaur)

{{< iconify mdi envelope >}} <ihor.miroshnychenko@knu.ua>

{{< iconify mdi linkedin >}} [ihormiroshnychenko](https://www.linkedin.com/in/ihormiroshnychenko/)
