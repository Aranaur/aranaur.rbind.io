<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src=".03_files/libs/clipboard/clipboard.min.js"></script>
<script src=".03_files/libs/quarto-html/tabby.min.js"></script>
<script src=".03_files/libs/quarto-html/popper.min.js"></script>
<script src=".03_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href=".03_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href=".03_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href=".03_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href=".03_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src=".03_files/libs/quarto-contrib/iconify-1.0.8/iconify-icon.min.js"></script><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.547">

  <meta name="author" content="Ігор Мірошниченко">
  <title>A/B-тестування</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href=".03_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href=".03_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href=".03_files/libs/revealjs/dist/theme/quarto.css">
  <link href=".03_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href=".03_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href=".03_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href=".03_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href=".03_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href=".03_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src=".03_files/libs/quarto-diagram/mermaid.min.js"></script>
  <script src=".03_files/libs/quarto-diagram/mermaid-init.js"></script>
  <link href=".03_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-iframe=".03_files/libs/colored-particles/index.html" class="quarto-title-block center">
  <h1 class="title">A/B-тестування</h1>
  <p class="subtitle">Прикладний статистичний аналіз</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Ігор Мірошниченко 
</div>
        <p class="quarto-title-affiliation">
            КНУ імені Тараса Шевченка | ФІТ
          </p>
    </div>
</div>

</section>
<section>
<section id="ідеї-та-гіпотези" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Ідеї та гіпотези</h1>

</section>
<section id="все-починається-з-ідеї" class="slide level2">
<h2>Все починається з ідеї</h2>
<p><strong>Експеримент</strong> - кінцева точка, коли в нас уже сформульована деяка гіпотеза, якимось чином валідована. Ми розуміємо, на яку частину продукту вона впливає і якою метрикою що потрібно перевірити. Але перед тим, як сформулюється гіпотеза, звідкись береться ідея. Звідки?</p>
<p><strong>Ідея</strong> - ще не підтверджена гіпотеза. Гіпотеза народжується на основі даних. Самі дані можуть бути отримані різними способами. наприклад, шляхом вивчення конкурентів, аналізом потенціалу ринку, або з використанням творчих механік (воркшопи, хакатони).</p>
</section>
<section id="кожній-ідеї---свій-метод-перевірки" class="slide level2">
<h2>Кожній ідеї - свій метод перевірки</h2>
<p>Крім кількісних методів аналізу даних можуть бути:</p>
<ul>
<li><strong>Глибинні інтерв’ю</strong> - спілкуємося з користувачами, з’ясовуємо проблеми, розмірковуємо</li>
<li><strong>Опитування</strong> - запитуємо що-небудь очно або дистанційним каналом (напр. розсилка)</li>
<li><strong>Юзабіліті-тестування</strong></li>
</ul>
</section>
<section id="для-перевірки-гіпотези-необхідні-умови" class="slide level2 smaller">
<h2>Для перевірки гіпотези необхідні умови</h2>
<ul>
<li>Відсутність факторів, що впливають, крім самої тестованої зміни: коли ми хочемо порівняти дві версії, має впливати тільки зміна, жодних інших зовнішніх чинників.</li>
<li>Репрезентативна оцінка: репрезентативність - відповідність властивостей вибірки характеристикам генеральної сукупності, тобто коли вибірка відображає властивості генеральної сукупності.</li>
</ul>
<blockquote>
<p>Приклад у цьому контексті: є вибірка А і вибірка Б. У вибірці А є користувачі з Києва. Якщо вибірка репрезентативна, то і в А і в Б користувачів з Києва буде по 30%. Якщо в А буде 25%, а в Б - 10%, то є зміщення і вибірки не репрезентативні. Це критично для проведення чесного А/В-тесту: якщо є дисбаланс, то результат експерименту може пояснюватися не тим, що в нас хороша гіпотеза, а тим, що порушується репрезентативність (напр. іншою купівельною спроможністю).</p>
</blockquote>
<ul>
<li><strong>Точність оцінки:</strong> за точність оцінки відповідають статистичні критерії, щільність і кількість даних, параметри розподілу метрик. Точність впливає на помилки і на якість експериментів.</li>
</ul>
</section></section>
<section>
<section id="що-таке-ab-тести" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Що таке A/B тести</h1>

</section>
<section id="що-таке-ab-тести-1" class="slide level2">
<h2>Що таке A/B тести</h2>
<p>З чого все починалося? Статистика як інструмент використовувалася для клінічних досліджень. Завдяки цим завданням математична статистика розвивалася.</p>
<p>A/B тестування - це де:</p>
<ul>
<li>перевіряється два і більше варіанти (контроль і тест) з метою визначення найбільш ефективного</li>
<li>ступінь ефективності вимірюється за допомогою порахованих імовірностей хибнопозитивних і хибнонегативних випадків</li>
</ul>
</section>
<section id="рішення" class="slide level2">
<h2>Рішення</h2>
<ol type="1">
<li><strong>Хибнопозитивні</strong> (<em>False Positive</em>, помилка I роду): виявляємо зміни, які насправді не працюють.</li>
<li><strong>Хибнонегативні</strong> (<em>False Negativ</em>e, помилка II роду): корисні зміни не беруться до уваги. Наприклад, зафіксували результат як не значущий, хоча він значущий.</li>
</ol>
</section>
<section id="приклади" class="slide level2 smaller">
<h2>Приклади</h2>
<p><strong>1. Хибнопозитивне рішення</strong></p>
<p><em>Гіпотеза</em>: підвищення тижневої ціни передплати з 1 до 2</p>
<p><em>Підсумок</em>: на перших 2 днях експерименту було зафіксовано статистично значущий результат. Продакт і аналітик ухвалили рішення прийняти результат як успішний, а після публікації зміни на всіх користувачів - ключовий показник змінився в гірший бік. Так, прийняли за істину те, що нею не є.</p>
<p><strong>2. Хибнонегативне рішення</strong></p>
<p>Проводили експеримент 2 дні, не бачили різниці, зупинили</p>
<p><em>Підсумок</em>: оскільки в експерименті було охоплено тільки 2 дні, ми не враховуємо поведінку аудиторії в інші дні тижня. Можливо, зміна має відкладений ефект: користувач у понеділок потрапив у тестову групу, а в п’ятницю прийняв рішення</p>
</section>
<section id="як-запамятати" class="slide level2 smaller">
<h2>Як запам’ятати</h2>
<div class="r-stack">
<p><img data-src="img/fp-fn-2.jpg" class="fragment absolute" style="top: 160px; left: 0px; width: 450px; "></p>
<p><img data-src="img/fp-fn.jpg" class="fragment absolute" style="top: 160px; right: 0px; width: 450px; "></p>
<p><img data-src="img/fp-fn-3.jpg" class="fragment" width="350"></p>
</div>
<div class="fragment">
<p><strong>Помилка I роду</strong> — хлопчик закричав “вовк!”, жителі повірили, хоча вовка не було.</p>
<p><strong>Помилка II роду</strong> — хлопчик закричав “вовк!”, жителі не повірили, хоча вовк насправді був.</p>
</div>
</section></section>
<section>
<section id="метрики-експерименту" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Метрики експерименту</h1>

</section>
<section id="рівні-метрик" class="slide level2">
<h2>Рівні метрик</h2>
<ul>
<li><strong>Цільові</strong> - показники, на які спрямована зміна (конверсія, середній чек)</li>
<li><strong>Випереджальні</strong> - показники, добре корельовані з цільовими, що дають предикт і корисні тоді, коли немає часу чекати на основну метрику</li>
<li><strong>Guardrail</strong> - показники, на які спрямовано впливає зміна, але які не є цільовими. Рекомендується за ними спостерігати і на їхній основі також ухвалювати рішення</li>
</ul>
</section>
<section id="приклад-e-commerce-тест-нового-ui-кошика" class="slide level2">
<h2>Приклад: e-commerce, тест нового UI кошика</h2>
<ul>
<li><strong>Цільові</strong>: конверсія в покупку, середній чек, ARPU (середній дохід на користувача), ARPPU (середній дохід на користувача, що сплачує)</li>
<li><strong>Випереджальні</strong>: додавання товару в кошик на сесію, перегляди товарів на сесію, відтік чекаута, помилки на чекауті</li>
<li><strong>Guardrail</strong>: час від входу в кошик до його проходження, частка пошукових запитів із кошика, взаємодія з рекомендаційними блоками в кошику</li>
</ul>
</section>
<section id="приклад-освітній-продукт-тест-нового-освітнього-контенту" class="slide level2">
<h2>Приклад: освітній продукт, тест нового освітнього контенту</h2>
<ul>
<li><strong>Цільові</strong>: продовження навчання, середній дохід на користувача, що сплачує (ARPPU)</li>
<li><strong>Випереджальні</strong>: інтенсивність навчання, кількість помилок у момент навчання, частота звернень до служби підтримки, технічні характеристики якості відео</li>
<li><strong>Guardrail</strong>: час проведений за одним заняттям, переривання занять, перемотування</li>
</ul>
</section>
<section id="типи-метрик" class="slide level2 smaller">
<h2>Типи метрик</h2>
<ul>
<li><strong>Частки</strong>
<ul>
<li>величина, яка береться з бінарної ознаки, коли є дві градації - 0 або 1: реєстрації, утримання на 7 день [0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1]</li>
</ul></li>
<li><strong>Неперервні</strong>
<ul>
<li>середнє вибіркове з деякого розподілу неперервних величин: час у сек./хв./тощо, чек у гривні [1123.32, 324.4, 823.21, 924.91].</li>
</ul></li>
<li><strong>Відносні</strong>
<ul>
<li>відношення двох випадкових величин: поїздок на водія, кліків на сесії, ціна за 1000 показів [10/123 = 0.081, 4129.2/12488 = 0.33, 1/100=0.01]</li>
</ul></li>
</ul>
</section>
<section id="пріоритет-метрик" class="slide level2 smaller">
<h2>Пріоритет метрик</h2>
<p>Система координат метрик - дає змогу краще і швидше ухвалювати рішення, коли метрик багато.</p>
<p>Якщо немає розуміння пріоритету - прийняти рішення досить складно.</p>
<p>На різних стадіях розвитку продукту система метрик може значно змінюватися - це динамічний артефакт, який потрібно постійно урізноманітнювати.</p>
<div class="fragment">
<p><strong>Довгі метрики vs.&nbsp;Швидкі метрики</strong></p>
<p>У кожної метрики є “вікно” - користувач не відразу ухвалює рішення про те, щоб зробити бажану дію для продукту. Важливо шукати “швидкі” метрики, які залежні від “довгих” і на основі цього змінювати пріоритет і всю ієрархію</p>
</div>
</section></section>
<section>
<section id="типи-експериментів" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Типи експериментів</h1>

</section>
<section id="ab-тестування" class="slide level2">
<h2>A/B тестування</h2>
<p><strong>Чим корисний:</strong> Виміряти ефект від зміни</p>
<p><strong>Ключові особливості:</strong></p>
<ul>
<li>кожна група експерименту бачить свій варіант</li>
<li>групи незалежні</li>
<li>групи взяті з однієї ГС</li>
<li>розподіл може бути нерівномірним</li>
</ul>
</section>
<section id="aa-тестування" class="slide level2">
<h2>A/A тестування</h2>
<p><strong>Чим корисний:</strong></p>
<ul>
<li>перевірити спліт-систему</li>
<li>вибрати гомогенні групи</li>
</ul>
<p><strong>Ключові особливості:</strong></p>
<ul>
<li>групи незалежні</li>
<li>групи взяті з однієї ГС</li>
<li>часто використовується для симуляцій</li>
</ul>
</section>
<section id="abn-тестування" class="slide level2">
<h2>A/B/n тестування</h2>
<p><strong>Чим корисний:</strong> Той самий A/B, тільки перевіряється від 2 і більше змін.</p>
<p><strong>Ключові особливості:</strong></p>
<ul>
<li>групи незалежні</li>
<li>групи взяті з однієї ГС</li>
<li>пов’язані з проблемою множинної перевірки гіпотез</li>
</ul>
</section>
<section id="tdi-team-draft-interleaving---тестування-змін" class="slide level2">
<h2>TDI (team draft interleaving) - тестування змін</h2>
<p><strong>Чим корисний:</strong> зміни у ранжуванні, рекомендаціях, пошуку</p>
<p><strong>Ключові особливості:</strong></p>
<ul>
<li>один користувач бачить одразу кілька варіантів</li>
<li>найчастіше використовується в пошуку і рекомендаціях</li>
<li>вибірки залежні - що накладає особливості</li>
</ul>
</section>
<section id="ab-vs.-tdi" class="slide level2">
<h2>A/B vs.&nbsp;TDI</h2>

<img data-src="img/ab_vs_interleaving.png" class="r-stretch"></section>
<section id="приклад-tdi-два-алгоритми-пошуку" class="slide level2 smaller">
<h2>Приклад TDI: два алгоритми пошуку</h2>
<p>Метод TDI дає змогу показати користувачеві результат видачі користувацького запиту із застосуванням двох алгоритмів. Користувач вирішує кліком, який же алгоритм дав релевантну відповідь. Поділу на варіанти тут немає. Самі розташування відповідей різних алгоритмів будуть перемішуватися, щоб результат експерименту не був залежний від розташування.</p>

<img data-src="img/tdi-1.png" class="r-stretch"></section>
<section id="diff-in-diff-різниця-в-різниці" class="slide level2">
<h2>Diff-in-Diff (різниця в різниці)</h2>
<p><strong>Чим корисний:</strong> коли немає можливості поділити користувачів на групи в один момент часу</p>
<p><strong>Ключові особливості:</strong></p>
<ul>
<li>групи залежні та рознесені в часі</li>
<li>один із типів регресій</li>
</ul>
</section>
<section id="приклад-diff-in-diff-економічна-зміна-в-державі" class="slide level2 smaller">
<h2>Приклад Diff-in-Diff: економічна зміна в державі</h2>
<p>Є дві групи (тест і контроль) і два періоди - період до взаємодії та після.</p>
<p>Одна з груп схильна до впливу, або бере участь у деякій програмі, у другому періоді, але не в першому. Друга група не піддається впливу в жодному з періодів. Метод усуває зміщення під час порівняння результатів у тестовій і контрольній групах тільки в другому періоді, яке може бути наслідком постійних відмінностей між цими групами.</p>

<img data-src="img/diff-in-diff.png" class="r-stretch"></section></section>
<section>
<section id="bootstrap" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Bootstrap</h1>

</section>
<section id="що-таке-bootstrap" class="slide level2">
<h2>Що таке Bootstrap</h2>
<p><strong>Бутстрап</strong> - ціле сімейство методів, що дає змогу перевіряти гіпотези за допомогою повторних вибірок.</p>
</section>
<section id="приклад-кейс-із-фуд-ритейлу" class="slide level2 smaller">
<h2>Приклад: кейс із фуд-ритейлу</h2>
<p>Додали нову вітрину “Ваші минулі покупки” на чекаут. Цікаво, як змінився середній чек. Як оцінити вплив експерименту на прибуток? Можемо подивитися на розподіл, описові статистики, підібрати тест і перевірити значущість відмінностей.</p>

<img data-src=".03_files/figure-revealjs/bootstrap-data-output-1.svg" id="bootstrap-data" class="quarto-figure quarto-figure-center r-stretch"><p>На око здається, що в тестовій групі ми стали заробляти більше.</p>
<p>Але бізнесу захочеться зрозуміти, чим пояснюється ця мінливість (різниця, яку ми спостерігаємо), за рахунок якої аудиторії досягли ефекту?</p>
</section>
<section id="приклад-кейс-із-фуд-ритейлу-1" class="slide level2 smaller">
<h2>Приклад: кейс із фуд-ритейлу</h2>
<p>Що буде краще відображати центральну тенденцію?</p>
<div class="fragment">
<p>Медіана!</p>
</div>
<div class="fragment">
<p>Чи можемо використати центральну граничну теорему для щоб побудувати ДІ для медіани?</p>
</div>
<div class="fragment">
<p>На даний момент не зможемо, тому потрібен якийсь метод для цього завдання</p>
</div>
</section>
<section id="приклад-кейс-із-фуд-ритейлу-2" class="slide level2">
<h2>Приклад: кейс із фуд-ритейлу</h2>
<p>Маючи тільки дані за наявною вибіркою, існує можливість оцінити будь-який її параметр, побудувавши <strong>емпіричний розподіл параметра</strong>.</p>
<p>У контексті нашого завдання з медіаною - отримати розподіл медіан і далі за ним обчислити довірчий інтервал:</p>
<p>Алгоритм:</p>
<ol type="1">
<li>Сформувати підвибірки з повтореннями з наявної вибірки</li>
<li>Обчислити медіану для підвибірки</li>
<li>Повторити кроки 1-2 N разів</li>
<li>Побудувати розподіл медіан</li>
<li>Обчислити довірчий інтервал</li>
</ol>
</section>
<section id="приклад-кейс-із-фуд-ритейлу-3" class="slide level2 smaller">
<h2>Приклад: кейс із фуд-ритейлу</h2>
<div id="cell-bootstrap-median" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap</span></span>
<span id="cb1-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bootstrap(data, n<span class="op">=</span><span class="dv">9999</span>):</span>
<span id="cb1-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Bootstrap function"""</span></span>
<span id="cb1-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.random.choice(data, size<span class="op">=</span>(n, <span class="bu">len</span>(data)), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap median</span></span>
<span id="cb1-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bootstrap_median(data, n<span class="op">=</span><span class="dv">9999</span>):</span>
<span id="cb1-8"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Bootstrap median function"""</span></span>
<span id="cb1-9"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.median(bootstrap(data, n), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap median for control and test</span></span>
<span id="cb1-12"><a href="" aria-hidden="true" tabindex="-1"></a>median_c <span class="op">=</span> bootstrap_median(control)</span>
<span id="cb1-13"><a href="" aria-hidden="true" tabindex="-1"></a>median_t <span class="op">=</span> bootstrap_median(test)</span>
<span id="cb1-14"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data</span></span>
<span id="cb1-16"><a href="" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb1-17"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(median_t, ax<span class="op">=</span>ax, color<span class="op">=</span>blue, label<span class="op">=</span><span class="st">'Середнє вибіркової медіани для тесту: </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(np.mean(median_t)))</span>
<span id="cb1-18"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(median_c, ax<span class="op">=</span>ax, color<span class="op">=</span>red, label<span class="op">=</span><span class="st">'Середнє вибіркової медіани для контролю: </span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>(np.mean(median_c)))</span>
<span id="cb1-19"><a href="" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb1-20"><a href="" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Розподіл медіани доходу'</span>)</span>
<span id="cb1-21"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="приклад-кейс-із-фуд-ритейлу-3-output" class="slide level2 smaller output-location-slide"><h2>Приклад: кейс із фуд-ритейлу</h2><div class="cell output-location-slide" data-execution_count="3">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/bootstrap-median-output-1.svg" id="bootstrap-median" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div></section><section id="приклад-кейс-із-фуд-ритейлу-4" class="slide level2">
<h2>Приклад: кейс із фуд-ритейлу</h2>
<p>Медіана за допомогою <code>scipy</code>:</p>
<div id="bootstrap-median-scipy" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> bootstrap</span>
<span id="cb2-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap median for control and test</span></span>
<span id="cb2-4"><a href="" aria-hidden="true" tabindex="-1"></a>median_c <span class="op">=</span> bootstrap(data<span class="op">=</span>(control,), statistic<span class="op">=</span>np.median, confidence_level<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb2-5"><a href="" aria-hidden="true" tabindex="-1"></a>median_t <span class="op">=</span> bootstrap(data<span class="op">=</span>(test,), statistic<span class="op">=</span>np.median, confidence_level<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb2-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Довірчий інтервал для контрольної групи = </span><span class="sc">{</span>median_c<span class="sc">.</span>confidence_interval<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb2-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Довірчий інтервал для тестової групи = </span><span class="sc">{</span>median_t<span class="sc">.</span>confidence_interval<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Довірчий інтервал для контрольної групи = ConfidenceInterval(low=2294.8899935602362, high=2914.284628954442)
Довірчий інтервал для тестової групи = ConfidenceInterval(low=2728.8595827184886, high=3259.0417274427105)</code></pre>
</div>
</div>
</section>
<section id="приклад-кейс-із-фуд-ритейлу-5" class="slide level2 smaller">
<h2>Приклад: кейс із фуд-ритейлу</h2>
<p>Середнє за допомогою <code>scipy</code>:</p>
<div id="bootstrap-mean-scipy" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> bootstrap</span>
<span id="cb4-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap median for control and test</span></span>
<span id="cb4-4"><a href="" aria-hidden="true" tabindex="-1"></a>mean_c <span class="op">=</span> bootstrap(data<span class="op">=</span>(control,), statistic<span class="op">=</span>np.mean, confidence_level<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb4-5"><a href="" aria-hidden="true" tabindex="-1"></a>mean_t <span class="op">=</span> bootstrap(data<span class="op">=</span>(test,), statistic<span class="op">=</span>np.mean, confidence_level<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb4-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Довірчий інтервал для контрольної групи = </span><span class="sc">{</span>mean_c<span class="sc">.</span>confidence_interval<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb4-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Довірчий інтервал для тестової групи = </span><span class="sc">{</span>mean_t<span class="sc">.</span>confidence_interval<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Довірчий інтервал для контрольної групи = ConfidenceInterval(low=4714.456586527343, high=6261.43817231836)
Довірчий інтервал для тестової групи = ConfidenceInterval(low=5057.483029164094, high=5998.541280222842)</code></pre>
</div>
</div>
<p>Графік розподілу середнього за допомогою <code>scipy</code>:</p>
<div id="cell-bootstrap-mean-scipy-plot" class="cell columns column-output-location" data-execution_count="6">
<div class="column">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data</span></span>
<span id="cb6-2"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(mean_t.bootstrap_distribution)</span>
<span id="cb6-3"><a href="" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean_t.confidence_interval[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb6-4"><a href="" aria-hidden="true" tabindex="-1"></a>plt.axvline(mean_t.confidence_interval[<span class="dv">1</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb6-5"><a href="" aria-hidden="true" tabindex="-1"></a>plt.axvline(np.mean(test), color<span class="op">=</span><span class="st">'blue'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb6-6"><a href="" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Розподіл середнього доходу'</span>)</span>
<span id="cb6-7"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/bootstrap-mean-scipy-plot-output-1.svg" id="bootstrap-mean-scipy-plot" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="чи-можна-використовувати-класичний-критерій" class="slide level2 smaller">
<h2>Чи можна використовувати класичний критерій?</h2>
<ul>
<li><p>У цьому випадку критерій Манна-Вітні найкраще підійде для завдання. Він дає відповідь на запитання, чи значуще різняться розподіли, чи ні.</p></li>
<li><p>До того ж, у кожного критерію своє аналітичне рішення, яке вимагає дотримуватися низки припущень (наприклад, однакова дисперсія/однаковий розмір вибірки/однакова форма розподілів тощо). Така можливість не завжди є.</p></li>
</ul>
<div id="classic-test" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> mannwhitneyu</span>
<span id="cb7-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># mann-whitney test</span></span>
<span id="cb7-4"><a href="" aria-hidden="true" tabindex="-1"></a>stat, p <span class="op">=</span> mannwhitneyu(control, test)</span>
<span id="cb7-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Statistics=</span><span class="sc">%.3f</span><span class="st">, p=</span><span class="sc">%.3f</span><span class="st">'</span> <span class="op">%</span> (stat, p))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Statistics=472183.000, p=0.031</code></pre>
</div>
</div>
</section>
<section id="підсумок" class="slide level2 smaller">
<h2>Підсумок</h2>
<ul>
<li>Бутстрап дає змогу будувати довірчий інтервал для будь-якого параметра розподілу, не застосовуючи для цього аналітичну формулу</li>
<li>Основна перевага Бутстрап - перевіряти гіпотези для будь-яких параметрів розподілу або моделей: Перцентилі/Квантилі/Децилі тощо.</li>
<li>Бутстрап перевіряє статистичні гіпотези без опори на певний теоретичний розподіл даних (на відміну від класичних стат. критеріїв)</li>
<li>Бутстрап дає змогу зробити оцінку будь-якого “складного” параметра шляхом знаходження довірчих інтервалів для нього. А для перевірки гіпотез - шляхом обчислення їхньої різниці.</li>
</ul>
</section>
<section id="гіпотези-і-бутстрап" class="slide level2">
<h2>Гіпотези і бутстрап</h2>
<p>Алгоритм:</p>
<ol type="1">
<li>Будуєте бутстрап-розподіл параметра в А і Б</li>
<li>Обчислюєте їхню різницю (віднімання матриць)</li>
<li>В отриманому розподілі різниць розраховуємо довірчий інтервал</li>
<li>Якщо довірчий інтервал не містить 0 - гіпотеза про рівність параметрів відхиляється</li>
</ol>
</section>
<section id="p-value-і-бутстрап" class="slide level2 smaller">
<h2>p-value і бутстрап</h2>
<div style="font-size: 70%;">
<p>Загадаємо, як рахується p-value для t-критерію:</p>
<ul>
<li>Нульова гіпотеза: розподіли однакові</li>
</ul>
<p><span class="math display">\[ H_0: \mu_x = \mu_y \]</span></p>
<ul>
<li>Рахуємо статистику критерію, яка перевіряє відхилення різниці від нуля за t-розподілом:</li>
</ul>
<p><span class="math display">\[ t = \frac{\bar{x} - \bar{y}}{\sqrt{\frac{s_x^2}{n_x} + \frac{s_y^2}{n_y}}} \]</span></p>
<ul>
<li>На кожній ітерації бутстрапу ми рахуємо різницю, де 0 — її математичне сподівання</li>
<li>Далі нам би хотілося з’ясувати, з якою ймовірністю ми б бачили такі відмінності в експерименті за умови вірності нульової гіпотези. Тому ми можемо порахувати ймовірність такого випадку, порахувавши суму випадків зі відхиленнями від нуля і поділивши на кількість усіх оцінок. Це і буде p-value:</li>
</ul>
<blockquote>
<p>За умови вірності нульової гіпотези, бутстрап вибірка різниць повинна мати нормальний розподіл з математичним сподіванням 0 (ЦГТ). Тому, якщо ми порахуємо відсоток випадків, коли різниця відхиляється від нуля, то це і буде p-value.</p>
</blockquote>
</div>
</section>
<section id="p-value-і-бутстрап-1" class="slide level2 smaller">
<h2>p-value і бутстрап</h2>
<p>Приклад реалізації на Python з розрахунком різниць, ДІ і p-value:</p>
<div id="bootstrap-pvalue" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb9-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb9-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Створюємо функцію</span></span>
<span id="cb9-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_bootstrap(</span>
<span id="cb9-9"><a href="" aria-hidden="true" tabindex="-1"></a>    data_column_1, <span class="co"># числові значення першої вибірки</span></span>
<span id="cb9-10"><a href="" aria-hidden="true" tabindex="-1"></a>    data_column_2, <span class="co"># числові значення другої вибірки</span></span>
<span id="cb9-11"><a href="" aria-hidden="true" tabindex="-1"></a>    boot_it <span class="op">=</span> <span class="dv">1000</span>, <span class="co"># кількість ітерацій бутстрепа</span></span>
<span id="cb9-12"><a href="" aria-hidden="true" tabindex="-1"></a>    statistic <span class="op">=</span> np.mean, <span class="co"># яку статистику рахуємо</span></span>
<span id="cb9-13"><a href="" aria-hidden="true" tabindex="-1"></a>    bootstrap_conf_level <span class="op">=</span> <span class="fl">0.95</span> <span class="co"># рівень значущості</span></span>
<span id="cb9-14"><a href="" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb9-15"><a href="" aria-hidden="true" tabindex="-1"></a>    boot_len <span class="op">=</span> <span class="bu">max</span>([<span class="bu">len</span>(data_column_1), <span class="bu">len</span>(data_column_2)]) <span class="co"># довжина вибірки</span></span>
<span id="cb9-16"><a href="" aria-hidden="true" tabindex="-1"></a>    boot_data <span class="op">=</span> [] <span class="co"># будуватимемо розподіл тут</span></span>
<span id="cb9-17"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(boot_it)): <span class="co"># створюємо підвибірки</span></span>
<span id="cb9-18"><a href="" aria-hidden="true" tabindex="-1"></a>        samples_1 <span class="op">=</span> data_column_1.sample(</span>
<span id="cb9-19"><a href="" aria-hidden="true" tabindex="-1"></a>            boot_len, </span>
<span id="cb9-20"><a href="" aria-hidden="true" tabindex="-1"></a>            replace <span class="op">=</span> <span class="va">True</span> <span class="co"># параметр повернення</span></span>
<span id="cb9-21"><a href="" aria-hidden="true" tabindex="-1"></a>        ).values</span>
<span id="cb9-22"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-23"><a href="" aria-hidden="true" tabindex="-1"></a>        samples_2 <span class="op">=</span> data_column_2.sample(</span>
<span id="cb9-24"><a href="" aria-hidden="true" tabindex="-1"></a>            boot_len, </span>
<span id="cb9-25"><a href="" aria-hidden="true" tabindex="-1"></a>            replace <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-26"><a href="" aria-hidden="true" tabindex="-1"></a>        ).values</span>
<span id="cb9-27"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-28"><a href="" aria-hidden="true" tabindex="-1"></a>        boot_data.append(statistic(samples_1<span class="op">-</span>samples_2)) <span class="co"># рахуємо статистику</span></span>
<span id="cb9-29"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-30"><a href="" aria-hidden="true" tabindex="-1"></a>    pd_boot_data <span class="op">=</span> pd.DataFrame(boot_data) <span class="co"># перетворюємо в датафрейм</span></span>
<span id="cb9-31"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-32"><a href="" aria-hidden="true" tabindex="-1"></a>    left_quant <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> bootstrap_conf_level)<span class="op">/</span><span class="dv">2</span> <span class="co"># ліва квантиль</span></span>
<span id="cb9-33"><a href="" aria-hidden="true" tabindex="-1"></a>    right_quant <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> bootstrap_conf_level) <span class="op">/</span> <span class="dv">2</span> <span class="co"># права квантиль</span></span>
<span id="cb9-34"><a href="" aria-hidden="true" tabindex="-1"></a>    ci <span class="op">=</span> pd_boot_data.quantile([left_quant, right_quant]) <span class="co"># ДІ</span></span>
<span id="cb9-35"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># рахуємо p-value    </span></span>
<span id="cb9-36"><a href="" aria-hidden="true" tabindex="-1"></a>    p_1 <span class="op">=</span> norm.cdf(</span>
<span id="cb9-37"><a href="" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb9-38"><a href="" aria-hidden="true" tabindex="-1"></a>        loc <span class="op">=</span> np.mean(boot_data), </span>
<span id="cb9-39"><a href="" aria-hidden="true" tabindex="-1"></a>        scale <span class="op">=</span> np.std(boot_data)</span>
<span id="cb9-40"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-41"><a href="" aria-hidden="true" tabindex="-1"></a>    p_2 <span class="op">=</span> norm.cdf(</span>
<span id="cb9-42"><a href="" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb9-43"><a href="" aria-hidden="true" tabindex="-1"></a>        loc <span class="op">=</span> <span class="op">-</span>np.mean(boot_data), </span>
<span id="cb9-44"><a href="" aria-hidden="true" tabindex="-1"></a>        scale <span class="op">=</span> np.std(boot_data)</span>
<span id="cb9-45"><a href="" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-46"><a href="" aria-hidden="true" tabindex="-1"></a>    p_value <span class="op">=</span> <span class="bu">min</span>(p_1, p_2) <span class="op">*</span> <span class="dv">2</span> <span class="co"># подвоюємо, бо двосторонній критерій</span></span>
<span id="cb9-47"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-48"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Візуалізуємо розподіл</span></span>
<span id="cb9-49"><a href="" aria-hidden="true" tabindex="-1"></a>    plt.hist(pd_boot_data[<span class="dv">0</span>], bins <span class="op">=</span> <span class="dv">50</span>)</span>
<span id="cb9-50"><a href="" aria-hidden="true" tabindex="-1"></a>    plt.vlines(ci, ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">50</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb9-51"><a href="" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'boot_data'</span>)</span>
<span id="cb9-52"><a href="" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'frequency'</span>)</span>
<span id="cb9-53"><a href="" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Histogram of boot_data"</span>)</span>
<span id="cb9-54"><a href="" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb9-55"><a href="" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb9-56"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"boot_data"</span>: boot_data, </span>
<span id="cb9-57"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ci"</span>: ci, </span>
<span id="cb9-58"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="st">"p_value"</span>: p_value}</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="повертаємось-до-прикладу" class="slide level2">
<h2>Повертаємось до прикладу</h2>
<div id="cell-bootstrap-pvalue-example" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap</span></span>
<span id="cb10-2"><a href="" aria-hidden="true" tabindex="-1"></a>booted_data <span class="op">=</span> get_bootstrap(</span>
<span id="cb10-3"><a href="" aria-hidden="true" tabindex="-1"></a>    data_column_1<span class="op">=</span>pd.Series(control), </span>
<span id="cb10-4"><a href="" aria-hidden="true" tabindex="-1"></a>    data_column_2<span class="op">=</span>pd.Series(test), </span>
<span id="cb10-5"><a href="" aria-hidden="true" tabindex="-1"></a>    boot_it<span class="op">=</span><span class="dv">10000</span>, </span>
<span id="cb10-6"><a href="" aria-hidden="true" tabindex="-1"></a>    statistic<span class="op">=</span>np.median, </span>
<span id="cb10-7"><a href="" aria-hidden="true" tabindex="-1"></a>    bootstrap_conf_level<span class="op">=</span><span class="fl">0.95</span></span>
<span id="cb10-8"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Значення p-value </span><span class="sc">{</span>booted_data[<span class="st">"p_value"</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-11"><a href="" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Довірчий інтервал </span><span class="sc">{</span>booted_data[<span class="st">"ci"</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section><section id="повертаємось-до-прикладу-output" class="slide level2 output-location-slide"><h2>Повертаємось до прикладу</h2><div class="cell output-location-slide" data-execution_count="9">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/bootstrap-pvalue-example-output-1.svg" id="bootstrap-pvalue-example" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Значення p-value 0.0889417562227498
Довірчий інтервал                 0
0.025 -520.593983
0.975   20.008479</code></pre>
</div>
</div></section></section>
<section>
<section id="aa-тестування-1" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>A/A тестування</h1>

</section>
<section id="для-чого-потрібне-aa-тестування" class="slide level2 smaller">
<h2>Для чого потрібне A/A тестування</h2>
<p>Переважно, завдання A/A тестів полягає в тому, щоб зрозуміти, чи працює система сплітування коректно, чи ні.</p>
<p>В А/А-тестах ми хочемо приймати нульову гіпотезу перевіряючи OEC (Overall Evaluation Criterion) - чи є різниця між групами статистично значущою:</p>
<p><span class="math display">\[ OEC_{control_{1}} = OEC_{control_{2}} \]</span></p>
<p>Переконатися в коректності системи сплітування можна шляхом двоетапної перевірки:</p>
<ul>
<li><strong>Чесний розподіл користувачів між групами</strong>. Зберігається репрезентативність за частками і дисперсії: сплітовалка не повинна віддавати пріоритет будь-якій із груп за будь-якою ознакою, через що може статися дисбаланс → зміна дисперсії та середніх</li>
<li><strong>Перевірка FPR за допомогою бізнес-метрик</strong>. Частота помилкових прокрасів метрики (наприклад, конверсія і середній чек) не повинна бути вищою за заданий рівень значущості (наприклад, 5%).</li>
</ul>
</section>
<section id="етапи-aa-тестування" class="slide level2">
<h2>Етапи A/A тестування</h2>
<ol type="1">
<li>Проводимо A/A тест. Час на A/A визначається таким чином, щоб охопити якомога більше факторів впливу на метрику (наприклад, тижнева сезонність)</li>
<li>Симулюємо нові A/A. Тест перераховується ≥ 10 тис. разів за допомогою симуляції нових “синтетичних” A/A</li>
<li>Рахуємо стат. значущість. У кожному тесті рахується p-value за допомогою статистичного оцінювача (бутстрап, t-тест тощо)</li>
<li>Рахуємо метрику якості FPR (False Positive Rate)</li>
<li>Робимо висновки. Перевіряється умова FPR &lt; <span class="math inline">\(\alpha\)</span>, і якщо умова дотримується, то сплітовалка працює коректно</li>
</ol>
</section>
<section id="показник-якості-fpr" class="slide level2 smaller">
<h2>Показник якості FPR</h2>
<p>Для перевірки якості сплітовалки рахуємо частку хибно позитивних оцінок (FPR):</p>
<p><span class="math display">\[ FPR = \frac{FP}{FP + TN} = \frac{FP}{N_{sim}}\]</span></p>
<p>Необхідно перевіряти FPR на кожному рівні значущості: частота хибних профарбовувань не повинна бути вищою за заданий рівень значущості. FPR не повинен перевищувати 0.05 для α = 0.05. Відповідно і для 0.01, 0.005 тощо.</p>
</section>
<section id="завищений-fpr" class="slide level2">
<h2>Завищений FPR</h2>
<p>Основні причини криються в зламаному спліт-алгоритмі.</p>
<p>Причини необхідно шукати на стороні, де реалізовано скрипт і його запуск. Часті кейси:</p>
<ul>
<li>Довге очікування відповіді сервера щодо присвоєння id експерименту і спліту</li>
<li>Пріоритет тій чи іншій групі</li>
<li>Не на всіх сторінках / кейсах реалізовано спліт-алгоритм</li>
<li>Банально “зламаний” рандом (залишок від ділення за сумою хеша?)</li>
</ul>
</section>
<section id="пошук-причини" class="slide level2">
<h2>Пошук причини</h2>
<p><strong>Дисбаланс у групах за описовими ознаками.</strong></p>
<p>Для пошуку дисбалансу необхідно порівняти поділ груп із врахуванням ознак. Цілком підійдуть:</p>
<ul>
<li>регіон</li>
<li>джерело трафіку</li>
<li>тип браузера</li>
<li>тощо</li>
</ul>
</section>
<section id="сильна-відмінність-конверсії-всередині-груп" class="slide level2">
<h2>Сильна відмінність конверсії всередині груп</h2>
<p>Для пошуку причини необхідно порівняти конверсію всередині градацій між контролем і тестом:</p>
<ul>
<li>Перевірка p-value на рівні <span class="math inline">\(\alpha\)</span></li>
<li>Додаткова перевірка FPR на рівні <span class="math inline">\(\alpha\)</span> (опціонально)</li>
</ul>
</section>
<section id="критерій-для-перевірки-дисбалансу" class="slide level2">
<h2>Критерій для перевірки дисбалансу</h2>
<p>Для перевірки фактичних часток з їхнім теоретичним рівномірним розподілом використовують спеціалізовані критерії згоди.</p>
<p>У ситуації з А/А підійде критерій <strong>CMH</strong> (Cochran-Mantel-Haenszel) для перевірки таблиць спряженості <strong>2 х 2 x K</strong>, де <em>K</em> - кількість градацій за аналізованою ознакою (наприклад, браузер 1, браузер 2 тощо).</p>
<p>В Python реалізований в <code>statsmodels.stats.contingency_tables.StratifiedTable</code>.</p>
</section>
<section id="як-користуватися-stratifiedtable" class="slide level2 smaller">
<h2>Як користуватися StratifiedTable</h2>
<p>За своєю суттю стратифіковані таблиці являють собою різновид так званих таблиць спряженості - методів перевірки взаємозв’язку між двома номінативними змінними.</p>
<p>Але відмінність полягає в тому, що в стратифікованих таблицях ми можемо використовувати більше двох змінних.</p>
<div id="cell-titanic-table" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="" aria-hidden="true" tabindex="-1"></a>titanic <span class="op">=</span> sns.load_dataset(<span class="st">'titanic'</span>)</span>
<span id="cb12-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="" aria-hidden="true" tabindex="-1"></a>pd.crosstab([titanic.sex, titanic.survived], titanic.pclass)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="titanic-table" class="cell-output cell-output-display" data-execution_count="10">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pclass</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">survived</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">female</td>
<td data-quarto-table-cell-role="th">0</td>
<td>3</td>
<td>6</td>
<td>72</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>91</td>
<td>70</td>
<td>72</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">male</td>
<td data-quarto-table-cell-role="th">0</td>
<td>77</td>
<td>91</td>
<td>300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>45</td>
<td>17</td>
<td>47</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="приклад-stratifiedtable" class="slide level2 smaller">
<h2>Приклад StratifiedTable</h2>
<p>Стратифіковані таблиці вносять третій вимір у процес. Уявіть, що ми перевіряємо ту саму гіпотезу про зв’язок статі та виживаймості, проте нам цікаво: а чи однаковий цей взаємозв’язок у різних класах? Відповідно, клас тут буде стратифікуючою змінною, і в нас одразу дві нульові гіпотези (якщо грубо):</p>
<ul>
<li>розподіл частот значень змінних статі і виживаймості (змінні незалежні одна від одної) цей розподіл однаковий у всіх класах</li>
<li>цей розподіл однаковий у всіх класах</li>
</ul>
</section>
<section id="приклад-stratifiedtable-1" class="slide level2 smaller scrollable">
<h2>Приклад StratifiedTable</h2>
<div id="stratified-table-eval" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.contingency_tables <span class="im">import</span> StratifiedTable</span>
<span id="cb13-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="" aria-hidden="true" tabindex="-1"></a>StratifiedTable.from_data(var1<span class="op">=</span><span class="st">'sex'</span>, var2<span class="op">=</span><span class="st">'survived'</span>, strata<span class="op">=</span><span class="st">'pclass'</span>, data<span class="op">=</span>titanic).summary()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:40%;">
<p>Тут нас цікавить p-value.</p>
<ul>
<li>Перший рядок (<code>Test of OR=1</code>) - це перевірка гіпотези про незалежність змінних,</li>
<li>Другий рядок (<code>Test constant OR</code>) - перевірка гіпотези про однаковість зв’язку за всіма рівнями стратифікуючої змінної.</li>
</ul>
<p>Так, у цій таблиці видно, що між змінними є зв’язок, і цей зв’язок різний у всіх класах.</p>
</div><div class="column" style="width:60%;">
<div id="cell-stratified-table-echo" class="cell" data-execution_count="12">
<div id="stratified-table-echo" class="cell-output cell-output-display" data-execution_count="11">
<table class="simpletable" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">Estimate</td>
<td data-quarto-table-cell-role="th">LCB</td>
<td data-quarto-table-cell-role="th">UCB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pooled odds</td>
<td>0.073</td>
<td>0.051</td>
<td>0.104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Pooled log odds</td>
<td>-2.622</td>
<td>-2.982</td>
<td>-2.261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pooled risk ratio</td>
<td>0.353</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th"></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td data-quarto-table-cell-role="th">Statistic</td>
<td data-quarto-table-cell-role="th">P-value</td>
<td data-quarto-table-cell-role="th"></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Test of OR=1</td>
<td>250.447</td>
<td>0.000</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Test constant OR</td>
<td>26.508</td>
<td>0.000</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th"></td>
<td data-quarto-table-cell-role="th"></td>
<td data-quarto-table-cell-role="th"></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Number of tables</td>
<td>3</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Min n</td>
<td>184</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Max n</td>
<td>491</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Avg n</td>
<td>297</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total n</td>
<td>891</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="приклад-стрімінговий-музичний-сервіс" class="slide level2">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<ul>
<li>Користувачі мають різний смак і ведуть себе по різному</li>
<li>Хочемо порівняти різні алгоритми створення плейлистів</li>
<li>Використаємо показники:
<ul>
<li>CTR (click-through rate) - частка користувачів, які клікнули на плейлист</li>
<li>Кількість відвідувань сервісу</li>
<li>Кількість кліків на плейлист</li>
<li>Чи почав користувач слухати плейлист</li>
</ul></li>
</ul>
</section>
<section id="приклад-стрімінговий-музичний-сервіс-1" class="slide level2 smaller">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<ul>
<li>Використаємо Бета-розподіл для генерації CTR.</li>
<li>Використаємо логнормальний розподіл для генерації кількості відвідувань.</li>
<li>Використаємо біноміальний розподіл для генерації кількості кліків.</li>
<li>Бінарну змінну, чи почав користувач слухати плейлист, згенеруємо за допомогою попередніх змінних.</li>
</ul>
<div id="aa-data-gen" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb14-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Кількість користувачів</span></span>
<span id="cb14-4"><a href="" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb14-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Параметри CTR</span></span>
<span id="cb14-7"><a href="" aria-hidden="true" tabindex="-1"></a>mean_ctr <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb14-8"><a href="" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb14-9"><a href="" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> mean_ctr <span class="op">*</span> beta <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> mean_ctr)</span>
<span id="cb14-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Генеруємо дані</span></span>
<span id="cb14-12"><a href="" aria-hidden="true" tabindex="-1"></a>ctr <span class="op">=</span> np.random.beta(alpha, beta, size<span class="op">=</span>n_users)</span>
<span id="cb14-13"><a href="" aria-hidden="true" tabindex="-1"></a>views <span class="op">=</span> np.random.lognormal(mean<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>n_users).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-14"><a href="" aria-hidden="true" tabindex="-1"></a>clicks <span class="op">=</span> np.random.binomial(n<span class="op">=</span>views, p<span class="op">=</span>ctr)</span>
<span id="cb14-15"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="" aria-hidden="true" tabindex="-1"></a>sessions <span class="op">=</span> []</span>
<span id="cb14-17"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> v, c <span class="kw">in</span> <span class="bu">zip</span>(views, clicks):</span>
<span id="cb14-18"><a href="" aria-hidden="true" tabindex="-1"></a>    sessions <span class="op">+=</span> [<span class="dv">1</span>] <span class="op">*</span> c <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> (v <span class="op">-</span> c)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="приклад-стрімінговий-музичний-сервіс-2" class="slide level2">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<p>Візуалізуємо дані розподіли трьох змінних</p>
<div id="aa-data-plot" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb15-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'whitegrid'</span>)</span>
<span id="cb15-5"><a href="" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">'colorblind'</span>)</span>
<span id="cb15-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb15-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(ctr, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb15-10"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(views, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">1</span>], bins<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb15-11"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(clicks, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">0</span>], bins<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-12"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(sessions, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb15-13"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'CTR'</span>)</span>
<span id="cb15-15"><a href="" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Views'</span>)</span>
<span id="cb15-16"><a href="" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Clicks'</span>)</span>
<span id="cb15-17"><a href="" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">'Session'</span>)</span>
<span id="cb15-18"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-20"><a href="" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'В середньому </span><span class="sc">{</span>np<span class="sc">.</span>mean(sessions)<span class="sc">:.2%}</span><span class="ss"> користувачів клікнули на плейлист'</span>))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="приклад-стрімінговий-музичний-сервіс-2-output" class="slide level2 output-location-slide"><h2>Приклад: стрімінговий музичний сервіс</h2><div class="cell output-location-slide" data-execution_count="14">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/aa-data-plot-output-1.svg" id="aa-data-plot-1" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div id="aa-data-plot-2" class="cell-output cell-output-display cell-output-markdown">
<p>В середньому 20.54% користувачів клікнули на плейлист</p>
</div>
</div></section><section id="приклад-стрімінговий-музичний-сервіс-3" class="slide level2 smaller">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<p>Розбиваємо користувачів на групи і порівнюємо розподіли</p>
<div id="aa-data-split" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.proportion <span class="im">import</span> proportions_ztest</span>
<span id="cb16-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pvalue(): </span>
<span id="cb16-4"><a href="" aria-hidden="true" tabindex="-1"></a>    user_ctr <span class="op">=</span> np.random.beta(alpha, beta, size<span class="op">=</span>users_num)</span>
<span id="cb16-5"><a href="" aria-hidden="true" tabindex="-1"></a>    views <span class="op">=</span> np.random.lognormal(mean<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>users_num).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb16-6"><a href="" aria-hidden="true" tabindex="-1"></a>    clicks <span class="op">=</span> np.random.binomial(views, user_ctr)</span>
<span id="cb16-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.random.rand(<span class="bu">len</span>(views)) <span class="op">&lt;</span> <span class="fl">0.5</span></span>
<span id="cb16-9"><a href="" aria-hidden="true" tabindex="-1"></a>    views_1, clicks_1 <span class="op">=</span> views[mask], clicks[mask]</span>
<span id="cb16-10"><a href="" aria-hidden="true" tabindex="-1"></a>    views_2, clicks_2 <span class="op">=</span> views[<span class="op">~</span>mask], clicks[<span class="op">~</span>mask]</span>
<span id="cb16-11"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-12"><a href="" aria-hidden="true" tabindex="-1"></a>    sessions_1 <span class="op">=</span> []</span>
<span id="cb16-13"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v, c <span class="kw">in</span> <span class="bu">zip</span>(views_1, clicks_1):</span>
<span id="cb16-14"><a href="" aria-hidden="true" tabindex="-1"></a>        sessions_1 <span class="op">+=</span> [<span class="dv">1</span>] <span class="op">*</span> c <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> (v <span class="op">-</span> c) </span>
<span id="cb16-15"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="" aria-hidden="true" tabindex="-1"></a>    sessions_2 <span class="op">=</span> []</span>
<span id="cb16-17"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v, c <span class="kw">in</span> <span class="bu">zip</span>(views_2, clicks_2):</span>
<span id="cb16-18"><a href="" aria-hidden="true" tabindex="-1"></a>        sessions_2 <span class="op">+=</span> [<span class="dv">1</span>] <span class="op">*</span> c <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> (v <span class="op">-</span> c) </span>
<span id="cb16-19"><a href="" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-20"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proportions_ztest(</span>
<span id="cb16-21"><a href="" aria-hidden="true" tabindex="-1"></a>        count<span class="op">=</span>[<span class="bu">sum</span>(sessions_1), <span class="bu">sum</span>(sessions_2)],</span>
<span id="cb16-22"><a href="" aria-hidden="true" tabindex="-1"></a>        nobs<span class="op">=</span>[<span class="bu">len</span>(sessions_1), <span class="bu">len</span>(sessions_2)]</span>
<span id="cb16-23"><a href="" aria-hidden="true" tabindex="-1"></a>    )[<span class="dv">1</span>]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="приклад-стрімінговий-музичний-сервіс-4" class="slide level2 smaller">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<p>Проводимо 10000 A/A-експериментів і рахуємо p-value</p>
<div id="aa-data-pvalue" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb17-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="" aria-hidden="true" tabindex="-1"></a>users_num <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb17-4"><a href="" aria-hidden="true" tabindex="-1"></a>pvalues <span class="op">=</span> [get_pvalue() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>)]</span>
<span id="cb17-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(pvalues)</span>
<span id="cb17-7"><a href="" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'p-value'</span>)</span>
<span id="cb17-8"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb17-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'В середньому </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.array(pvalues) <span class="op">&lt;</span> <span class="fl">0.05</span>)<span class="sc">:.2%}</span><span class="ss"> p-value менше 0.05'</span>))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div id="aa-data-pvalue-2" class="cell-output cell-output-display cell-output-markdown">
<p>В середньому 9.91% p-value менше 0.05</p>
</div>
</div>
<img data-src=".03_files/figure-revealjs/aa-data-pvalue-output-1.svg" id="aa-data-pvalue-1" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="приклад-стрімінговий-музичний-сервіс-5" class="slide level2">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<ul>
<li>Дані з однієї генеральної сукупності</li>
<li>Але при рівні значущості <span class="math inline">\(\alpha = 0.05\)</span> ми вихиляємо нульову гіпотезу в 1.98 рази частіше, ніж очікувалося</li>
</ul>
<div class="fragment">
<p>Чому так вийшло?</p>
</div>
<div class="fragment">
<p>Сесія <strong>залежить</strong> від переглядів і кліків на плейлист, а не від розбиття на групи.</p>
</div>
</section>
<section id="приклад-стрімінговий-музичний-сервіс-6" class="slide level2 smaller">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<p>Альтернатива: порівнювати кліки між групами</p>
<div id="aa-data-split-2" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> mannwhitneyu</span>
<span id="cb18-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pvalue(): </span>
<span id="cb18-4"><a href="" aria-hidden="true" tabindex="-1"></a>    user_ctr <span class="op">=</span> np.random.beta(alpha, beta, size<span class="op">=</span>users_num)</span>
<span id="cb18-5"><a href="" aria-hidden="true" tabindex="-1"></a>    views <span class="op">=</span> np.random.lognormal(mean<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>users_num).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb18-6"><a href="" aria-hidden="true" tabindex="-1"></a>    clicks <span class="op">=</span> np.random.binomial(views, user_ctr)</span>
<span id="cb18-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.random.rand(<span class="bu">len</span>(views)) <span class="op">&lt;</span> <span class="fl">0.5</span></span>
<span id="cb18-9"><a href="" aria-hidden="true" tabindex="-1"></a>    views_1, clicks_1 <span class="op">=</span> views[mask], clicks[mask]</span>
<span id="cb18-10"><a href="" aria-hidden="true" tabindex="-1"></a>    views_2, clicks_2 <span class="op">=</span> views[<span class="op">~</span>mask], clicks[<span class="op">~</span>mask]</span>
<span id="cb18-11"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mannwhitneyu(clicks_1, clicks_2)[<span class="dv">1</span>]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="приклад-стрімінговий-музичний-сервіс-7" class="slide level2 smaller">
<h2>Приклад: стрімінговий музичний сервіс</h2>
<p>Проводимо 10000 A/A-експериментів за альтернативним сценарієм і рахуємо p-value</p>
<div id="aa-data-pvalue-2" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="" aria-hidden="true" tabindex="-1"></a>pvalues <span class="op">=</span> [get_pvalue() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>)]</span>
<span id="cb19-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(pvalues)</span>
<span id="cb19-4"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'p-values'</span>)</span>
<span id="cb19-5"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb19-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'В середньому </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.array(pvalues) <span class="op">&lt;</span> <span class="fl">0.05</span>)<span class="sc">:.2%}</span><span class="ss"> p-value менше 0.05'</span>))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div id="aa-data-pvalue-2-2" class="cell-output cell-output-display cell-output-markdown">
<p>В середньому 4.91% p-value менше 0.05</p>
</div>
</div>
<img data-src=".03_files/figure-revealjs/aa-data-pvalue-2-output-1.svg" id="aa-data-pvalue-2-1" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="алгоритм-аа-експерименту" class="slide level2">
<h2>Алгоритм А/А-експерименту</h2>
<ol type="1">
<li>Взяти вибірку з метриками (бажано без експерементів)</li>
<li>Симулюємо А/А-експерименти (десятки тисяч разів)</li>
<li>Оцінюємо p-value у кожному експерименті і порівнюємо з рівнем значущості <span class="math inline">\(\alpha\)</span></li>
<li>Оцінюємо кількість помилок першого роду (хибнопозитивних) і дивимось розподіл p-value</li>
<li>Порівнюємо з очікуваною кількістю помилок першого роду</li>
</ol>
</section>
<section id="обмеження-і-інші-моменти" class="slide level2">
<h2>Обмеження і інші моменти</h2>
<ul>
<li>А/А бажано проводити якомога довше, щоб досягти достатньої репрезентативності (охопити тижневу сезонність і різні групи користувачів)</li>
<li>У разі, якщо немає можливості чекати, то не рекомендується використовувати “довгограючі” метрики для перевірки спліту (наприклад, С2 - конверсія в покупку)</li>
<li>Пост-симуляції потрібно робити без повернення спостережень у сплітах</li>
<li>Для пост-симуляцій найкраще підійде бутстрап, завдяки своїй точності</li>
</ul>
</section>
<section id="де-ще-застосовують-aa-тестування" class="slide level2">
<h2>Де ще застосовують A/A-тестування</h2>
<ul>
<li>A/A/B для контролю втручання інших (паралельних) експериментів</li>
<li>Підбір релевантних груп для порівняння між собою (наприклад, пошук близьких регіонів)</li>
<li>Симуляції для перевірки статистичного оцінювача (наприклад, щоб перевірити потужність для тесту при різних treatment ефектах)</li>
</ul>
</section></section>
<section>
<section id="вибір-метода-тестування" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Вибір метода тестування</h1>

</section>
<section id="блок-схема-вибору-метода-тестування" class="slide level2 smaller scrollable">
<h2>Блок схема вибору метода тестування</h2>
<div class="cell" data-reveal="true" data-layout-align="center">
<div class="cell-output-display">
<div id="test-choose">
<div>
<pre class="mermaid mermaid-js" data-label="test-choose">flowchart TD
    
    A[Тип даних] --&gt;|Неперервні|B[Тип питання?]
    A --&gt;|Дискретні|C[Хі-квадрат]
    B --&gt; |Взаємозвязок| D[Чи є незалежна змінна?]
    B --&gt; |Різниця| E[Різниця між чим?]
    D --&gt; |Так| F[Регресійний аналіз]
    D --&gt; |Ні| G[Кореляційний аналіз]
    G --&gt; |Параметричний| T[Кореляція Пірсона]
    G --&gt; |Непараметричний| U[Кореляція Спірмена]
    E --&gt; |Тест однаковості дисперсії| H[F тест,&lt;br/&gt; Тест Брауна-Форсайта,&lt;br/&gt; Тест Бартлетта]
    E --&gt; |Середніх| I[Скільки груп?]
    I --&gt; |2| J[Параметричні умови виконуються?]
    I --&gt; |&gt; 2| K[Параметричні умови виконуються?]
    J --&gt; |Так| L[t-тест для незалежних вибірок,&lt;br/&gt; t-тест для залежних вибірок]
    J --&gt; |Ні| M[Трансформація даних працює?]
    M --&gt; |Так| L
    M --&gt; |Ні| N[Манна-Уїтні,&lt;br/&gt; Вілкоксон]
    K --&gt; |Так| O[ANOVA]
    K --&gt; |Ні| P[Трансформація даних працює?]
    P --&gt; |Так| O
    P --&gt; |Ні| Q[Критерій Краскела-Уолліса]
    O --&gt; R[Пост-аналіз: &lt;br/&gt;Тест Тьюкі, &lt;br/&gt;Бонферроні]
    Q --&gt; S[Пост-аналіз: &lt;br/&gt;Тест Данна]

    style noteA opacity:0
    style noteA color:#0000
    subgraph noteA ["`**Параметричні умови:**&lt;br/&gt;1. Нормальність&lt;br/&gt;2. Рівність дисперсій&lt;br/&gt;3. Незалежні, незміщенні вибірки`"]
    end
</pre>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="розбиття-на-групи" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Розбиття на групи</h1>

</section>
<section id="розбиття-користувачів-на-групи" class="slide level2">
<h2>Розбиття користувачів на групи</h2>
<ul>
<li>Основна мета — створити контрольну і тестову вибірку так, щоб вони були максимально схожі</li>
<li>Досягається за рахунок випадкового розподілу користувачів на групи</li>
<li>Розбиття повинно бути відтворюваним</li>
<li>Зазвичай реалізується через використання <span class="hi">хеш-функції</span> від ідентифікатора користувача з певною <span class="purple">сіллю</span></li>
</ul>
</section>
<section id="хеш-функція-та-сіль" class="slide level2">
<h2>Хеш-функція та сіль</h2>
<ul>
<li>Хеш-функція - це функція, яка перетворює будь-який об’єкт на випадковий набір байтів</li>
<li>Хеш-функція має властивість, що при однакових вхідних даних вона завжди повертає один і той же результат</li>
<li>Сіль - це додатковий параметр, який додається до вхідних даних</li>
<li>Сіль дозволяє змінити результат хеш-функції, якщо вхідні дані не змінилися</li>
</ul>
</section>
<section id="приклад" class="slide level2 smaller">
<h2>Приклад</h2>
<p>Згенеруємо тестові дані для розбиття на групи:</p>
<div id="cell-data-gen" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb20-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb20-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="" aria-hidden="true" tabindex="-1"></a>user_id <span class="op">=</span> np.random.choice(<span class="bu">range</span>(<span class="dv">1000</span>), size<span class="op">=</span>n_users, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'user_id'</span>: user_id})</span>
<span id="cb20-11"><a href="" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="data-gen" class="cell-output cell-output-display" data-execution_count="18">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>681</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>990</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>155</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>768</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>438</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="приклад-1" class="slide level2 smaller">
<h2>Приклад</h2>
<p>Використаємо md5-хеш-функцію для розбиття на групи:</p>
<div id="cell-hash" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb21-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Тестові дані</span></span>
<span id="cb21-4"><a href="" aria-hidden="true" tabindex="-1"></a>salt <span class="op">=</span> <span class="st">'test'</span></span>
<span id="cb21-5"><a href="" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">'id_999'</span></span>
<span id="cb21-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Об'єднуємо дані</span></span>
<span id="cb21-8"><a href="" aria-hidden="true" tabindex="-1"></a>value_str <span class="op">=</span> user <span class="op">+</span> salt</span>
<span id="cb21-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Перетворюємо в байти</span></span>
<span id="cb21-11"><a href="" aria-hidden="true" tabindex="-1"></a>value_num <span class="op">=</span> <span class="bu">int</span>(hashlib.md5(value_str.encode(<span class="st">'utf-8'</span>)).hexdigest(), <span class="dv">16</span>)</span>
<span id="cb21-12"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Розбиваємо на групи за допомогою остачі від ділення</span></span>
<span id="cb21-14"><a href="" aria-hidden="true" tabindex="-1"></a>value_num <span class="op">%</span> <span class="dv">100</span></span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="hash" class="cell-output cell-output-display" data-execution_count="19">
<pre><code>72</code></pre>
</div>
</div>
</section>
<section id="приклад-2" class="slide level2 smaller">
<h2>Приклад</h2>
<p>Застосуємо до всіх користувачів:</p>
<div id="cell-hash-apply" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Створюємо функцію для розбиття на групи</span></span>
<span id="cb23-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hash_group(user_id, salt, n_groups):</span>
<span id="cb23-3"><a href="" aria-hidden="true" tabindex="-1"></a>    value_str <span class="op">=</span> <span class="bu">str</span>(user_id) <span class="op">+</span> <span class="bu">str</span>(salt)</span>
<span id="cb23-4"><a href="" aria-hidden="true" tabindex="-1"></a>    value_num <span class="op">=</span> <span class="bu">int</span>(hashlib.md5(value_str.encode()).hexdigest(), <span class="dv">16</span>)</span>
<span id="cb23-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value_num <span class="op">%</span> n_groups</span>
<span id="cb23-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="" aria-hidden="true" tabindex="-1"></a>salt <span class="op">=</span> <span class="st">'test_1'</span></span>
<span id="cb23-8"><a href="" aria-hidden="true" tabindex="-1"></a>n_groups <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb23-9"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Застосовуємо функцію до всіх користувачів</span></span>
<span id="cb23-11"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'group'</span>] <span class="op">=</span> df[<span class="st">'user_id'</span>].<span class="bu">apply</span>(hash_group, args<span class="op">=</span>(salt, n_groups))</span>
<span id="cb23-12"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Перевіряємо розподіл користувачів</span></span>
<span id="cb23-14"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'group'</span>].value_counts()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="hash-apply" class="cell-output cell-output-display" data-execution_count="20">
<pre><code>group
1    512
0    488
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="приклад-3" class="slide level2 smaller">
<h2>Приклад</h2>
<div id="cell-aa" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb25-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Чи клікнув користувач на рекламу</span></span>
<span id="cb25-4"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'clicks'</span>] <span class="op">=</span> np.random.choice(<span class="bu">range</span>(<span class="dv">2</span>), size<span class="op">=</span>n_users, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co"># Розбиваємо на групи</span></span>
<span id="cb25-7"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'aa_1'</span>] <span class="op">=</span> df[<span class="st">'user_id'</span>].<span class="bu">apply</span>(hash_group, args<span class="op">=</span>(<span class="st">'aa_1'</span>, n_groups))</span>
<span id="cb25-8"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'aa_2'</span>] <span class="op">=</span> df[<span class="st">'user_id'</span>].<span class="bu">apply</span>(hash_group, args<span class="op">=</span>(<span class="st">'aa_2'</span>, n_groups))</span>
<span id="cb25-9"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'aa_3'</span>] <span class="op">=</span> df[<span class="st">'user_id'</span>].<span class="bu">apply</span>(hash_group, args<span class="op">=</span>(<span class="st">'aa_3'</span>, n_groups))</span>
<span id="cb25-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="aa" class="cell-output cell-output-display" data-execution_count="22">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">clicks</th>
<th data-quarto-table-cell-role="th">aa_1</th>
<th data-quarto-table-cell-role="th">aa_2</th>
<th data-quarto-table-cell-role="th">aa_3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>681</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>990</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>155</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>768</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>438</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="перевірка-сплітів" class="slide level2">
<h2>Перевірка сплітів</h2>
<ul>
<li>Перевіряємо основні сегменти на рівність</li>
<li>Розмір груп має бути достатньо близьким один до одного</li>
<li>Важливо перевіряти розміри ортогональних експериментів, тобто коли проводяться два експерименти, але користувачі розбиваються за допомогою різних солей.</li>
</ul>
</section>
<section id="потужність-критерію" class="slide level2 smaller">
<h2>Потужність критерію</h2>
<p>Згенеруємо дані для експерименту:</p>
<div id="power" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="" aria-hidden="true" tabindex="-1"></a>users_num <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb26-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="" aria-hidden="true" tabindex="-1"></a>mean_user_ctr <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb26-4"><a href="" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb26-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_clicks(effect<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb26-7"><a href="" aria-hidden="true" tabindex="-1"></a>    new_mean_user_ctr <span class="op">=</span> mean_user_ctr <span class="op">+</span> effect</span>
<span id="cb26-8"><a href="" aria-hidden="true" tabindex="-1"></a>    alpha <span class="op">=</span> new_mean_user_ctr <span class="op">*</span> beta <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> new_mean_user_ctr)</span>
<span id="cb26-9"><a href="" aria-hidden="true" tabindex="-1"></a>    user_ctr <span class="op">=</span> np.random.beta(alpha, beta, size<span class="op">=</span>users_num)</span>
<span id="cb26-10"><a href="" aria-hidden="true" tabindex="-1"></a>    views <span class="op">=</span> np.random.lognormal(mean<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>users_num).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb26-11"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.random.binomial(views, user_ctr)</span>
<span id="cb26-12"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pvalue(): </span>
<span id="cb26-14"><a href="" aria-hidden="true" tabindex="-1"></a>    clicks_1 <span class="op">=</span> get_clicks(effect<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-15"><a href="" aria-hidden="true" tabindex="-1"></a>    clicks_2 <span class="op">=</span> get_clicks(effect<span class="op">=</span><span class="fl">0.03</span>)</span>
<span id="cb26-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mannwhitneyu(clicks_1, clicks_2)[<span class="dv">1</span>]</span>
<span id="cb26-17"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="" aria-hidden="true" tabindex="-1"></a>pvalues <span class="op">=</span> [get_pvalue() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>)]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="потужність-критерію-1" class="slide level2 smaller">
<h2>Потужність критерію</h2>
<p>Графік розподілу p-value:</p>
<div id="power-plot" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(pvalues)</span>
<span id="cb27-2"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'p-values'</span>)</span>
<span id="cb27-3"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'В середньому </span><span class="sc">{</span>np<span class="sc">.</span>mean(np.array(pvalues) <span class="op">&lt;</span> <span class="fl">0.05</span>)<span class="sc">:.2%}</span><span class="ss"> p-value менше 0.05'</span>))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div id="power-plot-2" class="cell-output cell-output-display cell-output-markdown">
<p>В середньому 64.82% p-value менше 0.05</p>
</div>
</div>
<img data-src=".03_files/figure-revealjs/power-plot-output-1.svg" id="power-plot-1" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="потужність-критерію-2" class="slide level2 smaller">
<h2>Потужність критерію</h2>
<p>Потужність критерію при оцінці числа кліків:</p>
<div id="power-plot-2" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> rankdata</span>
<span id="cb28-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="" aria-hidden="true" tabindex="-1"></a>sorted_pvalues <span class="op">=</span> np.sort(pvalues)</span>
<span id="cb28-4"><a href="" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> rankdata(sorted_pvalues, method<span class="op">=</span><span class="st">'ordinal'</span>)</span>
<span id="cb28-5"><a href="" aria-hidden="true" tabindex="-1"></a>cdf <span class="op">=</span> position <span class="op">/</span> sorted_pvalues.shape[<span class="dv">0</span>]</span>
<span id="cb28-6"><a href="" aria-hidden="true" tabindex="-1"></a>sorted_data <span class="op">=</span> np.hstack((sorted_pvalues, <span class="dv">1</span>))</span>
<span id="cb28-7"><a href="" aria-hidden="true" tabindex="-1"></a>cdf <span class="op">=</span> np.hstack((cdf, <span class="dv">1</span>))</span>
<span id="cb28-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="" aria-hidden="true" tabindex="-1"></a>plt.plot(sorted_data, cdf, linestyle<span class="op">=</span><span class="st">'solid'</span>)</span>
<span id="cb28-10"><a href="" aria-hidden="true" tabindex="-1"></a>plt.axvline(<span class="fl">0.05</span>, color<span class="op">=</span><span class="st">'k'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb28-11"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="fl">0.05</span>,<span class="fl">1.02</span>)</span>
<span id="cb28-12"><a href="" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">0.02</span>,<span class="fl">1.02</span>)</span>
<span id="cb28-13"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$\alpha$'</span>)</span>
<span id="cb28-14"><a href="" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потужність'</span>)</span>
<span id="cb28-15"><a href="" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Потужність критерію Манна-Уітні при оцінці числа кліків'</span>)</span>
<span id="cb28-16"><a href="" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb28-17"><a href="" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'power.pdf'</span>)</span>
<span id="cb28-18"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb28-19"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'Чим вища потужність критерію, частіше ми припускаємо помилки першого роду.</span><span class="ch">\n</span><span class="ss">Тобто для даного прикладу, приблизно у 65% випадків ми зможемо виявити ефект, а у 35% випадків - ні.'</span>))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="потужність-критерію-2-output" class="slide level2 smaller output-location-slide"><h2>Потужність критерію</h2><div class="cell output-location-slide" data-execution_count="26">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-2-output-1.svg" id="power-plot-2-1" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div id="power-plot-2-2" class="cell-output cell-output-display cell-output-markdown">
<p>Чим вища потужність критерію, частіше ми припускаємо помилки першого роду. Тобто для даного прикладу, приблизно у 65% випадків ми зможемо виявити ефект, а у 35% випадків - ні.</p>
</div>
</div></section><section id="потужність-критерію-3" class="slide level2">
<h2>Потужність критерію</h2>
<p>Потужність критерію залежить від:</p>
<ul>
<li><strong>Статистичного критерію</strong>
<ul>
<li>Критерії, які використовують ранги, мають більшу потужність</li>
<li>Критерії, які використовують значення, мають меншу потужність</li>
</ul></li>
</ul>
<p>Слід перевіряти, які критерії працюють краще для наших даних</p>
</section>
<section id="потужність-критерію-4" class="slide level2">
<h2>Потужність критерію</h2>
<p>Потужність критерію залежить від:</p>
<ul>
<li><strong>Дисперсії даних</strong></li>
</ul>
<div id="power-plot-3" class="cell quarto-layout-panel" data-layout-ncol="2" data-execution_count="27">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-3-output-1.svg" id="power-plot-3-1" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-3-output-2.svg" id="power-plot-3-2" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="потужність-критерію-5" class="slide level2">
<h2>Потужність критерію</h2>
<p>Потужність критерію залежить від:</p>
<ul>
<li><strong>Розмір ефекту</strong> — чим більший ефект, ти легше його виявити</li>
</ul>
<div id="power-plot-4" class="cell quarto-layout-panel" data-layout-ncol="2" data-execution_count="28">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-4-output-1.svg" id="power-plot-4-1" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-4-output-2.svg" id="power-plot-4-2" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="потужність-критерію-6" class="slide level2 smaller">
<h2>Потужність критерію</h2>
<p>Потужність критерію залежить від:</p>
<ul>
<li><strong>Розміру вибірки</strong> — чим більша вибірка, тим легше виявити ефект</li>
</ul>
<p>Наприклад, для критеію Стюдента — значення статистики збільшується при збільшенні вибірки</p>
<p><span class="math display">\[T_N=\frac{\overline{X}-\mu}{\frac{S}{\sqrt{N}}}\]</span></p>
<p>У цьому критерію потужність зростаю пропорційно <span class="math inline">\(\sqrt{N}\)</span>, тобто для того, щоб зменшити помилку вдвічі, потрібно збільшити вибірку в чотири рази</p>
</section>
<section id="потужність-через-аа-експерименти" class="slide level2 smaller">
<h2>Потужність через А/А-експерименти</h2>
<p>Також можна оцінювати потужність критерію через А/А-експерименти. Для цього потрібно:</p>
<p>Штучно будемо збільшимо ефект для однієї групи:</p>
<div id="power-aa" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="" aria-hidden="true" tabindex="-1"></a>users_num <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb29-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="" aria-hidden="true" tabindex="-1"></a>mean_user_ctr <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb29-4"><a href="" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb29-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_clicks(effect<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb29-7"><a href="" aria-hidden="true" tabindex="-1"></a>    new_mean_user_ctr <span class="op">=</span> mean_user_ctr <span class="op">+</span> effect</span>
<span id="cb29-8"><a href="" aria-hidden="true" tabindex="-1"></a>    alpha <span class="op">=</span> new_mean_user_ctr <span class="op">*</span> beta <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> new_mean_user_ctr)</span>
<span id="cb29-9"><a href="" aria-hidden="true" tabindex="-1"></a>    user_ctr <span class="op">=</span> np.random.beta(alpha, beta, size<span class="op">=</span>users_num)</span>
<span id="cb29-10"><a href="" aria-hidden="true" tabindex="-1"></a>    views <span class="op">=</span> np.random.lognormal(mean<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>users_num).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb29-11"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.random.binomial(views, user_ctr)</span>
<span id="cb29-12"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_pvalue(effect):</span>
<span id="cb29-14"><a href="" aria-hidden="true" tabindex="-1"></a>    clicks_1 <span class="op">=</span> get_clicks(effect<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-15"><a href="" aria-hidden="true" tabindex="-1"></a>    clicks_2 <span class="op">=</span> get_clicks(effect<span class="op">=</span>effect)</span>
<span id="cb29-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mannwhitneyu(clicks_1, clicks_2)[<span class="dv">1</span>]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="потужність-через-аа-експерименти-1" class="slide level2 smaller scrollable">
<h2>Потужність через А/А-експерименти</h2>
<p>Проводимо 10000 А/А-експериментів, рахуємо p-value і оцінюємо потужність критерію:</p>
<div id="cell-power-aa-plot" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb30-2"><a href="" aria-hidden="true" tabindex="-1"></a>effects <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">0.07</span>, <span class="fl">0.01</span>)</span>
<span id="cb30-3"><a href="" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> []</span>
<span id="cb30-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> effect <span class="kw">in</span> effects:</span>
<span id="cb30-6"><a href="" aria-hidden="true" tabindex="-1"></a>    pvalues <span class="op">=</span> [get_pvalue(effect<span class="op">=</span>effect) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>)]</span>
<span id="cb30-7"><a href="" aria-hidden="true" tabindex="-1"></a>    power.append(np.mean(np.array(pvalues) <span class="op">&lt;</span> <span class="fl">0.05</span>))</span>
<span id="cb30-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="" aria-hidden="true" tabindex="-1"></a>plt.plot(effects, power, <span class="st">'o-'</span>)</span>
<span id="cb30-10"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Ефект'</span>)</span>
<span id="cb30-11"><a href="" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потужність'</span>)</span>
<span id="cb30-12"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<ul>
<li>Коли ефект маленький, то і потужність близька до нуля.</li>
<li>Коли ефект зростає, то потужність наближається до 1</li>
<li>Потужність потрібно знати, щоб не виявилося, що вона становить 20% - тільки кожен 5-й успішний експеримент може бути детектуваний.</li>
<li>Невеликі ефекти критерії профарбовують насилу - невеликі ефекти навряд чи допоможуть нашій компанії вирости.</li>
</ul>
</section><section id="потужність-через-аа-експерименти-1-output" class="slide level2 smaller scrollable output-location-slide"><h2>Потужність через А/А-експерименти</h2><div class="cell output-location-slide" data-execution_count="30">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-aa-plot-output-1.svg" id="power-aa-plot" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div></section></section>
<section>
<section id="тривалість-експерименту" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Тривалість експерименту</h1>

</section>
<section id="тривалість-експерименту-1" class="slide level2">
<h2>Тривалість експерименту</h2>
<p>Розмір вибірки визначає тривалість експерименту.</p>
<p>Якщо ми хочемо виявити ефект 1%, то нам потрібно зібрати більше даних, ніж для виявлення ефекту 10%</p>
<p>Тобто в нас є дві альтернативи:</p>
<ul>
<li>Збільшити розмір вибірки</li>
<li>Збільшити тривалість експерименту</li>
</ul>
</section>
<section id="тривалість-експерименту-2" class="slide level2">
<h2>Тривалість експерименту</h2>
<p>Тривалість має бути репрезентативною для генеральної сукупності, наприклад, враховувати повні тижні.</p>
<p>Скільки часу нам треба?</p>
<div class="fragment">
<p>Мінімальний ефект, який можна виявити (MDE, англ. <em>Minimal detectable effect</em>)</p>
</div>
</section>
<section id="mde" class="slide level2 smaller">
<h2>MDE</h2>
<p>MDE - це мінімальний ефект, який ми зможемо виявити для заданого рівня значущості <span class="math inline">\(\alpha\)</span> та потужності критерію <span class="math inline">\(\beta\)</span>.</p>
<p>Визначається для кожної статистичного критерію окремо.</p>
<p>Наприклад, для критерію Сюдента:</p>
<p><span class="math display">\[\delta = (t_{1-\alpha/2} + t_{\beta}) \sigma\frac{2}{\sqrt{N}}\]</span></p>
<ul>
<li>Чим менший рівень значущості, тим більші значення квантиля у t-розподілу ми отримаємо.</li>
<li>Чим більшу потужність ми хочемо отримати, тим більший квантиль t-розподілу потрібно взяти.</li>
<li>Чим більша дисперсія в даних, тим ефект більший. Чим більше даних - тим менший MDE.</li>
</ul>
</section>
<section id="mde-1" class="slide level2">
<h2>MDE</h2>
<p>Якщо ми знаємо розподіл метрик, яка в них дисперсія, яку потужність хочемо отримати і якого розміру вибірку використовуватимемо - ми можемо обчислити MDE.</p>
<div id="cell-mde" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb31-2"><a href="" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb31-3"><a href="" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb31-4"><a href="" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb31-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> t</span>
<span id="cb31-7"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> sigma <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">/</span> N)</span>
<span id="cb31-9"><a href="" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> t(N<span class="op">-</span><span class="dv">1</span>).ppf(q<span class="op">=</span><span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> t(N<span class="op">-</span><span class="dv">1</span>).ppf(q<span class="op">=</span>power)</span>
<span id="cb31-10"><a href="" aria-hidden="true" tabindex="-1"></a>S <span class="op">*</span> M</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="mde" class="cell-output cell-output-display" data-execution_count="30">
<pre><code>0.19812131073445988</code></pre>
</div>
</div>
<p>Мінімальний ефект, який можна виявити, складає 0.2.</p>
</section>
<section id="mde-2" class="slide level2 smaller">
<h2>MDE</h2>
<p>Графік залежності MDE від розміру вибірки:</p>
<div id="cell-mde-plot" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_mde(N):</span>
<span id="cb33-2"><a href="" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> sigma <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">/</span> N)</span>
<span id="cb33-3"><a href="" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> t(N<span class="op">-</span><span class="dv">1</span>).ppf(q<span class="op">=</span><span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> t(N<span class="op">-</span><span class="dv">1</span>).ppf(q<span class="op">=</span>power)</span>
<span id="cb33-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> M <span class="op">*</span> S</span>
<span id="cb33-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">100</span>, <span class="dv">10000</span>, <span class="dv">100</span>)</span>
<span id="cb33-7"><a href="" aria-hidden="true" tabindex="-1"></a>mde <span class="op">=</span> [calc_mde(n) <span class="cf">for</span> n <span class="kw">in</span> x]</span>
<span id="cb33-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="" aria-hidden="true" tabindex="-1"></a>plt.plot(x, mde)</span>
<span id="cb33-10"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'N'</span>)</span>
<span id="cb33-11"><a href="" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'MDE'</span>)</span>
<span id="cb33-12"><a href="" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'sigma=5, alpha=0.05, power=0.8'</span>)</span>
<span id="cb33-13"><a href="" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb33-14"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="mde-2-output" class="slide level2 smaller output-location-slide"><h2>MDE</h2><div class="cell output-location-slide" data-execution_count="32">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/mde-plot-output-1.svg" id="mde-plot" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div></section><section id="розмір-вибірки" class="slide level2">
<h2>Розмір вибірки</h2>
<p>У зворотний бік можна за очікуваним ефектом обчислити необхідний розмір вибірки:</p>
<p><span class="math display">\[N = \frac{2\sigma^2(t_{1-\alpha/2} + t_{\beta})^2}{effect^2}\]</span></p>
</section></section>
<section>
<section id="методи-зменшення-дисперсії" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Методи зменшення дисперсії</h1>

</section>
<section id="що-впливає-на-потужність" class="slide level2">
<h2>Що впливає на потужність</h2>
<ul>
<li>Вибір критерію</li>
<li>Величина ефекту</li>
<li>Кількість спостережень</li>
<li>Дисперсія даних</li>
</ul>
</section>
<section id="що-впливає-на-потужність-1" class="slide level2">
<h2>Що впливає на потужність</h2>
<ul>
<li>Вибір критерію - беремо кращій</li>
<li>Величина ефекту - яка є</li>
<li>Кількість спостережень - чим більше, тим краще</li>
<li>Дисперсія даних - ?</li>
</ul>
</section>
<section id="величина-дисперсії" class="slide level2">
<h2>Величина дисперсії</h2>
<ul>
<li>Чим більша дисперсія, тим складніше виявити ефект</li>
</ul>
<div id="power-plot-new" class="cell quarto-layout-panel" data-layout-ncol="2" data-execution_count="33">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-new-output-1.svg" id="power-plot-new-1" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/power-plot-new-output-2.svg" id="power-plot-new-2" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="довірчий-інтервал" class="slide level2">
<h2>Довірчий інтервал</h2>
<ul>
<li>Довірчий інтервал - це інтервал, який містить параметр з заданою ймовірністю</li>
</ul>
<p><span class="math display">\[ \overline{X} \pm t_{N-1,1-\frac{\alpha}{2}} \frac{S}{\sqrt{N}}\]</span></p>
</section>
<section id="cuped" class="slide level2">
<h2>CUPED</h2>
<p>Уявімо, що в нас є 2 користувачі:</p>
<ul>
<li>До експерименту в першого було 3 прослуховування треків, у другого - 15</li>
<li>Під час експерименту стало 4 і 16 відповідно</li>
<li>Дисперсія помітно більша, ніж ефект</li>
<li>Як нам виключити особливості користувача, а дивитися на потенційну зміну?</li>
</ul>
</section>
<section id="cuped-1" class="slide level2">
<h2>CUPED</h2>
<ul>
<li>Виключаємо ефект із метрики</li>
<li>Вводимо нову метрику:</li>
</ul>
<p><span class="math display">\[ Y_{cuped} = Y - \theta X\]</span></p>
<ul>
<li><span class="math inline">\(Y\)</span> - початкова метрика</li>
<li><span class="math inline">\(X\)</span> - деякий показник користувача, який не залежить від потрапляння користувача в групу</li>
<li><span class="math inline">\(\theta\)</span> - загальний параметр</li>
</ul>
<p>Що за <span class="math inline">\(X\)</span> і де взяти <span class="math inline">\(\theta\)</span>?</p>
</section>
<section id="cuped-2" class="slide level2">
<h2>CUPED</h2>
<p>Дисперсія нової метрики:</p>
<p><span class="math display">\[Var(Y_{cuped}) = Var(Y) + \theta^2 Var(X) - 2\theta Cov(Y, X)\]</span></p>
<p>тоді:</p>
<p><span class="math display">\[\theta = \frac{Cov(Y, X)}{Var(X)}\]</span></p>
</section>
<section id="cuped-3" class="slide level2">
<h2>CUPED</h2>
<p><span class="math display">\[\theta = \frac{Cov(Y, X)}{Var(X)}\]</span></p>
<p>Підствимо:</p>
<p><span class="math display">\[ Var(Y_{cuped}) = Var(Y) + \theta^2 Var(X) - 2\theta Cov(Y, X) = \\ Var(Y) + \frac{Cov(Y, X)^2}{Var(X)} - 2\frac{Cov(Y, X)^2}{Var(X)} = \\ Var(Y) - \frac{Cov(Y, X)^2}{Var(Y)Var(X)} = Var(Y)(1 - \rho^2(Y,X))\]</span></p>
</section>
<section id="cuped-4" class="slide level2">
<h2>CUPED</h2>
<ul>
<li>Звітки взяти <span class="math inline">\(X\)</span>? Як зробити так, щоб експеремент на нього не впливав?</li>
</ul>
<p>Наприклад, взяти показник користувача до експерименту:</p>
<p><span class="math display">\[Y_{cuped}= Y - \frac{Cov(Y, Y_{prev})}{Var(Y_{prev})}Y_{prev}\]</span></p>
<p>або</p>
<p><span class="math display">\[Y_{cuped}= Y - \frac{Cov(Y, Y_{prev})}{Var(Y_{prev})}(Y_{prev}-\overline{Y_{prev}})\]</span></p>
</section>
<section id="cuped-приклад" class="slide level2 smaller">
<h2>CUPED: приклад</h2>
<ul>
<li>Користувачі регулярно роблять покупки</li>
<li>У кожного користувача різна середня сума корзини і є різниця між покупками</li>
</ul>
<div id="cell-cuped" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb34-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="" aria-hidden="true" tabindex="-1"></a>users_num <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb34-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb34-6"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'user'</span>] <span class="op">=</span> <span class="bu">range</span>(users_num)</span>
<span id="cb34-7"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'group'</span>] <span class="op">=</span> np.random.rand(users_num) <span class="op">&lt;</span> <span class="fl">0.5</span></span>
<span id="cb34-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'user_mean'</span>] <span class="op">=</span> np.random.uniform(<span class="dv">400</span>, <span class="dv">1000</span>, size<span class="op">=</span>users_num)</span>
<span id="cb34-10"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'cost_before'</span>] <span class="op">=</span> df[<span class="st">'user_mean'</span>] <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">50</span>, size<span class="op">=</span>users_num)</span>
<span id="cb34-11"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'cost'</span>] <span class="op">=</span> df[<span class="st">'user_mean'</span>] <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">50</span>, size<span class="op">=</span>users_num)</span>
<span id="cb34-12"><a href="" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="cuped" class="cell-output cell-output-display" data-execution_count="33">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">user_mean</th>
<th data-quarto-table-cell-role="th">cost_before</th>
<th data-quarto-table-cell-role="th">cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>True</td>
<td>640.663845</td>
<td>661.172318</td>
<td>654.736238</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>False</td>
<td>958.368641</td>
<td>993.761613</td>
<td>1016.476790</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>True</td>
<td>709.201688</td>
<td>654.161839</td>
<td>707.446650</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>False</td>
<td>885.749211</td>
<td>963.991729</td>
<td>844.468461</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>False</td>
<td>929.063337</td>
<td>957.175482</td>
<td>913.605361</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="cuped-приклад-1" class="slide level2 smaller">
<h2>CUPED: приклад</h2>
<p>Рахуємо параметр <span class="math inline">\(\theta\)</span>:</p>
<p><span class="math display">\[\theta = \frac{Cov(Y, X)}{Var(X)}\]</span></p>
<div id="cell-cuped-2" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> np.cov(df[<span class="st">'cost'</span>], df[<span class="st">'cost_before'</span>])[<span class="dv">0</span>, <span class="dv">1</span>] <span class="op">/</span> np.var(df[<span class="st">'cost_before'</span>])</span>
<span id="cb35-2"><a href="" aria-hidden="true" tabindex="-1"></a>theta</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="cuped-2" class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0.9240442595985432</code></pre>
</div>
</div>
<p>Стивимо нову метрику:</p>
<p><span class="math display">\[Y_{cuped}= Y - \frac{Cov(Y, Y_{prev})}{Var(Y_{prev})}(Y_{prev}-\overline{Y_{prev}})\]</span></p>
<div id="cuped-3" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'cost_cuped'</span>] <span class="op">=</span> df[<span class="st">'cost'</span>] <span class="op">-</span> theta <span class="op">*</span> (df[<span class="st">'cost_before'</span>] <span class="op">-</span> df[<span class="st">'cost_before'</span>].mean())</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cuped-приклад-2" class="slide level2 smaller">
<h2>CUPED: приклад</h2>
<p>Порівняємо дисперсії для кожної групи і відсоток зменшення дисперсії:</p>
<div id="cell-cuped-4" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'group'</span>).agg({<span class="st">'cost'</span>: np.var, <span class="st">'cost_cuped'</span>: np.var}) <span class="op">\</span></span>
<span id="cb38-2"><a href="" aria-hidden="true" tabindex="-1"></a>  .assign(diff<span class="op">=</span><span class="kw">lambda</span> x: (x[<span class="st">'cost'</span>] <span class="op">/</span> x[<span class="st">'cost_cuped'</span>]))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="cuped-4" class="cell-output cell-output-display" data-execution_count="36">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cost</th>
<th data-quarto-table-cell-role="th">cost_cuped</th>
<th data-quarto-table-cell-role="th">diff</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">False</td>
<td>35571.103046</td>
<td>4695.137693</td>
<td>7.576158</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">True</td>
<td>32837.704531</td>
<td>4389.019044</td>
<td>7.481787</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="cuped-підсумки" class="slide level2 smaller">
<h2>CUPED: підсумки</h2>
<ul>
<li>Допомагає зменшити дисперсію на 20-30%</li>
<li>Корисний для дисперсних метрик, на менш дисперсних може давати близьконульовий буст</li>
<li>Зберігає ефект і інтерпретуємо (взяли нову метрику, яка вичищена стара)</li>
</ul>
</section></section>
<section>
<section id="ab-тести-і-відносні-метрики" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>A/B тести і відносні метрики</h1>

</section>
<section id="вимірювання-кліків" class="slide level2">
<h2>Вимірювання кліків</h2>
<ul>
<li>Більша частина метрик є бінарною: клікнув чи ні, купив чи ні, підписався чи ні</li>
<li>Якщо ми вимірюємо кліки, то ми можемо виміряти їх як абсолютну величину, так і відносно до кількості показів</li>
<li>Хочеться вимірювати CTR (click-through rate) - відношення кліків до показів:
<ul>
<li>глобально для всього сайту</li>
<li>для кожного користувача окремо і усереднити</li>
</ul></li>
</ul>
<p><span class="math display">\[CTR = \frac{clicks}{views}\]</span></p>
</section>
<section id="дані" class="slide level2">
<h2>Дані</h2>
<p>Згенеруємо дані для прикладу:</p>
<div id="ctr" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1234</span>)</span>
<span id="cb39-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="" aria-hidden="true" tabindex="-1"></a>users_num <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb39-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="" aria-hidden="true" tabindex="-1"></a>mean_user_ctr <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb39-6"><a href="" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb39-7"><a href="" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> mean_user_ctr <span class="op">*</span> beta <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> mean_user_ctr)</span>
<span id="cb39-8"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb39-10"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'user'</span>] <span class="op">=</span> <span class="bu">range</span>(users_num)</span>
<span id="cb39-11"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'group'</span>] <span class="op">=</span> np.random.rand(users_num) <span class="op">&lt;</span> <span class="fl">0.5</span></span>
<span id="cb39-12"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'base_user_ctr'</span>] <span class="op">=</span> np.random.beta(alpha, beta, size<span class="op">=</span>users_num)</span>
<span id="cb39-14"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'views'</span>] <span class="op">=</span> np.random.lognormal(mean<span class="op">=</span><span class="dv">1</span>, sigma<span class="op">=</span><span class="dv">1</span>, size<span class="op">=</span>users_num).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb39-15"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'clicks'</span>] <span class="op">=</span> np.random.binomial(df[<span class="st">'views'</span>], df[<span class="st">'base_user_ctr'</span>])</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="дані-візуалізація" class="slide level2 smaller">
<h2>Дані: візуалізація</h2>
<div id="ctr-plot" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'views'</span>], bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb40-2"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'views'</span>)</span>
<span id="cb40-3"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb40-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'clicks'</span>], bins<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb40-6"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'clicks'</span>)</span>
<span id="cb40-7"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/ctr-plot-output-1.svg" id="ctr-plot-1" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/ctr-plot-output-2.svg" id="ctr-plot-2" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="як-вимірювати-ctr" class="slide level2">
<h2>Як вимірювати CTR</h2>
<p><strong>Наївно:</strong></p>
<ul>
<li>Кожен клік — це випадкова величина з розподілу Бернуллі</li>
<li>Давайте порівнювати дві групи за рівністю <span class="math inline">\(p\)</span> в розподілі Бернуллі</li>
<li>Кращий варіант: Z-критерій для різниці двох долей</li>
</ul>
<div class="fragment">
<p><strong>Але:</strong></p>
<ul>
<li>Порушується незалежність спостережень — не контролюємо помилки першого роду</li>
</ul>
</div>
<div class="fragment">
<p><strong>Все пропало…</strong></p>
</div>
</section>
<section id="як-вимірювати-ctr-1" class="slide level2 smaller">
<h2>Як вимірювати CTR</h2>
<p><strong>Порівнюємо кількість кліків:</strong></p>
<ul>
<li>Рахуємо по кожному користувачу кількість кліків</li>
<li>Порівнюємо дві групи за допомогою t-критерію Стюдента або U-критерію Манна-Уітні</li>
</ul>
<div id="cell-clicks-ctr" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> mannwhitneyu</span>
<span id="cb41-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="" aria-hidden="true" tabindex="-1"></a>mannwhitneyu(df[df.group <span class="op">==</span> <span class="dv">0</span>].clicks, df[df.group <span class="op">==</span> <span class="dv">1</span>].clicks)[<span class="dv">1</span>]</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="clicks-ctr" class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0.029967161071032627</code></pre>
</div>
</div>
</section>
<section id="як-вимірювати-ctr-2" class="slide level2 smaller">
<h2>Як вимірювати CTR</h2>
<p>Але хотілося б враховувати і перегляди</p>
<ul>
<li>Груповий CTR:</li>
</ul>
<p><span class="math display">\[CTR = \frac{\sum_{i=1}^{N} clicks_i}{\sum_{i=1}^{N} views_i}\]</span></p>
</section>
<section id="ctr-і-бутстрап" class="slide level2">
<h2>CTR і бутстрап</h2>
<ul>
<li>Формуємо вибірки з поверненням</li>
<li>Для кожної вибірки рахуємо груповий CTR</li>
<li>Оцінюємо значущість різниці групових CTR</li>
</ul>
<div id="ctr-bootstrap" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="" aria-hidden="true" tabindex="-1"></a>n_iter <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb43-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="" aria-hidden="true" tabindex="-1"></a>data_1 <span class="op">=</span> df[df.group <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb43-4"><a href="" aria-hidden="true" tabindex="-1"></a>data_2 <span class="op">=</span> df[df.group <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb43-5"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> []</span>
<span id="cb43-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_iter):</span>
<span id="cb43-8"><a href="" aria-hidden="true" tabindex="-1"></a>    sampled_data_1 <span class="op">=</span> data_1.sample(n<span class="op">=</span><span class="bu">len</span>(data_1), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-9"><a href="" aria-hidden="true" tabindex="-1"></a>    sampled_data_2 <span class="op">=</span> data_2.sample(n<span class="op">=</span><span class="bu">len</span>(data_2), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-10"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="" aria-hidden="true" tabindex="-1"></a>    ctr_1 <span class="op">=</span> sampled_data_1.clicks.<span class="bu">sum</span>() <span class="op">/</span> sampled_data_1.views.<span class="bu">sum</span>()</span>
<span id="cb43-12"><a href="" aria-hidden="true" tabindex="-1"></a>    ctr_2 <span class="op">=</span> sampled_data_2.clicks.<span class="bu">sum</span>() <span class="op">/</span> sampled_data_2.views.<span class="bu">sum</span>()</span>
<span id="cb43-13"><a href="" aria-hidden="true" tabindex="-1"></a>    stats.append(ctr_1 <span class="op">-</span> ctr_2)</span>
<span id="cb43-14"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> np.array(stats)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ctr-і-бутстрап-1" class="slide level2">
<h2>CTR і бутстрап</h2>
<div id="ctr-bootstrap-plot" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(stats)</span>
<span id="cb44-2"><a href="" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Різниця CTR'</span>)</span>
<span id="cb44-3"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb44-4"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="" aria-hidden="true" tabindex="-1"></a>display(Markdown(<span class="ss">f'p-value = </span><span class="sc">{</span><span class="dv">2</span> <span class="op">*</span> <span class="bu">min</span>(<span class="bu">sum</span>(stats <span class="op">&lt;=</span> <span class="dv">0</span>), <span class="bu">sum</span>(stats <span class="op">&gt;=</span> <span class="dv">0</span>)) <span class="op">/</span> <span class="bu">len</span>(stats)<span class="sc">}</span><span class="ss">'</span>))</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div id="ctr-bootstrap-plot-2" class="cell-output cell-output-display cell-output-markdown">
<p>p-value = 0.51</p>
</div>
</div>
<img data-src=".03_files/figure-revealjs/ctr-bootstrap-plot-output-1.svg" id="ctr-bootstrap-plot-1" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="бакетинг" class="slide level2 smaller">
<h2>Бакетинг</h2>
<ul>
<li>Розбиваємо користувачів на бакети (100 груп) за допомогою хеш-функції</li>
<li>Для кожного бакету рахуємо груповий CTR</li>
<li>Порівнюємо дві вибірки по 100 елементів за допомогою t-критерію Стюдента або U-критерію Манна-Уітні</li>
</ul>
<div id="cell-ctr-bucketing" class="cell columns column-output-location" data-execution_count="43">
<div class="column">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb45-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'bucket'</span>] <span class="op">=</span> df[<span class="st">'user'</span>].<span class="bu">apply</span>(</span>
<span id="cb45-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="bu">int</span>(hashlib.md5((<span class="bu">str</span>(x) <span class="op">+</span> <span class="st">'my_salt'</span>).encode()).hexdigest(), <span class="dv">16</span>) <span class="op">%</span> <span class="dv">100</span></span>
<span id="cb45-5"><a href="" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(df.bucket)</span>
<span id="cb45-8"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column fragment">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src=".03_files/figure-revealjs/ctr-bucketing-output-1.svg" id="ctr-bucketing" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="бакетинг-1" class="slide level2 smaller">
<h2>Бакетинг</h2>
<p>Рахуємо метрики:</p>
<div id="cell-ctr-bucketing-2" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="" aria-hidden="true" tabindex="-1"></a>new_df <span class="op">=</span> df.groupby([<span class="st">'group'</span>, <span class="st">'bucket'</span>]).<span class="bu">sum</span>([<span class="st">'views'</span>, <span class="st">'ctr'</span>]).reset_index()</span>
<span id="cb46-2"><a href="" aria-hidden="true" tabindex="-1"></a>new_df[<span class="st">'ctr'</span>] <span class="op">=</span> new_df.clicks <span class="op">/</span> new_df.views</span>
<span id="cb46-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="" aria-hidden="true" tabindex="-1"></a>new_df.head()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="ctr-bucketing-2" class="cell-output cell-output-display" data-execution_count="43">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">bucket</th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">base_user_ctr</th>
<th data-quarto-table-cell-role="th">views</th>
<th data-quarto-table-cell-role="th">clicks</th>
<th data-quarto-table-cell-role="th">ctr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>False</td>
<td>0</td>
<td>190580</td>
<td>7.743613</td>
<td>215</td>
<td>31</td>
<td>0.144186</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>False</td>
<td>1</td>
<td>206513</td>
<td>9.642510</td>
<td>183</td>
<td>41</td>
<td>0.224044</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False</td>
<td>2</td>
<td>233691</td>
<td>10.473614</td>
<td>246</td>
<td>58</td>
<td>0.235772</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False</td>
<td>3</td>
<td>187097</td>
<td>9.967690</td>
<td>233</td>
<td>54</td>
<td>0.231760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False</td>
<td>4</td>
<td>284826</td>
<td>11.246381</td>
<td>207</td>
<td>36</td>
<td>0.173913</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Рахуємо статистику:</p>
<div id="cell-ctr-bucketing-3" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="" aria-hidden="true" tabindex="-1"></a>mannwhitneyu(new_df[new_df.group <span class="op">==</span> <span class="dv">0</span>].ctr, new_df[new_df.group <span class="op">==</span> <span class="dv">1</span>].ctr)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="ctr-bucketing-3" class="cell-output cell-output-display" data-execution_count="44">
<pre><code>MannwhitneyuResult(statistic=5278.5, pvalue=0.4969703468347265)</code></pre>
</div>
</div>
</section>
<section id="лінеризація" class="slide level2">
<h2>Лінеризація</h2>
<p><span class="math display">\[ CTR_{line}=Click - A \times Views\]</span></p>
<ul>
<li><span class="math inline">\(A\)</span> - відношення показів до кліків у контрольній групі</li>
<li>Краща чутливість</li>
<li>Можемо використовувати звичні тести</li>
</ul>
</section>
<section id="лінеризація-1" class="slide level2">
<h2>Лінеризація</h2>
<div id="cell-ctr-linear" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="" aria-hidden="true" tabindex="-1"></a>coef <span class="op">=</span> df[df.group <span class="op">==</span> <span class="dv">0</span>].clicks.<span class="bu">sum</span>() <span class="op">/</span> df[df.group <span class="op">==</span> <span class="dv">0</span>].views.<span class="bu">sum</span>()</span>
<span id="cb49-2"><a href="" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'linearized_clicks'</span>] <span class="op">=</span> df.clicks <span class="op">-</span> coef <span class="op">*</span> df.views</span>
<span id="cb49-3"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'linearized_clicks'</span>], bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb49-5"><a href="" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src=".03_files/figure-revealjs/ctr-linear-output-1.svg" id="ctr-linear" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="лінеризація-2" class="slide level2">
<h2>Лінеризація</h2>
<p>Рахуємо статистику:</p>
<div id="cell-ctr-linear-2" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="" aria-hidden="true" tabindex="-1"></a>mannwhitneyu(df[df.group <span class="op">==</span> <span class="dv">0</span>].linearized_clicks, df[df.group <span class="op">==</span> <span class="dv">1</span>].linearized_clicks)</span></code><button title="Скопіювати текст" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="ctr-linear-2" class="cell-output cell-output-display" data-execution_count="46">
<pre><code>MannwhitneyuResult(statistic=12647800.5, pvalue=0.3014032934643708)</code></pre>
</div>
</div>
</section></section>
<section id="дякую-за-увагу" class="title-slide slide level1 center" data-background-color="#eef3f8">
<h1>Дякую за увагу!</h1>
<p><br> <br></p>
<p><iconify-icon inline="" icon="ic:baseline-telegram"></iconify-icon> <a href="https://t.me/araprof"><span class="citation" data-cites="araprof">@araprof</span></a></p>
<p><iconify-icon inline="" icon="mdi:youtube"></iconify-icon> <a href="https://www.youtube.com/@datamirosh"><span class="citation" data-cites="datamirosh">@datamirosh</span></a></p>
<p><iconify-icon inline="" icon="ion:home"></iconify-icon> <a href="https://aranaur.rbind.io">aranaur.rbind.io</a></p>
<p><iconify-icon inline="" icon="mdi:github"></iconify-icon> <a href="https://github.com/Aranaur">aranaur</a></p>
<p><iconify-icon inline="" icon="mdi:envelope"></iconify-icon> <a href="mailto:ihor.miroshnychenko@knu.ua" class="email">ihor.miroshnychenko@knu.ua</a></p>
<p><iconify-icon inline="" icon="mdi:linkedin"></iconify-icon> <a href="https://www.linkedin.com/in/ihormiroshnychenko/">ihormiroshnychenko</a></p>
<div class="quarto-auto-generated-content">
<p><img src="img/fit.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>🔗 <a href="https://aranaur.rbind.io/lectures/asa/">Матеріали курсу</a></p>
</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src=".03_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src=".03_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src=".03_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src=".03_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src=".03_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src=".03_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src=".03_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src=".03_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src=".03_files/libs/revealjs/plugin/search/search.js"></script>
  <script src=".03_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src=".03_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': true,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1350,

        height: 759.375,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Скопійовано!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Скопійовано!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>