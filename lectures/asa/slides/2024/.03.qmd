---
title: "$Z$-–∫—Ä–∏—Ç–µ—Ä—ñ–π"
subtitle: "–ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑"
author: "–Ü–≥–æ—Ä –ú—ñ—Ä–æ—à–Ω–∏—á–µ–Ω–∫–æ"
institute: –ö–ù–£ —ñ–º–µ–Ω—ñ –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞, –§–Ü–¢
from: markdown+emoji
title-slide-attributes:
    data-background-iframe: .03_files/libs/colored-particles/index.html
language: _language-ua.yml
footer: <a href="https://aranaur.rbind.io/lectures/asa/">üîó–ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</a>
format:
  revealjs: 
    code-line-numbers: false
    # center: true
    navigation-mode: vertical
    transition: fade
    background-transition: fade
    # controls-layout: bottom-right
    chalkboard: true
    logo: fit.png
    slide-number: true
    toc: true
    toc-depth: 1
    mouse-wheel: true
    width: 1350  
    height: 759.375
    highlight-style: github
    # fig-width: 9
    # fig-height: 5
    fig-format: svg
    theme: [default, custom.scss]
    mermaid:
      theme: forest
  # gfm:
  #   mermaid-format: png
preload-iframes: true
jupyter: python3
execute: 
  echo: true
  warning: false
editor_options: 
  chunk_output_type: console

revealjs-plugins:
  - verticator
---

```{python}
#| label: setup
#| include: false

# Import libraries
from scipy.stats import (
    norm, binom, expon
)
import numpy as numpy
from seaborn import distplot
from matplotlib import pyplot
import seaborn
import random

from IPython.display import Markdown
from tabulate import tabulate

# Define colors
red_pink   = "#e64173"
turquoise  = "#20B2AA"
orange     = "#FFA500"
red        = "#fb6107"
blue       = "#181485"
navy       = "#150E37FF"
green      = "#8bb174"
yellow     = "#D8BD44"
purple     = "#6A5ACD"
slate      = "#314f4f"
```

# –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—ñ—Ö {background-iframe=".03_files/libs/colored-particles/index.html"}

## –ù–∞–≤—ñ—â–æ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–µ—Ä–µ–¥–Ω—ñ?

1. –ü—Ä–∏—Ä—ñ—Å—Ç –≤–∏—Ä—É—á–∫–∏. 
    - –Ø–∫—â–æ –∑—Ä–æ—Å—Ç–∞—î —Å—É–º–∞—Ä–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è $\rightarrow$ –∑—Ä–æ—Å—Ç–∞—î —Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è. –¢–æ–º—É —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏ —è–∫ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —á–µ–∫–∞, –∞–±–æ ARPU.
2. –ó–±—ñ–ª—å—à–µ–Ω–Ω—è —á–∏—Å–ª–∞ –ø–æ–∫—É–ø–æ–∫.
3. –ó–º–µ–Ω—à–µ–Ω–Ω—è –≤—ñ–¥—Ç–æ–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

–î–∞–ª—ñ, –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤—Å—ñ—Ö –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω [–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª]{.hi}. *–ü–æ—Ç–æ–º—É —â–æ —Å–∞–º–µ —Ü—å–æ–º—É —Ä–æ–∑–ø–æ–¥—ñ–ª—É –ø—ñ–¥–ø–æ—Ä—è–¥–∫–æ–≤—É—î—Ç—å—Å—è —Å–µ—Ä–µ–¥–Ω—î –≤–∏–±—ñ—Ä–æ–∫*.

## –ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª {.tiny}

[–ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª]{.hi} $\xi \sim \mathcal{N}(\mu, \sigma^2)$ --- –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª, —É —è–∫–æ–º—É —â—ñ–ª—å–Ω—ñ—Å—Ç—å —Å–ø–∞–¥–∞—î –∑—ñ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è–º –≤—ñ–¥—Å—Ç–∞–Ω—ñ –≤—ñ–¥ $\mu$ –∑–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–æ—é –∫–≤–∞–¥—Ä–∞—Ç–∞.

$$
f(x) = \frac{1}{\sigma\sqrt{2\pi}} \exp^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2}
$$

–¥–µ

- $\mu$ --- –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–º—ñ—â–µ–Ω–Ω—è: –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ü–µ–Ω—Ç—Ä –∑—Å—É–Ω—É—Ç–∏–π –≤—ñ–¥–Ω–æ—Å–Ω–æ 0
- $\sigma^2$ --- –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞—Å—à—Ç–∞–±—É: –Ω–∞—Å–∫—ñ–ª—å–∫–∏ ¬´–ø–æ–ª–æ–≥–∏–º¬ª –±—É–¥–µ –≥—Ä–∞—Ñ—ñ–∫ —Ä–æ–∑–ø–æ–¥—ñ–ª—É

```{python}
#| label: normal_distribution-plot
#| echo: false
#| fig-align: center

# Parameters
params = [
    (0, 0.2),
    (0, 1),
    (0, 5),
    (-2, 0.5)
]

# Create figure
fig, ax = pyplot.subplots(figsize=(10, 6))

# Plot
for mu, sigma in params:
    x = numpy.linspace(-4, 4, 1000)
    y = (1 / (sigma * numpy.sqrt(2 * numpy.pi))) * numpy.exp(-0.5 * ((x - mu) / sigma) ** 2)
    ax.plot(x, y, label=f"$\mu={mu}, \sigma={sigma}$")

# Add legend
ax.legend()

# Show plot
pyplot.show()
```

## Python —Ç–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª

–ù–µ—Ö–∞–π –º–∏ —Ö–æ—á–µ–º–æ –∑–∞–¥–∞—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª $\mathcal{N}(\mu, \sigma^2)$. –î–ª—è —Ü—å–æ–≥–æ —î [–∫–ª–∞—Å](https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.norm.html) `norm`. 

*–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó*

- `loc` --- —Ü–µ $\mu$
- `scale` --- —Ü–µ $\sigma$, –∞–±–æ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è**. [–ù–µ –¥–∏—Å–ø–µ—Ä—Å—ñ—è!]{.red}

–ú–µ—Ç–æ–¥–∏ –∫–ª–∞—Å—É:

- `norm().cdf(x)` --- —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –≤ —Ç–æ—á—Ü—ñ x. $P(\xi \leq x)$
- `norm().ppf(q)` --- –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–≤–∞–Ω—Ç–∏–ª—å —Ä–æ–∑–ø–æ–¥—ñ–ª—É
- `norm().pdf(x)` --- –æ—Ç—Ä–∏–º–∞—Ç–∏ —â—ñ–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–∑–ø–æ–¥—ñ–ª—É –≤ —Ç–æ—á—Ü—ñ x.

## Python —Ç–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª {.smaller}

```{python}
#| label: normal-distribution-cumulative

# —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
stand_norm = norm(loc=0, scale=1)

# –∫—É–º—É–ª—è—Ç–∏–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É
print(f"P(X <= 2)  = {stand_norm.cdf(x=2)}")
print(f"–∏–ª–∏ —Ç–∞–∫ {norm(loc=0, scale=1).cdf(x=2)}")
# –º–æ–∂–Ω–∞ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –º–∞—Å–∏–≤–∏
print(f"[P(X <= 2), P(X <= -1)] = {stand_norm.cdf([2, -1])}")
```

\

```{python}
#| label: normal-distribution-percent

# –∫–≤–∞–Ω—Ç–∏–ª—å
print(f"quantile 0.975 = {stand_norm.ppf(0.975)}")
```

\

```{python}
#| label: normal-distribution-probability

# —â—ñ–ª—å–Ω—ñ—Å—Ç—å
print(f"pdf(0) = {stand_norm.pdf(0)}")
```

## Python —Ç–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª

```{python}
#| label: normal-distribution-plot
#| fig-align: center
#| code-fold: true

numpy.random.seed(2024)

check_distr = norm(loc=0, scale=2)
x = numpy.linspace(-8, 8, 1000) # —Ä–æ–∑—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Ä—ñ–≤–Ω–∏—Ö –≤—ñ–¥—Å—Ç–∞–Ω—è—Ö –æ–¥–Ω–∞ –≤—ñ–¥ –æ–¥–Ω–æ—ó 1000 —Ç–æ—á–æ–∫ –≤—ñ–¥ -8 –¥–æ 8
pdf = check_distr.pdf(x)
cdf = check_distr.cdf(x)
sample = check_distr.rvs(10000)

pyplot.figure(figsize=(22, 5))

pyplot.subplot(1, 2, 1)
pyplot.title('–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —â—ñ–ª—å–Ω–æ—Å—Ç—ñ', fontsize=12, color=slate)
pyplot.hist(sample, bins='auto', density=True, alpha=0.6, label='–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è') # rvs
pyplot.plot(x, pdf, label='—â—ñ–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–∑–ø–æ–¥—ñ–ª—É') # pdf
pyplot.legend(fontsize=12)
pyplot.subplot(1, 2, 2)
pyplot.plot(x, cdf) # cdf
pyplot.show()
```

## –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É

1. $\xi_1 \sim \mathcal{N}(\mu_1, \sigma_1^2),\ \xi_2 \sim \mathcal{N}(\mu_2, \sigma_2^2) \Rightarrow \\ \xi_1 + \xi_2 \sim \mathcal{N}(\mu_1 + \mu_2, \sigma_1^2 + \sigma_2^2)$[^1]
<br><br>

2. $a \xi_1 \sim \mathcal{N}(a\mu_1, a^2\sigma_1^2)$

[^1]: [–î–æ–≤–µ–¥–µ–Ω–Ω—è](https://en.wikipedia.org/wiki/Sum_of_normally_distributed_random_variables#:~:text=This%20means%20that%20the%20sum,squares%20of%20the%20standard%20deviations)

## Python —Ç–∞ –ø–µ—Ä—à–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É

```{python}
#| label: normal-distribution-sum

# –ø—Ä–∏–∫–ª–∞–¥–∏
first_mean = 3
first_var = 4

second_mean = -1
second_var = 2

first_dist = norm(loc=first_mean, scale=numpy.sqrt(first_var))
second_dist = norm(loc=second_mean, scale=numpy.sqrt(second_var))
# –í–∞–∂–ª–∏–≤–æ scale=numpy.sqrt(first_var + second_var)
checking_sum_distr = norm(loc=first_mean + second_mean, scale=numpy.sqrt(first_var + second_var))
```

1. –ó–≥–µ–Ω–µ—Ä—É—î–º–æ –≤–∏–±—ñ—Ä–∫—É –∑ 1 —ñ 2 —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ–≤ —Ç–∞ –ø—ñ–¥—Å—É–º—É—î–º–æ —ó—Ö.
2. –î–∞–ª—ñ, –ø–æ–±—É–¥—É—î–º–æ –µ–º–ø—ñ—Ä–∏—á–Ω—É —â—ñ–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–∑–ø–æ–¥—ñ–ª—É —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è—î–º–æ —ó—ó –∑—ñ —Å–ø—Ä–∞–≤–∂–Ω—å–æ—é –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫—É.

## Python —Ç–∞ –ø–µ—Ä—à–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É

```{python}
#| label: normal-distribution-sum-plot
#| fig-align: center
#| code-fold: true
#| 

first_sample = first_dist.rvs(10000)
second_sample = second_dist.rvs(10000)
sum_sample = first_sample + second_sample

x = numpy.linspace(-8, 12, 1000)

pyplot.figure(figsize=(10, 5))
pyplot.title('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ–≤', fontsize=12)
# –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –±—É–¥—É—î —è–∫ –≥—ñ—Å—Ç–æ—Ä–≥–∞–º–º—É –∑–Ω–∞—á–µ–Ω—å, —Ç–∞–∫ —ñ –µ–º–ø—ñ—Ä–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª
distplot(sum_sample, label='–ï–º–ø—ñ—Ä–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª')
pyplot.plot(x, checking_sum_distr.pdf(x), label='–ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª')
pyplot.legend(fontsize=12)
pyplot.xlabel('X', fontsize=12)
pyplot.ylabel('–©—ñ–ª—å–Ω—ñ—Å—Ç—å', fontsize=12)
pyplot.show()
```

## –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω–∞ —Ç–µ–æ—Ä–µ–º–∞ {.smaller}

–ù–µ—Ö–∞–π $\xi_1, ..., \xi_n$ --- **–Ω–µ–∑–∞–ª–µ–∂–Ω–æ** –æ–¥–Ω–∞–∫–æ–≤–æ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ –≤–∏–ø–∞–¥–∫–æ–≤—ñ –≤–µ–ª–∏—á–∏–Ω–∏, –≤ —è–∫–∏—Ö —ñ—Å–Ω—É—é—Ç—å –º–∞—Ç. —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è —Ç–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—è: 

- $E [\xi_i] = \mu < \infty$
- $Var[\xi_i] = \sigma^2 < \infty$. 

–¢–æ–¥—ñ $\sqrt{n}\dfrac{\overline \xi - \mu}{\sqrt{\sigma^2}}$ [—Å—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞ —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º](https://en.wikipedia.org/wiki/Convergence_in_distribution) –¥–æ $\mathcal{N}(0, 1)$.

## –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω–∞ —Ç–µ–æ—Ä–µ–º–∞ {.tiny}

- $\xi$ --- –≤–∏–ø–∞–¥–∫–æ–≤–∞ –≤–µ–ª–∏—á–∏–Ω–∞ –∑ –Ω–µ–≤—ñ–¥–æ–º–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º.
- $\mathbb{E}(\xi) = \mu$ --- –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è.
- $\text{Var}(\xi) = \sigma^2$ --- –¥–∏—Å–ø–µ—Ä—Å—ñ—è.

. . .

<br>

- $\sum_{i=1}^n \xi_i \sim \mathcal{N}(n\mu, n\sigma^2)$

. . .

- $\frac{\sum_{i=1}^n \xi_i}{n} = \bar{\xi} \sim \mathcal{N}(\mu, \frac{\sigma^2}{n})$

. . .

–ü—Ä–∏–≤–µ–¥–µ–º–æ —Ü–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É: –≤—ñ–¥–Ω—ñ–º–µ–º–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ–¥—ñ–ª–∏–º–æ –Ω–∞ $\frac{\sigma}{\sqrt{n}}$.

- $\bar{\xi} - \mu \sim \mathcal{N}(0, \frac{\sigma^2}{n})$

. . .

[$$\sqrt{n} \frac{\bar{\xi} - \mu}{\sigma} \sim \mathcal{N}(0, 1)$$]{.hi}

::: {.callout-note icon=false}
–í–∏–ø–∞–¥–∫–æ–≤—ñ –≤–µ–ª–∏—á–∏–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å–ª–∞–±–∫–æ –∑–∞–ª–µ–∂–Ω—ñ –æ–¥–Ω–∞ –≤—ñ–¥ –æ–¥–Ω–æ—ó —ñ –∑–ª–µ–≥–∫–∞ –ø–æ-—Ä—ñ–∑–Ω–æ–º—É —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω–∞ —Ç–µ–æ—Ä–µ–º–∞ –≤—Å–µ —â–µ –±—É–¥–µ [–ø—Ä–∞–≤–∏–ª—å–Ω–æ—é](https://en.wikipedia.org/wiki/Stable_distribution#A_generalized_central_limit_theorem).
:::

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¶–ì–¢ {.tiny .scrollable}

–ì–µ–Ω–µ—Ä—É—î–º–æ $N$ –≤–∏–±—ñ—Ä–æ–∫ –ø–æ $M$ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω—ñ–π:

- –ü–æ –∫–æ–∂–Ω—ñ–π –≤–∏–±—ñ—Ä—Ü—ñ —Ç—Ä–µ–±–∞ –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–æ—Ä–º–æ–≤–∞–Ω—É —Å–µ—Ä–µ–¥–Ω—é –∑–∞ $M$ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏.
- –£ –ø—ñ–¥—Å—É–º–∫—É –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ –≤–∏–±—ñ—Ä–∫—É –∑ N –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
- –í–æ–Ω–∞ —ñ –º–∞—î –±—É—Ç–∏ –∑ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É.

```{python}
#| label: central-limit-theorem-generate
#| code-fold: true

def visualize_CLT(sample_generator, expected_value, variance):
    """
        –§—É–Ω–∫—Ü—ñ—è-–≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ç–æ—Ä –¶–ì–¢. –ë—É–¥—É—î:
            - –≥—ñ—Å—Ç–æ—Ä–≥–∞–º—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¶–ì–¢,
            - –µ–º–ø—ñ—Ä–∏—á–Ω—É —â—ñ–ª—å–Ω—ñ—Å—Ç—å,
            - —â—ñ–ª—å–Ω—ñ—Å—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É.
        –ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
            - sample_generator: —Ñ—É–Ω–∫—Ü—ñ—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–±—ñ—Ä–∫–∏. –ù–µ –ø—Ä–∏–π–º–∞—î –Ω—ñ—á–æ–≥–æ –Ω–∞ –≤—Ö—ñ–¥
            - expected_value: –º–∞—Ç. —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è –≤–∏–±—ñ—Ä–∫–∏
            - variance: –¥–∏—Å–ø–µ—Ä—Å—ñ—è –≤–∏–±—ñ—Ä–∫–∏
    """

    numpy.random.seed(2024)
    N = 5000
    clt_sample = []
    for _ in range(N):
        # –≥–µ–Ω–µ—Ä—É—î–º–æ N —Ä–∞–∑—ñ–≤ –≤–∏–±—ñ—Ä–∫—É
        sample = sample_generator()

        # —Ä–∞—Ö—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑ –¶–ì–¢
        sample_size = len(sample)
        statistic = numpy.sqrt(sample_size) * (numpy.mean(sample) - expected_value) / numpy.sqrt(variance)

        #–∑–±–µ—Ä—ñ–≥–∞—î–º–æ
        clt_sample.append(statistic)

    x = numpy.linspace(-4, 4, 1000)
    pyplot.figure(figsize=(10, 5))
    pyplot.title('–†–æ–∑–ø–æ–¥—ñ–ª —Å–µ—Ä–µ–¥–Ω—ñ—Ö –∑–Ω–∞—á–µ–Ω—å', fontsize=12)
    seaborn.distplot(clt_sample, label='–ï–º–ø—ñ—Ä–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª')
    pyplot.plot(x, norm().pdf(x), label='$\mathcal{N}(0, 1)$')
    pyplot.legend(fontsize=12)
    pyplot.xlabel('X', fontsize=12)
    pyplot.ylabel('–©—ñ–ª—å–Ω—ñ—Å—Ç—å', fontsize=12)
    pyplot.show()
```

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¶–ì–¢: –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª {.tiny}

:::: {.columns}

::: {.column width="50%"}
```{python}
#| label: central-limit-theorem-binomial
#| fig-align: center

def binom_generator(p, n, size):
    return binom(p=p, n=n).rvs(size)

p = 0.01
n = 20
size = 5000

# –º–∏ –æ–±–µ—Ä—Ç–∞—î–º–æ binom_generator –≤ lambda, —â–æ–± —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –ø—Ä–∏–π–º–∞–ª–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞ –≤—Ö—ñ–¥
visualize_CLT(lambda: binom_generator(p, n, size), 
              expected_value = p * n, 
              variance = n * p * (1 - p)
             )
```

<center>üòä</center>


:::

::: {.column width="50%"}
```{python}
#| label: central-limit-theorem-binomial-small
#| fig-align: center

def binom_generator(p, n, size):
    return binom(p=p, n=n).rvs(size)

p = 0.01
n = 20
size = 40

# –º–∏ –æ–±–µ—Ä—Ç–∞—î–º–æ binom_generator –≤ lambda, —â–æ–± —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –ø—Ä–∏–π–º–∞–ª–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞ –≤—Ö—ñ–¥
visualize_CLT(lambda: binom_generator(p, n, size), 
              expected_value = p * n, 
              variance = n * p * (1 - p)
             )
```

<center>ü§®</center>
:::

::::

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¶–ì–¢: –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü—ñ–π–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª {.tiny}

```{python}
#| label: central-limit-theorem-exponential
#| fig-align: center
#| code-fold: true

def expon_generator(expected_value, size):
    return expon(scale=expected_value).rvs(size)

expected_value = 24
size = 400

visualize_CLT(lambda: expon_generator(expected_value, size), 
              expected_value=expected_value, variance=expected_value ** 2)
```

---

<iframe id="clt-example" src="https://aranaur-clt.hf.space/" style="border: none; width: 100%; height: 100%" frameborder="0">

</iframe>

::: footer
[:hugs: Hugging Face: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω–∞ —Ç–µ–æ—Ä–µ–º–∞](https://huggingface.co/spaces/aranaur/CLT)
:::

## –ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω—ñ —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è –¶–ü–¢

$$\begin{align}
\sqrt{n}\dfrac{\overline \xi - \mu}{\sqrt{\sigma^2}} &\sim \mathcal{N}(0, 1) \stackrel{–≤–ª. 2}{\Leftrightarrow}\\
\overline \xi - \mu &\sim \mathcal{N}\left(0, \dfrac{\sigma^2}{n} \right) \Leftrightarrow\\
\dfrac{\underset{i=1}{\overset{n}{\sum}} \xi_i}{n} &\sim \mathcal{N}\left(\mu, \dfrac{\sigma^2}{n} \right) \Leftrightarrow\\
\underset{i=1}{\overset{n}{\sum}} \xi_i &\sim \mathcal{N}\left(n \cdot \mu, n \cdot \sigma^2 \right)
\end{align}$$

# $Z$-–∫—Ä–∏—Ç–µ—Ä—ñ–π –§—ñ—à–µ—Ä–∞ {background-iframe=".03_files/libs/colored-particles/index.html"}

## üìà –ó–∞–¥–∞—á–∞ üöö: [–±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª]{.hi-slate} {.smaller}

- $T(X^n) = \underset{i=1}{\overset{n}{\sum}} X_i,\ T \overset{H_0}{\sim} \text{Binom} (n, \mu_0)$
- –ù–µ—Ö–∞–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è $T(X^n) = t$. –ú–∏–Ω—É–ª–æ–≥–æ —Ä–∞–∑—É 19.
- $\text{p-value} = P_{H_0}(T(X^n) \geq t) = 1 - P_{H_0}(T(X^n) < t)$
- –ê–±–æ, —è–∫—â–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç–∏ –º–æ–≤–æ—é Python `p-value = 1 - binom.cdf(t - 1, n, mu0)`

```{python}
#| label: binomial-p-value

def get_pvalue_by_old_logic(n, mu0, t):
    return 1 - binom.cdf(t-1, n=n, p=mu0)

n = 30
mu0 = 0.5
t = 19

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
```

## üìà –ó–∞–¥–∞—á–∞ üöö: [–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª]{.hi} {.smaller}

- –ó–∞ –¥–æ—Å–∏—Ç—å –≤–µ–ª–∏–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫–∏ $\underset{i=1}{\overset{n}{\sum}} X_i \sim \mathcal{N}\left(n \cdot \mu_0, n \cdot \sigma^2 \right)$,
- $X_i \overset{H_0}{\sim} \text{Bernoulli} (\mu_0)$
- $\sigma^2 = \mu_0 \cdot (1 - \mu_0)$
- $\text{p-–∑–Ω–∞—á–µ–Ω–Ω—è} = P_{H_0}(T(X^n) \geq t)$. 

–ê–±–æ `p-value = 1 - norm(loc=sum_mu, scale=sum_std).cdf(t)`. 

–ü—Ä–∏ —Ü—å–æ–º—É —Ü—å–æ–≥–æ —Ä–∞–∑—É –º–∏ –¥–∏–≤–∏–º–æ—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–µ –≤ —Ç–æ—á—Ü—ñ t-1, —è–∫ —Ä–æ–±–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ, –∞ –≤ —Ç–æ—á—Ü—ñ t. **–¢–∞–∫ —è–∫ —É –Ω–∞—Å –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª, —Ç–æ –Ω–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥–Ω—ñ–º–∞—Ç–∏ 1**:

- —É —Ä–∞–∑—ñ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É: $P(T(X^n) \geq t) = P(T(X^n) > t) = 1 - P(T(X^n) \leq t)$;
- —É —Ä–∞–∑—ñ –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É: $P(T(X^n) \geq t) = 1 - P(T(X^n) \leq t - 1)$.

## –ë—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π vs. –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª {.smaller}

```{python}
#| label: binomial-vs-normal
#| fig-align: center
#| echo: false

n = 30
mu0 = 0.5
t = 19

x = numpy.arange(0, 30)
binom_pmf = binom.pmf(x, n, mu0)
norm_pmf = norm(loc=n*mu0, scale=numpy.sqrt(n*mu0*(1-mu0))).pdf(x)

pyplot.figure(figsize=(10, 5))
pyplot.title('–ë—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π vs. –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª', fontsize=12)
pyplot.bar(x, binom_pmf, alpha=0.6, label='–ë—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª')
pyplot.plot(x, norm_pmf, label='–ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª')
pyplot.legend(fontsize=12)
pyplot.xlabel('X', fontsize=12)
pyplot.ylabel('–©—ñ–ª—å–Ω—ñ—Å—Ç—å', fontsize=12)
pyplot.show()
```

## üìà –ó–∞–¥–∞—á–∞ üöö: [–Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª]{.hi} {.smaller}

```{python}
#| label: normal-p-value

def get_pvalue_by_normal_approx(n, mu0, t):
    sum_mu = n * mu0
    sum_variance = n * mu0 * (1 - mu0)
    sum_std = numpy.sqrt(sum_variance)

    return 1 - norm(loc=sum_mu, scale=sum_std).cdf(t)

normal_dist_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_dist_p_value}")
```

<br><br>

```{python}
#| label: normal-p-value-large

n = 3000
mu0 = 0.5
t = 1544

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_dist_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_dist_p_value}")
```

## $Z$-–∫—Ä–∏—Ç–µ—Ä—ñ–π –§—ñ—à–µ—Ä–∞ {.smaller}

$H_0: \mu = \mu_0\ vs.\ H_1: \mu > \mu_0$

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ $Z(X) = \sqrt{n}\dfrac{\overline X - \mu_0}{\sqrt{\sigma^2}}$
- –ó–∞ –¥–æ—Å–∏—Ç—å –≤–µ–ª–∏–∫–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫–∏ $Z(X) \overset{H_0}{\sim} \mathcal{N}(0, 1)$ (–∑–∞ –¶–ì–¢)
- –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –∫—Ä–∏—Ç–µ—Ä—ñ–π: $\left\{Z(X) \geq z_{1 - \alpha} \right\}$
    - p-value = $1 - \Phi(z)$, –¥–µ $z$ --- —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ $Z(X)$, $\Phi(z)$ --- —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É $\mathcal{N}(0, 1)$
- –î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –∫—Ä–∏—Ç–µ—Ä—ñ–π: $\left\{Z(X) \geq z_{1 - \frac{\alpha}{2}} \right\} \bigcup \left\{Z(X) \leq -z_{1 - \frac{\alpha}{2}} \right\}$
    - p-value = $2\cdot \min \left[{\Phi(z), 1 - \Phi(z)} \right]$, –¥–µ $z$ --- —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ $Z(X)$

## Python —Ç–∞ $Z$-–∫—Ä–∏—Ç–µ—Ä—ñ–π –§—ñ—à–µ—Ä–∞: –º–∞–ª–∞ –≤–∏–±—ñ—Ä–∫–∞

```{python}
#| label: z-test-small

def z_criterion_pvalue(sample_mean, sample_size, mu0, variance):
    Z_statistic = numpy.sqrt(sample_size) * (sample_mean - mu0) / numpy.sqrt(variance)
    return 1 - norm().cdf(Z_statistic)

n = 30
t = 19
mu0 = 0.5
variance = mu0 * (1 - mu0)

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_p_value}")
z_pvalue = z_criterion_pvalue(t/n, n, mu0, variance)
print(f"Z-—Ç–µ—Å—Ç p-value: {z_pvalue}")
```

## Python —Ç–∞ $Z$-–∫—Ä–∏—Ç–µ—Ä—ñ–π –§—ñ—à–µ—Ä–∞: –±—ñ–ª—å—à–∞ –≤–∏–±—ñ—Ä–∫–∞

```{python}
#| label: z-test-large

def z_criterion_pvalue(sample_mean, sample_size, mu0, variance):
    Z_statistic = numpy.sqrt(sample_size) * (sample_mean - mu0) / numpy.sqrt(variance)
    return 1 - norm().cdf(Z_statistic)

n = 3000
t = 1544
mu0 = 0.5
variance = mu0 * (1 - mu0)

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_p_value}")
z_pvalue = z_criterion_pvalue(t/n, n, mu0, variance)
print(f"Z-—Ç–µ—Å—Ç p-value: {z_pvalue}")
```

## –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ—Å—Ç—å {.tiny}

> –ß–∏ –º–æ–∂–Ω–∞ —É—Ç–æ—á–Ω–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ $Z$-—Ç–µ—Å—Ç—É –¥–ª—è –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É –∑–∞ –º–∞–ª–∏—Ö —Ä–æ–∑–º—ñ—Ä—ñ–≤ –≤–∏–±—ñ—Ä–æ–∫?

- $Z$-—Ç–µ—Å—Ç: $p$-–∑–Ω–∞—á–µ–Ω–Ω—è = 0.07
- –¢–æ—á–Ω–∏–π $p$-–∑–Ω–∞—á–µ–Ω–Ω—è = 0.10

–î–ª—è –ø–æ—á–∞—Ç–∫—É –¥–∞–≤–∞–π—Ç–µ –≤—ñ–∑—É–∞–ª—ñ–∑—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é `p-value(t)` –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤, –æ–ø–∏—Å–∞–Ω–∏—Ö –≤–∏—â–µ: 

- `p-value` –∫—Ä–∏—Ç–µ—Ä—ñ—é, –∑–∞—Å–Ω–æ–≤–∞–Ω–æ–≥–æ –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—ñ
    - —Ç—É—Ç –ø—Ä–æ—Å—Ç–∞ —Ñ–æ—Ä–º—É–ª–∞: —Ç—Ä–µ–±–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `1 - norm.cdf(t)`
- `p-value` –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é. –ü–æ—Ä–∞—Ö—É—î–º–æ –π–æ–≥–æ —É 2 –≤–∏–ø–∞–¥–∫–∞—Ö:
    - t &mdash; –Ω–µ—Ü—ñ–ª–µ —á–∏—Å–ª–æ. –†–æ–∑–≥–ª—è–Ω–µ–º–æ –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥—ñ
        - –ù–µ—Ö–∞–π `t=19.5`. 
        p-value $= P(T(X) \geq t) = P(T(X) \geq 19.5) = 1 - P(T(X) < 19.5) =|P(T(X) = 19.5) = 0|= 1 - P(T(X) \leq 19.5)$. –ó–∞—É–≤–∞–∂–∏–º–æ, —â–æ –æ—Å—Ç–∞–Ω–Ω—è –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å &mdash; —Ñ—É–Ω–∫—Ü—ñ—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É. –¢–æ–º—É
            - `p-value = 1 - binom.cdf(t, n, mu0)`
    - t &mdash; —Ü—ñ–ª–µ —á–∏—Å–ª–æ.
        - –ù–µ—Ö–∞–π `t=19`. p-value $= P(T(X) \geq t) = P(T(X) \geq 19) = 1 - P(T(X) < 19) = 1 - P(T(X) \leq 18)$. 
            - `p-value = 1 - binom.cdf(t-1, n, mu0)`
            - –∞ —Ç–∞–∫–æ–∂ `p-value(t) = 1 - binom.cdf(t-a, n, mu0) = p-value(t-a)`, –¥–µ `0 < a < 1`. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, `p-value(19) = p-value(18.9)`.
    - –¢–æ–±—Ç–æ, —â–æ–± –∑–æ–±—Ä–∞–∑–∏—Ç–∏ –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–µ p-value, —Ç—Ä–µ–±–∞ –∑–æ–±—Ä–∞–∑–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `p-value = 1 - binom.cdf(t, n, mu0)`. –ó–Ω–∞—á–µ–Ω–Ω—è p-value —É —Ü—ñ–ª–∏—Ö —Ç–æ—á–∫–∞—Ö –ª–µ–∂–∞—Ç–∏–º—É—Ç—å –Ω–∞ –ø—Ä–∞–≤–∏—Ö –∫—ñ–Ω—Ü—è—Ö –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö –≤—ñ–¥—Ä—ñ–∑–∫—ñ–≤.

## –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ—Å—Ç—å {.tiny}

```{python}
#| label: continuity-correction-def
#| code-fold: true
#| fig-align: center

def cmp_pvalue_binom_and_norm(n, mu0, t, add_to_x=0):
    """
        –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π pvalue —É –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä—ñ—é —ñ –Ω–æ—Ä–º–∞–ª—å–Ω–æ—ó –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—ó.
        –ë—É–¥—É—î –≥—Ä–∞—Ñ—ñ–∫–∏:
            - binom pvalue
            - norm pvalue
            - –≤–µ–ª–∏–∫–∏–º–∏ –∫—Ä–∞–ø–∫–∞–º–∏ –ø–æ–∑–Ω–∞—á–µ–Ω–æ pvalue —É —Ç–æ—á—Ü—ñ t, –æ—Ç—Ä–∏–º–∞–Ω—ñ 2 —Å–ø–æ—Å–æ–±–∞–º–∏.
        –ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
            - n: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å —É –≤–∏–±—ñ—Ä—Ü—ñ
            - mu0: –∫–æ–Ω–≤–µ—Ä—Å—ñ—è –∑–∞ —É–º–æ–≤–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –Ω—É–ª—å–æ–≤–æ—ó –≥—ñ–ø–æ—Ç–µ–∑–∏
            - t: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–æ–∫ –∑ –æ–ø–ª–∞—Ç–æ—é
            - add_to_x: –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ T(X) —É –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ.
    """

    x_axis = numpy.linspace(0, n, 1000)
    dots_to_show = numpy.arange(0, n + 1, 1)
    # –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—É
    sum_mu = n * mu0
    sum_variance = n * mu0 * (1 - mu0)
    sum_std = numpy.sqrt(sum_variance)

    # —Å–∞–º—ñ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏
    binom_dist = binom(n=n, p=mu0)
    norm_dist = norm(loc=sum_mu, scale=sum_std)

    pyplot.figure(figsize=(20, 7))
    pyplot.title('–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è p-value: –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–æ–≥–æ —ñ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ', fontsize=12)
    # –±—É–¥—É—î–º–æ –∫—Ä–∞—Å–∏–≤–∏–π –¥–∏—Å–∫—Ä–µ—Ç–Ω–∏–π –±–µ—Ä–Ω—É–ª–ª—ñ—ó–≤—Å—å–∫–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª
    # —Å–ø–æ—á–∞—Ç–∫—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó
    pyplot.hlines(1 - binom_dist.cdf(x_axis[:-1]), x_axis[:-1],
                x_axis[1:], color=slate, linestyle='-')
    # –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó, —è–∫–∏—Ö –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –Ω–µ–º–∞—î
    pyplot.vlines(x_axis[:-1], 1 - binom_dist.cdf(x_axis[:-1]), 1 - binom_dist.cdf(x_axis[1:]),
                color=slate, linestyle=':')
    # –¥–∏—Å–∫—Ä–µ—Ç–Ω—ñ —Ç–æ—á–∫–∏ –≤ —Ä–æ–∑–ø–æ–¥—ñ–ª—ñ
    pyplot.scatter(dots_to_show, 1 - binom_dist.cdf(dots_to_show-1), color=slate, 
                alpha=1, linewidths=0.5,
                label=f'Binom pvalue = 1-binom.cdf(x-1)')
    # pvalue —á–µ—Ä–µ–∑ –±—ñ–Ω–æ–º—ñ–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª
    pyplot.scatter(t, 1 - binom_dist.cdf(t - 1), color=slate, marker='o',
                alpha=1, s=100, label=f'binom p-value({t})')
    # –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª, —â–æ –∞–ø—Ä–æ–∫—Å–∏–º—É—î, –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª
    add_str = "" if add_to_x == 0 else f"{add_to_x}"
    pyplot.plot(x_axis, 1 - norm_dist.cdf(x_axis + add_to_x), color=red_pink, alpha=0.5,
             label=f'Normal pvalue = 1-norm.cdf(x{add_str})')
    # pvalue —á–µ—Ä–µ–∑ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª
    pyplot.scatter(t, 1 - norm_dist.cdf(t + add_to_x), color=red_pink, 
                alpha=1, marker='o', s=100, label=f'norm p-value({t})')

    pyplot.legend(fontsize=12)
    pyplot.xlabel('t', fontsize=12)
    pyplot.ylabel('p-value', fontsize=12)
    pyplot.show()

cmp_pvalue_binom_and_norm(30, 0.5, 15)
```

- $p_{\text{binom}} > p_{\text{norm}}$
- –ü—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤–∏–±—ñ—Ä–∫–∏ —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–±—ñ–≥–∞—é—Ç—å—Å—è.

## –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ—Å—Ç—å {.tiny}

```{python}
#| label: continuity-correction-difference-1

n = 20
t = 10

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_dist_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_dist_p_value}")
print(f"–†—ñ–∑–Ω–∏—Ü—è: {round(abs(old_p_value - normal_dist_p_value), 3)}")
```

<br>

```{python}
#| label: continuity-correction-difference-2

# –ü—Ä–∏ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—ñ t
n = 20
t = 14

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_dist_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_dist_p_value}")
print(f"–†—ñ–∑–Ω–∏—Ü—è: {round(abs(old_p_value - normal_dist_p_value), 3)}")
```

<br>

```{python}
#| label: continuity-correction-difference-3

# –ü—Ä–∏ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—ñ n
n = 200
t = 100

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_dist_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_dist_p_value}")
print(f"–†—ñ–∑–Ω–∏—Ü—è: {round(abs(old_p_value - normal_dist_p_value), 3)}")
```

## –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ—Å—Ç—å

$$F_{\text{new}}(x) = F_{\text{old}}(x - 0.5)$$ 

```{python}
#| label: continuity-correction-correction
#| fig-align: center

cmp_pvalue_binom_and_norm(30, 0.5, 15, add_to_x=-0.5)
```

## –ü–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ—Å—Ç—å {.smaller}

```{python}
#| label: continuity-correction-def-2

def get_pvalue_by_normal_approx_with_addition(n, mu0, t):
    sum_mu = n * mu0
    sum_variance = n * mu0 * (1 - mu0)
    sum_std = numpy.sqrt(sum_variance)

    return 1 - norm(loc=sum_mu, scale=sum_std).cdf(t - 0.5)
```
<br>

```{python}
#| label: continuity-correction-difference-4

n = 30
mu0 = 0.5
t = 19

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_dist_p_value = get_pvalue_by_normal_approx(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º: {normal_dist_p_value}")
normal_with_add_p_value = get_pvalue_by_normal_approx_with_addition(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º —ñ–∑ –ø–æ–ø—Ä–∞–≤–∫–æ—é: {normal_with_add_p_value}")
```

## –ü–æ–ø—Ä–∞–≤–∫–∞ —Ç–∞ –∫—Ä–∏—Ç–µ—Ä—ñ–π –§—ñ—à–µ—Ä–∞ {.smaller}

```{python}
#| label: z-test-small-cc

def z_criterion_pvalue(sample_mean, sample_size, mu0, variance, use_continuity_correction=False):
    if use_continuity_correction:
        # –∫–æ—Ä–∏–≥—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è —Å—É–º–∏, —è–∫ —Ä–æ–±–∏–ª–∏ —Ü–µ —Ä–∞–Ω—ñ—à–µ
        sample_mean = (sample_mean * sample_size - 1/2) / sample_size
    Z_statistic = numpy.sqrt(sample_size) * (sample_mean - mu0) / numpy.sqrt(variance)
    return 1 - norm().cdf(Z_statistic) 
```

–ü–µ—Ä–µ–≥–ª—è–Ω–µ–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –º–∞–ª–æ—ó –≤–∏–±—ñ—Ä–∫–∏:

```{python}
#| label: z-test-small-cc-results

n = 30
t = 19
mu0 = 0.5
variance = mu0 * (1 - mu0)

old_p_value = get_pvalue_by_old_logic(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–∞ —Å—Ç–∞—Ä–æ—é, –∫–æ—Ä–µ–∫—Ç–Ω–æ—é —Ñ–æ—Ä–º—É–ª–æ—é: {old_p_value}")
normal_with_add_p_value = get_pvalue_by_normal_approx_with_addition(n, mu0, t)
print(f"p-value, –æ—Ç—Ä–∏–º–∞–Ω–µ –∑ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—å–Ω–∏–º —Ä–æ–∑–ø–æ–¥—ñ–ª–æ–º —ñ–∑ –ø–æ–ø—Ä–∞–≤–∫–æ—é: {normal_with_add_p_value}")
z_pvalue = z_criterion_pvalue(t/n, n, mu0, variance, use_continuity_correction=True)
print(f"Z-—Ç–µ—Å—Ç p-value: {z_pvalue}")
```

## –ü—ñ–¥—Å—É–º–æ–∫

–£ —Ü—å–æ–º—É –∑–∞–Ω—è—Ç—Ç—ñ –º–∏:

- –ü—Ä–∏–≥–∞–¥–∞–ª–∏, —â–æ —Ç–∞–∫–µ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª —ñ —è–∫—ñ –≤ –Ω—å–æ–≥–æ —î –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ.
- –ó–≥–∞–¥–∞–ª–∏, —è–∫ —Ñ–æ—Ä–º—É–ª—é—î—Ç—å—Å—è –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω–∞ —Ç–µ–æ—Ä–µ–º–∞ —ñ —è–∫ —ó—ó –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏.
- –î—ñ–∑–Ω–∞–ª–∏—Å—è –ø—Ä–æ $Z$-–∫—Ä–∏—Ç–µ—Ä—ñ–π –§—ñ—à–µ—Ä–∞ —ñ —Ä–æ–∑–≤'—è–∑–∞–ª–∏ –∑–∞ –π–æ–≥–æ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞–¥–∞—á—É –ø—Ä–æ –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó.
    - –ö—Ä—ñ–º —Ç–æ–≥–æ, –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ –ø–æ–±–∞—á–∏–ª–∏, —â–æ —Ç–∞–∫–µ –ø–æ–ø—Ä–∞–≤–∫–∞ –Ω–∞ –Ω–µ–ø–µ—Ä–µ—Ä–≤–Ω—ñ—Å—Ç—å —ñ –Ω–∞–≤—ñ—â–æ –≤–æ–Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∞.
    - –Ñ–¥–∏–Ω–µ –∞–ª–µ: [–≤ —Ü—å–æ–º—É –∫—Ä–∏—Ç–µ—Ä—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏ –¥–∏—Å–ø–µ—Ä—Å—ñ—é –≤–∏–±—ñ—Ä–∫–∏. –ê–ª–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ –≤–æ–Ω–∞ –Ω–µ –∑–∞–≤–∂–¥–∏ –≤—ñ–¥–æ–º–∞]{.hi}.

# –î—è–∫—É—é –∑–∞ —É–≤–∞–≥—É! {.unnumbered .unlisted background-iframe=".03_files/libs/colored-particles/index.html"}

<br> <br>

{{< iconify solar book-bold >}} [–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –∫—É—Ä—Å—É](https://aranaur.rbind.io/lectures/asa/)

{{< iconify mdi envelope >}} ihor.miroshnychenko\@knu.ua

{{< iconify ic baseline-telegram >}} [Data Mirosh](https://t.me/araprof)

{{< iconify mdi linkedin >}} [\@ihormiroshnychenko](https://www.linkedin.com/in/ihormiroshnychenko/)

{{< iconify mdi github >}} [\@aranaur](https://github.com/Aranaur)

{{< iconify ion home >}} [aranaur.rbind.io](https://aranaur.rbind.io)
